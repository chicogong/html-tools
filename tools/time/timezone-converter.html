<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时区转换器 - WebUtils</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            color: #888;
            font-size: 0.95rem;
        }
        .current-time {
            background: rgba(52,152,219,0.1);
            border: 1px solid rgba(52,152,219,0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .current-time-label {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 5px;
        }
        .current-time-value {
            font-size: 2rem;
            font-weight: 300;
            color: #3498db;
            font-family: 'Monaco', monospace;
        }
        .input-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .input-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }
        .input-group label {
            font-size: 0.85rem;
            color: #888;
        }
        input[type="datetime-local"],
        select {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px 15px;
            color: #e8e8e8;
            font-size: 1rem;
            width: 100%;
        }
        input[type="datetime-local"]:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52,152,219,0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8e8e8;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .timezone-list {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .timezone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .timezone-title {
            font-size: 1.1rem;
            color: #9b59b6;
        }
        .timezone-grid {
            display: grid;
            gap: 12px;
        }
        .timezone-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px 20px;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .timezone-card:hover {
            border-color: rgba(155,89,182,0.3);
            background: rgba(155,89,182,0.1);
        }
        .timezone-card.highlight {
            border-color: rgba(52,152,219,0.5);
            background: rgba(52,152,219,0.1);
        }
        .tz-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .tz-name {
            font-weight: 600;
            font-size: 1rem;
        }
        .tz-offset {
            font-size: 0.8rem;
            color: #888;
        }
        .tz-time {
            text-align: right;
        }
        .tz-time-value {
            font-size: 1.3rem;
            font-weight: 300;
            font-family: 'Monaco', monospace;
            color: #3498db;
        }
        .tz-date {
            font-size: 0.8rem;
            color: #888;
        }
        .tz-day-diff {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }
        .tz-day-diff.same {
            background: rgba(46,204,113,0.2);
            color: #2ecc71;
        }
        .tz-day-diff.prev {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
        }
        .tz-day-diff.next {
            background: rgba(52,152,219,0.2);
            color: #3498db;
        }
        .remove-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .timezone-card:hover .remove-btn {
            opacity: 1;
        }
        .remove-btn:hover {
            color: #e74c3c;
        }
        .add-timezone {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        .add-timezone select {
            flex: 1;
        }
        .quick-zones {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .quick-zone {
            padding: 6px 12px;
            background: rgba(155,89,182,0.2);
            border: 1px solid rgba(155,89,182,0.3);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quick-zone:hover {
            background: rgba(155,89,182,0.3);
        }
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #666;
            font-size: 0.85rem;
        }
        footer a {
            color: #3498db;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>时区转换器</h1>
            <p class="subtitle">在不同时区之间转换时间，方便跨时区协作</p>
        </header>

        <div class="current-time">
            <div class="current-time-label">当前时间 (本地)</div>
            <div class="current-time-value" id="currentTime">--:--:--</div>
        </div>

        <div class="input-section">
            <div class="input-row">
                <div class="input-group">
                    <label>选择时间</label>
                    <input type="datetime-local" id="inputTime">
                </div>
                <div class="input-group">
                    <label>源时区</label>
                    <select id="sourceTimezone"></select>
                </div>
                <button class="btn btn-primary" onclick="convertTime()">转换</button>
                <button class="btn btn-secondary" onclick="useNow()">使用当前时间</button>
            </div>
        </div>

        <div class="timezone-list">
            <div class="timezone-header">
                <span class="timezone-title">目标时区</span>
            </div>
            <div class="timezone-grid" id="timezoneGrid"></div>
            
            <div class="add-timezone">
                <select id="addTimezoneSelect"></select>
                <button class="btn btn-secondary" onclick="addTimezone()">添加时区</button>
            </div>

            <div class="quick-zones">
                <span class="quick-zone" onclick="addQuickZone('Asia/Shanghai')">北京</span>
                <span class="quick-zone" onclick="addQuickZone('America/New_York')">纽约</span>
                <span class="quick-zone" onclick="addQuickZone('America/Los_Angeles')">洛杉矶</span>
                <span class="quick-zone" onclick="addQuickZone('Europe/London')">伦敦</span>
                <span class="quick-zone" onclick="addQuickZone('Europe/Paris')">巴黎</span>
                <span class="quick-zone" onclick="addQuickZone('Asia/Tokyo')">东京</span>
                <span class="quick-zone" onclick="addQuickZone('Asia/Singapore')">新加坡</span>
                <span class="quick-zone" onclick="addQuickZone('Australia/Sydney')">悉尼</span>
            </div>
        </div>

        <footer>
            <a href="../../index.html">返回工具列表</a> · 
            <a href="https://github.com/chicogong/html-tools/blob/master/tools/timezone-converter.html" target="_blank">查看源代码</a>
        </footer>
    </div>

    <script>
        var inputTime = document.getElementById('inputTime');
        var sourceTimezone = document.getElementById('sourceTimezone');
        var addTimezoneSelect = document.getElementById('addTimezoneSelect');
        var timezoneGrid = document.getElementById('timezoneGrid');

        // 常用时区列表
        var timezones = [
            { id: 'Pacific/Honolulu', name: '檀香山', offset: -10 },
            { id: 'America/Anchorage', name: '安克雷奇', offset: -9 },
            { id: 'America/Los_Angeles', name: '洛杉矶', offset: -8 },
            { id: 'America/Denver', name: '丹佛', offset: -7 },
            { id: 'America/Chicago', name: '芝加哥', offset: -6 },
            { id: 'America/New_York', name: '纽约', offset: -5 },
            { id: 'America/Sao_Paulo', name: '圣保罗', offset: -3 },
            { id: 'Atlantic/Reykjavik', name: '雷克雅未克', offset: 0 },
            { id: 'Europe/London', name: '伦敦', offset: 0 },
            { id: 'Europe/Paris', name: '巴黎', offset: 1 },
            { id: 'Europe/Berlin', name: '柏林', offset: 1 },
            { id: 'Europe/Moscow', name: '莫斯科', offset: 3 },
            { id: 'Asia/Dubai', name: '迪拜', offset: 4 },
            { id: 'Asia/Kolkata', name: '孟买', offset: 5.5 },
            { id: 'Asia/Bangkok', name: '曼谷', offset: 7 },
            { id: 'Asia/Singapore', name: '新加坡', offset: 8 },
            { id: 'Asia/Shanghai', name: '北京/上海', offset: 8 },
            { id: 'Asia/Hong_Kong', name: '香港', offset: 8 },
            { id: 'Asia/Taipei', name: '台北', offset: 8 },
            { id: 'Asia/Tokyo', name: '东京', offset: 9 },
            { id: 'Asia/Seoul', name: '首尔', offset: 9 },
            { id: 'Australia/Sydney', name: '悉尼', offset: 11 },
            { id: 'Pacific/Auckland', name: '奥克兰', offset: 13 },
            { id: 'UTC', name: 'UTC', offset: 0 }
        ];

        // 用户选择的时区
        var selectedTimezones = ['Asia/Shanghai', 'America/New_York', 'Europe/London', 'Asia/Tokyo'];

        // 初始化时区选择器
        function initTimezoneSelectors() {
            // 清空选择器
            sourceTimezone.textContent = '';
            addTimezoneSelect.textContent = '';
            
            timezones.forEach(function(tz) {
                var sign = tz.offset >= 0 ? '+' : '';
                var text = tz.name + ' (UTC' + sign + tz.offset + ')';
                
                var option1 = document.createElement('option');
                option1.value = tz.id;
                option1.textContent = text;
                sourceTimezone.appendChild(option1);
                
                var option2 = document.createElement('option');
                option2.value = tz.id;
                option2.textContent = text;
                addTimezoneSelect.appendChild(option2);
            });

            // 默认选择本地时区
            var localTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            var matchingTz = timezones.find(function(tz) {
                return tz.id === localTz;
            });
            if (matchingTz) {
                sourceTimezone.value = matchingTz.id;
            } else {
                sourceTimezone.value = 'Asia/Shanghai';
            }
        }

        // 使用当前时间
        function useNow() {
            var now = new Date();
            var year = now.getFullYear();
            var month = String(now.getMonth() + 1).padStart(2, '0');
            var day = String(now.getDate()).padStart(2, '0');
            var hours = String(now.getHours()).padStart(2, '0');
            var minutes = String(now.getMinutes()).padStart(2, '0');
            inputTime.value = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
            convertTime();
        }

        // 获取时区信息
        function getTimezoneInfo(tzId) {
            return timezones.find(function(tz) {
                return tz.id === tzId;
            }) || { id: tzId, name: tzId, offset: 0 };
        }

        // 格式化时间
        function formatTime(date, tzId) {
            try {
                return date.toLocaleTimeString('zh-CN', {
                    timeZone: tzId,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return '--:--:--';
            }
        }

        // 格式化日期
        function formatDate(date, tzId) {
            try {
                return date.toLocaleDateString('zh-CN', {
                    timeZone: tzId,
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    weekday: 'short'
                });
            } catch (e) {
                return '----/--/--';
            }
        }

        // 获取时区偏移字符串
        function getOffsetString(tzId) {
            try {
                var now = new Date();
                var formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: tzId,
                    timeZoneName: 'shortOffset'
                });
                var parts = formatter.formatToParts(now);
                var tzPart = parts.find(function(p) {
                    return p.type === 'timeZoneName';
                });
                return tzPart ? tzPart.value : '';
            } catch (e) {
                return '';
            }
        }

        // 计算日期差异
        function getDayDiff(date, sourceTz, targetTz) {
            try {
                var sourceDate = new Date(date.toLocaleString('en-US', { timeZone: sourceTz }));
                var targetDate = new Date(date.toLocaleString('en-US', { timeZone: targetTz }));
                var sourceDayStart = new Date(sourceDate.getFullYear(), sourceDate.getMonth(), sourceDate.getDate());
                var targetDayStart = new Date(targetDate.getFullYear(), targetDate.getMonth(), targetDate.getDate());
                var diff = Math.round((targetDayStart - sourceDayStart) / (1000 * 60 * 60 * 24));
                return diff;
            } catch (e) {
                return 0;
            }
        }

        // 转换时间
        function convertTime() {
            var timeValue = inputTime.value;
            if (!timeValue) {
                useNow();
                return;
            }

            var sourceTz = sourceTimezone.value;
            
            // 创建日期对象
            var localDate = new Date(timeValue);
            
            // 渲染时区列表
            renderTimezones(localDate, sourceTz);
            saveState();
        }

        // 渲染时区列表
        function renderTimezones(date, sourceTz) {
            timezoneGrid.textContent = '';

            selectedTimezones.forEach(function(tzId) {
                var tzInfo = getTimezoneInfo(tzId);
                var dayDiff = getDayDiff(date, sourceTz, tzId);
                
                var card = document.createElement('div');
                card.className = 'timezone-card' + (tzId === sourceTz ? ' highlight' : '');
                
                var infoDiv = document.createElement('div');
                infoDiv.className = 'tz-info';
                
                var nameSpan = document.createElement('span');
                nameSpan.className = 'tz-name';
                nameSpan.textContent = tzInfo.name;
                
                var offsetSpan = document.createElement('span');
                offsetSpan.className = 'tz-offset';
                offsetSpan.textContent = tzId + ' ' + getOffsetString(tzId);
                
                infoDiv.appendChild(nameSpan);
                infoDiv.appendChild(offsetSpan);
                
                var timeDiv = document.createElement('div');
                timeDiv.className = 'tz-time';
                
                var timeSpan = document.createElement('span');
                timeSpan.className = 'tz-time-value';
                timeSpan.textContent = formatTime(date, tzId);
                
                if (dayDiff !== 0) {
                    var diffSpan = document.createElement('span');
                    diffSpan.className = 'tz-day-diff ' + (dayDiff > 0 ? 'next' : 'prev');
                    diffSpan.textContent = dayDiff > 0 ? '+' + dayDiff + '天' : dayDiff + '天';
                    timeSpan.appendChild(diffSpan);
                }
                
                var dateSpan = document.createElement('div');
                dateSpan.className = 'tz-date';
                dateSpan.textContent = formatDate(date, tzId);
                
                timeDiv.appendChild(timeSpan);
                timeDiv.appendChild(dateSpan);
                
                var removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'x';
                removeBtn.onclick = function() {
                    removeTimezone(tzId);
                };
                
                card.appendChild(infoDiv);
                card.appendChild(timeDiv);
                card.appendChild(removeBtn);
                
                timezoneGrid.appendChild(card);
            });
        }

        // 添加时区
        function addTimezone() {
            var tzId = addTimezoneSelect.value;
            if (selectedTimezones.indexOf(tzId) === -1) {
                selectedTimezones.push(tzId);
                convertTime();
            }
        }

        // 快速添加时区
        function addQuickZone(tzId) {
            if (selectedTimezones.indexOf(tzId) === -1) {
                selectedTimezones.push(tzId);
                convertTime();
            }
        }

        // 移除时区
        function removeTimezone(tzId) {
            selectedTimezones = selectedTimezones.filter(function(tz) {
                return tz !== tzId;
            });
            convertTime();
        }

        // 更新当前时间显示
        function updateCurrentTime() {
            var now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        }

        // URL 状态持久化
        function saveState() {
            var state = {
                time: inputTime.value,
                source: sourceTimezone.value,
                zones: selectedTimezones
            };
            try {
                var hash = btoa(encodeURIComponent(JSON.stringify(state)));
                history.replaceState(null, '', '#' + hash);
            } catch (e) {
                console.error('保存状态失败:', e);
            }
        }

        function loadState() {
            var hash = window.location.hash.slice(1);
            if (hash) {
                try {
                    var state = JSON.parse(decodeURIComponent(atob(hash)));
                    if (state.time) inputTime.value = state.time;
                    if (state.source) sourceTimezone.value = state.source;
                    if (state.zones && state.zones.length > 0) selectedTimezones = state.zones;
                    convertTime();
                } catch (e) {
                    console.error('加载状态失败:', e);
                    useNow();
                }
            } else {
                useNow();
            }
        }

        // 输入变化时转换
        inputTime.addEventListener('change', convertTime);
        sourceTimezone.addEventListener('change', convertTime);

        // 初始化
        initTimezoneSelectors();
        loadState();
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
    </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è°ƒè‰²æ¿æå–å™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="è°ƒè‰²æ¿æå–å™¨ - WebUtils" />
    <meta name="keywords" content="color-extractor,generator,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/generator/color-extractor.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="è°ƒè‰²æ¿æå–å™¨ - WebUtils" />
    <meta property="og:description" content="è°ƒè‰²æ¿æå–å™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/generator/color-extractor.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="è°ƒè‰²æ¿æå–å™¨ - WebUtils" />
    <meta name="twitter:description" content="è°ƒè‰²æ¿æå–å™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;

        /* å­—ä½“å˜é‡ */
        --font-sans:
          "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --primary-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      }

      [data-theme="dark"] {
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      body {
        font-size: 16px;
        line-height: 1.6;
        min-height: 100vh;
        padding: 2rem;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      header h1 {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: var(--primary-gradient);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--card-shadow);
        transition: transform 0.3s;
        z-index: 1000;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 2rem;
        align-items: start;
      }

      @media (max-width: 900px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }

      .upload-section {
        background: var(--pico-card-background-color);
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: var(--card-shadow);
      }

      .upload-area {
        border: 3px dashed var(--pico-muted-border-color);
        border-radius: 1rem;
        padding: 3rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: var(--pico-card-background-color);
        min-height: 400px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .upload-area:hover {
        border-color: #a8edea;
        background: rgba(168, 237, 234, 0.05);
      }

      .upload-area.dragover {
        border-color: #a8edea;
        background: rgba(168, 237, 234, 0.1);
      }

      .upload-area.has-image {
        padding: 1rem;
      }

      .upload-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }

      #previewImage {
        max-width: 100%;
        max-height: 500px;
        border-radius: 0.5rem;
        cursor: crosshair;
      }

      .palette-section {
        background: var(--pico-card-background-color);
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: var(--card-shadow);
      }

      .control-group {
        margin-bottom: 1.5rem;
      }

      .control-group label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
      }

      .slider-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .slider-group input[type="range"] {
        flex: 1;
      }

      .slider-value {
        min-width: 40px;
        text-align: right;
      }

      .color-palette {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .palette-color {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: transform 0.3s;
        border: 2px solid transparent;
      }

      .palette-color:hover {
        transform: translateX(5px);
        border-color: var(--pico-muted-border-color);
      }

      .color-swatch {
        width: 50px;
        height: 50px;
        border-radius: 0.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .color-info {
        flex: 1;
      }

      .color-hex {
        font-family: var(--font-mono);
        font-weight: bold;
        font-size: 1rem;
      }

      .color-rgb {
        font-size: 0.8rem;
        opacity: 0.7;
      }

      .color-percentage {
        font-size: 0.75rem;
        opacity: 0.5;
      }

      .btn-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .btn-group button {
        flex: 1;
      }

      .btn-primary {
        background: var(--primary-gradient);
        border: none;
      }

      .picked-color {
        background: var(--pico-card-background-color);
        padding: 1rem;
        border-radius: 0.5rem;
        margin-top: 1rem;
        display: none;
      }

      .picked-color.show {
        display: block;
      }

      .picked-preview {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .picked-swatch {
        width: 60px;
        height: 60px;
        border-radius: 0.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .format-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .format-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
        border: 1px solid var(--pico-muted-border-color);
        border-radius: 0.25rem;
        background: transparent;
        cursor: pointer;
      }

      .format-btn:hover {
        background: var(--pico-muted-border-color);
      }

      .algorithm-select {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .algo-btn {
        padding: 0.5rem;
        border: 2px solid var(--pico-muted-border-color);
        border-radius: 0.5rem;
        background: transparent;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s;
      }

      .algo-btn:hover,
      .algo-btn.active {
        border-color: #a8edea;
        background: rgba(168, 237, 234, 0.1);
      }

      .export-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .export-btn {
        padding: 0.5rem;
        border: 2px solid var(--pico-muted-border-color);
        border-radius: 0.5rem;
        background: transparent;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s;
      }

      .export-btn:hover {
        border-color: #a8edea;
        background: rgba(168, 237, 234, 0.1);
      }

      .hidden-canvas {
        display: none;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      è°ƒè‰²æ¿æå–å™¨
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="ğŸŒ“">ğŸŒ“</button>

    <div class="container">
      <header>
        <h1>ğŸ¨ è°ƒè‰²æ¿æå–å™¨</h1>
        <p>ä»å›¾ç‰‡ä¸­æå–ä¸»è¦é¢œè‰²ï¼Œç”Ÿæˆé…è‰²æ–¹æ¡ˆ</p>
      </header>

      <div class="main-content">
        <div class="upload-section">
          <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“·</div>
            <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
            <small>æ”¯æŒ JPGã€PNGã€GIFã€WebP æ ¼å¼</small>
            <small>ç‚¹å‡»å›¾ç‰‡å¯ä»¥å–è‰²</small>
            <input type="file" id="imageUpload" accept="image/*" style="display: none" />
            <img id="previewImage" alt="å›¾ç‰‡é¢„è§ˆ" style="display: none" />
          </div>

          <div class="picked-color" id="pickedColor">
            <h4>å–è‰²ç»“æœ</h4>
            <div class="picked-preview">
              <div class="picked-swatch" id="pickedSwatch"></div>
              <div class="picked-info">
                <div class="color-hex" id="pickedHex">#000000</div>
                <div class="color-rgb" id="pickedRgb">rgb(0, 0, 0)</div>
                <div class="format-buttons">
                  <button class="format-btn" onclick="copyPickedColor('hex')" aria-label="å¤åˆ¶ HEX">
                    å¤åˆ¶ HEX
                  </button>
                  <button class="format-btn" onclick="copyPickedColor('rgb')" aria-label="å¤åˆ¶ RGB">
                    å¤åˆ¶ RGB
                  </button>
                  <button class="format-btn" onclick="copyPickedColor('hsl')" aria-label="å¤åˆ¶ HSL">
                    å¤åˆ¶ HSL
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="palette-section">
          <div class="control-group">
            <label>ğŸ”¢ é¢œè‰²æ•°é‡</label>
            <div class="slider-group">
              <input type="range" id="colorCount" min="3" max="12" value="6" />
              <span class="slider-value" id="colorCountValue">6</span>
            </div>
          </div>

          <div class="control-group">
            <label>âš™ï¸ æå–ç®—æ³•</label>
            <div class="algorithm-select">
              <button class="algo-btn active" data-algo="quantize">é‡åŒ–</button>
              <button class="algo-btn" data-algo="kmeans">K-Means</button>
              <button class="algo-btn" data-algo="median">ä¸­ä½åˆ‡åˆ†</button>
              <button class="algo-btn" data-algo="dominant">ä¸»è‰²</button>
            </div>
          </div>

          <div class="control-group">
            <label>ğŸ¨ æå–çš„é¢œè‰²</label>
            <div class="color-palette" id="colorPalette">
              <p style="text-align: center; opacity: 0.5">ä¸Šä¼ å›¾ç‰‡åæ˜¾ç¤ºé¢œè‰²</p>
            </div>
          </div>

          <div class="control-group">
            <label>ğŸ“¤ å¯¼å‡ºæ ¼å¼</label>
            <div class="export-options">
              <button class="export-btn" onclick="exportPalette('css')" aria-label="CSS å˜é‡">
                CSS å˜é‡
              </button>
              <button class="export-btn" onclick="exportPalette('scss')" aria-label="SCSS">
                SCSS
              </button>
              <button class="export-btn" onclick="exportPalette('json')" aria-label="JSON">
                JSON
              </button>
              <button class="export-btn" onclick="exportPalette('ase')" aria-label="ASE">
                ASE
              </button>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn-primary" onclick="downloadPaletteImage()" aria-label="ğŸ“¥ ä¸‹è½½è‰²å¡å›¾">
              ğŸ“¥ ä¸‹è½½è‰²å¡å›¾
            </button>
          </div>
        </div>
      </div>
    </div>

    <canvas id="hiddenCanvas" class="hidden-canvas"></canvas>

    <script>
      // Theme management
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      };

      const savedTheme = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", savedTheme);

      let state = {
        imageData: null,
        colors: [],
        colorCount: 6,
        algorithm: "quantize",
        pickedColor: null
      };

      const uploadArea = document.getElementById("uploadArea");
      const imageUpload = document.getElementById("imageUpload");
      const previewImage = document.getElementById("previewImage");
      const hiddenCanvas = document.getElementById("hiddenCanvas");
      const ctx = hiddenCanvas.getContext("2d");

      // Upload handling
      uploadArea.addEventListener("click", (e) => {
        if (e.target === previewImage) return;
        imageUpload.click();
      });

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          loadImage(file);
        }
      });

      imageUpload.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) loadImage(file);
      });

      previewImage.addEventListener("click", (e) => {
        if (!state.imageData) return;

        const rect = previewImage.getBoundingClientRect();
        const scaleX = hiddenCanvas.width / rect.width;
        const scaleY = hiddenCanvas.height / rect.height;
        const x = Math.floor((e.clientX - rect.left) * scaleX);
        const y = Math.floor((e.clientY - rect.top) * scaleY);

        const index = (y * hiddenCanvas.width + x) * 4;
        const r = state.imageData.data[index];
        const g = state.imageData.data[index + 1];
        const b = state.imageData.data[index + 2];

        state.pickedColor = { r, g, b };
        showPickedColor();
      });

      window.loadImage = function (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            // Show preview
            previewImage.src = e.target.result;
            previewImage.style.display = "block";
            uploadArea.classList.add("has-image");
            uploadArea.querySelector(".upload-icon").style.display = "none";
            uploadArea.querySelector("p").style.display = "none";
            uploadArea.querySelectorAll("small").forEach((s) => (s.style.display = "none"));

            // Draw to hidden canvas for processing
            const maxSize = 200; // Downsample for performance
            let w = img.width;
            let h = img.height;
            if (w > maxSize || h > maxSize) {
              if (w > h) {
                h = (h / w) * maxSize;
                w = maxSize;
              } else {
                w = (w / h) * maxSize;
                h = maxSize;
              }
            }
            hiddenCanvas.width = w;
            hiddenCanvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            state.imageData = ctx.getImageData(0, 0, w, h);

            extractColors();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      };

      document.getElementById("colorCount").addEventListener("input", (e) => {
        state.colorCount = parseInt(e.target.value);
        document.getElementById("colorCountValue").textContent = e.target.value;
        if (state.imageData) extractColors();
      });

      document.querySelectorAll(".algo-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".algo-btn").forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          state.algorithm = btn.dataset.algo;
          if (state.imageData) extractColors();
        });
      });

      function extractColors() {
        if (!state.imageData) return;

        const pixels = [];
        const data = state.imageData.data;

        for (let i = 0; i < data.length; i += 4) {
          pixels.push([data[i], data[i + 1], data[i + 2]]);
        }

        switch (state.algorithm) {
          case "quantize":
            state.colors = quantizeColors(pixels, state.colorCount);
            break;
          case "kmeans":
            state.colors = kmeansColors(pixels, state.colorCount);
            break;
          case "median":
            state.colors = medianCutColors(pixels, state.colorCount);
            break;
          case "dominant":
            state.colors = dominantColors(pixels, state.colorCount);
            break;
        }

        renderPalette();
      }

      function quantizeColors(pixels, count) {
        const colorMap = {};
        const quantize = 32;

        pixels.forEach(([r, g, b]) => {
          const qr = Math.floor(r / quantize) * quantize;
          const qg = Math.floor(g / quantize) * quantize;
          const qb = Math.floor(b / quantize) * quantize;
          const key = qr + "," + qg + "," + qb;
          colorMap[key] = (colorMap[key] || 0) + 1;
        });

        const sorted = Object.entries(colorMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, count);

        return sorted.map(([key, freq]) => {
          const [r, g, b] = key.split(",").map(Number);
          return { r, g, b, frequency: freq / pixels.length };
        });
      }

      function kmeansColors(pixels, count) {
        let centroids = [];
        for (let i = 0; i < count; i++) {
          centroids.push(pixels[Math.floor(Math.random() * pixels.length)].slice());
        }

        for (let iter = 0; iter < 20; iter++) {
          const clusters = Array(count)
            .fill(null)
            .map(() => []);

          pixels.forEach((pixel) => {
            let minDist = Infinity;
            let closestIdx = 0;

            centroids.forEach((centroid, idx) => {
              const dist = Math.sqrt(
                (pixel[0] - centroid[0]) ** 2 +
                  (pixel[1] - centroid[1]) ** 2 +
                  (pixel[2] - centroid[2]) ** 2
              );
              if (dist < minDist) {
                minDist = dist;
                closestIdx = idx;
              }
            });

            clusters[closestIdx].push(pixel);
          });

          centroids = clusters.map((cluster, i) => {
            if (cluster.length === 0) return centroids[i];
            const sum = cluster.reduce(
              (acc, p) => [acc[0] + p[0], acc[1] + p[1], acc[2] + p[2]],
              [0, 0, 0]
            );
            return [sum[0] / cluster.length, sum[1] / cluster.length, sum[2] / cluster.length];
          });
        }

        return centroids.map((c) => ({
          r: Math.round(c[0]),
          g: Math.round(c[1]),
          b: Math.round(c[2]),
          frequency: 1 / count
        }));
      }

      function medianCutColors(pixels, count) {
        function splitBox(box) {
          const ranges = [0, 1, 2].map((i) => {
            const values = box.map((p) => p[i]);
            return Math.max(...values) - Math.min(...values);
          });

          const maxRange = Math.max(...ranges);
          const splitChannel = ranges.indexOf(maxRange);

          box.sort((a, b) => a[splitChannel] - b[splitChannel]);
          const mid = Math.floor(box.length / 2);
          return [box.slice(0, mid), box.slice(mid)];
        }

        let boxes = [pixels.slice()];

        while (boxes.length < count) {
          boxes.sort((a, b) => b.length - a.length);
          const largest = boxes.shift();
          const [box1, box2] = splitBox(largest);
          boxes.push(box1, box2);
        }

        return boxes.map((box) => {
          const avg = box.reduce(
            (acc, p) => [acc[0] + p[0], acc[1] + p[1], acc[2] + p[2]],
            [0, 0, 0]
          );
          return {
            r: Math.round(avg[0] / box.length),
            g: Math.round(avg[1] / box.length),
            b: Math.round(avg[2] / box.length),
            frequency: box.length / pixels.length
          };
        });
      }

      function dominantColors(pixels, count) {
        const colorMap = {};

        pixels.forEach(([r, g, b]) => {
          const key = r + "," + g + "," + b;
          colorMap[key] = (colorMap[key] || 0) + 1;
        });

        const sorted = Object.entries(colorMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, count * 10);

        // Cluster similar colors
        const result = [];
        sorted.forEach(([key, freq]) => {
          const [r, g, b] = key.split(",").map(Number);
          let found = false;

          for (const color of result) {
            const dist = Math.sqrt((r - color.r) ** 2 + (g - color.g) ** 2 + (b - color.b) ** 2);
            if (dist < 50) {
              found = true;
              break;
            }
          }

          if (!found && result.length < count) {
            result.push({ r, g, b, frequency: freq / pixels.length });
          }
        });

        return result;
      }

      function rgbToHex(r, g, b) {
        return "#" + [r, g, b].map((x) => Math.round(x).toString(16).padStart(2, "0")).join("");
      }

      function rgbToHsl(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          l = (max + min) / 2;

        if (max === min) {
          h = s = 0;
        } else {
          const d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch (max) {
            case r:
              h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
              break;
            case g:
              h = ((b - r) / d + 2) / 6;
              break;
            case b:
              h = ((r - g) / d + 4) / 6;
              break;
          }
        }

        return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
      }

      function getLuminance(r, g, b) {
        return (0.299 * r + 0.587 * g + 0.114 * b) / 255;
      }

      function renderPalette() {
        const container = document.getElementById("colorPalette");
        container.textContent = "";

        state.colors.forEach((color) => {
          const hex = rgbToHex(color.r, color.g, color.b);
          const isLight = getLuminance(color.r, color.g, color.b) > 0.5;

          const div = document.createElement("div");
          div.className = "palette-color";
          div.style.background = isLight ? "#f5f5f5" : "#2a2a2a";

          const swatch = document.createElement("div");
          swatch.className = "color-swatch";
          swatch.style.background = hex;

          const info = document.createElement("div");
          info.className = "color-info";

          const hexDiv = document.createElement("div");
          hexDiv.className = "color-hex";
          hexDiv.textContent = hex;
          hexDiv.style.color = isLight ? "#333" : "#fff";

          const rgbDiv = document.createElement("div");
          rgbDiv.className = "color-rgb";
          rgbDiv.textContent = "rgb(" + color.r + ", " + color.g + ", " + color.b + ")";
          rgbDiv.style.color = isLight ? "#666" : "#aaa";

          const percentDiv = document.createElement("div");
          percentDiv.className = "color-percentage";
          percentDiv.textContent = (color.frequency * 100).toFixed(1) + "%";
          percentDiv.style.color = isLight ? "#999" : "#777";

          info.appendChild(hexDiv);
          info.appendChild(rgbDiv);
          info.appendChild(percentDiv);

          div.appendChild(swatch);
          div.appendChild(info);

          div.addEventListener("click", () => {
            navigator.clipboard.writeText(hex).then(() => {
              alert("é¢œè‰² " + hex + " å·²å¤åˆ¶ï¼");
            });
          });

          container.appendChild(div);
        });
      }

      function showPickedColor() {
        const container = document.getElementById("pickedColor");
        container.classList.add("show");

        const { r, g, b } = state.pickedColor;
        const hex = rgbToHex(r, g, b);

        document.getElementById("pickedSwatch").style.background = hex;
        document.getElementById("pickedHex").textContent = hex;
        document.getElementById("pickedRgb").textContent = "rgb(" + r + ", " + g + ", " + b + ")";
      }

      window.copyPickedColor = function (format) {
        if (!state.pickedColor) return;

        const { r, g, b } = state.pickedColor;
        let value;

        switch (format) {
          case "hex":
            value = rgbToHex(r, g, b);
            break;
          case "rgb":
            value = "rgb(" + r + ", " + g + ", " + b + ")";
            break;
          case "hsl":
            const hsl = rgbToHsl(r, g, b);
            value = "hsl(" + hsl.h + ", " + hsl.s + "%, " + hsl.l + "%)";
            break;
        }

        navigator.clipboard.writeText(value).then(() => {
          alert("å·²å¤åˆ¶: " + value);
        });
      };

      window.exportPalette = function (format) {
        if (state.colors.length === 0) {
          alert("è¯·å…ˆä¸Šä¼ å›¾ç‰‡å¹¶æå–é¢œè‰²");
          return;
        }

        let content;

        switch (format) {
          case "css":
            content = ":root {\n";
            state.colors.forEach((c, i) => {
              content += "    --color-" + (i + 1) + ": " + rgbToHex(c.r, c.g, c.b) + ";\n";
            });
            content += "}";
            break;
          case "scss":
            content = "";
            state.colors.forEach((c, i) => {
              content += "$color-" + (i + 1) + ": " + rgbToHex(c.r, c.g, c.b) + ";\n";
            });
            break;
          case "json":
            content = JSON.stringify(
              state.colors.map((c) => ({
                hex: rgbToHex(c.r, c.g, c.b),
                rgb: { r: c.r, g: c.g, b: c.b },
                frequency: c.frequency
              })),
              null,
              2
            );
            break;
          case "ase":
            alert("ASE æ ¼å¼å¯¼å‡ºæš‚ä¸æ”¯æŒ");
            return;
        }

        navigator.clipboard.writeText(content).then(() => {
          alert(format.toUpperCase() + " æ ¼å¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
        });
      };

      window.downloadPaletteImage = function () {
        if (state.colors.length === 0) {
          alert("è¯·å…ˆä¸Šä¼ å›¾ç‰‡å¹¶æå–é¢œè‰²");
          return;
        }

        const canvas = document.createElement("canvas");
        const width = 800;
        const height = 200;
        canvas.width = width;
        canvas.height = height;
        const c = canvas.getContext("2d");

        const colorWidth = width / state.colors.length;

        state.colors.forEach((color, i) => {
          c.fillStyle = rgbToHex(color.r, color.g, color.b);
          c.fillRect(i * colorWidth, 0, colorWidth, height * 0.7);

          // Text
          const isLight = getLuminance(color.r, color.g, color.b) > 0.5;
          c.fillStyle = isLight ? "#333" : "#fff";
          c.font = "bold 14px sans-serif";
          c.textAlign = "center";
          c.fillText(
            rgbToHex(color.r, color.g, color.b),
            i * colorWidth + colorWidth / 2,
            height * 0.7 - 10
          );
        });

        // Bottom info bar
        c.fillStyle = "#fff";
        c.fillRect(0, height * 0.7, width, height * 0.3);
        c.fillStyle = "#333";
        c.font = "12px sans-serif";
        c.textAlign = "center";
        c.fillText("è°ƒè‰²æ¿æå–å™¨ - " + state.colors.length + " ç§é¢œè‰²", width / 2, height * 0.85);

        const link = document.createElement("a");
        link.download = "palette.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      };

      // Initialize
      renderPalette();
    </script>
  </body>
</html>

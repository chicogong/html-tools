<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹ æƒ¯è¿½è¸ªå™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: white; text-align: center; margin-bottom: 20px; }
        .card { background: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .add-habit { display: flex; gap: 12px; margin-bottom: 20px; }
        .add-habit input { flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
        .add-habit input:focus { outline: none; border-color: #667eea; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .week-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .week-nav button { padding: 8px 16px; background: #f0f0f0; border: none; border-radius: 8px; cursor: pointer; }
        .week-nav button:hover { background: #e0e0e0; }
        .week-title { font-weight: 600; color: #333; }
        .habits-header { display: grid; grid-template-columns: 1fr repeat(7, 40px) 60px; gap: 8px; padding: 12px 0; border-bottom: 2px solid #f0f0f0; margin-bottom: 12px; }
        .day-label { text-align: center; font-size: 12px; color: #666; }
        .day-label.today { color: #667eea; font-weight: bold; }
        .habit-row { display: grid; grid-template-columns: 1fr repeat(7, 40px) 60px; gap: 8px; padding: 12px 0; border-bottom: 1px solid #f0f0f0; align-items: center; }
        .habit-name { font-weight: 500; color: #333; display: flex; align-items: center; gap: 8px; }
        .habit-emoji { font-size: 20px; }
        .day-check { width: 36px; height: 36px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; background: white; }
        .day-check:hover { border-color: #667eea; }
        .day-check.checked { background: linear-gradient(135deg, #667eea, #764ba2); border-color: transparent; color: white; }
        .day-check.today { border-color: #667eea; }
        .streak { font-size: 14px; color: #666; text-align: center; }
        .streak-fire { color: #f5576c; }
        .delete-btn { background: none; border: none; color: #999; cursor: pointer; font-size: 18px; padding: 4px 8px; }
        .delete-btn:hover { color: #f5576c; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; padding: 20px; text-align: center; color: white; }
        .stat-value { font-size: 32px; font-weight: bold; }
        .stat-label { font-size: 13px; opacity: 0.9; margin-top: 4px; }
        .empty { text-align: center; padding: 40px; color: #999; }
        .emoji-picker { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
        .emoji-btn { padding: 8px 12px; background: #f5f5f5; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .emoji-btn:hover { background: #e0e0e0; }
        .emoji-btn.selected { border-color: #667eea; background: #f0e6ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… ä¹ æƒ¯è¿½è¸ªå™¨</h1>
        <div class="card">
            <div class="emoji-picker" id="emojiPicker">
                <button class="emoji-btn selected" data-emoji="ğŸ’ª">ğŸ’ª</button>
                <button class="emoji-btn" data-emoji="ğŸ“š">ğŸ“š</button>
                <button class="emoji-btn" data-emoji="ğŸƒ">ğŸƒ</button>
                <button class="emoji-btn" data-emoji="ğŸ’§">ğŸ’§</button>
                <button class="emoji-btn" data-emoji="ğŸ§˜">ğŸ§˜</button>
                <button class="emoji-btn" data-emoji="ğŸ¯">ğŸ¯</button>
                <button class="emoji-btn" data-emoji="âœï¸">âœï¸</button>
                <button class="emoji-btn" data-emoji="ğŸ">ğŸ</button>
                <button class="emoji-btn" data-emoji="ğŸ˜´">ğŸ˜´</button>
                <button class="emoji-btn" data-emoji="ğŸ¸">ğŸ¸</button>
            </div>
            <div class="add-habit">
                <input type="text" id="habitInput" placeholder="æ·»åŠ æ–°ä¹ æƒ¯ï¼Œå¦‚ï¼šæ¯å¤©è¿åŠ¨30åˆ†é’Ÿ" onkeypress="if(event.key==='Enter')addHabit()">
                <button class="btn btn-primary" onclick="addHabit()">æ·»åŠ ä¹ æƒ¯</button>
            </div>
            
            <div class="week-nav">
                <button onclick="changeWeek(-1)">â† ä¸Šä¸€å‘¨</button>
                <span class="week-title" id="weekTitle"></span>
                <button onclick="changeWeek(1)">ä¸‹ä¸€å‘¨ â†’</button>
            </div>
            
            <div class="habits-header">
                <span></span>
                <span class="day-label" id="day0"></span>
                <span class="day-label" id="day1"></span>
                <span class="day-label" id="day2"></span>
                <span class="day-label" id="day3"></span>
                <span class="day-label" id="day4"></span>
                <span class="day-label" id="day5"></span>
                <span class="day-label" id="day6"></span>
                <span style="font-size: 12px; color: #666; text-align: center;">è¿ç»­</span>
            </div>
            
            <div id="habitsList"></div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalHabits">0</div>
                    <div class="stat-label">ä¹ æƒ¯æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedToday">0</div>
                    <div class="stat-label">ä»Šæ—¥å®Œæˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="longestStreak">0</div>
                    <div class="stat-label">æœ€é•¿è¿ç»­</div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let habits = JSON.parse(localStorage.getItem('habits') || '[]');
        let checks = JSON.parse(localStorage.getItem('habitChecks') || '{}');
        let currentWeekStart = getWeekStart(new Date());
        let selectedEmoji = 'ğŸ’ª';
        
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }
        
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        
        function init() {
            // Emoji picker
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.onclick = () => {
                    document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedEmoji = btn.dataset.emoji;
                };
            });
            
            renderWeek();
            renderHabits();
            updateStats();
        }
        
        function renderWeek() {
            const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
            const today = formatDate(new Date());
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                const dayEl = document.getElementById('day' + i);
                const dateStr = formatDate(date);
                dayEl.textContent = `${days[i]}\n${date.getDate()}`;
                dayEl.classList.toggle('today', dateStr === today);
            }
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            document.getElementById('weekTitle').textContent = 
                `${currentWeekStart.getMonth() + 1}æœˆ${currentWeekStart.getDate()}æ—¥ - ${weekEnd.getMonth() + 1}æœˆ${weekEnd.getDate()}æ—¥`;
        }
        
        function renderHabits() {
            const list = document.getElementById('habitsList');
            const today = formatDate(new Date());
            
            if (habits.length === 0) {
                list.innerHTML = '<div class="empty">è¿˜æ²¡æœ‰ä¹ æƒ¯ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</div>';
                return;
            }
            
            list.innerHTML = habits.map((habit, index) => {
                let daysHtml = '';
                for (let i = 0; i < 7; i++) {
                    const date = new Date(currentWeekStart);
                    date.setDate(date.getDate() + i);
                    const dateStr = formatDate(date);
                    const isChecked = checks[habit.id]?.[dateStr];
                    const isToday = dateStr === today;
                    daysHtml += `
                        <div class="day-check ${isChecked ? 'checked' : ''} ${isToday ? 'today' : ''}" 
                             onclick="toggleCheck('${habit.id}', '${dateStr}')">
                            ${isChecked ? 'âœ“' : ''}
                        </div>
                    `;
                }
                
                const streak = getStreak(habit.id);
                
                return `
                    <div class="habit-row">
                        <div class="habit-name">
                            <span class="habit-emoji">${habit.emoji}</span>
                            <span>${habit.name}</span>
                        </div>
                        ${daysHtml}
                        <div class="streak ${streak >= 3 ? 'streak-fire' : ''}">${streak >= 3 ? 'ğŸ”¥' : ''} ${streak}å¤©</div>
                        <button class="delete-btn" onclick="deleteHabit(${index})">Ã—</button>
                    </div>
                `;
            }).join('');
        }
        
        function addHabit() {
            const input = document.getElementById('habitInput');
            const name = input.value.trim();
            if (!name) return;
            
            habits.push({
                id: Date.now().toString(),
                name: name,
                emoji: selectedEmoji,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            input.value = '';
            renderHabits();
            updateStats();
        }
        
        function deleteHabit(index) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªä¹ æƒ¯å—ï¼Ÿ')) {
                const habitId = habits[index].id;
                habits.splice(index, 1);
                delete checks[habitId];
                saveData();
                renderHabits();
                updateStats();
            }
        }
        
        function toggleCheck(habitId, dateStr) {
            if (!checks[habitId]) checks[habitId] = {};
            checks[habitId][dateStr] = !checks[habitId][dateStr];
            saveData();
            renderHabits();
            updateStats();
        }
        
        function getStreak(habitId) {
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                if (checks[habitId]?.[dateStr]) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            
            return streak;
        }
        
        function changeWeek(delta) {
            currentWeekStart.setDate(currentWeekStart.getDate() + delta * 7);
            renderWeek();
            renderHabits();
        }
        
        function updateStats() {
            const today = formatDate(new Date());
            let completedToday = 0;
            let longestStreak = 0;
            
            habits.forEach(habit => {
                if (checks[habit.id]?.[today]) completedToday++;
                longestStreak = Math.max(longestStreak, getStreak(habit.id));
            });
            
            document.getElementById('totalHabits').textContent = habits.length;
            document.getElementById('completedToday').textContent = completedToday;
            document.getElementById('longestStreak').textContent = longestStreak;
        }
        
        function saveData() {
            localStorage.setItem('habits', JSON.stringify(habits));
            localStorage.setItem('habitChecks', JSON.stringify(checks));
        }
        
        init();
    </script>
</body>
</html>
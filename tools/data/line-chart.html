<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æŠ˜çº¿å›¾ç”Ÿæˆå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="åˆ›å»ºæŠ˜çº¿å›¾å’Œæ›²çº¿å›¾ï¼Œæ”¯æŒå¤šæ•°æ®ç³»åˆ—ã€è‡ªå®šä¹‰æ ‡é¢˜å’Œè½´æ ‡ç­¾ã€å¯¼å‡ºPNG" />
    <meta name="keywords" content="line chart æŠ˜çº¿å›¾ æ›²çº¿å›¾ chart.js æ•°æ®å¯è§†åŒ–" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/data/line-chart.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="æŠ˜çº¿å›¾ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:description" content="åˆ›å»ºæŠ˜çº¿å›¾å’Œæ›²çº¿å›¾ï¼Œæ”¯æŒå¤šæ•°æ®ç³»åˆ—ã€è‡ªå®šä¹‰æ ‡é¢˜å’Œè½´æ ‡ç­¾ã€å¯¼å‡ºPNG" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/data/line-chart.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="æŠ˜çº¿å›¾ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:description" content="åˆ›å»ºæŠ˜çº¿å›¾å’Œæ›²çº¿å›¾ï¼Œæ”¯æŒå¤šæ•°æ®ç³»åˆ—ã€è‡ªå®šä¹‰æ ‡é¢˜å’Œè½´æ ‡ç­¾ã€å¯¼å‡ºPNG" />
    <!-- OG Image -->
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <!-- JSON-LD BreadcrumbList Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "é¦–é¡µ",
            "item": "https://tools.realtime-ai.chat/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "æ•°æ®å·¥å…·",
            "item": "https://tools.realtime-ai.chat/#data"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "æŠ˜çº¿å›¾ç”Ÿæˆå™¨",
            "item": "https://tools.realtime-ai.chat/tools/data/line-chart.html"
          }
        ]
      }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-magenta: #f72585;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-blue: #4cc9f0;
        --accent-purple: #7b2cbf;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --font-sans: "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
        --accent-cyan: #00d4b8;
        --accent-magenta: #e63975;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }
      
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }
      .theme-toggle:hover {
        transform: scale(1.1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-bg-deep);
        color: var(--color-text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      .bg-grid {
        position: fixed;
        inset: 0;
        background-image:
          linear-gradient(rgb(0, 245, 212, 0.02) 1px, transparent 1px),
          linear-gradient(90deg, rgb(0, 245, 212, 0.02) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        padding: 8px 14px;
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        flex-wrap: wrap;
      }

      .breadcrumb a {
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .breadcrumb a:hover {
        color: var(--color-accent-cyan);
      }

      .breadcrumb-separator {
        color: var(--text-muted);
        user-select: none;
      }

      .breadcrumb-current {
        color: var(--color-text-primary);
        font-weight: 500;
      }

      .title-section {
        flex: 1;
      }

      .title-section h1 {
        font-family: var(--font-mono);
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .title-section h1 .icon {
        font-size: 1.8rem;
      }

      .title-section p {
        color: var(--color-text-secondary);
        margin-top: 4px;
        font-size: 0.9rem;
      }

      .main-content {
        background: var(--color-bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 24px;
        flex: 1;
      }

      .tool-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      @media (max-width: 900px) {
        .tool-layout {
          grid-template-columns: 1fr;
        }
      }

      .tool-section {
        margin-bottom: 24px;
      }

      .section-title {
        font-family: var(--font-mono);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-subtle);
      }

      .input-group {
        margin-bottom: 16px;
      }

      .input-label {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-secondary);
        margin-bottom: 8px;
      }

      .input-hint {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 4px;
      }

      input[type="text"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 10px 14px;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-primary);
        transition: border-color 0.2s;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--color-accent-cyan);
      }

      textarea {
        min-height: 180px;
        resize: vertical;
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 600px) {
        .input-row {
          grid-template-columns: 1fr;
        }
      }

      .btn-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .btn {
        flex: 1;
        min-width: 120px;
        padding: 12px 20px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--color-accent-cyan);
        color: var(--color-bg-deep);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px var(--glow-cyan);
      }

      .btn-secondary {
        background: var(--color-bg-surface);
        color: var(--color-text-primary);
        border: 1px solid var(--border-subtle);
      }

      .btn-secondary:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .btn-success {
        background: var(--accent-green);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px var(--glow-green);
      }

      .chart-container {
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 20px;
        min-height: 400px;
        position: relative;
      }

      .chart-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 360px;
        color: var(--text-muted);
        font-family: var(--font-mono);
        font-size: 0.9rem;
      }

      .series-manager {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 16px;
      }

      .series-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
      }

      .series-color {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        padding: 0;
      }

      .series-name {
        flex: 1;
        padding: 8px 12px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        background: var(--color-bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-primary);
      }

      .series-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
        background: transparent;
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .series-btn:hover {
        border-color: var(--accent-red);
        color: var(--accent-red);
      }

      .add-series-btn {
        padding: 10px;
        background: transparent;
        border: 1px dashed var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-secondary);
        cursor: pointer;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        transition: all 0.2s;
      }

      .add-series-btn:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--accent-green);
        color: var(--color-bg-deep);
        padding: 12px 24px;
        border-radius: var(--radius-md);
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }

      .toast.error {
        background: var(--accent-red);
        color: white;
      }

      @media (max-width: 600px) {
        .container {
          padding: 16px;
        }

        .btn-row {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .series-item {
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-grid"></div>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>

    <div class="container">
      <header class="header">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../../index.html">é¦–é¡µ</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">æŠ˜çº¿å›¾ç”Ÿæˆå™¨</span>
        </nav>
        <div class="title-section">
          <h1>
            <span class="icon">ğŸ“ˆ</span>
            æŠ˜çº¿å›¾ç”Ÿæˆå™¨
          </h1>
          <p>åˆ›å»ºæŠ˜çº¿å›¾å’Œæ›²çº¿å›¾ï¼Œæ”¯æŒå¤šæ•°æ®ç³»åˆ—</p>
        </div>
      </header>

      <main class="main-content">
        <div class="tool-layout">
          <!-- å·¦ä¾§ï¼šæ•°æ®è¾“å…¥ -->
          <div class="input-panel">
            <div class="tool-section">
              <div class="section-title">å›¾è¡¨è®¾ç½®</div>
              <div class="input-group">
                <label class="input-label">å›¾è¡¨æ ‡é¢˜</label>
                <input type="text" id="chartTitle" placeholder="æˆ‘çš„æŠ˜çº¿å›¾" value="æŠ˜çº¿å›¾" />
              </div>
              <div class="input-row">
                <div class="input-group">
                  <label class="input-label">X è½´æ ‡ç­¾</label>
                  <input type="text" id="xAxisLabel" placeholder="X è½´" />
                </div>
                <div class="input-group">
                  <label class="input-label">Y è½´æ ‡ç­¾</label>
                  <input type="text" id="yAxisLabel" placeholder="Y è½´" />
                </div>
              </div>
              <div class="input-row">
                <div class="input-group">
                  <label class="input-label">çº¿æ¡æ ·å¼</label>
                  <select id="lineStyle">
                    <option value="smooth">å¹³æ»‘æ›²çº¿</option>
                    <option value="linear">ç›´çº¿</option>
                    <option value="stepped">é˜¶æ¢¯</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label">æ˜¾ç¤ºæ•°æ®ç‚¹</label>
                  <select id="showPoints">
                    <option value="true">æ˜¾ç¤º</option>
                    <option value="false">éšè—</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="tool-section">
              <div class="section-title">æ•°æ®ç³»åˆ—</div>
              <div class="series-manager" id="seriesManager">
                <!-- åŠ¨æ€æ·»åŠ çš„ç³»åˆ— -->
              </div>
              <button class="add-series-btn" onclick="addSeries()">+ æ·»åŠ æ•°æ®ç³»åˆ—</button>
            </div>

            <div class="tool-section">
              <div class="section-title">æ•°æ®è¾“å…¥</div>
              <div class="input-group">
                <label class="input-label">è¾“å…¥æ•°æ®ï¼ˆæ¯è¡Œä¸€ä¸ªç‚¹ï¼‰</label>
                <textarea id="dataInput" placeholder="æ ¼å¼ï¼šX,Y æˆ– X,Y1,Y2,Y3...

ç¤ºä¾‹ï¼ˆå•ç³»åˆ—ï¼‰ï¼š
1,10
2,25
3,18
4,32
5,28

ç¤ºä¾‹ï¼ˆå¤šç³»åˆ—ï¼‰ï¼š
Jan,65,28
Feb,59,48
Mar,80,40
Apr,81,19
May,56,86"></textarea>
                <div class="input-hint">æç¤ºï¼šç¬¬ä¸€åˆ—ä¸ºXè½´æ ‡ç­¾ï¼Œåç»­åˆ—å¯¹åº”å„æ•°æ®ç³»åˆ—çš„Yå€¼</div>
              </div>
              <div class="btn-row">
                <button class="btn btn-primary" onclick="generateChart()">ğŸ“Š ç”Ÿæˆå›¾è¡¨</button>
                <button class="btn btn-secondary" onclick="loadSampleData()">ğŸ“ ç¤ºä¾‹æ•°æ®</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ”„ æ¸…ç©º</button>
              </div>
            </div>
          </div>

          <!-- å³ä¾§ï¼šå›¾è¡¨æ˜¾ç¤º -->
          <div class="output-panel">
            <div class="tool-section">
              <div class="section-title">å›¾è¡¨é¢„è§ˆ</div>
              <div class="chart-container">
                <canvas id="lineChart"></canvas>
                <div class="chart-placeholder" id="chartPlaceholder">è¾“å…¥æ•°æ®åç”Ÿæˆå›¾è¡¨</div>
              </div>
              <div class="btn-row" style="margin-top: 16px">
                <button class="btn btn-success" onclick="exportPNG()">ğŸ“¥ å¯¼å‡º PNG</button>
                <button class="btn btn-secondary" onclick="shareChart()">ğŸ”— åˆ†äº«</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div class="toast" id="toast">æ“ä½œæˆåŠŸ</div>

    <script>
      // å…¨å±€å˜é‡
      let chart = null;
      let seriesCount = 0;
      const defaultColors = [
        '#00f5d4', // cyan
        '#f72585', // magenta
        '#fbbf24', // yellow
        '#a855f7', // purple
        '#10b981', // green
        '#3b82f6', // blue
        '#f43f5e', // red
        '#06b6d4', // teal
      ];

      const LS_KEY = 'line-chart-data';

      // ä¸»é¢˜åˆ‡æ¢
      function toggleTheme() {
        const body = document.body;
        const isDark = body.getAttribute('data-theme') !== 'light';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
        // é‡æ–°ç”Ÿæˆå›¾è¡¨ä»¥æ›´æ–°ä¸»é¢˜
        if (chart) {
          generateChart();
        }
      }

      // åŠ è½½ä¸»é¢˜
      (function () {
        const saved = localStorage.getItem('theme');
        if (saved === 'light') {
          document.body.setAttribute('data-theme', 'light');
        }
      })();

      // åˆ›å»ºç³»åˆ—å…ƒç´ 
      function createSeriesElement(name, color, id) {
        const item = document.createElement('div');
        item.className = 'series-item';
        item.dataset.seriesId = id;

        const colorInput = document.createElement('input');
        colorInput.type = 'color';
        colorInput.className = 'series-color';
        colorInput.value = color;
        colorInput.title = 'é€‰æ‹©é¢œè‰²';

        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'series-name';
        nameInput.value = name;
        nameInput.placeholder = 'ç³»åˆ—åç§°';

        const removeBtn = document.createElement('button');
        removeBtn.className = 'series-btn';
        removeBtn.title = 'åˆ é™¤ç³»åˆ—';
        removeBtn.textContent = 'âœ•';
        removeBtn.onclick = function() { removeSeries(this); };

        item.appendChild(colorInput);
        item.appendChild(nameInput);
        item.appendChild(removeBtn);

        // ç»‘å®šäº‹ä»¶
        colorInput.addEventListener('input', saveToStorage);
        colorInput.addEventListener('change', saveToStorage);
        nameInput.addEventListener('input', saveToStorage);
        nameInput.addEventListener('change', saveToStorage);

        return item;
      }

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function () {
        // æ·»åŠ é»˜è®¤æ•°æ®ç³»åˆ—
        addSeries('ç³»åˆ— 1', defaultColors[0]);

        // ä» localStorage åŠ è½½
        loadFromStorage();

        // ä» URL hash åŠ è½½
        loadFromUrl();

        // è‡ªåŠ¨ä¿å­˜
        document.querySelectorAll('input, textarea, select').forEach((el) => {
          el.addEventListener('input', saveToStorage);
          el.addEventListener('change', saveToStorage);
        });
      });

      // æ·»åŠ æ•°æ®ç³»åˆ—
      function addSeries(name, color) {
        seriesCount++;
        const seriesName = name || ('ç³»åˆ— ' + seriesCount);
        const seriesColor = color || defaultColors[(seriesCount - 1) % defaultColors.length];

        const container = document.getElementById('seriesManager');
        const item = createSeriesElement(seriesName, seriesColor, seriesCount);
        container.appendChild(item);
      }

      // ç§»é™¤æ•°æ®ç³»åˆ—
      function removeSeries(btn) {
        const items = document.querySelectorAll('.series-item');
        if (items.length <= 1) {
          showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªæ•°æ®ç³»åˆ—', 'error');
          return;
        }
        btn.closest('.series-item').remove();
        saveToStorage();
      }

      // è·å–æ‰€æœ‰ç³»åˆ—é…ç½®
      function getSeriesConfig() {
        const items = document.querySelectorAll('.series-item');
        return Array.from(items).map(function(item) {
          return {
            name: item.querySelector('.series-name').value || 'æœªå‘½å',
            color: item.querySelector('.series-color').value
          };
        });
      }

      // è§£ææ•°æ®
      function parseData(input) {
        const lines = input.trim().split('\n').filter(function(line) { return line.trim(); });
        if (lines.length === 0) return null;

        const labels = [];
        const datasets = [];
        const seriesConfig = getSeriesConfig();

        // è§£ææ¯è¡Œæ•°æ®
        lines.forEach(function(line) {
          const parts = line.split(',').map(function(s) { return s.trim(); });
          if (parts.length < 2) return;

          labels.push(parts[0]);

          // è§£æ Y å€¼
          for (let i = 1; i < parts.length; i++) {
            const value = parseFloat(parts[i]);
            if (!isNaN(value)) {
              if (!datasets[i - 1]) {
                datasets[i - 1] = [];
              }
              datasets[i - 1].push(value);
            }
          }
        });

        if (labels.length === 0 || datasets.length === 0) return null;

        // ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç³»åˆ—é…ç½®
        while (seriesConfig.length < datasets.length) {
          const idx = seriesConfig.length;
          seriesConfig.push({
            name: 'ç³»åˆ— ' + (idx + 1),
            color: defaultColors[idx % defaultColors.length]
          });
          // æ·»åŠ  UI
          addSeries(seriesConfig[idx].name, seriesConfig[idx].color);
        }

        return { labels: labels, datasets: datasets, seriesConfig: seriesConfig };
      }

      // ç”Ÿæˆå›¾è¡¨
      function generateChart() {
        const input = document.getElementById('dataInput').value;
        if (!input.trim()) {
          showToast('è¯·è¾“å…¥æ•°æ®', 'error');
          return;
        }

        const parsed = parseData(input);
        if (!parsed) {
          showToast('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥', 'error');
          return;
        }

        const labels = parsed.labels;
        const datasets = parsed.datasets;
        const seriesConfig = parsed.seriesConfig;
        const chartTitle = document.getElementById('chartTitle').value || 'æŠ˜çº¿å›¾';
        const xAxisLabel = document.getElementById('xAxisLabel').value;
        const yAxisLabel = document.getElementById('yAxisLabel').value;
        const lineStyle = document.getElementById('lineStyle').value;
        const showPoints = document.getElementById('showPoints').value === 'true';

        // åˆ¤æ–­å½“å‰ä¸»é¢˜
        const isLight = document.body.getAttribute('data-theme') === 'light';
        const gridColor = isLight ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
        const textColor = isLight ? '#1a1a1a' : '#e8e8ed';

        // éšè—å ä½ç¬¦
        document.getElementById('chartPlaceholder').style.display = 'none';

        // é”€æ¯æ—§å›¾è¡¨
        if (chart) {
          chart.destroy();
        }

        // æ„å»ºæ•°æ®é›†
        const chartDatasets = datasets.map(function(data, index) {
          const config = seriesConfig[index] || {
            name: 'ç³»åˆ— ' + (index + 1),
            color: defaultColors[index % defaultColors.length]
          };

          return {
            label: config.name,
            data: data,
            borderColor: config.color,
            backgroundColor: config.color + '20',
            borderWidth: 2,
            fill: false,
            tension: lineStyle === 'smooth' ? 0.4 : 0,
            stepped: lineStyle === 'stepped',
            pointRadius: showPoints ? 4 : 0,
            pointHoverRadius: showPoints ? 6 : 4,
            pointBackgroundColor: config.color,
            pointBorderColor: config.color
          };
        });

        // åˆ›å»ºå›¾è¡¨
        const ctx = document.getElementById('lineChart').getContext('2d');
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: chartDatasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            interaction: {
              mode: 'index',
              intersect: false
            },
            plugins: {
              title: {
                display: !!chartTitle,
                text: chartTitle,
                color: textColor,
                font: {
                  size: 16,
                  weight: '600',
                  family: "'Space Grotesk', sans-serif"
                },
                padding: { bottom: 20 }
              },
              legend: {
                display: datasets.length > 1,
                position: 'top',
                labels: {
                  color: textColor,
                  font: {
                    family: "'Space Grotesk', sans-serif"
                  },
                  usePointStyle: true,
                  padding: 15
                }
              },
              tooltip: {
                backgroundColor: isLight ? 'rgba(255, 255, 255, 0.95)' : 'rgba(26, 26, 36, 0.95)',
                titleColor: textColor,
                bodyColor: textColor,
                borderColor: isLight ? '#e5e5e5' : '#3a3a4a',
                borderWidth: 1,
                cornerRadius: 8,
                titleFont: {
                  family: "'Space Grotesk', sans-serif",
                  weight: '600'
                },
                bodyFont: {
                  family: "'JetBrains Mono', monospace"
                },
                padding: 12
              }
            },
            scales: {
              x: {
                display: true,
                title: {
                  display: !!xAxisLabel,
                  text: xAxisLabel,
                  color: textColor,
                  font: {
                    family: "'Space Grotesk', sans-serif",
                    weight: '500'
                  }
                },
                grid: {
                  color: gridColor
                },
                ticks: {
                  color: textColor,
                  font: {
                    family: "'JetBrains Mono', monospace",
                    size: 11
                  }
                }
              },
              y: {
                display: true,
                title: {
                  display: !!yAxisLabel,
                  text: yAxisLabel,
                  color: textColor,
                  font: {
                    family: "'Space Grotesk', sans-serif",
                    weight: '500'
                  }
                },
                grid: {
                  color: gridColor
                },
                ticks: {
                  color: textColor,
                  font: {
                    family: "'JetBrains Mono', monospace",
                    size: 11
                  }
                },
                beginAtZero: true
              }
            }
          }
        });

        showToast('å›¾è¡¨ç”ŸæˆæˆåŠŸ');
        saveToStorage();
      }

      // å¯¼å‡º PNG
      function exportPNG() {
        if (!chart) {
          showToast('è¯·å…ˆç”Ÿæˆå›¾è¡¨', 'error');
          return;
        }

        const canvas = document.getElementById('lineChart');
        const link = document.createElement('a');
        link.download = 'line-chart.png';
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();

        showToast('å›¾è¡¨å·²å¯¼å‡º');
      }

      // åˆ†äº«å›¾è¡¨
      function shareChart() {
        const data = {
          title: document.getElementById('chartTitle').value,
          xAxis: document.getElementById('xAxisLabel').value,
          yAxis: document.getElementById('yAxisLabel').value,
          style: document.getElementById('lineStyle').value,
          points: document.getElementById('showPoints').value,
          series: getSeriesConfig(),
          data: document.getElementById('dataInput').value
        };

        const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
        const url = window.location.href.split('#')[0] + '#' + encoded;

        navigator.clipboard.writeText(url).then(function() {
          showToast('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(function() {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€æ é“¾æ¥', 'error');
        });
      }

      // ä» URL åŠ è½½
      function loadFromUrl() {
        const hash = window.location.hash.slice(1);
        if (!hash) return;

        try {
          const data = JSON.parse(decodeURIComponent(atob(hash)));

          if (data.title) document.getElementById('chartTitle').value = data.title;
          if (data.xAxis) document.getElementById('xAxisLabel').value = data.xAxis;
          if (data.yAxis) document.getElementById('yAxisLabel').value = data.yAxis;
          if (data.style) document.getElementById('lineStyle').value = data.style;
          if (data.points) document.getElementById('showPoints').value = data.points;
          if (data.data) document.getElementById('dataInput').value = data.data;

          // æ¢å¤ç³»åˆ—é…ç½®
          if (data.series && data.series.length > 0) {
            document.getElementById('seriesManager').textContent = '';
            seriesCount = 0;
            data.series.forEach(function(s) { addSeries(s.name, s.color); });
          }

          // è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨
          if (data.data) {
            setTimeout(generateChart, 100);
          }
        } catch (e) {
          // å¿½ç•¥è§£æé”™è¯¯
        }
      }

      // ä¿å­˜åˆ° localStorage
      function saveToStorage() {
        const data = {
          title: document.getElementById('chartTitle').value,
          xAxis: document.getElementById('xAxisLabel').value,
          yAxis: document.getElementById('yAxisLabel').value,
          style: document.getElementById('lineStyle').value,
          points: document.getElementById('showPoints').value,
          series: getSeriesConfig(),
          data: document.getElementById('dataInput').value
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      }

      // ä» localStorage åŠ è½½
      function loadFromStorage() {
        // å¦‚æœæœ‰ URL hashï¼Œä¼˜å…ˆä½¿ç”¨ URL
        if (window.location.hash) return;

        const saved = localStorage.getItem(LS_KEY);
        if (!saved) return;

        try {
          const data = JSON.parse(saved);

          if (data.title) document.getElementById('chartTitle').value = data.title;
          if (data.xAxis) document.getElementById('xAxisLabel').value = data.xAxis;
          if (data.yAxis) document.getElementById('yAxisLabel').value = data.yAxis;
          if (data.style) document.getElementById('lineStyle').value = data.style;
          if (data.points) document.getElementById('showPoints').value = data.points;
          if (data.data) document.getElementById('dataInput').value = data.data;

          // æ¢å¤ç³»åˆ—é…ç½®
          if (data.series && data.series.length > 0) {
            document.getElementById('seriesManager').textContent = '';
            seriesCount = 0;
            data.series.forEach(function(s) { addSeries(s.name, s.color); });
          }
        } catch (e) {
          // å¿½ç•¥è§£æé”™è¯¯
        }
      }

      // åŠ è½½ç¤ºä¾‹æ•°æ®
      function loadSampleData() {
        const sampleData = 'Jan,65,28,45\nFeb,59,48,52\nMar,80,40,61\nApr,81,19,73\nMay,56,86,42\nJun,55,27,58\nJul,40,90,35';

        document.getElementById('dataInput').value = sampleData;
        document.getElementById('chartTitle').value = 'æœˆåº¦æ•°æ®å¯¹æ¯”';
        document.getElementById('xAxisLabel').value = 'æœˆä»½';
        document.getElementById('yAxisLabel').value = 'æ•°å€¼';

        // ç¡®ä¿æœ‰ 3 ä¸ªç³»åˆ—
        const manager = document.getElementById('seriesManager');
        manager.textContent = '';
        seriesCount = 0;
        addSeries('é”€å”®é¢', '#00f5d4');
        addSeries('æˆæœ¬', '#f72585');
        addSeries('åˆ©æ¶¦', '#fbbf24');

        generateChart();
      }

      // æ¸…ç©ºæ‰€æœ‰å†…å®¹
      function clearAll() {
        document.getElementById('chartTitle').value = 'æŠ˜çº¿å›¾';
        document.getElementById('xAxisLabel').value = '';
        document.getElementById('yAxisLabel').value = '';
        document.getElementById('lineStyle').value = 'smooth';
        document.getElementById('showPoints').value = 'true';
        document.getElementById('dataInput').value = '';

        // é‡ç½®ç³»åˆ—
        document.getElementById('seriesManager').textContent = '';
        seriesCount = 0;
        addSeries('ç³»åˆ— 1', defaultColors[0]);

        // é”€æ¯å›¾è¡¨
        if (chart) {
          chart.destroy();
          chart = null;
        }
        document.getElementById('chartPlaceholder').style.display = 'flex';

        // æ¸…é™¤å­˜å‚¨
        localStorage.removeItem(LS_KEY);
        window.location.hash = '';

        showToast('å·²æ¸…ç©º');
      }

      // æ˜¾ç¤ºæç¤º
      function showToast(msg, type) {
        type = type || 'success';
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.className = 'toast' + (type === 'error' ? ' error' : '');
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 2000);
      }
    </script>
  </body>
</html>

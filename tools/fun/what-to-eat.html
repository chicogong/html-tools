<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils" />
    <meta name="keywords" content="what-to-eat,fun,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/fun/what-to-eat.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils" />
    <meta property="og:description" content="‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/fun/what-to-eat.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils" />
    <meta name="twitter:description" content="‰ªäÂ§©ÂêÉ‰ªÄ‰πà - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;

        /* Â≠ó‰ΩìÂèòÈáè */
        --font-sans:
          "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      :root {
        --bg-primary: #0a0a0f;
        --bg-secondary: #12121a;
        --bg-tertiary: #1a1a24;
        --color-text-primary: #fff;
        --color-text-secondary: #a0a0a0;
        --accent: #ef4444;
        --accent-hover: #f87171;
        --border: #2a2a3a;
        --success: #4ade80;
      }
      [data-theme="light"] {
        --bg-primary: #f8fafc;
        --bg-secondary: #fff;
        --bg-tertiary: #f1f5f9;
        --color-text-primary: #1e293b;
        --color-text-secondary: #64748b;
        --accent: #dc2626;
        --accent-hover: #ef4444;
        --border: #e2e8f0;
      }
      body {
        font-family: var(--font-sans);
        background: var(--bg-primary);
        color: var(--color-text-primary);
        min-height: 100vh;
      }
      .header {
        background: linear-gradient(135deg, #ef4444, #f97316, #eab308);
        padding: 20px;
        text-align: center;
        position: relative;
      }
      .header h1 {
        font-size: 24px;
        margin-bottom: 5px;
        color: #fff;
      }
      .header p {
        font-size: 14px;
        opacity: 0.9;
        color: #fff;
      }
      .back-link {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #fff;
        text-decoration: none;
        font-size: 14px;
        opacity: 0.9;
        transition: opacity 0.2s;
      }
      .back-link:hover {
        opacity: 1;
      }
      .theme-toggle {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.2);
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
      }
      .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 20px;
      }
      .main-area {
        background: var(--bg-secondary);
        border-radius: 20px;
        padding: 30px;
        border: 1px solid var(--border);
        margin-bottom: 20px;
        text-align: center;
      }
      .slot-machine {
        background: var(--bg-tertiary);
        border-radius: 16px;
        padding: 30px;
        margin: 20px 0;
        position: relative;
        overflow: hidden;
      }
      .slot-window {
        height: 100px;
        overflow: hidden;
        position: relative;
        border-radius: 12px;
        background: var(--bg-primary);
        margin-bottom: 20px;
      }
      .slot-reel {
        position: absolute;
        width: 100%;
        transition: transform 0.1s linear;
      }
      .slot-item {
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: bold;
      }
      .slot-item .emoji {
        font-size: 40px;
        margin-right: 15px;
      }
      .result-display {
        font-size: 36px;
        font-weight: bold;
        color: var(--accent);
        padding: 20px;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }
      .result-emoji {
        font-size: 50px;
      }
      .spin-btn {
        padding: 18px 60px;
        font-size: 20px;
        font-weight: 600;
        background: linear-gradient(135deg, var(--accent), var(--accent-hover));
        color: #fff;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
      }
      .spin-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4);
      }
      .spin-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .category-tabs {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }
      .category-tab {
        padding: 10px 20px;
        border-radius: 20px;
        border: 1px solid var(--border);
        background: var(--bg-tertiary);
        color: var(--color-text-primary);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .category-tab.active {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }
      .category-tab:hover:not(.active) {
        border-color: var(--accent);
      }
      .options-panel {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--border);
        margin-bottom: 20px;
      }
      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .panel-title {
        font-size: 16px;
        font-weight: 600;
      }
      .panel-actions {
        display: flex;
        gap: 10px;
      }
      .small-btn {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--bg-tertiary);
        color: var(--color-text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }
      .small-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }
      .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 10px;
        max-height: 200px;
        overflow-y: auto;
      }
      .option-chip {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        background: var(--bg-tertiary);
        border-radius: 8px;
        font-size: 14px;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all 0.2s;
      }
      .option-chip:hover {
        border-color: var(--accent);
      }
      .option-chip.excluded {
        opacity: 0.4;
        text-decoration: line-through;
      }
      .option-chip .emoji {
        font-size: 18px;
      }
      .add-option {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      .add-input {
        flex: 1;
        padding: 10px 15px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: var(--bg-tertiary);
        color: var(--color-text-primary);
        font-size: 14px;
        outline: none;
      }
      .add-input:focus {
        border-color: var(--accent);
      }
      .add-btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        background: var(--accent);
        color: #fff;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .add-btn:hover {
        background: var(--accent-hover);
      }
      .history-panel {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--border);
      }
      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .history-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 150px;
        overflow-y: auto;
      }
      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: var(--bg-tertiary);
        border-radius: 8px;
        font-size: 14px;
      }
      .history-food {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .history-time {
        color: var(--color-text-secondary);
        font-size: 12px;
      }
      .shake-hint {
        font-size: 12px;
        color: var(--color-text-secondary);
        margin-top: 15px;
      }
      .empty-state {
        color: var(--color-text-secondary);
        padding: 30px;
        text-align: center;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">È¶ñÈ°µ</a>
      <span>‚Ä∫</span>
      ‰ªäÂ§©ÂêÉ‰ªÄ‰πà
    </nav>
    <div class="header">
      <a href="../../index.html" class="back-link">‚Üê ËøîÂõû</a>
      <h1>üçΩÔ∏è ‰ªäÂ§©ÂêÉ‰ªÄ‰πà</h1>
      <p>Ëß£ÂÜ≥ÈÄâÊã©Âõ∞ÈöæÁóá ¬∑ ÈöèÊú∫ÂÜ≥ÂÆöÁæéÈ£ü</p>
      <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    </div>

    <div class="container">
      <div class="main-area">
        <div class="category-tabs" id="categoryTabs"></div>

        <div class="slot-machine">
          <div class="slot-window">
            <div class="slot-reel" id="slotReel"></div>
          </div>
          <div class="result-display" id="resultDisplay">
            <span class="result-emoji">ü§î</span>
            <span>ÁÇπÂáªÊåâÈíÆÂÜ≥ÂÆö</span>
          </div>
        </div>

        <button class="spin-btn" id="spinBtn" onclick="spin()">üé∞ ÂºÄÂßãÈöèÊú∫</button>
        <div class="shake-hint">üí° ‰πüÂèØ‰ª•ÊëáÂä®ÊâãÊú∫Êù•ÈöèÊú∫</div>
      </div>

      <div class="options-panel">
        <div class="panel-header">
          <span class="panel-title">
            üìù ÂΩìÂâçÈÄâÈ°π (
            <span id="optionCount">0</span>
            )
          </span>
          <div class="panel-actions">
            <button class="small-btn" onclick="resetOptions()">ÈáçÁΩÆ</button>
            <button class="small-btn" onclick="clearExcluded()">ÂèñÊ∂àÊéíÈô§</button>
          </div>
        </div>
        <div class="options-grid" id="optionsGrid"></div>
        <div class="add-option">
          <input
            type="text"
            class="add-input"
            id="newOption"
            placeholder="Ê∑ªÂä†Ëá™ÂÆö‰πâÈÄâÈ°π..."
            onkeydown="if (event.key === 'Enter') addOption();"
          />
          <button class="add-btn" onclick="addOption()">Ê∑ªÂä†</button>
        </div>
      </div>

      <div class="history-panel">
        <div class="history-header">
          <span class="panel-title">üìú ÂéÜÂè≤ËÆ∞ÂΩï</span>
          <button class="small-btn" onclick="clearHistory()">Ê∏ÖÁ©∫</button>
        </div>
        <div class="history-list" id="historyList">
          <div class="empty-state">ÊöÇÊó†ËÆ∞ÂΩï</div>
        </div>
      </div>
    </div>

    <script>
      // È¢ÑËÆæÈ£üÁâ©Êï∞ÊçÆ
      const presetFoods = {
        ÂÖ®ÈÉ®: [],
        ‰∏≠È§ê: [
          { name: "Á∫¢ÁÉßËÇâ", emoji: "ü•©" },
          { name: "ÂÆ´‰øùÈ∏°‰∏Å", emoji: "üçó" },
          { name: "È∫ªÂ©ÜË±ÜËÖê", emoji: "ü•¢" },
          { name: "Á≥ñÈÜãÈáåËÑä", emoji: "üçñ" },
          { name: "È±ºÈ¶ôËÇâ‰∏ù", emoji: "üêü" },
          { name: "ÂõûÈîÖËÇâ", emoji: "ü•ì" },
          { name: "Ê∞¥ÁÖÆÈ±º", emoji: "üê†" },
          { name: "ÈÖ∏ËèúÈ±º", emoji: "üç≤" },
          { name: "Âåó‰∫¨ÁÉ§È∏≠", emoji: "ü¶Ü" },
          { name: "È•∫Â≠ê", emoji: "ü•ü" },
          { name: "ÁÇíÈ•≠", emoji: "üçö" },
          { name: "Èù¢Êù°", emoji: "üçú" }
        ],
        Âø´È§ê: [
          { name: "Ê±âÂ†°", emoji: "üçî" },
          { name: "Êä´Ëê®", emoji: "üçï" },
          { name: "ÁÇ∏È∏°", emoji: "üçó" },
          { name: "ËñØÊù°", emoji: "üçü" },
          { name: "ÁÉ≠Áãó", emoji: "üå≠" },
          { name: "‰∏âÊòéÊ≤ª", emoji: "ü•™" },
          { name: "ÁÇ∏È∏°Êéí", emoji: "üçñ" },
          { name: "È∏°Á±≥Ëä±", emoji: "üêî" }
        ],
        Êó•Èü©: [
          { name: "ÂØøÂè∏", emoji: "üç£" },
          { name: "ÊãâÈù¢", emoji: "üçú" },
          { name: "ÁÉ§ËÇâ", emoji: "ü•©" },
          { name: "Áü≥ÈîÖÊãåÈ•≠", emoji: "üçö" },
          { name: "Èü©ÂºèÁÇ∏È∏°", emoji: "üçó" },
          { name: "ÈÉ®ÈòüÈîÖ", emoji: "üç≤" },
          { name: "Â§©Â¶áÁΩó", emoji: "üç§" },
          { name: "ÂíñÂñ±È•≠", emoji: "üçõ" }
        ],
        Èù¢È£ü: [
          { name: "ÂÖ∞Â∑ûÊãâÈù¢", emoji: "üçú" },
          { name: "ÈáçÂ∫ÜÂ∞èÈù¢", emoji: "üå∂Ô∏è" },
          { name: "ÁÇ∏ÈÖ±Èù¢", emoji: "üçù" },
          { name: "ÂàÄÂâäÈù¢", emoji: "üî™" },
          { name: "ÊãÖÊãÖÈù¢", emoji: "ü•¢" },
          { name: "ÁÉ≠Âπ≤Èù¢", emoji: "üî•" },
          { name: "Èò≥Êò•Èù¢", emoji: "üçú" },
          { name: "Ê≤πÊ≥ºÈù¢", emoji: "üõ¢Ô∏è" }
        ],
        Â∞èÂêÉ: [
          { name: "ÁÖéÈ•ºÊûúÂ≠ê", emoji: "ü•û" },
          { name: "ËÇâÂ§πÈ¶ç", emoji: "ü•ô" },
          { name: "ÁîüÁÖéÂåÖ", emoji: "ü•ü" },
          { name: "Ëá≠Ë±ÜËÖê", emoji: "üßÄ" },
          { name: "ÁÉ§‰∏≤", emoji: "üç¢" },
          { name: "È∫ªËæ£ÁÉ´", emoji: "üå∂Ô∏è" },
          { name: "ÈÖ∏Ëæ£Á≤â", emoji: "üçú" },
          { name: "ÂáâÁöÆ", emoji: "ü•í" }
        ],
        Â§ñÂçñ: [
          { name: "ÈªÑÁÑñÈ∏°", emoji: "üçó" },
          { name: "È∫ªËæ£È¶ôÈîÖ", emoji: "üç≥" },
          { name: "ÂÜíËèú", emoji: "ü•¨" },
          { name: "ÁõñÊµáÈ•≠", emoji: "üçö" },
          { name: "ÁÇíÊ≤≥Á≤â", emoji: "üçù" },
          { name: "Ëû∫Ëõ≥Á≤â", emoji: "üêö" },
          { name: "È∏°ÂÖ¨ÁÖ≤", emoji: "üç≤" },
          { name: "ÁÉ§È±º", emoji: "üêü" }
        ]
      };

      let currentCategory = "ÂÖ®ÈÉ®";
      let currentOptions = [];
      let excludedOptions = new Set();
      let isSpinning = false;
      let history = JSON.parse(localStorage.getItem("whatToEatHistory") || "[]");
      let customOptions = JSON.parse(localStorage.getItem("whatToEatCustom") || "[]");

      // HTML ËΩ¨‰πâÂáΩÊï∞ (Èò≤Ê≠¢ XSS)
      function escapeHtml(str) {
        const div = document.createElement("div");
        div.textContent = str;
        return div.innerHTML;
      }

      // Èü≥È¢ë
      let audioCtx = null;

      function initAudio() {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      function playTickSound() {
        initAudio();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.frequency.value = 600 + Math.random() * 200;
        oscillator.type = "sine";
        gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        oscillator.start(audioCtx.currentTime);
        oscillator.stop(audioCtx.currentTime + 0.05);
      }

      function playWinSound() {
        initAudio();
        [523.25, 659.25, 783.99].forEach((freq, i) => {
          setTimeout(() => {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.frequency.value = freq;
            oscillator.type = "sine";
            gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2);
          }, i * 100);
        });
      }

      function secureRandom() {
        const array = new Uint32Array(1);
        crypto.getRandomValues(array);
        return array[0] / (0xffffffff + 1);
      }

      function getAllFoods() {
        let foods = [];
        Object.entries(presetFoods).forEach(([cat, items]) => {
          if (cat !== "ÂÖ®ÈÉ®") foods = foods.concat(items);
        });
        foods = foods.concat(customOptions);
        return foods;
      }

      function getAvailableOptions() {
        let foods;
        if (currentCategory === "ÂÖ®ÈÉ®") {
          foods = getAllFoods();
        } else {
          foods = [...presetFoods[currentCategory], ...customOptions];
        }
        return foods.filter((f) => !excludedOptions.has(f.name));
      }

      function renderCategories() {
        const tabs = document.getElementById("categoryTabs");
        tabs.innerHTML = Object.keys(presetFoods)
          .map(
            (cat) =>
              `<button class="category-tab ${cat === currentCategory ? "active" : ""}" 
                         onclick="selectCategory('${cat}')">${cat}</button>`
          )
          .join("");
      }

      function selectCategory(cat) {
        currentCategory = cat;
        renderCategories();
        renderOptions();
      }

      function renderOptions() {
        const grid = document.getElementById("optionsGrid");
        const options =
          currentCategory === "ÂÖ®ÈÉ®"
            ? getAllFoods()
            : [...(presetFoods[currentCategory] || []), ...customOptions];

        document.getElementById("optionCount").textContent = options.filter(
          (o) => !excludedOptions.has(o.name)
        ).length;

        if (options.length === 0) {
          grid.innerHTML = '<div class="empty-state">ÊöÇÊó†ÈÄâÈ°π</div>';
          return;
        }

        grid.innerHTML = options
          .map(
            (opt) => `
                <div class="option-chip ${excludedOptions.has(opt.name) ? "excluded" : ""}" 
                     onclick="toggleExclude('${escapeHtml(opt.name).replace(/'/g, "\\'")}')">
                    <span class="emoji">${escapeHtml(opt.emoji)}</span>
                    <span>${escapeHtml(opt.name)}</span>
                </div>
            `
          )
          .join("");
      }

      function toggleExclude(name) {
        if (excludedOptions.has(name)) {
          excludedOptions.delete(name);
        } else {
          excludedOptions.add(name);
        }
        renderOptions();
      }

      function clearExcluded() {
        excludedOptions.clear();
        renderOptions();
      }

      function resetOptions() {
        excludedOptions.clear();
        customOptions = [];
        localStorage.setItem("whatToEatCustom", "[]");
        renderOptions();
      }

      function addOption() {
        const input = document.getElementById("newOption");
        const name = input.value.trim();
        if (!name) return;

        const emojis = ["üç¥", "ü•Ñ", "üçΩÔ∏è", "ü•£", "üç±"];
        customOptions.push({
          name: name,
          emoji: emojis[Math.floor(Math.random() * emojis.length)]
        });
        localStorage.setItem("whatToEatCustom", JSON.stringify(customOptions));
        input.value = "";
        renderOptions();
      }

      function spin() {
        const options = getAvailableOptions();
        if (isSpinning || options.length < 2) {
          if (options.length < 2) alert("ÂèØÈÄâÈ°π‰∏çË∂≥ÔºåËØ∑Ê∑ªÂä†Êõ¥Â§öÈÄâÈ°πÊàñÂèñÊ∂àÊéíÈô§");
          return;
        }

        isSpinning = true;
        initAudio();
        document.getElementById("spinBtn").disabled = true;

        const reel = document.getElementById("slotReel");
        const result = document.getElementById("resultDisplay");

        // ÂàõÂª∫ÊªöÂä®È°π
        const shuffled = [...options].sort(() => secureRandom() - 0.5);
        reel.innerHTML = shuffled
          .concat(shuffled)
          .concat(shuffled)
          .map(
            (opt) => `
                <div class="slot-item">
                    <span class="emoji">${opt.emoji}</span>
                    <span>${opt.name}</span>
                </div>
            `
          )
          .join("");

        // ÈÄâÊã©ÁªìÊûú
        const winnerIndex = Math.floor(secureRandom() * options.length);
        const winner = options[winnerIndex];

        // Âä®Áîª
        let pos = 0;
        const targetPos = (options.length + winnerIndex) * 100;
        const duration = 3000;
        const startTime = Date.now();

        function animate() {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 4);

          pos = eased * targetPos;
          reel.style.transform = `translateY(-${pos}px)`;

          if (progress < 0.9) playTickSound();

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            // ÂÆåÊàê
            result.innerHTML = `
                        <span class="result-emoji">${winner.emoji}</span>
                        <span>${winner.name}</span>
                    `;
            playWinSound();

            // Ê∑ªÂä†ÂéÜÂè≤
            addHistory(winner);

            isSpinning = false;
            document.getElementById("spinBtn").disabled = false;
          }
        }

        animate();
      }

      function addHistory(food) {
        const now = new Date();
        const timeStr = `${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, "0")}`;
        history.unshift({ ...food, time: timeStr });
        if (history.length > 20) history.pop();
        localStorage.setItem("whatToEatHistory", JSON.stringify(history));
        renderHistory();
      }

      function renderHistory() {
        const list = document.getElementById("historyList");
        if (history.length === 0) {
          list.innerHTML = '<div class="empty-state">ÊöÇÊó†ËÆ∞ÂΩï</div>';
          return;
        }
        list.innerHTML = history
          .map(
            (h) => `
                <div class="history-item">
                    <div class="history-food">
                        <span>${h.emoji}</span>
                        <span>${h.name}</span>
                    </div>
                    <span class="history-time">${h.time}</span>
                </div>
            `
          )
          .join("");
      }

      function clearHistory() {
        history = [];
        localStorage.setItem("whatToEatHistory", "[]");
        renderHistory();
      }

      // ÊëáÂä®Ê£ÄÊµã
      let lastShake = 0;
      if (window.DeviceMotionEvent) {
        window.addEventListener("devicemotion", (e) => {
          const acc = e.accelerationIncludingGravity;
          if (acc) {
            const total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
            if (total > 35 && Date.now() - lastShake > 3500) {
              lastShake = Date.now();
              spin();
            }
          }
        });
      }

      // ÈîÆÁõò
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space" || e.code === "Enter") {
          if (document.activeElement.tagName !== "INPUT") {
            e.preventDefault();
            spin();
          }
        }
      });

      function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute("data-theme");
        const next = current === "light" ? "dark" : "light";
        body.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
      }

      // ÂàùÂßãÂåñ
      document.body.setAttribute("data-theme", localStorage.getItem("theme") || "dark");
      renderCategories();
      renderOptions();
      renderHistory();
    </script>
  </body>
</html>

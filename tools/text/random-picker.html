<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºæ–‡æœ¬é€‰æ‹©å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --animation-duration: 0.3s;
        }
        body {
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        header h1 {
            margin: 0;
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .input-section textarea {
            min-height: 200px;
            font-family: monospace;
        }
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin: 1rem 0;
        }
        .controls label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
        }
        .controls input[type="number"] {
            width: 80px;
            margin: 0;
        }
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .result-section {
            margin-top: 2rem;
        }
        .result-box {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1.5rem;
            min-height: 100px;
        }
        .result-item {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            background: var(--pico-secondary-background);
            border-radius: var(--pico-border-radius);
            animation: fade-in var(--animation-duration) ease-in;
        }
        .result-item.highlight {
            background: var(--pico-primary-background);
            color: var(--pico-primary-inverse);
            font-weight: bold;
            transform: scale(1.02);
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            color: var(--pico-muted-color);
            font-size: 0.9rem;
        }
        .history-section {
            margin-top: 2rem;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .history-time {
            color: var(--pico-muted-color);
            font-size: 0.8rem;
        }
        .empty-state {
            text-align: center;
            color: var(--pico-muted-color);
            padding: 2rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ğŸ² éšæœºæ–‡æœ¬é€‰æ‹©å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        </header>

        <section class="input-section">
            <label for="textInput">
                è¾“å…¥æ–‡æœ¬ï¼ˆæ¯è¡Œä¸€ä¸ªé€‰é¡¹ï¼‰
                <textarea id="textInput" placeholder="é€‰é¡¹1&#10;é€‰é¡¹2&#10;é€‰é¡¹3&#10;..."></textarea>
            </label>
        </section>

        <section class="controls">
            <label>
                æŠ½å–æ•°é‡ï¼š
                <input type="number" id="pickCount" value="1" min="1" max="100">
            </label>
            <label>
                <input type="checkbox" id="allowDuplicate">
                å…è®¸é‡å¤
            </label>
            <label>
                <input type="checkbox" id="showAnimation" checked>
                æ˜¾ç¤ºåŠ¨ç”»
            </label>
        </section>

        <div class="btn-group">
            <button onclick="pickRandom()">ğŸ¯ å¼€å§‹æŠ½å–</button>
            <button class="secondary" onclick="shuffleAll()">ğŸ”€ æ‰“ä¹±é¡ºåº</button>
            <button class="secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <button class="outline" onclick="loadExample()">ğŸ“ åŠ è½½ç¤ºä¾‹</button>
        </div>

        <div class="stats">
            <span>æ€»é€‰é¡¹æ•°ï¼š<strong id="totalCount">0</strong></span>
            <span>å·²å»é‡ï¼š<strong id="uniqueCount">0</strong></span>
        </div>

        <section class="result-section">
            <h3>æŠ½å–ç»“æœ</h3>
            <div class="result-box" id="resultBox">
                <div class="empty-state">ç‚¹å‡»"å¼€å§‹æŠ½å–"æŸ¥çœ‹ç»“æœ</div>
            </div>
        </section>

        <section class="history-section">
            <details>
                <summary>æŠ½å–å†å²</summary>
                <div class="history-list" id="historyList">
                    <div class="empty-state">æš‚æ— å†å²è®°å½•</div>
                </div>
                <button class="outline secondary" onclick="clearHistory()" style="margin-top: 0.5rem;">æ¸…ç©ºå†å²</button>
            </details>
        </section>
    </main>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        window.toggleTheme = function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        };

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // è·å–æ‰€æœ‰é€‰é¡¹
        function getOptions() {
            const text = document.getElementById('textInput').value;
            return text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        // è·å–å»é‡åçš„é€‰é¡¹
        function getUniqueOptions() {
            return [...new Set(getOptions())];
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const options = getOptions();
            const unique = getUniqueOptions();
            document.getElementById('totalCount').textContent = options.length;
            document.getElementById('uniqueCount').textContent = unique.length;
        }

        // éšæœºæŠ½å–
        window.pickRandom = function() {
            const options = getUniqueOptions();
            const count = parseInt(document.getElementById('pickCount').value) || 1;
            const allowDuplicate = document.getElementById('allowDuplicate').checked;
            const showAnimation = document.getElementById('showAnimation').checked;

            if (options.length === 0) {
                alert('è¯·å…ˆè¾“å…¥é€‰é¡¹');
                return;
            }

            let results = [];
            if (allowDuplicate) {
                for (let i = 0; i < count; i++) {
                    const idx = Math.floor(Math.random() * options.length);
                    results.push(options[idx]);
                }
            } else {
                if (count > options.length) {
                    alert(`é€‰é¡¹æ•°é‡ä¸è¶³ï¼Œæœ€å¤šåªèƒ½æŠ½å– ${options.length} ä¸ªä¸é‡å¤é€‰é¡¹`);
                    return;
                }
                const shuffled = [...options].sort(() => Math.random() - 0.5);
                results = shuffled.slice(0, count);
            }

            displayResults(results, showAnimation);
            addToHistory(results);
        };

        // æ˜¾ç¤ºç»“æœ
        function displayResults(results, animate) {
            const box = document.getElementById('resultBox');
            box.textContent = '';

            if (animate) {
                results.forEach((item, index) => {
                    setTimeout(() => {
                        const div = document.createElement('div');
                        div.className = 'result-item';
                        div.textContent = (index + 1) + '. ' + item;
                        if (index === results.length - 1) {
                            div.classList.add('highlight');
                        }
                        box.appendChild(div);
                    }, index * 150);
                });
            } else {
                results.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    if (index === results.length - 1 && results.length === 1) {
                        div.classList.add('highlight');
                    }
                    div.textContent = (index + 1) + '. ' + item;
                    box.appendChild(div);
                });
            }
        }

        // æ‰“ä¹±é¡ºåº
        window.shuffleAll = function() {
            const options = getOptions();
            if (options.length === 0) {
                alert('è¯·å…ˆè¾“å…¥é€‰é¡¹');
                return;
            }
            const shuffled = options.sort(() => Math.random() - 0.5);
            document.getElementById('textInput').value = shuffled.join('\n');
            updateStats();
        };

        // æ¸…ç©º
        window.clearAll = function() {
            document.getElementById('textInput').value = '';
            const box = document.getElementById('resultBox');
            box.textContent = '';
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'empty-state';
            emptyDiv.textContent = 'ç‚¹å‡»"å¼€å§‹æŠ½å–"æŸ¥çœ‹ç»“æœ';
            box.appendChild(emptyDiv);
            updateStats();
        };

        // åŠ è½½ç¤ºä¾‹
        window.loadExample = function() {
            const examples = [
                'å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ',
                'å­™å…«', 'å‘¨ä¹', 'å´å', 'éƒ‘åä¸€', 'ç‹åäºŒ'
            ];
            document.getElementById('textInput').value = examples.join('\n');
            updateStats();
        };

        // å†å²è®°å½•
        let history = JSON.parse(localStorage.getItem('picker-history') || '[]');

        function addToHistory(results) {
            const record = {
                time: new Date().toLocaleString('zh-CN'),
                results: results
            };
            history.unshift(record);
            if (history.length > 50) history.pop();
            localStorage.setItem('picker-history', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.textContent = '';
            
            if (history.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                emptyDiv.textContent = 'æš‚æ— å†å²è®°å½•';
                list.appendChild(emptyDiv);
                return;
            }
            
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const resultSpan = document.createElement('span');
                resultSpan.textContent = item.results.join(', ');
                
                const timeSpan = document.createElement('span');
                timeSpan.className = 'history-time';
                timeSpan.textContent = item.time;
                
                div.appendChild(resultSpan);
                div.appendChild(timeSpan);
                list.appendChild(div);
            });
        }

        window.clearHistory = function() {
            history = [];
            localStorage.removeItem('picker-history');
            renderHistory();
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            renderHistory();
            document.getElementById('textInput').addEventListener('input', updateStats);
            updateStats();
        });
    </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‰ªäÊó•ËøêÂäø - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="‰ªäÊó•ËøêÂäø - WebUtils" />
    <meta name="keywords" content="fortune-teller,fun,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/fun/fortune-teller.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="‰ªäÊó•ËøêÂäø - WebUtils" />
    <meta property="og:description" content="‰ªäÊó•ËøêÂäø - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/fun/fortune-teller.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="‰ªäÊó•ËøêÂäø - WebUtils" />
    <meta name="twitter:description" content="‰ªäÊó•ËøêÂäø - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <meta name="description" content="ÊØèÊó•ËøêÂäøÁ≠æÊñáÔºåËé∑Âèñ‰ªäÊó•ÁöÑÂ•ΩËøêÊåáÂºï" />
    <meta name="keywords" content="ËøêÂäø,Á≠æÊñá,ÊØèÊó•ËøêÂäø,Â•ΩËøê,fortune" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;

        /* Â≠ó‰ΩìÂèòÈáè */
        --font-sans:
          "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --bg-elevated: #1a1a24;
        --border-subtle: #2a2a3a;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #a0a0b0;
        --color-text-muted: #606070;
        --color-accent-cyan: #00f5d4;
        --color-accent-purple: #bf5af2;
        --accent-green: #30d158;
        --accent-orange: #ff9f0a;
        --accent-red: #ff453a;
        --accent-gold: #ffd700;
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 16px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-bg-deep);
        color: var(--color-text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 24px 20px;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: var(--color-text-secondary);
        text-decoration: none;
        font-size: 14px;
        margin-bottom: 20px;
        transition: color 0.2s;
      }

      .back-link:hover {
        color: var(--color-accent-cyan);
      }

      h1 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        color: var(--color-text-secondary);
        margin-bottom: 32px;
        font-size: 15px;
      }

      .fortune-card {
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 40px 32px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .fortune-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--accent-gold),
          var(--accent-orange),
          var(--color-accent-purple)
        );
      }

      .fortune-date {
        font-size: 14px;
        color: var(--color-text-muted);
        margin-bottom: 24px;
      }

      .fortune-icon {
        font-size: 64px;
        margin-bottom: 24px;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .fortune-level {
        display: inline-block;
        padding: 8px 24px;
        border-radius: 20px;
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 24px;
      }

      .fortune-level.great {
        background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
        color: #000;
      }

      .fortune-level.good {
        background: var(--accent-green);
        color: #000;
      }

      .fortune-level.normal {
        background: var(--color-accent-cyan);
        color: #000;
      }

      .fortune-level.bad {
        background: var(--color-accent-purple);
        color: #fff;
      }

      .fortune-message {
        font-size: 20px;
        line-height: 1.8;
        margin-bottom: 32px;
        color: var(--color-text-primary);
      }

      .fortune-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 32px;
      }

      .detail-item {
        background: var(--bg-elevated);
        border-radius: var(--radius-md);
        padding: 16px;
        text-align: left;
      }

      .detail-label {
        font-size: 12px;
        color: var(--color-text-muted);
        margin-bottom: 4px;
      }

      .detail-value {
        font-size: 16px;
        font-weight: 600;
      }

      .detail-value.good {
        color: var(--accent-green);
      }
      .detail-value.bad {
        color: var(--accent-red);
      }
      .detail-value.neutral {
        color: var(--color-accent-cyan);
      }

      .lucky-items {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-bottom: 32px;
      }

      .lucky-item {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        padding: 8px 16px;
        font-size: 14px;
      }

      .lucky-item span {
        margin-right: 6px;
      }

      .btn {
        padding: 14px 32px;
        border: none;
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
        color: #000;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
      }

      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .share-section {
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid var(--border-subtle);
      }

      .share-btn {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        color: var(--color-text-secondary);
        padding: 10px 20px;
      }

      .share-btn:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .history-section {
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-top: 24px;
      }

      .history-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--color-text-secondary);
      }

      .history-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: var(--bg-elevated);
        border-radius: var(--radius-sm);
      }

      .history-date {
        font-size: 14px;
        color: var(--color-text-muted);
      }

      .history-level {
        font-size: 14px;
        font-weight: 600;
      }

      .countdown {
        font-size: 14px;
        color: var(--color-text-muted);
        margin-top: 16px;
      }

      @keyframes shake {
        0%,
        100% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(10deg);
        }
      }

      .fortune-icon.shaking {
        animation: shake 0.5s ease-in-out;
      }

      @media (max-width: 480px) {
        .fortune-details {
          grid-template-columns: 1fr;
        }

        .fortune-message {
          font-size: 18px;
        }
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="ÂàáÊç¢‰∏ªÈ¢ò">
      <span id="theme-icon">üåô</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">È¶ñÈ°µ</a>
      <span>‚Ä∫</span>
      ‰ªäÊó•ËøêÂäø
    </nav>
    <div class="container">
      <h1>‰ªäÊó•ËøêÂäø</h1>
      <p class="subtitle">ÊØèÊó•‰∏ÄÁ≠æÔºåÂèëÁé∞‰ªäÂ§©ÁöÑÂ•ΩËøêÊ∞î</p>

      <div class="fortune-card">
        <div class="fortune-date" id="fortuneDate"></div>
        <div class="fortune-icon" id="fortuneIcon">üîÆ</div>
        <div class="fortune-level" id="fortuneLevel">ÁÇπÂáªÊ±ÇÁ≠æ</div>
        <div class="fortune-message" id="fortuneMessage">ÊëáÂä®Ê∞¥Êô∂ÁêÉÔºåÊè≠Á§∫‰ªäÊó•ËøêÂäø</div>

        <div class="fortune-details" id="fortuneDetails" style="display: none">
          <div class="detail-item">
            <div class="detail-label">ÂÆú</div>
            <div class="detail-value good" id="goodThing">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Âøå</div>
            <div class="detail-value bad" id="badThing">-</div>
          </div>
        </div>

        <div class="lucky-items" id="luckyItems" style="display: none"></div>

        <button class="btn btn-primary" id="drawBtn">Ê±ÇÁ≠æ</button>
        <div class="countdown" id="countdown" style="display: none"></div>

        <div class="share-section" id="shareSection" style="display: none">
          <button class="btn share-btn" id="shareBtn">Â§çÂà∂ÂàÜ‰∫´ÊñáÊ°à</button>
        </div>
      </div>

      <div class="history-section" id="historySection" style="display: none">
        <div class="history-title">ÂéÜÂè≤ËÆ∞ÂΩï</div>
        <div class="history-list" id="historyList"></div>
      </div>
    </div>

    <script>
      (function () {
        "use strict";

        const FORTUNE_DATA = {
          levels: [
            { name: "Â§ßÂêâ", class: "great", icon: "üåü", weight: 10 },
            { name: "‰∏≠Âêâ", class: "good", icon: "‚ú®", weight: 25 },
            { name: "Â∞èÂêâ", class: "good", icon: "üçÄ", weight: 30 },
            { name: "Âπ≥", class: "normal", icon: "‚òØÔ∏è", weight: 25 },
            { name: "Â∞èÂá∂", class: "bad", icon: "üåô", weight: 10 }
          ],
          messages: {
            great: [
              "‰ªäÊó•ËøêÂäøÊûÅ‰Ω≥Ôºå‰∏á‰∫ãÈ°∫ÈÅÇÔºåË¥µ‰∫∫Áõ∏Âä©„ÄÇ",
              "ÊòüÂÖâÁíÄÁí®ÁÖßÂâçÁ®ãÔºå‰∏ÄÂàáÂä™ÂäõÁöÜÊúâÂõûÊä•„ÄÇ",
              "Â•ΩËøêÁàÜÊ£öÁöÑ‰∏ÄÂ§©ÔºåÊääÊè°Êú∫‰ºöÂãáÂæÄÁõ¥ÂâçÔºÅ",
              "‰ªäÊó•ÂÆúÂ§ßËÉÜË°åÂä®ÔºåÊàêÂäüÂ∞±Âú®ÁúºÂâç„ÄÇ"
            ],
            good: [
              "‰ªäÊó•ËøêÂäøËâØÂ•ΩÔºå‰øùÊåÅÁßØÊûÅÂøÉÊÄÅ„ÄÇ",
              "Á®≥‰∏≠Ê±ÇËøõÔºåÂ∞è‰∫ãÈ°∫Âà©ÔºåÂ§ß‰∫ãÂèØÊúü„ÄÇ",
              "‰ªäÊó•ÈÄÇÂêàÂ≠¶‰π†Êñ∞ÊäÄËÉΩÔºå‰ºöÊúâÊÑèÂ§ñÊî∂Ëé∑„ÄÇ",
              "‰∫∫ÈôÖÂÖ≥Á≥ªÂíåË∞êÔºåÈÄÇÂêàÁ§æ‰∫§Ê¥ªÂä®„ÄÇ"
            ],
            normal: [
              "‰ªäÊó•ËøêÂäøÂπ≥Á®≥ÔºåÂÆúÈùô‰∏çÂÆúÂä®„ÄÇ",
              "Âπ≥Âá°ÁöÑ‰∏ÄÂ§©‰πüÊúâÂ∞èÁ°ÆÂπ∏Á≠âÁùÄ‰Ω†„ÄÇ",
              "‰øùÊåÅÂπ≥Â∏∏ÂøÉÔºåÈ°∫ÂÖ∂Ëá™ÁÑ∂ÊúÄÂ•Ω„ÄÇ",
              "‰ªäÊó•ÈÄÇÂêàÊï¥ÁêÜÊÄùÁª™Ôºå‰∏∫Êú™Êù•ÂÅöÂáÜÂ§á„ÄÇ"
            ],
            bad: [
              "‰ªäÊó•ÂÆú‰ΩéË∞ÉË°å‰∫ãÔºåÈÅøÂÖçÂÜ≤Á™Å„ÄÇ",
              "Â∞èÂøÉÈ©∂Âæó‰∏áÂπ¥ËàπÔºåË∞®ÊÖé‰∏∫‰∏ä„ÄÇ",
              "ÈÄÜÂ¢É‰∏≠Ëï¥ËóèÊú∫ÈÅáÔºå‰øùÊåÅ‰πêËßÇ„ÄÇ",
              "‰ªäÊó•‰∏çÂÆúÂÜíÈô©ÔºåÁ®≥ÊâéÁ®≥ÊâìÊúÄÈáçË¶Å„ÄÇ"
            ]
          },
          goodThings: [
            "ÂÜô‰ª£Á†Å",
            "Â≠¶‰π†",
            "ËøêÂä®",
            "ÈòÖËØª",
            "ÂÜ•ÊÉ≥",
            "Êó©Ëµ∑",
            "ÂñùÂíñÂï°",
            "Âê¨Èü≥‰πê",
            "Êï£Ê≠•",
            "Êï¥ÁêÜ",
            "Âàõ‰Ωú",
            "Ê≤üÈÄö",
            "ËßÑÂàí",
            "Â§çÁõò",
            "Â∞ùËØïÊñ∞‰∫ãÁâ©",
            "Â∏ÆÂä©‰ªñ‰∫∫"
          ],
          badThings: [
            "ÁÜ¨Â§ú",
            "ÊãñÂª∂",
            "ÂÜ≤Âä®Ê∂àË¥π",
            "‰∫âÂêµ",
            "ËøáÂ∫¶Âä≥Á¥Ø",
            "Ë∑≥ËøáÊµãËØï",
            "ÂøΩÁï•ÊñáÊ°£",
            "Êï∑Ë°ç‰∫Ü‰∫ã",
            "ÈíªÁâõËßíÂ∞ñ"
          ],
          luckyColors: [
            { name: "ËìùËâ≤", emoji: "üíô" },
            { name: "ÁªøËâ≤", emoji: "üíö" },
            { name: "Á¥´Ëâ≤", emoji: "üíú" },
            { name: "ÈáëËâ≤", emoji: "üíõ" },
            { name: "ÁôΩËâ≤", emoji: "ü§ç" },
            { name: "Ê©ôËâ≤", emoji: "üß°" }
          ],
          luckyNumbers: ["1", "3", "5", "7", "8", "9", "11", "13", "21", "42"],
          luckyDirections: ["‰∏ú", "Âçó", "Ë•ø", "Âåó", "‰∏úÂçó", "Ë•øÂçó", "‰∏úÂåó", "Ë•øÂåó"]
        };

        // DOM Elements
        const fortuneDate = document.getElementById("fortuneDate");
        const fortuneIcon = document.getElementById("fortuneIcon");
        const fortuneLevel = document.getElementById("fortuneLevel");
        const fortuneMessage = document.getElementById("fortuneMessage");
        const fortuneDetails = document.getElementById("fortuneDetails");
        const goodThing = document.getElementById("goodThing");
        const badThing = document.getElementById("badThing");
        const luckyItems = document.getElementById("luckyItems");
        const drawBtn = document.getElementById("drawBtn");
        const countdown = document.getElementById("countdown");
        const shareSection = document.getElementById("shareSection");
        const shareBtn = document.getElementById("shareBtn");
        const historySection = document.getElementById("historySection");
        const historyList = document.getElementById("historyList");

        function getDateString(date = new Date()) {
          return date.toLocaleDateString("zh-CN", {
            year: "numeric",
            month: "long",
            day: "numeric",
            weekday: "long"
          });
        }

        function getTodayKey() {
          const d = new Date();
          return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
        }

        function seededRandom(seed) {
          const x = Math.sin(seed) * 10000;
          return x - Math.floor(x);
        }

        function pickRandom(arr, seed) {
          return arr[Math.floor(seededRandom(seed) * arr.length)];
        }

        function pickWeighted(items, seed) {
          const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
          let random = seededRandom(seed) * totalWeight;

          for (const item of items) {
            random -= item.weight;
            if (random <= 0) return item;
          }
          return items[items.length - 1];
        }

        function generateFortune(dateKey) {
          // Use date as seed for reproducible results
          const seed = dateKey.split("-").reduce((a, b) => a + parseInt(b), 0);

          const level = pickWeighted(FORTUNE_DATA.levels, seed);
          const messageType =
            level.class === "great"
              ? "great"
              : level.class === "good"
                ? "good"
                : level.class === "normal"
                  ? "normal"
                  : "bad";

          const message = pickRandom(FORTUNE_DATA.messages[messageType], seed + 1);
          const good = pickRandom(FORTUNE_DATA.goodThings, seed + 2);
          const bad = pickRandom(FORTUNE_DATA.badThings, seed + 3);
          const color = pickRandom(FORTUNE_DATA.luckyColors, seed + 4);
          const number = pickRandom(FORTUNE_DATA.luckyNumbers, seed + 5);
          const direction = pickRandom(FORTUNE_DATA.luckyDirections, seed + 6);

          return {
            level,
            message,
            good,
            bad,
            luckyColor: color,
            luckyNumber: number,
            luckyDirection: direction,
            date: dateKey
          };
        }

        function displayFortune(fortune) {
          fortuneIcon.textContent = fortune.level.icon;
          fortuneLevel.textContent = fortune.level.name;
          fortuneLevel.className = `fortune-level ${fortune.level.class}`;
          fortuneMessage.textContent = fortune.message;

          goodThing.textContent = fortune.good;
          badThing.textContent = fortune.bad;
          fortuneDetails.style.display = "grid";

          luckyItems.innerHTML = "";
          const items = [
            { emoji: fortune.luckyColor.emoji, text: `Âπ∏ËøêËâ≤: ${fortune.luckyColor.name}` },
            { emoji: "üî¢", text: `Âπ∏ËøêÊï∞: ${fortune.luckyNumber}` },
            { emoji: "üß≠", text: `Âπ∏ËøêÊñπ‰Ωç: ${fortune.luckyDirection}` }
          ];
          items.forEach((item) => {
            const div = document.createElement("div");
            div.className = "lucky-item";
            const span = document.createElement("span");
            span.textContent = item.emoji;
            div.appendChild(span);
            div.appendChild(document.createTextNode(item.text));
            luckyItems.appendChild(div);
          });
          luckyItems.style.display = "flex";

          shareSection.style.display = "block";
          drawBtn.textContent = "‰ªäÊó•Â∑≤Ê±ÇÁ≠æ";
          drawBtn.disabled = true;
        }

        function saveFortune(fortune) {
          const history = JSON.parse(localStorage.getItem("fortuneHistory") || "[]");

          // Check if already exists
          if (history.some((h) => h.date === fortune.date)) return;

          history.unshift({
            date: fortune.date,
            level: fortune.level.name,
            levelClass: fortune.level.class
          });

          // Keep last 7 days
          localStorage.setItem("fortuneHistory", JSON.stringify(history.slice(0, 7)));
          localStorage.setItem("lastFortune", JSON.stringify(fortune));
          localStorage.setItem("lastFortuneDate", fortune.date);
        }

        function loadHistory() {
          let history = [];
          try {
            history = JSON.parse(localStorage.getItem("fortuneHistory") || "[]");
          } catch (e) {
            localStorage.removeItem("fortuneHistory");
          }

          if (history.length === 0) {
            historySection.style.display = "none";
            return;
          }

          historySection.style.display = "block";
          historyList.innerHTML = "";
          history.forEach((h) => {
            const div = document.createElement("div");
            div.className = "history-item";
            const dateSpan = document.createElement("span");
            dateSpan.className = "history-date";
            dateSpan.textContent = h.date || "";
            const levelSpan = document.createElement("span");
            levelSpan.className = "history-level " + (h.levelClass || "");
            levelSpan.textContent = h.level || "";
            div.appendChild(dateSpan);
            div.appendChild(levelSpan);
            historyList.appendChild(div);
          });
        }

        function checkTodayFortune() {
          const todayKey = getTodayKey();
          const lastDate = localStorage.getItem("lastFortuneDate");

          if (lastDate === todayKey) {
            const fortune = JSON.parse(localStorage.getItem("lastFortune"));
            displayFortune(fortune);
            updateCountdown();
          }
        }

        function updateCountdown() {
          const now = new Date();
          const tomorrow = new Date(now);
          tomorrow.setDate(tomorrow.getDate() + 1);
          tomorrow.setHours(0, 0, 0, 0);

          const diff = tomorrow - now;
          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

          countdown.textContent = `Ë∑ùÁ¶ª‰∏ãÊ¨°Ê±ÇÁ≠æ: ${hours}Â∞èÊó∂${minutes}ÂàÜÈíü`;
          countdown.style.display = "block";
        }

        function drawFortune() {
          const todayKey = getTodayKey();

          // Animation
          fortuneIcon.classList.add("shaking");
          drawBtn.disabled = true;
          drawBtn.textContent = "Ê±ÇÁ≠æ‰∏≠...";

          setTimeout(() => {
            fortuneIcon.classList.remove("shaking");

            const fortune = generateFortune(todayKey);
            displayFortune(fortune);
            saveFortune(fortune);
            loadHistory();
            updateCountdown();
          }, 1000);
        }

        function copyShareText() {
          const lastFortune = JSON.parse(localStorage.getItem("lastFortune"));
          if (!lastFortune) return;

          const text = `üîÆ ‰ªäÊó•ËøêÂäø - ${lastFortune.level.name}

${lastFortune.message}

‚úÖ ÂÆú: ${lastFortune.good}
‚ùå Âøå: ${lastFortune.bad}
${lastFortune.luckyColor.emoji} Âπ∏ËøêËâ≤: ${lastFortune.luckyColor.name}
üî¢ Âπ∏ËøêÊï∞: ${lastFortune.luckyNumber}
üß≠ Âπ∏ËøêÊñπ‰Ωç: ${lastFortune.luckyDirection}

‚Äî Êù•Ëá™ WebUtils ‰ªäÊó•ËøêÂäø`;

          navigator.clipboard.writeText(text).then(() => {
            shareBtn.textContent = "Â∑≤Â§çÂà∂!";
            setTimeout(() => {
              shareBtn.textContent = "Â§çÂà∂ÂàÜ‰∫´ÊñáÊ°à";
            }, 2000);
          });
        }

        // Event Listeners
        drawBtn.addEventListener("click", drawFortune);
        shareBtn.addEventListener("click", copyShareText);

        // Initialize
        fortuneDate.textContent = getDateString();
        checkTodayFortune();
        loadHistory();
      })();

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem("theme", newTheme);
      }

      // Load saved theme
      const savedTheme = localStorage.getItem("theme") || "dark";
      if (savedTheme === "light") {
        document.documentElement.setAttribute("data-theme", "light");
        document.getElementById("theme-icon").textContent = "‚òÄÔ∏è";
      }
    </script>
  </body>
</html>

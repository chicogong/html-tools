<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦‚ç‡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { min-height: 100vh; padding: 2rem 1rem; }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .tabs button { flex: 1; min-width: 100px; }
        .tabs button.active { background: var(--pico-primary); color: var(--pico-primary-inverse); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .calc-box { background: var(--pico-muted-border-color); border-radius: var(--pico-border-radius); padding: 1.5rem; margin-bottom: 1.5rem; }
        .result-highlight { font-size: 2rem; font-weight: bold; color: var(--pico-primary); text-align: center; margin: 1rem 0; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .result-card { background: var(--pico-background-color); border-radius: var(--pico-border-radius); padding: 1rem; text-align: center; }
        .result-card h5 { margin: 0 0 0.5rem; font-size: 0.85rem; color: var(--pico-muted-color); }
        .result-card .value { font-size: 1.2rem; font-weight: bold; font-family: monospace; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .formula { background: var(--pico-background-color); padding: 1rem; border-radius: var(--pico-border-radius); margin-top: 1rem; font-family: monospace; text-align: center; }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>æ¦‚ç‡è®¡ç®—å™¨</h1>
            <button id="themeToggle" class="outline" onclick="toggleTheme()">ğŸŒ™</button>
        </header>

        <div class="tabs">
            <button class="active" onclick="showTab('basic')">åŸºç¡€æ¦‚ç‡</button>
            <button onclick="showTab('binomial')">äºŒé¡¹åˆ†å¸ƒ</button>
            <button onclick="showTab('normal')">æ­£æ€åˆ†å¸ƒ</button>
            <button onclick="showTab('poisson')">æ³Šæ¾åˆ†å¸ƒ</button>
            <button onclick="showTab('bayes')">è´å¶æ–¯</button>
        </div>

        <div id="basic" class="tab-content active">
            <div class="calc-box">
                <h3>åŸºç¡€æ¦‚ç‡è®¡ç®—</h3>
                <div class="input-row">
                    <div>
                        <label>æœ‰åˆ©ç»“æœæ•°</label>
                        <input type="number" id="favorable" value="1" min="0">
                    </div>
                    <div>
                        <label>æ€»å¯èƒ½ç»“æœæ•°</label>
                        <input type="number" id="total" value="6" min="1">
                    </div>
                </div>
                <button onclick="calcBasic()" style="margin-top: 1rem;">è®¡ç®—æ¦‚ç‡</button>

                <div class="result-highlight" id="basicResult">0%</div>

                <div class="result-grid">
                    <div class="result-card"><h5>æ¦‚ç‡ (å°æ•°)</h5><div class="value" id="probDecimal">0</div></div>
                    <div class="result-card"><h5>æ¦‚ç‡ (ç™¾åˆ†æ¯”)</h5><div class="value" id="probPercent">0%</div></div>
                    <div class="result-card"><h5>èµ”ç‡ (æœ‰åˆ©:ä¸åˆ©)</h5><div class="value" id="oddsFor">0:0</div></div>
                    <div class="result-card"><h5>ä¸å‘ç”Ÿæ¦‚ç‡</h5><div class="value" id="probAgainst">0%</div></div>
                </div>

                <div class="formula">P(A) = æœ‰åˆ©ç»“æœæ•° / æ€»å¯èƒ½ç»“æœæ•°</div>
            </div>

            <div class="calc-box">
                <h3>ç‹¬ç«‹äº‹ä»¶æ¦‚ç‡</h3>
                <div class="input-row">
                    <div>
                        <label>äº‹ä»¶Aæ¦‚ç‡</label>
                        <input type="number" id="probA" value="0.5" min="0" max="1" step="0.01">
                    </div>
                    <div>
                        <label>äº‹ä»¶Bæ¦‚ç‡</label>
                        <input type="number" id="probB" value="0.3" min="0" max="1" step="0.01">
                    </div>
                </div>
                <button onclick="calcIndependent()" style="margin-top: 1rem;">è®¡ç®—</button>

                <div class="result-grid">
                    <div class="result-card"><h5>Aä¸”B (P(Aâˆ©B))</h5><div class="value" id="probAnd">0</div></div>
                    <div class="result-card"><h5>Aæˆ–B (P(AâˆªB))</h5><div class="value" id="probOr">0</div></div>
                    <div class="result-card"><h5>éA (P(A'))</h5><div class="value" id="probNotA">0</div></div>
                    <div class="result-card"><h5>éB (P(B'))</h5><div class="value" id="probNotB">0</div></div>
                </div>
            </div>
        </div>

        <div id="binomial" class="tab-content">
            <div class="calc-box">
                <h3>äºŒé¡¹åˆ†å¸ƒ</h3>
                <p style="color: var(--pico-muted-color);">næ¬¡ç‹¬ç«‹è¯•éªŒä¸­æ°å¥½å‘ç”Ÿkæ¬¡æˆåŠŸçš„æ¦‚ç‡</p>
                <div class="input-row">
                    <div>
                        <label>è¯•éªŒæ¬¡æ•° (n)</label>
                        <input type="number" id="binN" value="10" min="1">
                    </div>
                    <div>
                        <label>æˆåŠŸæ¬¡æ•° (k)</label>
                        <input type="number" id="binK" value="3" min="0">
                    </div>
                    <div>
                        <label>å•æ¬¡æˆåŠŸæ¦‚ç‡ (p)</label>
                        <input type="number" id="binP" value="0.5" min="0" max="1" step="0.01">
                    </div>
                </div>
                <button onclick="calcBinomial()" style="margin-top: 1rem;">è®¡ç®—</button>

                <div class="result-highlight" id="binomialResult">0%</div>

                <div class="result-grid">
                    <div class="result-card"><h5>P(X = k)</h5><div class="value" id="binExact">0</div></div>
                    <div class="result-card"><h5>P(X â‰¤ k)</h5><div class="value" id="binLessEq">0</div></div>
                    <div class="result-card"><h5>P(X â‰¥ k)</h5><div class="value" id="binGreaterEq">0</div></div>
                    <div class="result-card"><h5>æœŸæœ›å€¼ E(X)</h5><div class="value" id="binExpected">0</div></div>
                    <div class="result-card"><h5>æ–¹å·® Var(X)</h5><div class="value" id="binVariance">0</div></div>
                    <div class="result-card"><h5>æ ‡å‡†å·® Ïƒ</h5><div class="value" id="binStdDev">0</div></div>
                </div>

                <div class="formula">P(X=k) = C(n,k) Ã— p^k Ã— (1-p)^(n-k)</div>
            </div>
        </div>

        <div id="normal" class="tab-content">
            <div class="calc-box">
                <h3>æ­£æ€åˆ†å¸ƒ</h3>
                <div class="input-row">
                    <div>
                        <label>å‡å€¼ (Î¼)</label>
                        <input type="number" id="normMean" value="0" step="any">
                    </div>
                    <div>
                        <label>æ ‡å‡†å·® (Ïƒ)</label>
                        <input type="number" id="normStd" value="1" min="0.001" step="any">
                    </div>
                    <div>
                        <label>æ•°å€¼ (x)</label>
                        <input type="number" id="normX" value="1" step="any">
                    </div>
                </div>
                <button onclick="calcNormal()" style="margin-top: 1rem;">è®¡ç®—</button>

                <div class="result-highlight" id="normalResult">Z = 0</div>

                <div class="result-grid">
                    <div class="result-card"><h5>Zåˆ†æ•°</h5><div class="value" id="zScore">0</div></div>
                    <div class="result-card"><h5>P(X â‰¤ x)</h5><div class="value" id="normLess">0</div></div>
                    <div class="result-card"><h5>P(X â‰¥ x)</h5><div class="value" id="normGreater">0</div></div>
                    <div class="result-card"><h5>PDF f(x)</h5><div class="value" id="normPdf">0</div></div>
                </div>

                <h4 style="margin-top: 1.5rem;">æŸ¥æ‰¾åˆ†ä½æ•°</h4>
                <div class="input-row">
                    <div>
                        <label>ç´¯ç§¯æ¦‚ç‡</label>
                        <input type="number" id="normProb" value="0.95" min="0" max="1" step="0.01">
                    </div>
                    <div>
                        <button onclick="calcNormalInverse()" style="margin-top: 1.8rem;">æ±‚xå€¼</button>
                    </div>
                </div>
                <div class="result-card" style="margin-top: 1rem;"><h5>å¯¹åº”çš„xå€¼</h5><div class="value" id="normInverse">0</div></div>
            </div>
        </div>

        <div id="poisson" class="tab-content">
            <div class="calc-box">
                <h3>æ³Šæ¾åˆ†å¸ƒ</h3>
                <p style="color: var(--pico-muted-color);">å•ä½æ—¶é—´å†…äº‹ä»¶å‘ç”Ÿkæ¬¡çš„æ¦‚ç‡</p>
                <div class="input-row">
                    <div>
                        <label>å¹³å‡å‘ç”Ÿç‡ (Î»)</label>
                        <input type="number" id="poissonLambda" value="3" min="0" step="0.1">
                    </div>
                    <div>
                        <label>å‘ç”Ÿæ¬¡æ•° (k)</label>
                        <input type="number" id="poissonK" value="2" min="0">
                    </div>
                </div>
                <button onclick="calcPoisson()" style="margin-top: 1rem;">è®¡ç®—</button>

                <div class="result-highlight" id="poissonResult">0%</div>

                <div class="result-grid">
                    <div class="result-card"><h5>P(X = k)</h5><div class="value" id="poisExact">0</div></div>
                    <div class="result-card"><h5>P(X â‰¤ k)</h5><div class="value" id="poisLessEq">0</div></div>
                    <div class="result-card"><h5>P(X â‰¥ k)</h5><div class="value" id="poisGreaterEq">0</div></div>
                    <div class="result-card"><h5>æœŸæœ›å€¼ E(X)</h5><div class="value" id="poisExpected">0</div></div>
                </div>

                <div class="formula">P(X=k) = (Î»^k Ã— e^(-Î»)) / k!</div>
            </div>
        </div>

        <div id="bayes" class="tab-content">
            <div class="calc-box">
                <h3>è´å¶æ–¯å®šç†</h3>
                <p style="color: var(--pico-muted-color);">å·²çŸ¥Bå‘ç”Ÿï¼Œæ±‚Aå‘ç”Ÿçš„æ¡ä»¶æ¦‚ç‡</p>
                <div class="input-row">
                    <div>
                        <label>P(A) å…ˆéªŒæ¦‚ç‡</label>
                        <input type="number" id="bayesPriorA" value="0.01" min="0" max="1" step="0.001">
                    </div>
                    <div>
                        <label>P(B|A) ä¼¼ç„¶åº¦</label>
                        <input type="number" id="bayesLikelihood" value="0.9" min="0" max="1" step="0.01">
                    </div>
                    <div>
                        <label>P(B|éA)</label>
                        <input type="number" id="bayesFalsePositive" value="0.05" min="0" max="1" step="0.01">
                    </div>
                </div>
                <button onclick="calcBayes()" style="margin-top: 1rem;">è®¡ç®—åéªŒæ¦‚ç‡</button>

                <div class="result-highlight" id="bayesResult">P(A|B) = 0%</div>

                <div class="result-grid">
                    <div class="result-card"><h5>P(A|B) åéªŒæ¦‚ç‡</h5><div class="value" id="bayesPosterior">0</div></div>
                    <div class="result-card"><h5>P(B) è¾¹é™…æ¦‚ç‡</h5><div class="value" id="bayesMarginal">0</div></div>
                    <div class="result-card"><h5>P(éA|B)</h5><div class="value" id="bayesNotA">0</div></div>
                </div>

                <div class="formula">P(A|B) = P(B|A) Ã— P(A) / P(B)</div>
            </div>
        </div>

        <article style="margin-top: 2rem;">
            <h4>å¸¸ç”¨æ¦‚ç‡å…¬å¼</h4>
            <table>
                <thead><tr><th>å…¬å¼</th><th>æè¿°</th></tr></thead>
                <tbody>
                    <tr><td>P(A') = 1 - P(A)</td><td>è¡¥é›†æ¦‚ç‡</td></tr>
                    <tr><td>P(AâˆªB) = P(A) + P(B) - P(Aâˆ©B)</td><td>åŠ æ³•å…¬å¼</td></tr>
                    <tr><td>P(Aâˆ©B) = P(A) Ã— P(B)</td><td>ç‹¬ç«‹äº‹ä»¶ä¹˜æ³•</td></tr>
                    <tr><td>P(A|B) = P(Aâˆ©B) / P(B)</td><td>æ¡ä»¶æ¦‚ç‡</td></tr>
                </tbody>
            </table>
        </article>
    </main>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function factorial(n) {
            if (n <= 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) result *= i;
            return result;
        }

        function combination(n, k) {
            if (k > n) return 0;
            return factorial(n) / (factorial(k) * factorial(n - k));
        }

        function format(num, digits = 6) {
            return Number.isFinite(num) ? num.toFixed(digits) : '0';
        }

        function calcBasic() {
            const favorable = parseFloat(document.getElementById('favorable').value) || 0;
            const total = parseFloat(document.getElementById('total').value) || 1;
            
            const prob = favorable / total;
            const against = total - favorable;

            document.getElementById('basicResult').textContent = (prob * 100).toFixed(2) + '%';
            document.getElementById('probDecimal').textContent = format(prob);
            document.getElementById('probPercent').textContent = (prob * 100).toFixed(4) + '%';
            document.getElementById('oddsFor').textContent = favorable + ':' + against;
            document.getElementById('probAgainst').textContent = ((1 - prob) * 100).toFixed(4) + '%';
        }

        function calcIndependent() {
            const pA = parseFloat(document.getElementById('probA').value) || 0;
            const pB = parseFloat(document.getElementById('probB').value) || 0;

            document.getElementById('probAnd').textContent = format(pA * pB);
            document.getElementById('probOr').textContent = format(pA + pB - pA * pB);
            document.getElementById('probNotA').textContent = format(1 - pA);
            document.getElementById('probNotB').textContent = format(1 - pB);
        }

        function calcBinomial() {
            const n = parseInt(document.getElementById('binN').value) || 1;
            const k = parseInt(document.getElementById('binK').value) || 0;
            const p = parseFloat(document.getElementById('binP').value) || 0.5;

            const exact = combination(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
            
            let lessEq = 0;
            for (let i = 0; i <= k; i++) {
                lessEq += combination(n, i) * Math.pow(p, i) * Math.pow(1 - p, n - i);
            }

            const expected = n * p;
            const variance = n * p * (1 - p);

            document.getElementById('binomialResult').textContent = (exact * 100).toFixed(4) + '%';
            document.getElementById('binExact').textContent = format(exact);
            document.getElementById('binLessEq').textContent = format(lessEq);
            document.getElementById('binGreaterEq').textContent = format(1 - lessEq + exact);
            document.getElementById('binExpected').textContent = format(expected, 2);
            document.getElementById('binVariance').textContent = format(variance, 4);
            document.getElementById('binStdDev').textContent = format(Math.sqrt(variance), 4);
        }

        // Standard normal CDF approximation
        function normalCDF(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;

            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x) / Math.sqrt(2);

            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

            return 0.5 * (1.0 + sign * y);
        }

        function normalPDF(x, mean, std) {
            return Math.exp(-0.5 * Math.pow((x - mean) / std, 2)) / (std * Math.sqrt(2 * Math.PI));
        }

        function normalInverseCDF(p) {
            // Approximation for inverse normal CDF
            if (p <= 0) return -Infinity;
            if (p >= 1) return Infinity;
            if (p === 0.5) return 0;

            const a = [
                -3.969683028665376e+01, 2.209460984245205e+02,
                -2.759285104469687e+02, 1.383577518672690e+02,
                -3.066479806614716e+01, 2.506628277459239e+00
            ];
            const b = [
                -5.447609879822406e+01, 1.615858368580409e+02,
                -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01
            ];
            const c = [
                -7.784894002430293e-03, -3.223964580411365e-01,
                -2.400758277161838e+00, -2.549732539343734e+00,
                4.374664141464968e+00, 2.938163982698783e+00
            ];
            const d = [
                7.784695709041462e-03, 3.224671290700398e-01,
                2.445134137142996e+00, 3.754408661907416e+00
            ];

            const pLow = 0.02425;
            const pHigh = 1 - pLow;
            let q, r;

            if (p < pLow) {
                q = Math.sqrt(-2 * Math.log(p));
                return (((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) /
                       ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
            } else if (p <= pHigh) {
                q = p - 0.5;
                r = q * q;
                return (((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q /
                       (((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1);
            } else {
                q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) /
                        ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
            }
        }

        function calcNormal() {
            const mean = parseFloat(document.getElementById('normMean').value) || 0;
            const std = parseFloat(document.getElementById('normStd').value) || 1;
            const x = parseFloat(document.getElementById('normX').value) || 0;

            const z = (x - mean) / std;
            const cdf = normalCDF(z);
            const pdf = normalPDF(x, mean, std);

            document.getElementById('normalResult').textContent = 'Z = ' + format(z, 4);
            document.getElementById('zScore').textContent = format(z, 4);
            document.getElementById('normLess').textContent = format(cdf);
            document.getElementById('normGreater').textContent = format(1 - cdf);
            document.getElementById('normPdf').textContent = format(pdf);
        }

        function calcNormalInverse() {
            const mean = parseFloat(document.getElementById('normMean').value) || 0;
            const std = parseFloat(document.getElementById('normStd').value) || 1;
            const prob = parseFloat(document.getElementById('normProb').value) || 0.5;

            const z = normalInverseCDF(prob);
            const x = z * std + mean;

            document.getElementById('normInverse').textContent = format(x, 4);
        }

        function calcPoisson() {
            const lambda = parseFloat(document.getElementById('poissonLambda').value) || 1;
            const k = parseInt(document.getElementById('poissonK').value) || 0;

            const exact = Math.pow(lambda, k) * Math.exp(-lambda) / factorial(k);
            
            let lessEq = 0;
            for (let i = 0; i <= k; i++) {
                lessEq += Math.pow(lambda, i) * Math.exp(-lambda) / factorial(i);
            }

            document.getElementById('poissonResult').textContent = (exact * 100).toFixed(4) + '%';
            document.getElementById('poisExact').textContent = format(exact);
            document.getElementById('poisLessEq').textContent = format(lessEq);
            document.getElementById('poisGreaterEq').textContent = format(1 - lessEq + exact);
            document.getElementById('poisExpected').textContent = format(lambda, 2);
        }

        function calcBayes() {
            const pA = parseFloat(document.getElementById('bayesPriorA').value) || 0;
            const pBgivenA = parseFloat(document.getElementById('bayesLikelihood').value) || 0;
            const pBgivenNotA = parseFloat(document.getElementById('bayesFalsePositive').value) || 0;

            const pNotA = 1 - pA;
            const pB = pBgivenA * pA + pBgivenNotA * pNotA;
            const pAgivenB = (pBgivenA * pA) / pB;

            document.getElementById('bayesResult').textContent = 'P(A|B) = ' + (pAgivenB * 100).toFixed(2) + '%';
            document.getElementById('bayesPosterior').textContent = format(pAgivenB);
            document.getElementById('bayesMarginal').textContent = format(pB);
            document.getElementById('bayesNotA').textContent = format(1 - pAgivenB);
        }

        loadTheme();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿè®¡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body {
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .input-section {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--pico-muted-border-color);
        }
        .input-section h3 {
            margin: 0 0 1rem 0;
        }
        .input-section textarea {
            width: 100%;
            min-height: 100px;
            font-family: monospace;
            resize: vertical;
        }
        .input-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .input-controls button {
            margin: 0;
        }
        .data-preview {
            margin-top: 1rem;
            padding: 0.5rem;
            background: var(--pico-code-background-color);
            border-radius: var(--pico-border-radius);
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 60px;
            overflow-y: auto;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            border: 1px solid var(--pico-muted-border-color);
        }
        .stat-card .label {
            font-size: 0.85rem;
            color: var(--pico-muted-color);
            margin-bottom: 0.25rem;
        }
        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
        }
        .histogram-section {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            border: 1px solid var(--pico-muted-border-color);
            margin-bottom: 1rem;
        }
        .histogram-section h3 {
            margin: 0 0 1rem 0;
        }
        .histogram {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 2px;
            padding: 1rem 0;
            border-bottom: 2px solid var(--pico-muted-border-color);
        }
        .bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }
        .bar {
            width: 100%;
            background: var(--pico-primary);
            border-radius: 4px 4px 0 0;
            min-height: 2px;
            transition: height 0.3s ease;
        }
        .bar-label {
            font-size: 0.7rem;
            margin-top: 0.25rem;
            text-align: center;
            color: var(--pico-muted-color);
        }
        .bar-count {
            font-size: 0.7rem;
            color: var(--pico-primary);
            margin-bottom: 0.25rem;
        }
        .histogram-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            align-items: center;
        }
        .histogram-controls label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .histogram-controls input[type="number"] {
            width: 80px;
            margin: 0;
        }
        .quartile-section {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            border: 1px solid var(--pico-muted-border-color);
        }
        .box-plot {
            height: 60px;
            position: relative;
            margin: 2rem 1rem;
        }
        .box-plot-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--pico-muted-border-color);
        }
        .box-plot-box {
            position: absolute;
            top: 20%;
            height: 60%;
            background: var(--pico-primary);
            opacity: 0.3;
            border: 2px solid var(--pico-primary);
        }
        .box-plot-median {
            position: absolute;
            top: 20%;
            height: 60%;
            width: 3px;
            background: var(--pico-contrast);
        }
        .box-plot-whisker {
            position: absolute;
            top: 35%;
            height: 30%;
            width: 2px;
            background: var(--pico-muted-border-color);
        }
        .box-plot-cap {
            position: absolute;
            top: 35%;
            height: 30%;
            width: 10px;
            border-left: 2px solid var(--pico-muted-border-color);
            border-right: 2px solid var(--pico-muted-border-color);
        }
        .quartile-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h2>ç»Ÿè®¡è®¡ç®—å™¨</h2>
            <button class="outline" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ æ·±è‰²</button>
        </header>

        <div class="input-section">
            <h3>æ•°æ®è¾“å…¥</h3>
            <textarea id="dataInput" placeholder="è¾“å…¥æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”&#10;ä¾‹å¦‚: 1, 2, 3, 4, 5&#10;æˆ–: 1 2 3 4 5&#10;æˆ–æ¯è¡Œä¸€ä¸ªæ•°å­—"></textarea>
            <div class="input-controls">
                <button onclick="calculate()">è®¡ç®—ç»Ÿè®¡é‡</button>
                <button class="secondary" onclick="loadSampleData()">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
                <button class="secondary" onclick="generateRandom()">ç”Ÿæˆéšæœºæ•°æ®</button>
                <button class="contrast" onclick="clearData()">æ¸…ç©º</button>
            </div>
            <div class="data-preview" id="dataPreview">å·²è§£æ 0 ä¸ªæ•°æ®ç‚¹</div>
        </div>

        <div class="results" id="results">
            <div class="stat-card">
                <div class="label">æ•°æ®ä¸ªæ•° (n)</div>
                <div class="value" id="count">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æ€»å’Œ (Î£x)</div>
                <div class="value" id="sum">-</div>
            </div>
            <div class="stat-card">
                <div class="label">å¹³å‡å€¼ (xÌ„)</div>
                <div class="value" id="mean">-</div>
            </div>
            <div class="stat-card">
                <div class="label">ä¸­ä½æ•°</div>
                <div class="value" id="median">-</div>
            </div>
            <div class="stat-card">
                <div class="label">ä¼—æ•°</div>
                <div class="value" id="mode">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æ ‡å‡†å·® (Ïƒ)</div>
                <div class="value" id="stdDev">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æ–¹å·® (ÏƒÂ²)</div>
                <div class="value" id="variance">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æœ€å°å€¼</div>
                <div class="value" id="min">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æœ€å¤§å€¼</div>
                <div class="value" id="max">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æå·®</div>
                <div class="value" id="range">-</div>
            </div>
            <div class="stat-card">
                <div class="label">Q1 (25%)</div>
                <div class="value" id="q1">-</div>
            </div>
            <div class="stat-card">
                <div class="label">Q3 (75%)</div>
                <div class="value" id="q3">-</div>
            </div>
            <div class="stat-card">
                <div class="label">å››åˆ†ä½è· (IQR)</div>
                <div class="value" id="iqr">-</div>
            </div>
            <div class="stat-card">
                <div class="label">å˜å¼‚ç³»æ•° (CV)</div>
                <div class="value" id="cv">-</div>
            </div>
        </div>

        <div class="histogram-section">
            <h3>ç›´æ–¹å›¾</h3>
            <div class="histogram" id="histogram"></div>
            <div class="histogram-controls">
                <label>
                    åˆ†ç»„æ•°:
                    <input type="number" id="binCount" value="10" min="2" max="50" onchange="updateHistogram()">
                </label>
            </div>
        </div>

        <div class="quartile-section">
            <h3>ç®±çº¿å›¾ (Box Plot)</h3>
            <div class="box-plot" id="boxPlot">
                <div class="box-plot-line"></div>
            </div>
            <div class="quartile-values" id="quartileValues">
                <span>æœ€å°å€¼: -</span>
                <span>Q1: -</span>
                <span>ä¸­ä½æ•°: -</span>
                <span>Q3: -</span>
                <span>æœ€å¤§å€¼: -</span>
            </div>
        </div>
    </main>

    <script>
        let data = [];

        function parseData(input) {
            const numbers = input
                .replace(/[ï¼Œï¼›\n\r\t]/g, ',')
                .split(/[,\s]+/)
                .map(function(s) { return s.trim(); })
                .filter(function(s) { return s !== ''; })
                .map(function(s) { return parseFloat(s); })
                .filter(function(n) { return !isNaN(n); });
            return numbers;
        }

        function updatePreview() {
            const input = document.getElementById('dataInput').value;
            data = parseData(input);
            const preview = document.getElementById('dataPreview');
            if (data.length === 0) {
                preview.textContent = 'å·²è§£æ 0 ä¸ªæ•°æ®ç‚¹';
            } else if (data.length <= 20) {
                preview.textContent = 'å·²è§£æ ' + data.length + ' ä¸ªæ•°æ®ç‚¹: ' + data.join(', ');
            } else {
                preview.textContent = 'å·²è§£æ ' + data.length + ' ä¸ªæ•°æ®ç‚¹: ' + data.slice(0, 10).join(', ') + ' ... ' + data.slice(-5).join(', ');
            }
        }

        document.getElementById('dataInput').addEventListener('input', updatePreview);

        function calculate() {
            updatePreview();
            if (data.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°æ®');
                return;
            }

            const sorted = data.slice().sort(function(a, b) { return a - b; });
            const n = data.length;
            const sum = data.reduce(function(a, b) { return a + b; }, 0);
            const mean = sum / n;
            
            // Median
            const median = n % 2 === 0 
                ? (sorted[n/2 - 1] + sorted[n/2]) / 2 
                : sorted[Math.floor(n/2)];
            
            // Mode
            const freq = {};
            let maxFreq = 0;
            data.forEach(function(val) {
                freq[val] = (freq[val] || 0) + 1;
                if (freq[val] > maxFreq) maxFreq = freq[val];
            });
            const modes = Object.keys(freq).filter(function(k) { return freq[k] === maxFreq; }).map(Number);
            const modeStr = maxFreq === 1 ? 'æ— ' : modes.slice(0, 3).join(', ') + (modes.length > 3 ? '...' : '');
            
            // Variance and StdDev
            const variance = data.reduce(function(acc, val) { return acc + Math.pow(val - mean, 2); }, 0) / n;
            const stdDev = Math.sqrt(variance);
            
            // Min, Max, Range
            const min = sorted[0];
            const max = sorted[n - 1];
            const range = max - min;
            
            // Quartiles
            const q1 = percentile(sorted, 25);
            const q3 = percentile(sorted, 75);
            const iqr = q3 - q1;
            
            // CV
            const cv = (stdDev / mean) * 100;

            // Update display
            document.getElementById('count').textContent = n;
            document.getElementById('sum').textContent = formatNum(sum);
            document.getElementById('mean').textContent = formatNum(mean);
            document.getElementById('median').textContent = formatNum(median);
            document.getElementById('mode').textContent = modeStr;
            document.getElementById('stdDev').textContent = formatNum(stdDev);
            document.getElementById('variance').textContent = formatNum(variance);
            document.getElementById('min').textContent = formatNum(min);
            document.getElementById('max').textContent = formatNum(max);
            document.getElementById('range').textContent = formatNum(range);
            document.getElementById('q1').textContent = formatNum(q1);
            document.getElementById('q3').textContent = formatNum(q3);
            document.getElementById('iqr').textContent = formatNum(iqr);
            document.getElementById('cv').textContent = formatNum(cv) + '%';

            updateHistogram();
            updateBoxPlot(min, q1, median, q3, max);
        }

        function percentile(sorted, p) {
            const index = (p / 100) * (sorted.length - 1);
            const lower = Math.floor(index);
            const upper = Math.ceil(index);
            if (lower === upper) return sorted[lower];
            return sorted[lower] + (sorted[upper] - sorted[lower]) * (index - lower);
        }

        function formatNum(num) {
            if (Number.isInteger(num)) return num.toString();
            return num.toFixed(4);
        }

        function updateHistogram() {
            if (data.length === 0) return;
            
            const binCount = parseInt(document.getElementById('binCount').value) || 10;
            const sorted = data.slice().sort(function(a, b) { return a - b; });
            const min = sorted[0];
            const max = sorted[sorted.length - 1];
            const binWidth = (max - min) / binCount || 1;
            
            const bins = new Array(binCount).fill(0);
            data.forEach(function(val) {
                let binIndex = Math.floor((val - min) / binWidth);
                if (binIndex >= binCount) binIndex = binCount - 1;
                bins[binIndex]++;
            });
            
            const maxBin = Math.max.apply(null, bins);
            const histogram = document.getElementById('histogram');
            histogram.textContent = '';
            
            bins.forEach(function(count, i) {
                const container = document.createElement('div');
                container.className = 'bar-container';
                
                const countLabel = document.createElement('div');
                countLabel.className = 'bar-count';
                countLabel.textContent = count > 0 ? count : '';
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = (count / maxBin * 100) + '%';
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                const binStart = min + i * binWidth;
                const binEnd = min + (i + 1) * binWidth;
                label.textContent = formatNum(binStart);
                label.title = formatNum(binStart) + ' - ' + formatNum(binEnd);
                
                container.appendChild(countLabel);
                container.appendChild(bar);
                container.appendChild(label);
                histogram.appendChild(container);
            });
        }

        function updateBoxPlot(min, q1, median, q3, max) {
            const boxPlot = document.getElementById('boxPlot');
            boxPlot.textContent = '';
            
            const line = document.createElement('div');
            line.className = 'box-plot-line';
            boxPlot.appendChild(line);
            
            const range = max - min || 1;
            
            // Left whisker
            const leftWhisker = document.createElement('div');
            leftWhisker.className = 'box-plot-whisker';
            leftWhisker.style.left = '0%';
            boxPlot.appendChild(leftWhisker);
            
            // Left cap
            const leftCap = document.createElement('div');
            leftCap.className = 'box-plot-cap';
            leftCap.style.left = '-4px';
            boxPlot.appendChild(leftCap);
            
            // Box
            const box = document.createElement('div');
            box.className = 'box-plot-box';
            box.style.left = ((q1 - min) / range * 100) + '%';
            box.style.width = ((q3 - q1) / range * 100) + '%';
            boxPlot.appendChild(box);
            
            // Median line
            const medianLine = document.createElement('div');
            medianLine.className = 'box-plot-median';
            medianLine.style.left = ((median - min) / range * 100) + '%';
            boxPlot.appendChild(medianLine);
            
            // Right whisker
            const rightWhisker = document.createElement('div');
            rightWhisker.className = 'box-plot-whisker';
            rightWhisker.style.left = '100%';
            boxPlot.appendChild(rightWhisker);
            
            // Right cap
            const rightCap = document.createElement('div');
            rightCap.className = 'box-plot-cap';
            rightCap.style.left = 'calc(100% - 4px)';
            boxPlot.appendChild(rightCap);
            
            // Update labels
            document.getElementById('quartileValues').textContent = '';
            var labels = ['æœ€å°å€¼: ' + formatNum(min), 'Q1: ' + formatNum(q1), 
                         'ä¸­ä½æ•°: ' + formatNum(median), 'Q3: ' + formatNum(q3), 
                         'æœ€å¤§å€¼: ' + formatNum(max)];
            labels.forEach(function(text) {
                var span = document.createElement('span');
                span.textContent = text;
                document.getElementById('quartileValues').appendChild(span);
            });
        }

        function loadSampleData() {
            document.getElementById('dataInput').value = 
                '23, 45, 67, 32, 54, 78, 89, 12, 34, 56,\n' +
                '43, 65, 87, 21, 43, 65, 87, 98, 76, 54,\n' +
                '32, 45, 67, 89, 23, 45, 67, 34, 56, 78';
            updatePreview();
            calculate();
        }

        function generateRandom() {
            const count = 50;
            const numbers = [];
            for (let i = 0; i < count; i++) {
                // Generate normally distributed numbers (Box-Muller)
                const u1 = Math.random();
                const u2 = Math.random();
                const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                numbers.push(Math.round((z * 15 + 50) * 10) / 10);
            }
            document.getElementById('dataInput').value = numbers.join(', ');
            updatePreview();
            calculate();
        }

        function clearData() {
            document.getElementById('dataInput').value = '';
            data = [];
            updatePreview();
            
            ['count', 'sum', 'mean', 'median', 'mode', 'stdDev', 'variance', 
             'min', 'max', 'range', 'q1', 'q3', 'iqr', 'cv'].forEach(function(id) {
                document.getElementById(id).textContent = '-';
            });
            
            document.getElementById('histogram').textContent = '';
            document.getElementById('boxPlot').textContent = '';
            var line = document.createElement('div');
            line.className = 'box-plot-line';
            document.getElementById('boxPlot').appendChild(line);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.getElementById('themeBtn');
            if (html.getAttribute('data-theme') === 'light') {
                html.setAttribute('data-theme', 'dark');
                btn.textContent = 'â˜€ï¸ æµ…è‰²';
            } else {
                html.setAttribute('data-theme', 'light');
                btn.textContent = 'ğŸŒ™ æ·±è‰²';
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çºªå¿µæ—¥å€’è®¡æ—¶ - é‡è¦æ—¥æœŸæé†’</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --primary: #ec4899; --success: #22c55e; }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .event-card { background: var(--pico-card-background-color); border-radius: 12px; padding: 1.25rem; position: relative; overflow: hidden; }
        .event-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--event-color, var(--primary)); }
        .event-card .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .event-card .name { font-weight: 600; font-size: 1.1rem; margin-bottom: 0.25rem; }
        .event-card .date { font-size: 0.8rem; color: var(--pico-muted-color); margin-bottom: 0.75rem; }
        .event-card .countdown { font-size: 2rem; font-weight: 700; color: var(--event-color, var(--primary)); }
        .event-card .countdown-label { font-size: 0.85rem; color: var(--pico-muted-color); }
        .event-card .countdown.past { color: var(--success); }
        .event-card .actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .event-card .actions button { padding: 0.3rem 0.6rem; margin: 0; font-size: 0.75rem; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--pico-card-background-color); border-radius: 12px; padding: 1.5rem; max-width: 400px; width: 90%; }
        .modal h2 { margin: 0 0 1rem; font-size: 1.1rem; }
        .form-group { margin-bottom: 0.75rem; }
        .form-group label { display: block; margin-bottom: 0.25rem; font-size: 0.85rem; font-weight: 500; }
        .form-group input, .form-group select { margin: 0; }
        .icon-picker { display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.4rem; margin-top: 0.4rem; }
        .icon-option { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; border: 2px solid var(--pico-muted-border-color); border-radius: 6px; cursor: pointer; }
        .icon-option:hover, .icon-option.selected { border-color: var(--primary); background: rgba(236,72,153,0.1); }
        .color-picker { display: flex; gap: 0.4rem; margin-top: 0.4rem; }
        .color-option { width: 28px; height: 28px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: var(--pico-color); }
        .btn-group { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1rem; }
        .empty-state { text-align: center; padding: 3rem; color: var(--pico-muted-color); }
        .empty-state .icon { font-size: 4rem; margin-bottom: 1rem; }
        .repeat-badge { display: inline-block; font-size: 0.65rem; padding: 0.1rem 0.4rem; background: var(--pico-muted-border-color); border-radius: 8px; margin-left: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“… çºªå¿µæ—¥å€’è®¡æ—¶</h1>
            <div><button id="addEventBtn" class="primary">+ æ·»åŠ çºªå¿µæ—¥</button> <button id="themeToggle" class="outline">ğŸŒ™</button></div>
        </header>
        <div class="events-grid" id="eventsGrid"></div>
    </div>
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <h2 id="modalTitle">æ·»åŠ çºªå¿µæ—¥</h2>
            <form id="eventForm">
                <input type="hidden" id="eventId">
                <div class="form-group"><label>åç§° *</label><input type="text" id="eventName" required placeholder="å¦‚ï¼šç”Ÿæ—¥ã€çºªå¿µæ—¥"></div>
                <div class="form-group"><label>æ—¥æœŸ *</label><input type="date" id="eventDate" required></div>
                <div class="form-group"><label>é‡å¤</label><select id="eventRepeat"><option value="">ä¸é‡å¤</option><option value="yearly">æ¯å¹´é‡å¤</option></select></div>
                <div class="form-group"><label>é€‰æ‹©å›¾æ ‡</label><div class="icon-picker" id="iconPicker"></div></div>
                <div class="form-group"><label>é€‰æ‹©é¢œè‰²</label><div class="color-picker" id="colorPicker"></div></div>
                <div class="btn-group"><button type="button" class="secondary" id="cancelBtn">å–æ¶ˆ</button><button type="submit" class="primary">ä¿å­˜</button></div>
            </form>
        </div>
    </div>
    <script>
        const icons = ['ğŸ‚','ğŸ’•','ğŸ“','âœˆï¸','ğŸ ','ğŸ’','ğŸ‘¶','ğŸ‰','ğŸ†','ğŸ“…','ğŸ’¼','ğŸ„','ğŸŒ¸','ğŸƒ','â¤ï¸','â­'];
        const colors = ['#ec4899','#f43f5e','#f97316','#eab308','#22c55e','#14b8a6','#3b82f6','#8b5cf6'];
        let events = [], selectedIcon = 'ğŸ‚', selectedColor = '#ec4899';
        const $ = id => document.getElementById(id);
        function init() { loadData(); renderIconPicker(); renderColorPicker(); render(); setupEvents(); loadTheme(); setInterval(render, 60000); }
        window.loadData = function() { events = JSON.parse(localStorage.getItem('countdownEvents') || '[]'); };
        window.saveData = function() { localStorage.setItem('countdownEvents', JSON.stringify(events)); };
        function genId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); }
        function renderIconPicker() { $('iconPicker').innerHTML = icons.map(i => '<div class="icon-option '+(i===selectedIcon?'selected':'')+'" data-icon="'+i+'">'+i+'</div>').join(''); }
        function renderColorPicker() { $('colorPicker').innerHTML = colors.map(c => '<div class="color-option '+(c===selectedColor?'selected':'')+'" data-color="'+c+'" style="background:'+c+'"></div>').join(''); }
        function getCountdown(dateStr, repeat) {
            const now = new Date(); now.setHours(0,0,0,0);
            let target = new Date(dateStr); target.setHours(0,0,0,0);
            if (repeat === 'yearly') {
                target.setFullYear(now.getFullYear());
                if (target < now) target.setFullYear(now.getFullYear() + 1);
            }
            const diff = Math.floor((target - now) / (1000 * 60 * 60 * 24));
            return { days: diff, isPast: diff < 0, isToday: diff === 0 };
        }
        function render() {
            if (!events.length) { $('eventsGrid').innerHTML = '<div class="empty-state"><div class="icon">ğŸ“…</div><p>è¿˜æ²¡æœ‰æ·»åŠ çºªå¿µæ—¥</p><p>ç‚¹å‡»"æ·»åŠ çºªå¿µæ—¥"å¼€å§‹è®°å½•é‡è¦æ—¥æœŸ</p></div>'; return; }
            const sorted = [...events].sort((a, b) => {
                const ca = getCountdown(a.date, a.repeat), cb = getCountdown(b.date, b.repeat);
                if (ca.isToday && !cb.isToday) return -1;
                if (!ca.isToday && cb.isToday) return 1;
                return Math.abs(ca.days) - Math.abs(cb.days);
            });
            $('eventsGrid').innerHTML = sorted.map(e => {
                const c = getCountdown(e.date, e.repeat);
                let countdownText, labelText;
                if (c.isToday) { countdownText = 'ä»Šå¤©'; labelText = 'å°±æ˜¯ä»Šå¤©ï¼'; }
                else if (c.days > 0) { countdownText = c.days; labelText = 'å¤©å'; }
                else { countdownText = Math.abs(c.days); labelText = 'å¤©å‰'; }
                return '<div class="event-card" style="--event-color:'+e.color+'"><div class="icon">'+e.icon+'</div><div class="name">'+e.name+(e.repeat?'<span class="repeat-badge">æ¯å¹´</span>':'')+'</div><div class="date">'+e.date+'</div><div class="countdown '+(c.isPast?'past':'')+'">'+countdownText+'</div><div class="countdown-label">'+labelText+'</div><div class="actions"><button onclick="editEvent(\''+e.id+'\')" class="outline">ç¼–è¾‘</button><button onclick="deleteEvent(\''+e.id+'\')" class="outline secondary">åˆ é™¤</button></div></div>';
            }).join('');
        }
        function setupEvents() {
            $('addEventBtn').onclick = () => { $('modalTitle').textContent = 'æ·»åŠ çºªå¿µæ—¥'; $('eventForm').reset(); $('eventId').value = ''; selectedIcon = 'ğŸ‚'; selectedColor = '#ec4899'; renderIconPicker(); renderColorPicker(); $('eventModal').classList.add('show'); };
            $('eventForm').onsubmit = ev => { ev.preventDefault(); const id = $('eventId').value; const e = { id: id || genId(), name: $('eventName').value, date: $('eventDate').value, repeat: $('eventRepeat').value, icon: selectedIcon, color: selectedColor }; if (id) { const i = events.findIndex(x=>x.id===id); if (i!==-1) events[i] = e; } else events.push(e); saveData(); render(); $('eventModal').classList.remove('show'); };
            $('cancelBtn').onclick = () => $('eventModal').classList.remove('show');
            $('iconPicker').onclick = ev => { const o = ev.target.closest('.icon-option'); if (o) { selectedIcon = o.dataset.icon; renderIconPicker(); } };
            $('colorPicker').onclick = ev => { const o = ev.target.closest('.color-option'); if (o) { selectedColor = o.dataset.color; renderColorPicker(); } };
            $('themeToggle').onclick = toggleTheme;
            $('eventModal').onclick = ev => { if (ev.target.id === 'eventModal') $('eventModal').classList.remove('show'); };
        }
        window.editEvent = id => { const e = events.find(x=>x.id===id); if (!e) return; $('modalTitle').textContent = 'ç¼–è¾‘çºªå¿µæ—¥'; $('eventId').value = id; $('eventName').value = e.name; $('eventDate').value = e.date; $('eventRepeat').value = e.repeat || ''; selectedIcon = e.icon; selectedColor = e.color; renderIconPicker(); renderColorPicker(); $('eventModal').classList.add('show'); };
        window.deleteEvent = id => { if (confirm('ç¡®å®šåˆ é™¤?')) { events = events.filter(e=>e.id!==id); saveData(); render(); } };
        function loadTheme() { const t = localStorage.getItem('theme') || 'light'; document.documentElement.setAttribute('data-theme', t); $('themeToggle').textContent = t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; }
        window.toggleTheme = function() { const c = document.documentElement.getAttribute('data-theme'); const n = c === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('theme', n); $('themeToggle').textContent = n === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; };
        init();
    </script>
</body>
</html>

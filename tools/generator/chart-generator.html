<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils" />
  <meta name="keywords" content="chart-generator,generator,tools,webutils" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/generator/chart-generator.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils" />
  <meta property="og:description" content="åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/generator/chart-generator.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils" />
  <meta name="twitter:description" content="åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨ - WebUtils" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

  <meta name="description" content="åœ¨çº¿ç”ŸæˆæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ç­‰å¤šç§å›¾è¡¨ï¼Œæ”¯æŒCSVæ•°æ®å¯¼å…¥å’ŒPNG/SVGå¯¼å‡º" />
  <meta name="keywords" content="å›¾è¡¨ç”Ÿæˆå™¨,chart generator,æŸ±çŠ¶å›¾,æŠ˜çº¿å›¾,é¥¼å›¾,æ•°æ®å¯è§†åŒ–" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --glow-red: rgb(244, 63, 94, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-input: #f5f5f5;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --border-strong: #d5d5d5;
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-blue: #4cc9f0;
      --accent-purple: #a855f7;
      --accent-pink: #ec4899;
      --accent-orange: #f97316;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --transition-fast: 0.15s ease;
      --transition-normal: 0.2s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgb(0, 245, 212, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgb(0, 245, 212, 0.02) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
      min-height: 100vh;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-decoration: none;
      padding: 8px 14px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      transition: all var(--transition-normal);
    }

    .back-link:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .title-section h1 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .title-section .desc {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .main-layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
    }

    @media (max-width: 1000px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }

    /* æ§åˆ¶é¢æ¿ */
    .control-panel {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 20px;
      height: fit-content;
      max-height: calc(100vh - 150px);
      overflow-y: auto;
    }

    .control-section {
      margin-bottom: 20px;
    }

    .control-section:last-child {
      margin-bottom: 0;
    }

    .control-section h3 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-row {
      margin-bottom: 12px;
    }

    .control-row label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      display: block;
      margin-bottom: 6px;
    }

    input[type="text"], input[type="number"], textarea {
      width: 100%;
      padding: 10px 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      outline: none;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--accent-cyan);
    }

    select {
      width: 100%;
      padding: 10px 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      cursor: pointer;
      outline: none;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .checkbox-row input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent-cyan);
    }

    .checkbox-row span {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* å›¾è¡¨ç±»å‹é€‰æ‹©å™¨ */
    .chart-types {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .chart-type-btn {
      padding: 12px 8px;
      background: var(--bg-input);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
    }

    .chart-type-btn:hover {
      border-color: var(--accent-cyan);
      color: var(--text-primary);
    }

    .chart-type-btn.active {
      border-color: var(--accent-cyan);
      background: var(--glow-cyan);
      color: var(--accent-cyan);
    }

    .chart-type-btn .icon {
      font-size: 20px;
      margin-bottom: 4px;
      display: block;
    }

    /* æ•°æ®è¡¨æ ¼ */
    .data-table-wrapper {
      max-height: 200px;
      overflow: auto;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
    }

    .data-table th, .data-table td {
      padding: 8px;
      border: 1px solid var(--border-subtle);
      text-align: left;
    }

    .data-table th {
      background: var(--bg-surface);
      color: var(--text-secondary);
      font-weight: 500;
    }

    .data-table input {
      width: 100%;
      padding: 4px 8px;
      font-size: 0.8rem;
      background: var(--bg-input);
      border: 1px solid transparent;
      color: var(--text-primary);
    }

    .data-table input:focus {
      border-color: var(--accent-cyan);
      outline: none;
    }

    .data-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .data-actions button {
      flex: 1;
      padding: 8px;
      font-size: 0.75rem;
    }

    /* é¢„è§ˆé¢æ¿ */
    .preview-panel {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 24px;
      display: flex;
      flex-direction: column;
    }

    .preview-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    button {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 10px 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-normal);
      white-space: nowrap;
    }

    button:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: var(--accent-cyan);
    }

    button.primary {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
      color: var(--bg-deep);
    }

    button.primary:hover {
      background: #00dfc4;
      box-shadow: 0 0 20px var(--glow-cyan);
    }

    .chart-container {
      flex: 1;
      min-height: 400px;
      background: #fff;
      border-radius: var(--radius-md);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chart-canvas {
      max-width: 100%;
      max-height: 500px;
    }

    .message {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      margin-top: 12px;
      display: none;
    }

    .message.success {
      display: block;
      background: var(--glow-green);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
    }

    .message.error {
      display: block;
      background: rgba(244, 63, 94, 0.15);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
    }

    /* é¢œè‰²é€‰æ‹©å™¨ */
    .color-presets {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .color-preset {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .color-preset:hover {
      transform: scale(1.1);
    }

    .color-preset.active {
      border-color: var(--text-primary);
    }

    /* æ–‡ä»¶ä¸Šä¼  */
    .file-drop {
      border: 2px dashed var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .file-drop:hover, .file-drop.dragover {
      border-color: var(--accent-cyan);
      background: var(--glow-cyan);
    }

    #csv-input {
      display: none;
    }
  
        .breadcrumb {     background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>

<body>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
    <span id="theme-icon">ğŸŒ™</span>
  </button>

    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span>åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨</nav>
  <div class="bg-grid"></div>

  <div class="container">
    <div class="header">
      <a href="../../index.html" class="back-link">â† è¿”å›</a>
      <div class="title-section">
        <h1>
          <span class="title-icon">ğŸ“Š</span>
          åœ¨çº¿å›¾è¡¨ç”Ÿæˆå™¨
        </h1>
        <p class="desc">å¿«é€Ÿåˆ›å»ºæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ç­‰å¤šç§å›¾è¡¨ï¼Œæ”¯æŒCSVå¯¼å…¥å’Œå¤šæ ¼å¼å¯¼å‡º</p>
      </div>
    </div>

    <div class="main-layout">
      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="control-panel">
        <div class="control-section">
          <h3>å›¾è¡¨ç±»å‹</h3>
          <div class="chart-types">
            <button class="chart-type-btn active" data-type="bar">
              <span class="icon">ğŸ“Š</span>
              æŸ±çŠ¶å›¾
            </button>
            <button class="chart-type-btn" data-type="line">
              <span class="icon">ğŸ“ˆ</span>
              æŠ˜çº¿å›¾
            </button>
            <button class="chart-type-btn" data-type="pie">
              <span class="icon">ğŸ¥§</span>
              é¥¼å›¾
            </button>
            <button class="chart-type-btn" data-type="doughnut">
              <span class="icon">ğŸ©</span>
              ç¯å½¢å›¾
            </button>
            <button class="chart-type-btn" data-type="radar">
              <span class="icon">ğŸ•¸ï¸</span>
              é›·è¾¾å›¾
            </button>
            <button class="chart-type-btn" data-type="polarArea">
              <span class="icon">ğŸ¯</span>
              æåŒºå›¾
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>å›¾è¡¨æ ‡é¢˜</h3>
          <div class="control-row">
            <input type="text" id="chart-title" placeholder="è¾“å…¥å›¾è¡¨æ ‡é¢˜" value="é”€å”®æ•°æ®ç»Ÿè®¡">
          </div>
        </div>

        <div class="control-section">
          <h3>æ•°æ®</h3>
          <div class="control-row">
            <label>å¯¼å…¥CSVæ–‡ä»¶</label>
            <div class="file-drop" id="file-drop">
              ğŸ“ ç‚¹å‡»æˆ–æ‹–æ‹½CSVæ–‡ä»¶åˆ°è¿™é‡Œ
            </div>
            <input type="file" id="csv-input" accept=".csv">
          </div>
          <div class="control-row">
            <label>æˆ–æ‰‹åŠ¨ç¼–è¾‘æ•°æ®</label>
            <div class="data-table-wrapper">
              <table class="data-table" id="data-table">
                <thead>
                  <tr>
                    <th>æ ‡ç­¾</th>
                    <th>æ•°å€¼</th>
                  </tr>
                </thead>
                <tbody id="data-tbody">
                </tbody>
              </table>
            </div>
            <div class="data-actions">
              <button id="add-row-btn">+ æ·»åŠ è¡Œ</button>
              <button id="clear-data-btn">æ¸…ç©º</button>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>é…è‰²æ–¹æ¡ˆ</h3>
          <div class="control-row">
            <select id="color-scheme">
              <option value="default">é»˜è®¤é…è‰²</option>
              <option value="pastel">æŸ”å’Œè‰²</option>
              <option value="vivid">é²œè‰³è‰²</option>
              <option value="ocean">æµ·æ´‹è“</option>
              <option value="sunset">æ—¥è½æ©™</option>
              <option value="forest">æ£®æ—ç»¿</option>
              <option value="mono">å•è‰²</option>
            </select>
          </div>
        </div>

        <div class="control-section">
          <h3>é€‰é¡¹</h3>
          <div class="checkbox-row">
            <input type="checkbox" id="show-legend" checked>
            <span>æ˜¾ç¤ºå›¾ä¾‹</span>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="show-grid" checked>
            <span>æ˜¾ç¤ºç½‘æ ¼çº¿</span>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="show-animation" checked>
            <span>å¯ç”¨åŠ¨ç”»</span>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="show-values">
            <span>æ˜¾ç¤ºæ•°æ®æ ‡ç­¾</span>
          </div>
        </div>
      </div>

      <!-- é¢„è§ˆé¢æ¿ -->
      <div class="preview-panel">
        <div class="preview-toolbar">
          <button id="sample-btn">ğŸ“ ç¤ºä¾‹æ•°æ®</button>
          <button id="refresh-btn">ğŸ”„ åˆ·æ–°å›¾è¡¨</button>
          <button id="copy-btn" class="primary">ğŸ“· å¤åˆ¶å›¾ç‰‡</button>
          <button id="download-png-btn">ğŸ’¾ ä¸‹è½½PNG</button>
          <button id="download-svg-btn">ğŸ“„ ä¸‹è½½SVG</button>
          <button id="share-btn">ğŸ”— åˆ†äº«é“¾æ¥</button>
        </div>

        <div class="chart-container">
          <canvas id="chart-canvas"></canvas>
        </div>

        <div id="message" class="message"></div>
      </div>
    </div>
  </div>

  <input type="file" id="csv-file" accept=".csv" style="display:none">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    // XSS é˜²æŠ¤
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, c =>
        ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // çŠ¶æ€
    const state = {
      chartType: 'bar',
      title: 'é”€å”®æ•°æ®ç»Ÿè®¡',
      data: [
        { label: 'ä¸€æœˆ', value: 65 },
        { label: 'äºŒæœˆ', value: 59 },
        { label: 'ä¸‰æœˆ', value: 80 },
        { label: 'å››æœˆ', value: 81 },
        { label: 'äº”æœˆ', value: 56 },
        { label: 'å…­æœˆ', value: 55 }
      ],
      colorScheme: 'default',
      showLegend: true,
      showGrid: true,
      showAnimation: true,
      showValues: false
    };

    // é…è‰²æ–¹æ¡ˆ
    const colorSchemes = {
      default: ['#4cc9f0', '#7209b7', '#f72585', '#4361ee', '#3a0ca3', '#560bad', '#480ca8', '#3f37c9'],
      pastel: ['#b5e48c', '#99d98c', '#76c893', '#52b69a', '#34a0a4', '#168aad', '#1a759f', '#1e6091'],
      vivid: ['#ff595e', '#ffca3a', '#8ac926', '#1982c4', '#6a4c93', '#ff6b6b', '#feca57', '#48dbfb'],
      ocean: ['#0077b6', '#00b4d8', '#90e0ef', '#caf0f8', '#03045e', '#023e8a', '#0096c7', '#48cae4'],
      sunset: ['#ff9f1c', '#ffbf69', '#cbf3f0', '#2ec4b6', '#ff6b6b', '#feca57', '#ff9ff3', '#54a0ff'],
      forest: ['#2d6a4f', '#40916c', '#52b788', '#74c69d', '#95d5b2', '#b7e4c7', '#d8f3dc', '#1b4332'],
      mono: ['#212529', '#343a40', '#495057', '#6c757d', '#adb5bd', '#ced4da', '#dee2e6', '#e9ecef']
    };

    // Chartå®ä¾‹
    let chart = null;

    // DOMå…ƒç´ 
    const chartCanvas = document.getElementById('chart-canvas');
    const dataTbody = document.getElementById('data-tbody');
    const messageEl = document.getElementById('message');

    // æ¸²æŸ“æ•°æ®è¡¨æ ¼
    function renderDataTable() {
      dataTbody.innerHTML = state.data.map((row, i) => `
        <tr>
          <td><input type="text" value="${escapeHtml(row.label)}" data-index="${i}" data-field="label"></td>
          <td><input type="number" value="${row.value}" data-index="${i}" data-field="value"></td>
        </tr>
      `).join('');

      // æ·»åŠ äº‹ä»¶ç›‘å¬
      dataTbody.querySelectorAll('input').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          const field = e.target.dataset.field;
          if (field === 'value') {
            state.data[index][field] = parseFloat(e.target.value) || 0;
          } else {
            state.data[index][field] = e.target.value;
          }
          renderChart();
        });
      });
    }

    // æ¸²æŸ“å›¾è¡¨
    function renderChart() {
      const ctx = chartCanvas.getContext('2d');
      const colors = colorSchemes[state.colorScheme];
      
      // é”€æ¯æ—§å›¾è¡¨
      if (chart) {
        chart.destroy();
      }

      const labels = state.data.map(d => d.label);
      const values = state.data.map(d => d.value);
      const backgroundColors = state.data.map((_, i) => colors[i % colors.length]);
      const borderColors = backgroundColors.map(c => c);

      const datasets = [{
        label: state.title,
        data: values,
        backgroundColor: backgroundColors.map(c => c + (state.chartType === 'line' ? '40' : '')),
        borderColor: borderColors,
        borderWidth: state.chartType === 'line' ? 3 : 1,
        fill: state.chartType === 'line' ? true : undefined,
        tension: 0.4
      }];

      const options = {
        responsive: true,
        maintainAspectRatio: false,
        animation: state.showAnimation ? {
          duration: 1000,
          easing: 'easeOutQuart'
        } : false,
        plugins: {
          legend: {
            display: state.showLegend && ['pie', 'doughnut', 'polarArea'].includes(state.chartType),
            position: 'bottom'
          },
          title: {
            display: !!state.title,
            text: state.title,
            font: {
              size: 18,
              weight: 'bold'
            }
          },
          datalabels: state.showValues ? {
            display: true,
            color: '#333'
          } : undefined
        }
      };

      // æ ¹æ®å›¾è¡¨ç±»å‹è°ƒæ•´é…ç½®
      if (['bar', 'line'].includes(state.chartType)) {
        options.scales = {
          y: {
            beginAtZero: true,
            grid: {
              display: state.showGrid
            }
          },
          x: {
            grid: {
              display: state.showGrid
            }
          }
        };
      }

      chart = new Chart(ctx, {
        type: state.chartType,
        data: {
          labels: labels,
          datasets: datasets
        },
        options: options
      });
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, type) {
      messageEl.textContent = text;
      messageEl.className = 'message ' + type;
      setTimeout(() => {
        messageEl.className = 'message';
      }, 3000);
    }

    // æ·»åŠ è¡Œ
    function addRow() {
      state.data.push({ label: 'æ–°é¡¹ç›®', value: 0 });
      renderDataTable();
      renderChart();
    }

    // æ¸…ç©ºæ•°æ®
    function clearData() {
      state.data = [{ label: 'é¡¹ç›®1', value: 0 }];
      renderDataTable();
      renderChart();
    }

    // åŠ è½½ç¤ºä¾‹æ•°æ®
    function loadSampleData() {
      const samples = [
        [
          { label: 'ä¸€æœˆ', value: 65 },
          { label: 'äºŒæœˆ', value: 59 },
          { label: 'ä¸‰æœˆ', value: 80 },
          { label: 'å››æœˆ', value: 81 },
          { label: 'äº”æœˆ', value: 56 },
          { label: 'å…­æœˆ', value: 55 }
        ],
        [
          { label: 'Chrome', value: 62.5 },
          { label: 'Safari', value: 19.8 },
          { label: 'Firefox', value: 5.1 },
          { label: 'Edge', value: 4.3 },
          { label: 'å…¶ä»–', value: 8.3 }
        ],
        [
          { label: 'æŠ€æœ¯', value: 85 },
          { label: 'è®¾è®¡', value: 70 },
          { label: 'å¸‚åœº', value: 65 },
          { label: 'è¿è¥', value: 75 },
          { label: 'é”€å”®', value: 80 }
        ]
      ];
      state.data = samples[Math.floor(Math.random() * samples.length)];
      renderDataTable();
      renderChart();
      showMessage('å·²åŠ è½½ç¤ºä¾‹æ•°æ®', 'success');
    }

    // è§£æCSV
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const data = [];
      
      for (let i = 1; i < lines.length; i++) { // è·³è¿‡æ ‡é¢˜è¡Œ
        const parts = lines[i].split(',');
        if (parts.length >= 2) {
          data.push({
            label: parts[0].trim().replace(/^"|"$/g, ''),
            value: parseFloat(parts[1]) || 0
          });
        }
      }
      
      return data;
    }

    // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    function handleFileUpload(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = parseCSV(e.target.result);
          if (data.length > 0) {
            state.data = data;
            renderDataTable();
            renderChart();
            showMessage(`å·²å¯¼å…¥ ${data.length} æ¡æ•°æ®`, 'success');
          } else {
            showMessage('CSVæ–‡ä»¶æ ¼å¼æ— æ•ˆ', 'error');
          }
        } catch (err) {
          showMessage('è§£æCSVå¤±è´¥: ' + err.message, 'error');
        }
      };
      reader.readAsText(file);
    }

    // å¤åˆ¶å›¾ç‰‡
    async function copyImage() {
      try {
        const dataUrl = chartCanvas.toDataURL('image/png');
        const blob = await (await fetch(dataUrl)).blob();
        await navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]);
        showMessage('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      } catch (err) {
        showMessage('å¤åˆ¶å¤±è´¥: ' + err.message, 'error');
      }
    }

    // ä¸‹è½½PNG
    function downloadPng() {
      const url = chartCanvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = `chart-${Date.now()}.png`;
      a.click();
      showMessage('PNGå·²ä¸‹è½½', 'success');
    }

    // ä¸‹è½½SVG (é€šè¿‡canvasè½¬æ¢)
    function downloadSvg() {
      // Chart.js ä¸ç›´æ¥æ”¯æŒSVGï¼Œè¿™é‡Œä½¿ç”¨PNG
      downloadPng();
      showMessage('æ³¨ï¼šChart.jsç”Ÿæˆçš„æ˜¯Canvaså›¾è¡¨ï¼Œå·²å¯¼å‡ºä¸ºPNG', 'success');
    }

    // åˆ†äº«é“¾æ¥
    function shareLink() {
      const shareData = {
        t: state.chartType,
        title: state.title,
        d: state.data,
        c: state.colorScheme,
        l: state.showLegend,
        g: state.showGrid,
        a: state.showAnimation,
        v: state.showValues
      };
      const hash = btoa(encodeURIComponent(JSON.stringify(shareData)));
      const url = location.origin + location.pathname + '#' + hash;
      navigator.clipboard.writeText(url).then(() => {
        showMessage('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      });
      history.replaceState(null, '', '#' + hash);
    }

    // ä»URLåŠ è½½
    function loadFromUrl() {
      const hash = location.hash.slice(1);
      if (!hash) return;
      try {
        const data = JSON.parse(decodeURIComponent(atob(hash)));
        if (data.t) state.chartType = data.t;
        if (data.title) state.title = data.title;
        if (data.d) state.data = data.d;
        if (data.c) state.colorScheme = data.c;
        if (typeof data.l !== 'undefined') state.showLegend = data.l;
        if (typeof data.g !== 'undefined') state.showGrid = data.g;
        if (typeof data.a !== 'undefined') state.showAnimation = data.a;
        if (typeof data.v !== 'undefined') state.showValues = data.v;

        // æ›´æ–°UI
        document.getElementById('chart-title').value = state.title;
        document.getElementById('color-scheme').value = state.colorScheme;
        document.getElementById('show-legend').checked = state.showLegend;
        document.getElementById('show-grid').checked = state.showGrid;
        document.getElementById('show-animation').checked = state.showAnimation;
        document.getElementById('show-values').checked = state.showValues;
        document.querySelectorAll('.chart-type-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.type === state.chartType);
        });
      } catch (e) {
        console.error('Failed to load from URL', e);
      }
    }

    // äº‹ä»¶ç›‘å¬
    document.querySelectorAll('.chart-type-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.chartType = btn.dataset.type;
        renderChart();
      });
    });

    document.getElementById('chart-title').addEventListener('input', (e) => {
      state.title = e.target.value;
      renderChart();
    });

    document.getElementById('color-scheme').addEventListener('change', (e) => {
      state.colorScheme = e.target.value;
      renderChart();
    });

    document.getElementById('show-legend').addEventListener('change', (e) => {
      state.showLegend = e.target.checked;
      renderChart();
    });

    document.getElementById('show-grid').addEventListener('change', (e) => {
      state.showGrid = e.target.checked;
      renderChart();
    });

    document.getElementById('show-animation').addEventListener('change', (e) => {
      state.showAnimation = e.target.checked;
      renderChart();
    });

    document.getElementById('show-values').addEventListener('change', (e) => {
      state.showValues = e.target.checked;
      renderChart();
    });

    document.getElementById('add-row-btn').addEventListener('click', addRow);
    document.getElementById('clear-data-btn').addEventListener('click', clearData);
    document.getElementById('sample-btn').addEventListener('click', loadSampleData);
    document.getElementById('refresh-btn').addEventListener('click', renderChart);
    document.getElementById('copy-btn').addEventListener('click', copyImage);
    document.getElementById('download-png-btn').addEventListener('click', downloadPng);
    document.getElementById('download-svg-btn').addEventListener('click', downloadSvg);
    document.getElementById('share-btn').addEventListener('click', shareLink);

    // æ–‡ä»¶ä¸Šä¼ 
    const fileDrop = document.getElementById('file-drop');
    const csvInput = document.getElementById('csv-input');

    fileDrop.addEventListener('click', () => csvInput.click());
    csvInput.addEventListener('change', (e) => {
      if (e.target.files[0]) handleFileUpload(e.target.files[0]);
    });

    fileDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDrop.classList.add('dragover');
    });

    fileDrop.addEventListener('dragleave', () => {
      fileDrop.classList.remove('dragover');
    });

    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]);
    });

    // åˆå§‹åŒ–
    loadFromUrl();
    renderDataTable();
    renderChart();
  
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', newTheme);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
      document.getElementById('theme-icon').textContent = 'â˜€ï¸';
    }

</script>
</body>
</html>

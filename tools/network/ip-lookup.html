<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPåœ°å€æŸ¥è¯¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; }
        h1 { color: white; text-align: center; margin-bottom: 20px; }
        .card { background: white; border-radius: 20px; padding: 28px; box-shadow: 0 15px 50px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .search-box { display: flex; gap: 12px; margin-bottom: 20px; }
        .search-box input { flex: 1; padding: 16px; font-size: 18px; border: 2px solid #e0e0e0; border-radius: 12px; }
        .search-box input:focus { outline: none; border-color: #667eea; }
        .btn { padding: 16px 32px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .my-ip { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 16px; color: white; margin-bottom: 20px; }
        .my-ip-label { font-size: 14px; opacity: 0.9; }
        .my-ip-value { font-size: 32px; font-weight: bold; margin-top: 8px; font-family: monospace; }
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (max-width: 500px) { .info-grid { grid-template-columns: 1fr; } }
        .info-item { background: #f8f8f8; border-radius: 12px; padding: 16px; }
        .info-label { font-size: 12px; color: #666; margin-bottom: 4px; }
        .info-value { font-size: 16px; font-weight: 600; color: #333; word-break: break-all; }
        .map-container { height: 300px; border-radius: 12px; overflow: hidden; background: #e0e0e0; margin-top: 20px; display: flex; align-items: center; justify-content: center; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #ffebee; color: #c62828; padding: 16px; border-radius: 12px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ IPåœ°å€æŸ¥è¯¢</h1>
        <div class="card">
            <div class="my-ip">
                <div class="my-ip-label">æ‚¨çš„IPåœ°å€</div>
                <div class="my-ip-value" id="myIP">æ­£åœ¨è·å–...</div>
            </div>
            <div class="search-box">
                <input type="text" id="ipInput" placeholder="è¾“å…¥IPåœ°å€æŸ¥è¯¢ï¼Œå¦‚ 8.8.8.8">
                <button class="btn" onclick="lookupIP()">æŸ¥è¯¢</button>
            </div>
        </div>
        <div class="card" id="resultCard" style="display: none;">
            <h3 style="margin-bottom: 16px;">ğŸ“ æŸ¥è¯¢ç»“æœ</h3>
            <div class="info-grid" id="infoGrid"></div>
            <div class="map-container" id="mapContainer">
                <span>ğŸ—ºï¸ åœ°å›¾åŠ è½½ä¸­...</span>
            </div>
        </div>
        <div id="errorMsg"></div>
    </div>
    <script>
        // Get user's IP
        async function getMyIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                document.getElementById('myIP').textContent = data.ip;
                document.getElementById('ipInput').placeholder = `è¾“å…¥IPåœ°å€æŸ¥è¯¢ï¼Œæˆ–ç‚¹å‡»æŸ¥è¯¢æ‚¨çš„IP: ${data.ip}`;
            } catch (e) {
                document.getElementById('myIP').textContent = 'è·å–å¤±è´¥';
            }
        }
        
        async function lookupIP() {
            let ip = document.getElementById('ipInput').value.trim();
            if (!ip) {
                ip = document.getElementById('myIP').textContent;
                if (ip === 'æ­£åœ¨è·å–...' || ip === 'è·å–å¤±è´¥') {
                    alert('è¯·è¾“å…¥IPåœ°å€');
                    return;
                }
            }
            
            // Validate IP format
            const ipv4Regex = /^(\d{1,3}\.){3}\d{1,3}$/;
            const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
            
            if (!ipv4Regex.test(ip) && !ipv6Regex.test(ip)) {
                document.getElementById('errorMsg').innerHTML = '<div class="error">è¯·è¾“å…¥æœ‰æ•ˆçš„IPåœ°å€æ ¼å¼</div>';
                return;
            }
            
            document.getElementById('resultCard').style.display = 'block';
            document.getElementById('errorMsg').innerHTML = '';
            document.getElementById('infoGrid').innerHTML = '<div class="loading">æ­£åœ¨æŸ¥è¯¢...</div>';
            
            try {
                // Using ip-api.com (free, no API key needed)
                const res = await fetch(`http://ip-api.com/json/${ip}?lang=zh-CN`);
                const data = await res.json();
                
                if (data.status === 'fail') {
                    throw new Error(data.message || 'æŸ¥è¯¢å¤±è´¥');
                }
                
                displayResult(data);
            } catch (e) {
                // Fallback: show basic info without API
                displayBasicInfo(ip);
            }
        }
        
        function displayResult(data) {
            const info = [
                { label: 'IPåœ°å€', value: data.query },
                { label: 'å›½å®¶', value: `${data.country} (${data.countryCode})` },
                { label: 'åœ°åŒº', value: data.regionName },
                { label: 'åŸå¸‚', value: data.city },
                { label: 'é‚®ç¼–', value: data.zip || '-' },
                { label: 'æ—¶åŒº', value: data.timezone },
                { label: 'ISP', value: data.isp },
                { label: 'ç»„ç»‡', value: data.org },
                { label: 'AS', value: data.as },
                { label: 'ç»çº¬åº¦', value: `${data.lat}, ${data.lon}` }
            ];
            
            document.getElementById('infoGrid').innerHTML = info.map(i => `
                <div class="info-item">
                    <div class="info-label">${i.label}</div>
                    <div class="info-value">${i.value || '-'}</div>
                </div>
            `).join('');
            
            // Show map
            if (data.lat && data.lon) {
                document.getElementById('mapContainer').innerHTML = `
                    <iframe 
                        width="100%" 
                        height="300" 
                        frameborder="0" 
                        style="border:0"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${data.lon-0.1}%2C${data.lat-0.1}%2C${data.lon+0.1}%2C${data.lat+0.1}&layer=mapnik&marker=${data.lat}%2C${data.lon}"
                        allowfullscreen>
                    </iframe>
                `;
            }
        }
        
        function displayBasicInfo(ip) {
            // Parse IP for basic info
            const isPrivate = isPrivateIP(ip);
            const ipType = ip.includes(':') ? 'IPv6' : 'IPv4';
            
            const info = [
                { label: 'IPåœ°å€', value: ip },
                { label: 'IPç±»å‹', value: ipType },
                { label: 'æ˜¯å¦ç§æœ‰', value: isPrivate ? 'æ˜¯ (å†…ç½‘IP)' : 'å¦ (å…¬ç½‘IP)' },
                { label: 'IPç±»åˆ«', value: getIPClass(ip) }
            ];
            
            document.getElementById('infoGrid').innerHTML = info.map(i => `
                <div class="info-item">
                    <div class="info-label">${i.label}</div>
                    <div class="info-value">${i.value}</div>
                </div>
            `).join('') + '<div class="info-item" style="grid-column: 1/-1;"><div class="info-label">æç¤º</div><div class="info-value">ç”±äºç½‘ç»œé™åˆ¶ï¼Œæ— æ³•è·å–è¯¦ç»†åœ°ç†ä½ç½®ä¿¡æ¯</div></div>';
            
            document.getElementById('mapContainer').innerHTML = '<span>ğŸ—ºï¸ æ— æ³•æ˜¾ç¤ºåœ°å›¾</span>';
        }
        
        function isPrivateIP(ip) {
            const parts = ip.split('.').map(Number);
            if (parts.length !== 4) return false;
            
            // 10.0.0.0 - 10.255.255.255
            if (parts[0] === 10) return true;
            // 172.16.0.0 - 172.31.255.255
            if (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) return true;
            // 192.168.0.0 - 192.168.255.255
            if (parts[0] === 192 && parts[1] === 168) return true;
            // 127.0.0.0 - 127.255.255.255 (localhost)
            if (parts[0] === 127) return true;
            
            return false;
        }
        
        function getIPClass(ip) {
            const parts = ip.split('.').map(Number);
            if (parts.length !== 4) return 'IPv6';
            
            const first = parts[0];
            if (first >= 1 && first <= 126) return 'Aç±»';
            if (first >= 128 && first <= 191) return 'Bç±»';
            if (first >= 192 && first <= 223) return 'Cç±»';
            if (first >= 224 && first <= 239) return 'Dç±» (ç»„æ’­)';
            if (first >= 240 && first <= 255) return 'Eç±» (ä¿ç•™)';
            return 'æœªçŸ¥';
        }
        
        getMyIP();
    </script>
</body>
</html>
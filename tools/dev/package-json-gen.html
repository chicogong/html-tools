<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>package.json ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { padding: 1rem; }
        .container { max-width: 1400px; }
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 992px) {
            .grid-layout { grid-template-columns: 1fr; }
        }
        .dep-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        .dep-row input {
            margin-bottom: 0;
        }
        .dep-name { flex: 1; }
        .dep-version { flex: 0 0 120px; }
        pre {
            background: var(--pico-code-background-color);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            overflow-x: auto;
            max-height: 70vh;
            font-size: 0.85rem;
        }
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
        .output-section { position: sticky; top: 1rem; }
        .template-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        details { margin-bottom: 0.5rem; }
        .script-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        .script-row input { margin-bottom: 0; }
        .script-name { flex: 0 0 120px; }
        .script-cmd { flex: 1; }
        .popular-deps {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .popular-dep {
            padding: 0.2rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <button class="theme-toggle outline" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
    
    <main class="container">
        <h1>ğŸ“¦ package.json ç”Ÿæˆå™¨</h1>
        <p>å¯è§†åŒ–åˆ›å»º Node.js é¡¹ç›®é…ç½®æ–‡ä»¶</p>

        <div class="grid-layout">
            <section>
                <article>
                    <header>
                        <h3>é¡¹ç›®åŸºæœ¬ä¿¡æ¯</h3>
                    </header>
                    <div class="grid">
                        <label>
                            é¡¹ç›®åç§°
                            <input type="text" id="pkgName" value="my-project" onchange="generateOutput()">
                        </label>
                        <label>
                            ç‰ˆæœ¬å·
                            <input type="text" id="pkgVersion" value="1.0.0" onchange="generateOutput()">
                        </label>
                    </div>
                    <label>
                        æè¿°
                        <input type="text" id="pkgDescription" placeholder="é¡¹ç›®æè¿°" onchange="generateOutput()">
                    </label>
                    <div class="grid">
                        <label>
                            å…¥å£æ–‡ä»¶
                            <input type="text" id="pkgMain" value="index.js" onchange="generateOutput()">
                        </label>
                        <label>
                            ç±»å‹
                            <select id="pkgType" onchange="generateOutput()">
                                <option value="">CommonJS (é»˜è®¤)</option>
                                <option value="module">ES Module</option>
                            </select>
                        </label>
                    </div>
                    <div class="grid">
                        <label>
                            ä½œè€…
                            <input type="text" id="pkgAuthor" placeholder="ä½œè€…å" onchange="generateOutput()">
                        </label>
                        <label>
                            è®¸å¯è¯
                            <select id="pkgLicense" onchange="generateOutput()">
                                <option value="MIT">MIT</option>
                                <option value="ISC">ISC</option>
                                <option value="Apache-2.0">Apache 2.0</option>
                                <option value="GPL-3.0">GPL 3.0</option>
                                <option value="BSD-3-Clause">BSD 3-Clause</option>
                                <option value="UNLICENSED">UNLICENSED</option>
                            </select>
                        </label>
                    </div>
                    <label>
                        <input type="checkbox" id="pkgPrivate" onchange="generateOutput()">
                        ç§æœ‰åŒ…ï¼ˆä¸å‘å¸ƒåˆ° npmï¼‰
                    </label>
                </article>

                <article>
                    <header>
                        <h3>å¿«é€Ÿæ¨¡æ¿</h3>
                    </header>
                    <div class="btn-group">
                        <button class="template-btn outline" onclick="addTemplate('express')">Express</button>
                        <button class="template-btn outline" onclick="addTemplate('react')">React</button>
                        <button class="template-btn outline" onclick="addTemplate('vue')">Vue.js</button>
                        <button class="template-btn outline" onclick="addTemplate('typescript')">TypeScript</button>
                        <button class="template-btn outline" onclick="addTemplate('cli')">CLI å·¥å…·</button>
                        <button class="template-btn outline" onclick="addTemplate('api')">REST API</button>
                    </div>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>Scripts è„šæœ¬</h3>
                            <button class="outline" onclick="addScript()">+ æ·»åŠ </button>
                        </div>
                    </header>
                    <div id="scriptsContainer"></div>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>Dependencies ä¾èµ–</h3>
                            <button class="outline" onclick="addDependency('dep')">+ æ·»åŠ </button>
                        </div>
                    </header>
                    <div class="popular-deps">
                        <small>å¸¸ç”¨:</small>
                        <button class="popular-dep outline" onclick="quickAddDep('express', 'dep')">express</button>
                        <button class="popular-dep outline" onclick="quickAddDep('axios', 'dep')">axios</button>
                        <button class="popular-dep outline" onclick="quickAddDep('lodash', 'dep')">lodash</button>
                        <button class="popular-dep outline" onclick="quickAddDep('dayjs', 'dep')">dayjs</button>
                        <button class="popular-dep outline" onclick="quickAddDep('dotenv', 'dep')">dotenv</button>
                    </div>
                    <div id="depsContainer"></div>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>DevDependencies å¼€å‘ä¾èµ–</h3>
                            <button class="outline" onclick="addDependency('dev')">+ æ·»åŠ </button>
                        </div>
                    </header>
                    <div class="popular-deps">
                        <small>å¸¸ç”¨:</small>
                        <button class="popular-dep outline" onclick="quickAddDep('typescript', 'dev')">typescript</button>
                        <button class="popular-dep outline" onclick="quickAddDep('eslint', 'dev')">eslint</button>
                        <button class="popular-dep outline" onclick="quickAddDep('prettier', 'dev')">prettier</button>
                        <button class="popular-dep outline" onclick="quickAddDep('jest', 'dev')">jest</button>
                        <button class="popular-dep outline" onclick="quickAddDep('nodemon', 'dev')">nodemon</button>
                    </div>
                    <div id="devDepsContainer"></div>
                </article>

                <article>
                    <details>
                        <summary>é«˜çº§é…ç½®</summary>
                        
                        <label>
                            å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰
                            <input type="text" id="pkgKeywords" placeholder="node, javascript, tool" onchange="generateOutput()">
                        </label>
                        
                        <label>
                            ä»“åº“ URL
                            <input type="text" id="pkgRepository" placeholder="https://github.com/user/repo" onchange="generateOutput()">
                        </label>
                        
                        <label>
                            ä¸»é¡µ
                            <input type="text" id="pkgHomepage" placeholder="https://example.com" onchange="generateOutput()">
                        </label>
                        
                        <label>
                            Bug æŠ¥å‘Šåœ°å€
                            <input type="text" id="pkgBugs" placeholder="https://github.com/user/repo/issues" onchange="generateOutput()">
                        </label>

                        <div class="grid">
                            <label>
                                Node å¼•æ“ç‰ˆæœ¬
                                <input type="text" id="pkgNodeEngine" placeholder=">=18.0.0" onchange="generateOutput()">
                            </label>
                            <label>
                                npm å¼•æ“ç‰ˆæœ¬
                                <input type="text" id="pkgNpmEngine" placeholder=">=9.0.0" onchange="generateOutput()">
                            </label>
                        </div>

                        <label>
                            å¯æ‰§è¡Œæ–‡ä»¶å (bin)
                            <input type="text" id="pkgBin" placeholder="my-cli" onchange="generateOutput()">
                        </label>

                        <label>
                            files (å‘å¸ƒæ—¶åŒ…å«çš„æ–‡ä»¶ï¼Œé€—å·åˆ†éš”)
                            <input type="text" id="pkgFiles" placeholder="dist, lib, README.md" onchange="generateOutput()">
                        </label>
                    </details>
                </article>
            </section>

            <section class="output-section">
                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ç”Ÿæˆç»“æœ</h3>
                            <div class="btn-group">
                                <button class="outline" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶</button>
                                <button class="outline" onclick="downloadFile()">ğŸ’¾ ä¸‹è½½</button>
                            </div>
                        </div>
                    </header>
                    <pre><code id="output"></code></pre>
                </article>

                <article>
                    <header>
                        <h3>å®‰è£…å‘½ä»¤</h3>
                    </header>
                    <pre><code id="installCmd"></code></pre>
                    <button class="outline" onclick="copyInstallCmd()">ğŸ“‹ å¤åˆ¶å®‰è£…å‘½ä»¤</button>
                </article>
            </section>
        </div>
    </main>

    <script>
        let scripts = [];
        let dependencies = [];
        let devDependencies = [];
        let scriptId = 0;
        let depId = 0;

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        const templates = {
            express: {
                scripts: [
                    { name: 'start', cmd: 'node index.js' },
                    { name: 'dev', cmd: 'nodemon index.js' }
                ],
                deps: ['express', 'cors', 'dotenv'],
                devDeps: ['nodemon']
            },
            react: {
                type: 'module',
                scripts: [
                    { name: 'dev', cmd: 'vite' },
                    { name: 'build', cmd: 'vite build' },
                    { name: 'preview', cmd: 'vite preview' }
                ],
                deps: ['react', 'react-dom'],
                devDeps: ['vite', '@vitejs/plugin-react']
            },
            vue: {
                type: 'module',
                scripts: [
                    { name: 'dev', cmd: 'vite' },
                    { name: 'build', cmd: 'vite build' },
                    { name: 'preview', cmd: 'vite preview' }
                ],
                deps: ['vue'],
                devDeps: ['vite', '@vitejs/plugin-vue']
            },
            typescript: {
                scripts: [
                    { name: 'build', cmd: 'tsc' },
                    { name: 'dev', cmd: 'ts-node src/index.ts' },
                    { name: 'start', cmd: 'node dist/index.js' }
                ],
                deps: [],
                devDeps: ['typescript', '@types/node', 'ts-node']
            },
            cli: {
                scripts: [
                    { name: 'build', cmd: 'tsc' },
                    { name: 'start', cmd: 'node dist/index.js' }
                ],
                deps: ['commander', 'chalk'],
                devDeps: ['typescript', '@types/node']
            },
            api: {
                scripts: [
                    { name: 'start', cmd: 'node dist/index.js' },
                    { name: 'dev', cmd: 'ts-node-dev src/index.ts' },
                    { name: 'build', cmd: 'tsc' }
                ],
                deps: ['express', 'cors', 'helmet', 'dotenv'],
                devDeps: ['typescript', '@types/node', '@types/express', '@types/cors', 'ts-node-dev']
            }
        };

        function addTemplate(type) {
            const tpl = templates[type];
            if (!tpl) return;

            if (tpl.type) {
                document.getElementById('pkgType').value = tpl.type;
            }

            tpl.scripts.forEach(s => addScript(s));
            tpl.deps.forEach(d => quickAddDep(d, 'dep'));
            tpl.devDeps.forEach(d => quickAddDep(d, 'dev'));

            generateOutput();
        }

        function addScript(template = null) {
            const id = scriptId++;
            scripts.push({
                id,
                name: template?.name || '',
                cmd: template?.cmd || ''
            });
            renderScripts();
            generateOutput();
        }

        function removeScript(id) {
            scripts = scripts.filter(s => s.id !== id);
            renderScripts();
            generateOutput();
        }

        function renderScripts() {
            const container = document.getElementById('scriptsContainer');
            container.replaceChildren();

            scripts.forEach(script => {
                const row = document.createElement('div');
                row.className = 'script-row';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'script-name';
                nameInput.value = script.name;
                nameInput.placeholder = 'è„šæœ¬å';
                nameInput.onchange = (e) => { script.name = e.target.value; generateOutput(); };

                const cmdInput = document.createElement('input');
                cmdInput.type = 'text';
                cmdInput.className = 'script-cmd';
                cmdInput.value = script.cmd;
                cmdInput.placeholder = 'å‘½ä»¤';
                cmdInput.onchange = (e) => { script.cmd = e.target.value; generateOutput(); };

                const delBtn = document.createElement('button');
                delBtn.className = 'outline secondary';
                delBtn.style.padding = '0.25rem 0.5rem';
                delBtn.textContent = 'Ã—';
                delBtn.onclick = () => removeScript(script.id);

                row.appendChild(nameInput);
                row.appendChild(cmdInput);
                row.appendChild(delBtn);
                container.appendChild(row);
            });
        }

        function addDependency(type, template = null) {
            const id = depId++;
            const dep = {
                id,
                name: template?.name || '',
                version: template?.version || '^'
            };

            if (type === 'dep') {
                dependencies.push(dep);
                renderDependencies();
            } else {
                devDependencies.push(dep);
                renderDevDependencies();
            }
            generateOutput();
        }

        function quickAddDep(name, type) {
            const list = type === 'dep' ? dependencies : devDependencies;
            if (list.some(d => d.name === name)) return;

            addDependency(type, { name, version: '^' });
        }

        function removeDependency(id, type) {
            if (type === 'dep') {
                dependencies = dependencies.filter(d => d.id !== id);
                renderDependencies();
            } else {
                devDependencies = devDependencies.filter(d => d.id !== id);
                renderDevDependencies();
            }
            generateOutput();
        }

        function renderDependencies() {
            renderDepList('depsContainer', dependencies, 'dep');
        }

        function renderDevDependencies() {
            renderDepList('devDepsContainer', devDependencies, 'dev');
        }

        function renderDepList(containerId, list, type) {
            const container = document.getElementById(containerId);
            container.replaceChildren();

            list.forEach(dep => {
                const row = document.createElement('div');
                row.className = 'dep-row';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'dep-name';
                nameInput.value = dep.name;
                nameInput.placeholder = 'åŒ…å';
                nameInput.onchange = (e) => { dep.name = e.target.value; generateOutput(); };

                const versionInput = document.createElement('input');
                versionInput.type = 'text';
                versionInput.className = 'dep-version';
                versionInput.value = dep.version;
                versionInput.placeholder = '^1.0.0';
                versionInput.onchange = (e) => { dep.version = e.target.value; generateOutput(); };

                const delBtn = document.createElement('button');
                delBtn.className = 'outline secondary';
                delBtn.style.padding = '0.25rem 0.5rem';
                delBtn.textContent = 'Ã—';
                delBtn.onclick = () => removeDependency(dep.id, type);

                row.appendChild(nameInput);
                row.appendChild(versionInput);
                row.appendChild(delBtn);
                container.appendChild(row);
            });
        }

        function generateOutput() {
            const pkg = {};

            // Basic info
            const name = document.getElementById('pkgName').value.trim();
            if (name) pkg.name = name;

            const version = document.getElementById('pkgVersion').value.trim();
            if (version) pkg.version = version;

            const description = document.getElementById('pkgDescription').value.trim();
            if (description) pkg.description = description;

            const main = document.getElementById('pkgMain').value.trim();
            if (main) pkg.main = main;

            const type = document.getElementById('pkgType').value;
            if (type) pkg.type = type;

            if (document.getElementById('pkgPrivate').checked) {
                pkg.private = true;
            }

            // Scripts
            if (scripts.length > 0) {
                const validScripts = scripts.filter(s => s.name && s.cmd);
                if (validScripts.length > 0) {
                    pkg.scripts = {};
                    validScripts.forEach(s => {
                        pkg.scripts[s.name] = s.cmd;
                    });
                }
            }

            // Keywords
            const keywords = document.getElementById('pkgKeywords').value.trim();
            if (keywords) {
                pkg.keywords = keywords.split(',').map(k => k.trim()).filter(k => k);
            }

            // Author
            const author = document.getElementById('pkgAuthor').value.trim();
            if (author) pkg.author = author;

            // License
            pkg.license = document.getElementById('pkgLicense').value;

            // Repository
            const repository = document.getElementById('pkgRepository').value.trim();
            if (repository) {
                pkg.repository = {
                    type: 'git',
                    url: repository
                };
            }

            // Homepage
            const homepage = document.getElementById('pkgHomepage').value.trim();
            if (homepage) pkg.homepage = homepage;

            // Bugs
            const bugs = document.getElementById('pkgBugs').value.trim();
            if (bugs) pkg.bugs = { url: bugs };

            // Engines
            const nodeEngine = document.getElementById('pkgNodeEngine').value.trim();
            const npmEngine = document.getElementById('pkgNpmEngine').value.trim();
            if (nodeEngine || npmEngine) {
                pkg.engines = {};
                if (nodeEngine) pkg.engines.node = nodeEngine;
                if (npmEngine) pkg.engines.npm = npmEngine;
            }

            // Bin
            const bin = document.getElementById('pkgBin').value.trim();
            if (bin && main) {
                pkg.bin = {};
                pkg.bin[bin] = main;
            }

            // Files
            const files = document.getElementById('pkgFiles').value.trim();
            if (files) {
                pkg.files = files.split(',').map(f => f.trim()).filter(f => f);
            }

            // Dependencies
            if (dependencies.length > 0) {
                const validDeps = dependencies.filter(d => d.name);
                if (validDeps.length > 0) {
                    pkg.dependencies = {};
                    validDeps.forEach(d => {
                        pkg.dependencies[d.name] = d.version || '*';
                    });
                }
            }

            // DevDependencies
            if (devDependencies.length > 0) {
                const validDevDeps = devDependencies.filter(d => d.name);
                if (validDevDeps.length > 0) {
                    pkg.devDependencies = {};
                    validDevDeps.forEach(d => {
                        pkg.devDependencies[d.name] = d.version || '*';
                    });
                }
            }

            document.getElementById('output').textContent = JSON.stringify(pkg, null, 2);

            // Generate install command
            let installCmd = '';
            const depNames = dependencies.filter(d => d.name).map(d => d.name);
            const devDepNames = devDependencies.filter(d => d.name).map(d => d.name);

            if (depNames.length > 0) {
                installCmd += 'npm install ' + depNames.join(' ') + '\n';
            }
            if (devDepNames.length > 0) {
                installCmd += 'npm install -D ' + devDepNames.join(' ');
            }

            document.getElementById('installCmd').textContent = installCmd.trim() || '# æš‚æ— ä¾èµ–';
        }

        function copyOutput() {
            const output = document.getElementById('output').textContent;
            navigator.clipboard.writeText(output).then(() => {
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function copyInstallCmd() {
            const cmd = document.getElementById('installCmd').textContent;
            navigator.clipboard.writeText(cmd).then(() => {
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function downloadFile() {
            const output = document.getElementById('output').textContent;
            const blob = new Blob([output], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'package.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize with some default scripts
        addScript({ name: 'start', cmd: 'node index.js' });
        addScript({ name: 'test', cmd: 'echo "Error: no test specified" && exit 1' });
        generateOutput();
    </script>
</body>
</html>

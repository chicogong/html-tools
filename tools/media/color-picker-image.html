<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å›¾ç‰‡å–è‰²å™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="å›¾ç‰‡å–è‰²å™¨ - WebUtils" />
    <meta name="keywords" content="color-picker-image,media,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/media/color-picker-image.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="å›¾ç‰‡å–è‰²å™¨ - WebUtils" />
    <meta property="og:description" content="å›¾ç‰‡å–è‰²å™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/media/color-picker-image.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="å›¾ç‰‡å–è‰²å™¨ - WebUtils" />
    <meta name="twitter:description" content="å›¾ç‰‡å–è‰²å™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      :root {
        --canvas-bg: #f0f0f0;
      }
      [data-theme="dark"] {
        --canvas-bg: #2a2a2a;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }
      .canvas-container {
        position: relative;
        background: var(--canvas-bg);
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 1rem;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #imageCanvas {
        max-width: 100%;
        cursor: crosshair;
        display: none;
      }
      .placeholder {
        text-align: center;
        color: var(--muted-color);
        padding: 2rem;
      }
      .color-preview {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }
      .color-box {
        width: 100px;
        height: 100px;
        border-radius: 8px;
        border: 3px solid var(--contrast);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
      .color-info {
        flex: 1;
        min-width: 200px;
      }
      .color-value {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .color-value input {
        margin: 0;
        font-family: monospace;
      }
      .color-value button {
        padding: 0.5rem 1rem;
        margin: 0;
      }
      .history-title {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      .color-history {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .history-color {
        width: 50px;
        height: 50px;
        border-radius: 4px;
        cursor: pointer;
        border: 2px solid transparent;
        transition:
          border-color 0.2s,
          transform 0.2s;
      }
      .history-color:hover {
        border-color: var(--primary);
        transform: scale(1.1);
      }
      .zoom-controls {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .zoom-controls button {
        padding: 0.5rem 1rem;
      }
      .magnifier {
        position: fixed;
        width: 150px;
        height: 150px;
        border: 3px solid var(--primary);
        border-radius: 50%;
        pointer-events: none;
        display: none;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
      }
      .magnifier canvas {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      .magnifier-crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid red;
        border-radius: 50%;
      }
      .drop-zone {
        border: 2px dashed var(--muted-color);
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        transition:
          border-color 0.3s,
          background 0.3s;
      }
      .drop-zone.dragover {
        border-color: var(--primary);
        background: var(--primary-focus);
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      å›¾ç‰‡å–è‰²å™¨
    </nav>
    <main class="container">
      <header>
        <h1>ğŸ¨ å›¾ç‰‡å–è‰²å™¨</h1>
        <button id="themeToggle" class="outline">ğŸŒ™ æš—è‰²æ¨¡å¼</button>
      </header>

      <div class="drop-zone" id="dropZone">
        <p>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
        <input type="file" id="fileInput" accept="image/*" style="display: none" />
        <button onclick="document.getElementById('fileInput').click()" aria-label="é€‰æ‹©å›¾ç‰‡">
          é€‰æ‹©å›¾ç‰‡
        </button>
      </div>

      <div class="zoom-controls" style="display: none" id="zoomControls">
        <button onclick="zoomCanvas(1.2)" aria-label="ğŸ” æ”¾å¤§">ğŸ” æ”¾å¤§</button>
        <button onclick="zoomCanvas(0.8)" aria-label="ğŸ” ç¼©å°">ğŸ” ç¼©å°</button>
        <button onclick="zoomCanvas(1, true)" aria-label="â†º é‡ç½®">â†º é‡ç½®</button>
        <label style="display: flex; align-items: center; gap: 0.5rem">
          <input type="checkbox" id="magnifierToggle" checked />
          æ”¾å¤§é•œ
        </label>
      </div>

      <div class="canvas-container" id="canvasContainer">
        <canvas id="imageCanvas"></canvas>
        <div class="placeholder" id="placeholder">è¯·ä¸Šä¼ å›¾ç‰‡å¼€å§‹å–è‰²</div>
      </div>

      <div class="color-preview">
        <div class="color-box" id="colorBox" style="background: #fff"></div>
        <div class="color-info">
          <div class="color-value">
            <label for="input-hex-">HEX:</label>
            <input
              id="input-hex-"
              type="text"
              id="hexValue"
              value="#FFFFFF"
              readonly
              aria-label="æ–‡æœ¬è¾“å…¥æ¡†"
              placeholder="è¯·è¾“å…¥æ–‡æœ¬è¾“å…¥æ¡†"
            />
            <button onclick="copyColor('hex')" aria-label="å¤åˆ¶">å¤åˆ¶</button>
          </div>
          <div class="color-value">
            <label for="input-rgb-">RGB:</label>
            <input
              id="input-rgb-"
              type="text"
              id="rgbValue"
              value="rgb(255, 255, 255)"
              readonly
              aria-label="æ–‡æœ¬è¾“å…¥æ¡†"
              placeholder="è¯·è¾“å…¥æ–‡æœ¬è¾“å…¥æ¡†"
            />
            <button onclick="copyColor('rgb')" aria-label="å¤åˆ¶">å¤åˆ¶</button>
          </div>
          <div class="color-value">
            <label for="input-hsl-">HSL:</label>
            <input
              id="input-hsl-"
              type="text"
              id="hslValue"
              value="hsl(0, 0%, 100%)"
              readonly
              aria-label="æ–‡æœ¬è¾“å…¥æ¡†"
              placeholder="è¯·è¾“å…¥æ–‡æœ¬è¾“å…¥æ¡†"
            />
            <button onclick="copyColor('hsl')" aria-label="å¤åˆ¶">å¤åˆ¶</button>
          </div>
        </div>
      </div>

      <h3 class="history-title">ğŸ“‹ å–è‰²å†å²</h3>
      <div class="color-history" id="colorHistory"></div>
      <button onclick="clearHistory()" class="secondary outline" style="margin-top: 1rem">
        æ¸…ç©ºå†å²
      </button>

      <div class="magnifier" id="magnifier">
        <canvas id="magnifierCanvas" width="150" height="150"></canvas>
        <div class="magnifier-crosshair"></div>
      </div>
    </main>

    <script>
      // Theme toggle
      const themeToggle = document.getElementById("themeToggle");
      const html = document.documentElement;

      function setTheme(dark) {
        html.setAttribute("data-theme", dark ? "dark" : "light");
        themeToggle.textContent = dark ? "â˜€ï¸ äº®è‰²æ¨¡å¼" : "ğŸŒ™ æš—è‰²æ¨¡å¼";
        localStorage.setItem("theme", dark ? "dark" : "light");
      }

      themeToggle.addEventListener("click", () => {
        setTheme(html.getAttribute("data-theme") !== "dark");
      });

      // Initialize theme
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        setTheme(savedTheme === "dark");
      } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        setTheme(true);
      }

      // Canvas and image handling
      const canvas = document.getElementById("imageCanvas");
      const ctx = canvas.getContext("2d", { willReadFrequently: true });
      const fileInput = document.getElementById("fileInput");
      const dropZone = document.getElementById("dropZone");
      const placeholder = document.getElementById("placeholder");
      const zoomControls = document.getElementById("zoomControls");
      const magnifier = document.getElementById("magnifier");
      const magnifierCanvas = document.getElementById("magnifierCanvas");
      const magnifierCtx = magnifierCanvas.getContext("2d");

      let originalImage = null;
      let scale = 1;
      let colorHistory = JSON.parse(localStorage.getItem("colorHistory") || "[]");

      // File input
      fileInput.addEventListener("change", (e) => {
        if (e.target.files[0]) loadImage(e.target.files[0]);
      });

      // Drag and drop
      dropZone.addEventListener("click", () => fileInput.click());
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });
      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
      });
      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        if (e.dataTransfer.files[0]) loadImage(e.dataTransfer.files[0]);
      });

      window.loadImage = function (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            originalImage = img;
            scale = 1;
            drawImage();
            canvas.style.display = "block";
            placeholder.style.display = "none";
            zoomControls.style.display = "flex";
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      };

      function drawImage() {
        if (!originalImage) return;
        const maxWidth = document.getElementById("canvasContainer").clientWidth - 20;
        const maxHeight = 600;

        let width = originalImage.width * scale;
        let height = originalImage.height * scale;

        if (width > maxWidth) {
          const ratio = maxWidth / width;
          width = maxWidth;
          height = height * ratio;
        }
        if (height > maxHeight) {
          const ratio = maxHeight / height;
          height = maxHeight;
          width = width * ratio;
        }

        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(originalImage, 0, 0, width, height);
      }

      window.zoomCanvas = function (factor, reset = false) {
        if (reset) {
          scale = 1;
        } else {
          scale *= factor;
          scale = Math.max(0.1, Math.min(5, scale));
        }
        drawImage();
      };

      // Color picking
      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
        const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));

        const pixel = ctx.getImageData(x, y, 1, 1).data;
        const color = {
          r: pixel[0],
          g: pixel[1],
          b: pixel[2]
        };

        updateColorDisplay(color);
        addToHistory(color);
      });

      // Magnifier
      canvas.addEventListener("mousemove", (e) => {
        if (!document.getElementById("magnifierToggle").checked) {
          magnifier.style.display = "none";
          return;
        }

        magnifier.style.display = "block";
        magnifier.style.left = e.clientX + 20 + "px";
        magnifier.style.top = e.clientY - 75 + "px";

        const rect = canvas.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
        const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));

        // Draw magnified area
        const zoomFactor = 8;
        const sourceSize = Math.floor(150 / zoomFactor);

        magnifierCtx.imageSmoothingEnabled = false;
        magnifierCtx.clearRect(0, 0, 150, 150);
        magnifierCtx.drawImage(
          canvas,
          x - sourceSize / 2,
          y - sourceSize / 2,
          sourceSize,
          sourceSize,
          0,
          0,
          150,
          150
        );
      });

      canvas.addEventListener("mouseleave", () => {
        magnifier.style.display = "none";
      });

      function updateColorDisplay(color) {
        const hex = rgbToHex(color.r, color.g, color.b);
        const hsl = rgbToHsl(color.r, color.g, color.b);

        document.getElementById("colorBox").style.background = hex;
        document.getElementById("hexValue").value = hex;
        document.getElementById("rgbValue").value =
          "rgb(" + color.r + ", " + color.g + ", " + color.b + ")";
        document.getElementById("hslValue").value =
          "hsl(" + hsl.h + ", " + hsl.s + "%, " + hsl.l + "%)";
      }

      function rgbToHex(r, g, b) {
        return (
          "#" +
          [r, g, b]
            .map((x) => x.toString(16).padStart(2, "0"))
            .join("")
            .toUpperCase()
        );
      }

      function rgbToHsl(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          l = (max + min) / 2;

        if (max === min) {
          h = s = 0;
        } else {
          const d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch (max) {
            case r:
              h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
              break;
            case g:
              h = ((b - r) / d + 2) / 6;
              break;
            case b:
              h = ((r - g) / d + 4) / 6;
              break;
          }
        }

        return {
          h: Math.round(h * 360),
          s: Math.round(s * 100),
          l: Math.round(l * 100)
        };
      }

      window.copyColor = function (type) {
        const input = document.getElementById(type + "Value");
        navigator.clipboard.writeText(input.value).then(() => {
          const btn = input.nextElementSibling;
          const original = btn.textContent;
          btn.textContent = "å·²å¤åˆ¶!";
          setTimeout(() => (btn.textContent = original), 1000);
        });
      };

      function addToHistory(color) {
        const hex = rgbToHex(color.r, color.g, color.b);
        // Remove duplicate
        colorHistory = colorHistory.filter((c) => c !== hex);
        colorHistory.unshift(hex);
        // Keep only last 20 colors
        colorHistory = colorHistory.slice(0, 20);
        localStorage.setItem("colorHistory", JSON.stringify(colorHistory));
        renderHistory();
      }

      function renderHistory() {
        const container = document.getElementById("colorHistory");
        container.replaceChildren();
        colorHistory.forEach((hex) => {
          const div = document.createElement("div");
          div.className = "history-color";
          div.style.background = hex;
          div.title = hex;
          div.addEventListener("click", () => selectHistoryColor(hex));
          container.appendChild(div);
        });
      }

      window.selectHistoryColor = function (hex) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        updateColorDisplay({ r, g, b });
      };

      window.clearHistory = function () {
        colorHistory = [];
        localStorage.removeItem("colorHistory");
        renderHistory();
      };

      // Initialize
      renderHistory();

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", newTheme);
      }
    </script>
  </body>
</html>

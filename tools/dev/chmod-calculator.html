<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chmod Calculator - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="Linux æ–‡ä»¶æƒé™è®¡ç®—ï¼Œæ”¯æŒæ•°å­—å’Œç¬¦å·æ¨¡å¼äº’è½¬" />
  <meta name="keywords" content="chmod æƒé™ linux unix æ–‡ä»¶æƒé™ rwx" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/chmod-calculator.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Chmod è®¡ç®—å™¨ - WebUtils" />
  <meta property="og:description" content="Linux æ–‡ä»¶æƒé™è®¡ç®—ï¼Œæ”¯æŒæ•°å­—å’Œç¬¦å·æ¨¡å¼äº’è½¬" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/chmod-calculator.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chmod è®¡ç®—å™¨ - WebUtils" />
  <meta name="twitter:description" content="Linux æ–‡ä»¶æƒé™è®¡ç®—ï¼Œæ”¯æŒæ•°å­—å’Œç¬¦å·æ¨¡å¼äº’è½¬" />
  <!-- OG Image -->
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />


  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-blue: #4cc9f0;
      --accent-orange: #f97316;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0 245 212 / 15%);
      --glow-green: rgb(16 185 129 / 15%);
      --glow-red: rgb(244 63 94 / 15%);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #f8fafc;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-card-hover: #f1f5f9;
      --bg-input: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-subtle: #e2e8f0;
      --border-strong: #cbd5e1;
      --accent-cyan: #0891b2;
      --glow-cyan: rgb(8 145 178 / 15%);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgb(0 245 212 / 2%) 1px, transparent 1px),
        linear-gradient(90deg, rgb(0 245 212 / 2%) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 0 auto;
      padding: 24px;
      min-height: 100vh;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-decoration: none;
      padding: 8px 14px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .back-link:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .title-section {
      flex: 1;
    }

    .title-section h1 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .desc {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      transition: all 0.2s ease;
    }

    .theme-toggle:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .main-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 24px;
    }

    /* Result Display */
    .result-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    .result-box {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 16px;
      text-align: center;
    }

    .result-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }

    .result-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-cyan);
      letter-spacing: 0.1em;
    }

    .result-box.symbolic .result-value {
      font-size: 1.5rem;
      letter-spacing: 0.05em;
    }

    /* Permission Matrix */
    .permission-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .permission-table {
      width: 100%;
      border-collapse: collapse;
    }

    .permission-table th,
    .permission-table td {
      padding: 12px 8px;
      text-align: center;
      border-bottom: 1px solid var(--border-subtle);
    }

    .permission-table th {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .permission-table th.role-header {
      text-align: left;
      width: 120px;
    }

    .permission-table td.role-cell {
      text-align: left;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .role-owner { color: var(--accent-cyan); }
    .role-group { color: var(--accent-green); }
    .role-other { color: var(--accent-orange); }

    /* Custom Checkbox */
    .perm-checkbox {
      appearance: none;
      width: 32px;
      height: 32px;
      background: var(--bg-surface);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .perm-checkbox:hover {
      border-color: var(--accent-cyan);
    }

    .perm-checkbox:checked {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
    }

    .perm-checkbox:checked::after {
      content: '\2713';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--bg-deep);
      font-size: 1.2rem;
      font-weight: bold;
    }

    .perm-checkbox:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px var(--glow-cyan);
    }

    /* Input Section */
    .input-section {
      margin-bottom: 24px;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .input-group input {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      padding: 12px;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      outline: none;
      transition: all 0.2s ease;
    }

    .input-group input:focus {
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 3px var(--glow-cyan);
    }

    .input-group input::placeholder {
      color: var(--text-muted);
    }

    /* Common File Permissions */
    .presets-section {
      margin-bottom: 24px;
    }

    .presets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 8px;
    }

    .preset-btn {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      padding: 10px 12px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
    }

    .preset-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-cyan);
      color: var(--text-primary);
    }

    .preset-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px var(--glow-cyan);
    }

    .preset-value {
      display: block;
      font-weight: 600;
      color: var(--accent-cyan);
      margin-bottom: 2px;
    }

    .preset-name {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 10px 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: var(--accent-cyan);
    }

    button:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px var(--glow-cyan);
    }

    button.primary {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
      color: var(--bg-deep);
    }

    button.primary:hover {
      background: #00dfc4;
    }

    /* Message */
    .message {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      margin-top: 16px;
      display: none;
    }

    .message.success {
      background: var(--glow-green);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
    }

    .message.error {
      background: var(--glow-red);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
    }

    /* Command Preview */
    .command-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border-subtle);
    }

    .command-box {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 12px 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      color: var(--accent-green);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .command-text {
      flex: 1;
      overflow-x: auto;
      white-space: nowrap;
    }

    /* Responsive */
    @media (width <= 640px) {
      .container {
        padding: 16px;
      }

      .result-section {
        grid-template-columns: 1fr;
      }

      .input-row {
        grid-template-columns: 1fr;
      }

      .result-value {
        font-size: 1.5rem;
      }

      .result-box.symbolic .result-value {
        font-size: 1.2rem;
      }

      .permission-table th,
      .permission-table td {
        padding: 8px 4px;
      }

      .perm-checkbox {
        width: 28px;
        height: 28px;
      }
    }
  </style>
</head>

<body>
  <div class="bg-grid"></div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <a href="../../index.html" class="back-link">â† è¿”å›</a>
      <div class="title-section">
        <h1>
          <span class="title-icon">ğŸ”</span>
          Chmod Calculator
        </h1>
        <p class="desc">Linux æ–‡ä»¶æƒé™è®¡ç®—å™¨ - æ•°å­—ä¸ç¬¦å·æ ¼å¼äº’è½¬</p>
      </div>
      <div class="header-actions">
        <button id="themeToggle" class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
      </div>
    </div>

    <!-- Main Card -->
    <div class="main-card">
      <!-- Result Display -->
      <div class="result-section">
        <div class="result-box numeric">
          <div class="result-label">Numeric (å…«è¿›åˆ¶)</div>
          <div id="numericResult" class="result-value">755</div>
        </div>
        <div class="result-box symbolic">
          <div class="result-label">Symbolic (ç¬¦å·)</div>
          <div id="symbolicResult" class="result-value">rwxr-xr-x</div>
        </div>
      </div>

      <!-- Permission Matrix -->
      <div class="permission-section">
        <h2 class="section-title">ğŸ“Š æƒé™çŸ©é˜µ</h2>
        <table class="permission-table">
          <thead>
            <tr>
              <th class="role-header">è§’è‰²</th>
              <th>Read (4)</th>
              <th>Write (2)</th>
              <th>Execute (1)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="role-cell role-owner">Owner (æ‰€æœ‰è€…)</td>
              <td><input type="checkbox" class="perm-checkbox" data-role="owner" data-perm="r" checked></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="owner" data-perm="w" checked></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="owner" data-perm="x" checked></td>
            </tr>
            <tr>
              <td class="role-cell role-group">Group (ç”¨æˆ·ç»„)</td>
              <td><input type="checkbox" class="perm-checkbox" data-role="group" data-perm="r" checked></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="group" data-perm="w"></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="group" data-perm="x" checked></td>
            </tr>
            <tr>
              <td class="role-cell role-other">Other (å…¶ä»–äºº)</td>
              <td><input type="checkbox" class="perm-checkbox" data-role="other" data-perm="r" checked></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="other" data-perm="w"></td>
              <td><input type="checkbox" class="perm-checkbox" data-role="other" data-perm="x" checked></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Direct Input -->
      <div class="input-section">
        <h2 class="section-title">âœï¸ ç›´æ¥è¾“å…¥</h2>
        <div class="input-row">
          <div class="input-group">
            <label for="numericInput">Numeric (å¦‚ 755, 644)</label>
            <input type="text" id="numericInput" placeholder="755" maxlength="4">
          </div>
          <div class="input-group">
            <label for="symbolicInput">Symbolic (å¦‚ rwxr-xr-x)</label>
            <input type="text" id="symbolicInput" placeholder="rwxr-xr-x" maxlength="10">
          </div>
        </div>
      </div>

      <!-- Common Presets -->
      <div class="presets-section">
        <h2 class="section-title">âš¡ å¸¸ç”¨æƒé™</h2>
        <div class="presets-grid">
          <button class="preset-btn" data-chmod="755">
            <span class="preset-value">755</span>
            <span class="preset-name">ç›®å½•/å¯æ‰§è¡Œæ–‡ä»¶</span>
          </button>
          <button class="preset-btn" data-chmod="644">
            <span class="preset-value">644</span>
            <span class="preset-name">æ™®é€šæ–‡ä»¶</span>
          </button>
          <button class="preset-btn" data-chmod="777">
            <span class="preset-value">777</span>
            <span class="preset-name">å®Œå…¨å¼€æ”¾</span>
          </button>
          <button class="preset-btn" data-chmod="700">
            <span class="preset-value">700</span>
            <span class="preset-name">ä»…æ‰€æœ‰è€…</span>
          </button>
          <button class="preset-btn" data-chmod="600">
            <span class="preset-value">600</span>
            <span class="preset-name">ç§æœ‰æ–‡ä»¶</span>
          </button>
          <button class="preset-btn" data-chmod="444">
            <span class="preset-value">444</span>
            <span class="preset-name">åªè¯»</span>
          </button>
          <button class="preset-btn" data-chmod="666">
            <span class="preset-value">666</span>
            <span class="preset-name">å¯è¯»å†™</span>
          </button>
          <button class="preset-btn" data-chmod="400">
            <span class="preset-value">400</span>
            <span class="preset-name">SSH ç§é’¥</span>
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button id="copyNumeric" class="primary">ğŸ“‹ å¤åˆ¶æ•°å­—</button>
        <button id="copySymbolic">ğŸ“‹ å¤åˆ¶ç¬¦å·</button>
        <button id="copyCommand">ğŸ“‹ å¤åˆ¶å‘½ä»¤</button>
        <button id="shareBtn">ğŸ”— åˆ†äº«</button>
        <button id="resetBtn">ğŸ”„ é‡ç½®</button>
      </div>

      <!-- Command Preview -->
      <div class="command-section">
        <h2 class="section-title">ğŸ’» å‘½ä»¤é¢„è§ˆ</h2>
        <div class="command-box">
          <span id="commandText" class="command-text">chmod 755 filename</span>
        </div>
      </div>

      <!-- Message -->
      <div id="message" class="message"></div>
    </div>
  </div>

  <script>
    // DOM Elements
    const numericResultEl = document.getElementById('numericResult');
    const symbolicResultEl = document.getElementById('symbolicResult');
    const numericInputEl = document.getElementById('numericInput');
    const symbolicInputEl = document.getElementById('symbolicInput');
    const commandTextEl = document.getElementById('commandText');
    const messageEl = document.getElementById('message');
    const checkboxes = document.querySelectorAll('.perm-checkbox');
    const presetBtns = document.querySelectorAll('.preset-btn');
    const themeToggleEl = document.getElementById('themeToggle');

    // Permission values
    const PERM_VALUES = { r: 4, w: 2, x: 1 };

    // State
    let state = {
      owner: { r: true, w: true, x: true },
      group: { r: true, w: false, x: true },
      other: { r: true, w: false, x: true }
    };

    // ===================================
    // Core Conversion Logic
    // ===================================
    function getNumericValue() {
      const owner = (state.owner.r ? 4 : 0) + (state.owner.w ? 2 : 0) + (state.owner.x ? 1 : 0);
      const group = (state.group.r ? 4 : 0) + (state.group.w ? 2 : 0) + (state.group.x ? 1 : 0);
      const other = (state.other.r ? 4 : 0) + (state.other.w ? 2 : 0) + (state.other.x ? 1 : 0);
      return '' + owner + group + other;
    }

    function getSymbolicValue() {
      const formatRole = (perms) => {
        return (perms.r ? 'r' : '-') + (perms.w ? 'w' : '-') + (perms.x ? 'x' : '-');
      };
      return formatRole(state.owner) + formatRole(state.group) + formatRole(state.other);
    }

    function parseNumeric(value) {
      const cleaned = value.replace(/^0+/, '') || '0';
      if (!/^[0-7]{1,3}$/.test(cleaned)) {
        return null;
      }
      const padded = cleaned.padStart(3, '0');
      const digits = padded.split('').map(Number);

      return {
        owner: { r: (digits[0] & 4) !== 0, w: (digits[0] & 2) !== 0, x: (digits[0] & 1) !== 0 },
        group: { r: (digits[1] & 4) !== 0, w: (digits[1] & 2) !== 0, x: (digits[1] & 1) !== 0 },
        other: { r: (digits[2] & 4) !== 0, w: (digits[2] & 2) !== 0, x: (digits[2] & 1) !== 0 }
      };
    }

    function parseSymbolic(value) {
      const cleaned = value.toLowerCase().replace(/[^rwx-]/g, '');
      if (cleaned.length !== 9) {
        return null;
      }

      const parseRole = (str) => ({
        r: str[0] === 'r',
        w: str[1] === 'w',
        x: str[2] === 'x'
      });

      return {
        owner: parseRole(cleaned.slice(0, 3)),
        group: parseRole(cleaned.slice(3, 6)),
        other: parseRole(cleaned.slice(6, 9))
      };
    }

    // ===================================
    // UI Update
    // ===================================
    function updateDisplay() {
      const numeric = getNumericValue();
      const symbolic = getSymbolicValue();

      numericResultEl.textContent = numeric;
      symbolicResultEl.textContent = symbolic;
      commandTextEl.textContent = 'chmod ' + numeric + ' filename';

      // Update checkboxes
      checkboxes.forEach(cb => {
        const role = cb.dataset.role;
        const perm = cb.dataset.perm;
        cb.checked = state[role][perm];
      });

      saveState();
    }

    function setPermissions(newState) {
      state = newState;
      updateDisplay();
    }

    // ===================================
    // URL State Persistence
    // ===================================
    function saveState() {
      try {
        const numeric = getNumericValue();
        history.replaceState(null, '', '#' + numeric);
      } catch (error) {
        // Ignore
      }
    }

    function loadState() {
      try {
        const hash = location.hash.slice(1);
        if (!hash) return null;
        return parseNumeric(hash);
      } catch (error) {
        return null;
      }
    }

    function restoreState() {
      const savedState = loadState();
      if (savedState) {
        setPermissions(savedState);
      } else {
        updateDisplay();
      }
    }

    // ===================================
    // Clipboard Operations
    // ===================================
    async function copyToClipboard(text, label) {
      try {
        await navigator.clipboard.writeText(text);
        showMessage('å·²å¤åˆ¶ ' + label, 'success');
      } catch (error) {
        showMessage('å¤åˆ¶å¤±è´¥', 'error');
      }
    }

    // ===================================
    // Theme Toggle
    // ===================================
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      themeToggleEl.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      themeToggleEl.textContent = next === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    // ===================================
    // Helper Functions
    // ===================================
    function showMessage(text, type = 'success') {
      messageEl.textContent = text;
      messageEl.className = 'message ' + type;
      messageEl.style.display = 'block';
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 3000);
    }

    function resetToDefault() {
      setPermissions({
        owner: { r: true, w: true, x: true },
        group: { r: true, w: false, x: true },
        other: { r: true, w: false, x: true }
      });
      numericInputEl.value = '';
      symbolicInputEl.value = '';
      showMessage('å·²é‡ç½®ä¸º 755', 'success');
    }

    function generateShareLink() {
      navigator.clipboard.writeText(location.href)
        .then(() => showMessage('åˆ†äº«é“¾æ¥å·²å¤åˆ¶', 'success'))
        .catch(() => showMessage('å¤åˆ¶é“¾æ¥å¤±è´¥', 'error'));
    }

    // ===================================
    // Event Listeners
    // ===================================

    // Checkbox changes
    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        const role = cb.dataset.role;
        const perm = cb.dataset.perm;
        state[role][perm] = cb.checked;
        updateDisplay();
      });
    });

    // Numeric input
    numericInputEl.addEventListener('input', () => {
      const value = numericInputEl.value;
      if (!value) return;
      const parsed = parseNumeric(value);
      if (parsed) {
        setPermissions(parsed);
      }
    });

    // Symbolic input
    symbolicInputEl.addEventListener('input', () => {
      const value = symbolicInputEl.value;
      if (!value) return;
      const parsed = parseSymbolic(value);
      if (parsed) {
        setPermissions(parsed);
      }
    });

    // Preset buttons
    presetBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const chmod = btn.dataset.chmod;
        const parsed = parseNumeric(chmod);
        if (parsed) {
          setPermissions(parsed);
          showMessage('å·²è®¾ç½®ä¸º ' + chmod, 'success');
        }
      });
    });

    // Action buttons
    document.getElementById('copyNumeric').addEventListener('click', () => {
      copyToClipboard(getNumericValue(), 'æ•°å­—æ ¼å¼');
    });

    document.getElementById('copySymbolic').addEventListener('click', () => {
      copyToClipboard(getSymbolicValue(), 'ç¬¦å·æ ¼å¼');
    });

    document.getElementById('copyCommand').addEventListener('click', () => {
      copyToClipboard('chmod ' + getNumericValue() + ' filename', 'å‘½ä»¤');
    });

    document.getElementById('shareBtn').addEventListener('click', generateShareLink);
    document.getElementById('resetBtn').addEventListener('click', resetToDefault);
    themeToggleEl.addEventListener('click', toggleTheme);

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'c' && !window.getSelection().toString()) {
        e.preventDefault();
        copyToClipboard(getNumericValue(), 'æ•°å­—æ ¼å¼');
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        resetToDefault();
      }
    });

    // ===================================
    // Initialize
    // ===================================
    initTheme();
    restoreState();
  </script>
</body>
</html>

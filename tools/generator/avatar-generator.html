<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>像素头像生成器 | WebUtils</title>
  <meta name="description" content="在线像素风格头像生成器，生成独特的像素艺术头像">
  <meta name="keywords" content="头像,像素,avatar,pixel,生成器,8bit">
  <link rel="icon" href="../../favicon.svg" type="image/svg+xml">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: white;
      text-decoration: none;
      margin-bottom: 20px;
      opacity: 0.9;
    }
    .back-link:hover { opacity: 1; }
    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2rem;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .preview-section {
      text-align: center;
      margin-bottom: 30px;
    }
    .avatar-preview {
      width: 200px;
      height: 200px;
      margin: 0 auto 20px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    #avatarCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    .size-options {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .size-btn {
      padding: 8px 16px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      background: transparent;
      color: white;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }
    .size-btn.active {
      background: white;
      color: #2d1b69;
    }
    .seed-input {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
    }
    .seed-input label {
      color: rgba(255,255,255,0.8);
    }
    .seed-input input {
      width: 200px;
      padding: 10px 15px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 14px;
    }
    .seed-input input:focus {
      outline: none;
      border-color: white;
    }
    .seed-input input::placeholder { color: rgba(255,255,255,0.4); }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      color: white;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    .color-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .color-section h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1rem;
    }
    .color-presets {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .color-preset {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
    }
    .color-preset:hover, .color-preset.active {
      border-color: white;
      transform: scale(1.1);
    }
    .custom-colors {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .color-picker-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .color-picker-group label {
      color: rgba(255,255,255,0.8);
      font-size: 13px;
    }
    input[type="color"] {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: transparent;
    }
    .gallery {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .gallery h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1rem;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 15px;
    }
    .gallery-item {
      aspect-ratio: 1;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s;
      image-rendering: pixelated;
    }
    .gallery-item:hover {
      transform: scale(1.05);
    }
    .gallery-item canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">← 返回工具列表</a>
    <h1>像素头像生成器</h1>
    
    <div class="card">
      <div class="preview-section">
        <div class="avatar-preview">
          <canvas id="avatarCanvas" width="8" height="8"></canvas>
        </div>
        
        <div class="size-options">
          <button class="size-btn active" onclick="setSize(8)">8x8</button>
          <button class="size-btn" onclick="setSize(16)">16x16</button>
          <button class="size-btn" onclick="setSize(32)">32x32</button>
        </div>
        
        <div class="seed-input">
          <label>种子:</label>
          <input type="text" id="seedInput" placeholder="输入名称或随机种子">
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="generateRandom()">随机生成</button>
          <button class="btn btn-secondary" onclick="generateFromSeed()">从种子生成</button>
          <button class="btn btn-secondary" onclick="downloadAvatar()">下载 PNG</button>
        </div>
      </div>
      
      <div class="color-section">
        <h3>配色方案</h3>
        <div class="color-presets" id="colorPresets"></div>
        <div class="custom-colors">
          <div class="color-picker-group">
            <label>主色:</label>
            <input type="color" id="primaryColor" value="#4ade80">
          </div>
          <div class="color-picker-group">
            <label>背景:</label>
            <input type="color" id="bgColor" value="#1e1b4b">
          </div>
        </div>
      </div>
      
      <div class="gallery">
        <h3>随机画廊</h3>
        <div class="gallery-grid" id="gallery"></div>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('avatarCanvas');
    const ctx = canvas.getContext('2d');
    
    let currentSize = 8;
    let currentSeed = Math.random().toString(36).substring(7);
    let primaryColor = '#4ade80';
    let bgColor = '#1e1b4b';
    
    const colorPresets = [
      { primary: '#4ade80', bg: '#1e1b4b' },
      { primary: '#60a5fa', bg: '#1e1b4b' },
      { primary: '#f472b6', bg: '#1e1b4b' },
      { primary: '#fbbf24', bg: '#1e1b4b' },
      { primary: '#a78bfa', bg: '#1e1b4b' },
      { primary: '#34d399', bg: '#0f172a' },
      { primary: '#fb7185', bg: '#0f172a' },
      { primary: '#38bdf8', bg: '#0f172a' },
      { primary: '#ffffff', bg: '#000000' },
      { primary: '#10b981', bg: '#fef3c7' },
      { primary: '#f59e0b', bg: '#1f2937' },
      { primary: '#ef4444', bg: '#fef2f2' }
    ];
    
    function seededRandom(seed) {
      let hash = 0;
      for (let i = 0; i < seed.length; i++) {
        hash = seed.charCodeAt(i) + ((hash << 5) - hash);
        hash = hash & hash;
      }
      
      return function() {
        hash = Math.sin(hash) * 10000;
        return hash - Math.floor(hash);
      };
    }
    
    function generateAvatar(seed, size, primary, bg, targetCanvas) {
      const cvs = targetCanvas || canvas;
      const context = cvs.getContext('2d');
      
      cvs.width = size;
      cvs.height = size;
      
      const random = seededRandom(seed);
      const halfSize = Math.floor(size / 2);
      
      // 填充背景
      context.fillStyle = bg;
      context.fillRect(0, 0, size, size);
      
      // 生成像素图案（左半边，然后镜像）
      const pattern = [];
      for (let y = 0; y < size; y++) {
        pattern[y] = [];
        for (let x = 0; x < halfSize + (size % 2); x++) {
          // 边缘更容易为空，中心更容易填充
          const distFromCenter = Math.abs(x - halfSize / 2) / (halfSize / 2);
          const threshold = 0.3 + distFromCenter * 0.4;
          pattern[y][x] = random() > threshold;
        }
      }
      
      // 绘制像素
      context.fillStyle = primary;
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < halfSize + (size % 2); x++) {
          if (pattern[y][x]) {
            context.fillRect(x, y, 1, 1);
            // 镜像
            if (x < halfSize) {
              context.fillRect(size - 1 - x, y, 1, 1);
            }
          }
        }
      }
      
      return cvs;
    }
    
    function generateRandom() {
      currentSeed = Math.random().toString(36).substring(2, 10);
      document.getElementById('seedInput').value = currentSeed;
      generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
    }
    
    function generateFromSeed() {
      const input = document.getElementById('seedInput').value.trim();
      if (input) {
        currentSeed = input;
        generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
      }
    }
    
    function setSize(size) {
      currentSize = size;
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.includes(size));
      });
      generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
    }
    
    function downloadAvatar() {
      // 创建高分辨率版本
      const exportCanvas = document.createElement('canvas');
      const exportSize = 512;
      exportCanvas.width = exportSize;
      exportCanvas.height = exportSize;
      
      const exportCtx = exportCanvas.getContext('2d');
      exportCtx.imageSmoothingEnabled = false;
      
      // 先生成原始大小
      const tempCanvas = document.createElement('canvas');
      generateAvatar(currentSeed, currentSize, primaryColor, bgColor, tempCanvas);
      
      // 放大到导出尺寸
      exportCtx.drawImage(tempCanvas, 0, 0, exportSize, exportSize);
      
      // 下载
      const link = document.createElement('a');
      link.download = `avatar-${currentSeed}.png`;
      link.href = exportCanvas.toDataURL('image/png');
      link.click();
    }
    
    function initColorPresets() {
      const container = document.getElementById('colorPresets');
      colorPresets.forEach((preset, index) => {
        const btn = document.createElement('div');
        btn.className = 'color-preset';
        btn.style.background = `linear-gradient(135deg, ${preset.primary} 50%, ${preset.bg} 50%)`;
        btn.onclick = () => {
          primaryColor = preset.primary;
          bgColor = preset.bg;
          document.getElementById('primaryColor').value = preset.primary;
          document.getElementById('bgColor').value = preset.bg;
          generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
          
          document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('active'));
          btn.classList.add('active');
        };
        container.appendChild(btn);
      });
    }
    
    function initGallery() {
      const gallery = document.getElementById('gallery');
      for (let i = 0; i < 12; i++) {
        const seed = Math.random().toString(36).substring(2, 10);
        const preset = colorPresets[i % colorPresets.length];
        
        const item = document.createElement('div');
        item.className = 'gallery-item';
        
        const cvs = document.createElement('canvas');
        generateAvatar(seed, 8, preset.primary, preset.bg, cvs);
        
        item.appendChild(cvs);
        item.onclick = () => {
          currentSeed = seed;
          primaryColor = preset.primary;
          bgColor = preset.bg;
          document.getElementById('seedInput').value = seed;
          document.getElementById('primaryColor').value = preset.primary;
          document.getElementById('bgColor').value = preset.bg;
          generateAvatar(seed, currentSize, primaryColor, bgColor);
        };
        
        gallery.appendChild(item);
      }
    }
    
    // 颜色选择器事件
    document.getElementById('primaryColor').addEventListener('input', (e) => {
      primaryColor = e.target.value;
      generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
    });
    
    document.getElementById('bgColor').addEventListener('input', (e) => {
      bgColor = e.target.value;
      generateAvatar(currentSeed, currentSize, primaryColor, bgColor);
    });
    
    // 回车键生成
    document.getElementById('seedInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') generateFromSeed();
    });
    
    // 初始化
    initColorPresets();
    initGallery();
    generateRandom();
  </script>
</body>
</html>

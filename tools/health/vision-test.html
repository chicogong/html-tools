<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="keywords" content="vision-test,health,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/health/vision-test.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta property="og:description" content="è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/health/vision-test.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="twitter:description" content="è§†åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;

        /* å­—ä½“å˜é‡ */
        --font-sans:
          "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      :root {
        --bg: #0a0a0f;
        --card: #12121a;
        --border: #2a2a3a;
        --text: #fff;
        --text2: #888;
        --accent: #3b82f6;
        --accent2: #06b6d4;
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f5f5f5;
          --card: #fff;
          --border: #e0e0e0;
          --text: #333;
          --text2: #666;
        }
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        text-align: center;
        margin-bottom: 8px;
        font-size: 1.8rem;
      }
      .subtitle {
        text-align: center;
        color: var(--text2);
        margin-bottom: 24px;
      }
      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      .tab {
        flex: 1;
        min-width: 100px;
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: var(--bg);
        color: var(--text);
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
      }
      .tab.active {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
      }
      .card-title {
        font-size: 1rem;
        color: var(--text2);
        margin-bottom: 16px;
      }
      .test-area {
        min-height: 400px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 12px;
        padding: 40px;
        margin-bottom: 20px;
      }
      .e-chart {
        font-family: "Arial Black", sans-serif;
        color: #000;
        text-align: center;
      }
      .e-char {
        display: inline-block;
        transition: transform 0.3s;
      }
      .controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }
      .controls button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        background: var(--accent);
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: opacity 0.2s;
      }
      .controls button:hover {
        opacity: 0.9;
      }
      .controls button.secondary {
        background: var(--border);
        color: var(--text);
      }
      .direction-pad {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        gap: 8px;
        margin: 20px auto;
      }
      .direction-btn {
        width: 60px;
        height: 60px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--bg);
        color: var(--text);
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .direction-btn:hover {
        border-color: var(--accent);
        background: var(--accent);
        color: white;
      }
      .direction-btn.center {
        visibility: hidden;
      }
      .result-hero {
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        padding: 28px;
        border-radius: 12px;
        text-align: center;
        color: white;
        margin-bottom: 20px;
      }
      .result-hero .label {
        opacity: 0.9;
        margin-bottom: 8px;
      }
      .result-hero .big {
        font-size: 2.5rem;
        font-weight: 700;
      }
      .result-hero .sub {
        margin-top: 8px;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      .progress {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
      }
      .progress-dot {
        flex: 1;
        height: 6px;
        background: var(--border);
        border-radius: 3px;
      }
      .progress-dot.done {
        background: var(--accent);
      }
      .progress-dot.current {
        background: var(--accent);
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      @media (max-width: 768px) {
        .info-grid {
          grid-template-columns: 1fr;
        }
      }
      .info-item {
        padding: 16px;
        background: var(--bg);
        border-radius: 8px;
      }
      .info-title {
        font-weight: 600;
        margin-bottom: 8px;
      }
      .info-text {
        font-size: 0.9rem;
        color: var(--text2);
      }
      .color-test {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        max-width: 400px;
      }
      .astigmatism-chart {
        width: 300px;
        height: 300px;
        margin: 20px auto;
      }
      .contrast-test {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }
      .contrast-row {
        display: flex;
        gap: 12px;
      }
      .contrast-letter {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        background: white;
        border-radius: 8px;
      }
      .note {
        margin-top: 16px;
        padding: 12px;
        background: var(--bg);
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--text2);
      }
      .instructions {
        padding: 20px;
        background: var(--bg);
        border-radius: 12px;
        margin-bottom: 20px;
      }
      .instructions h3 {
        margin-bottom: 12px;
      }
      .instructions ol {
        padding-left: 20px;
      }
      .instructions li {
        margin-bottom: 8px;
        color: var(--text2);
      }
      .back-link {
        display: inline-block;
        margin-bottom: 16px;
        color: var(--accent);
        text-decoration: none;
        font-size: 0.9rem;
      }
      .back-link:hover {
        text-decoration: underline;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      è§†åŠ›æµ‹è¯•å·¥å…·
    </nav>
    <div class="container">
      <a href="../../index.html" class="back-link">â† è¿”å›</a>
      <h1>è§†åŠ›æµ‹è¯•å·¥å…·</h1>
      <p class="subtitle">åœ¨çº¿è§†åŠ›è‡ªæµ‹ï¼ˆä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šæ£€æŸ¥ï¼‰</p>

      <div class="tabs">
        <div class="tab active" data-test="snellen" onclick="setTest('snellen')">è§†åŠ›è¡¨æµ‹è¯•</div>
        <div class="tab" data-test="astigmatism" onclick="setTest('astigmatism')">æ•£å…‰æµ‹è¯•</div>
        <div class="tab" data-test="contrast" onclick="setTest('contrast')">å¯¹æ¯”æ•æ„Ÿåº¦</div>
      </div>

      <div id="testContent"></div>

      <div class="card">
        <div class="card-title">è§†åŠ›çŸ¥è¯†</div>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-title">ä»€ä¹ˆæ˜¯è§†åŠ›</div>
            <div class="info-text">
              è§†åŠ›æŒ‡çœ¼ç›åˆ†è¾¨ç‰©ä½“ç»†èŠ‚çš„èƒ½åŠ›ã€‚æ ‡å‡†è§†åŠ›1.0è¡¨ç¤ºåœ¨5ç±³è·ç¦»èƒ½åˆ†è¾¨1.45mmé«˜åº¦çš„ç»†èŠ‚ã€‚
            </div>
          </div>
          <div class="info-item">
            <div class="info-title">æŠ¤çœ¼å»ºè®®</div>
            <div class="info-text">
              éµå¾ª20-20-20æ³•åˆ™ï¼šæ¯20åˆ†é’Ÿï¼Œçœ‹20è‹±å°ºï¼ˆ6ç±³ï¼‰å¤–ï¼ŒæŒç»­20ç§’ã€‚ä¿æŒå……è¶³ç…§æ˜ï¼Œé¿å…ç”¨çœ¼ç–²åŠ³ã€‚
            </div>
          </div>
          <div class="info-item">
            <div class="info-title">ä½•æ—¶å°±åŒ»</div>
            <div class="info-text">
              å¦‚å‡ºç°è§†åŠ›æ¨¡ç³Šã€é‡å½±ã€çœ¼ç—›ã€é—ªå…‰æ„Ÿæˆ–è§†é‡ç¼ºæŸï¼Œåº”åŠæ—¶å°±åŒ»æ£€æŸ¥ã€‚
            </div>
          </div>
          <div class="info-item">
            <div class="info-title">æ£€æŸ¥é¢‘ç‡</div>
            <div class="info-text">
              å„¿ç«¥æ¯å¹´æ£€æŸ¥ä¸€æ¬¡ï¼Œæˆäººæ¯2å¹´ä¸€æ¬¡ï¼Œ40å²ä»¥ä¸Šæˆ–æœ‰çœ¼ç—…å²è€…æ¯å¹´æ£€æŸ¥ã€‚
            </div>
          </div>
        </div>
      </div>

      <div class="note">
        æœ¬å·¥å…·ä»…ä¾›æ—¥å¸¸è‡ªæµ‹å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šçœ¼ç§‘æ£€æŸ¥ã€‚å±å¹•æµ‹è¯•ç»“æœå¯èƒ½å› è®¾å¤‡ã€ç¯å¢ƒå…‰çº¿ç­‰å› ç´ äº§ç”Ÿåå·®ã€‚å¦‚æœ‰è§†åŠ›é—®é¢˜ï¼Œè¯·åŠæ—¶åˆ°åŒ»é™¢è¿›è¡Œä¸“ä¸šæ£€æŸ¥ã€‚
      </div>
    </div>

    <script>
      let currentTest = "snellen";
      let testState = {
        level: 0,
        correct: 0,
        total: 0,
        currentDirection: 0,
        results: []
      };

      const snellenLevels = [
        { size: 80, vision: "0.1", equiv: "20/200" },
        { size: 60, vision: "0.15", equiv: "20/133" },
        { size: 48, vision: "0.2", equiv: "20/100" },
        { size: 40, vision: "0.25", equiv: "20/80" },
        { size: 32, vision: "0.3", equiv: "20/67" },
        { size: 28, vision: "0.4", equiv: "20/50" },
        { size: 24, vision: "0.5", equiv: "20/40" },
        { size: 20, vision: "0.6", equiv: "20/33" },
        { size: 16, vision: "0.8", equiv: "20/25" },
        { size: 12, vision: "1.0", equiv: "20/20" },
        { size: 10, vision: "1.2", equiv: "20/17" },
        { size: 8, vision: "1.5", equiv: "20/13" }
      ];

      const directions = [
        { angle: 0, arrow: "â†’", name: "å³" },
        { angle: 90, arrow: "â†“", name: "ä¸‹" },
        { angle: 180, arrow: "â†", name: "å·¦" },
        { angle: 270, arrow: "â†‘", name: "ä¸Š" }
      ];

      function setTest(test) {
        currentTest = test;
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.toggle("active", t.dataset.test === test));
        resetTest();
        renderTest();
      }

      function resetTest() {
        testState = { level: 0, correct: 0, total: 0, currentDirection: 0, results: [] };
      }

      function renderTest() {
        const container = document.getElementById("testContent");
        container.textContent = "";

        if (currentTest === "snellen") {
          renderSnellenTest(container);
        } else if (currentTest === "astigmatism") {
          renderAstigmatismTest(container);
        } else if (currentTest === "contrast") {
          renderContrastTest(container);
        }
      }

      function renderSnellenTest(container) {
        // è¯´æ˜
        const instructions = document.createElement("div");
        instructions.className = "instructions";
        const h3 = document.createElement("h3");
        h3.textContent = "æµ‹è¯•è¯´æ˜";
        instructions.appendChild(h3);
        const ol = document.createElement("ol");
        [
          "ä¸å±å¹•ä¿æŒçº¦50-60cmè·ç¦»",
          "å¯é€‰æ‹©æµ‹è¯•å·¦çœ¼æˆ–å³çœ¼ï¼ˆé®ä½å¦ä¸€åªçœ¼ï¼‰",
          'è§‚å¯Ÿå±å¹•ä¸Šçš„"E"å­—å¼€å£æ–¹å‘',
          "ç‚¹å‡»å¯¹åº”æ–¹å‘çš„ç®­å¤´æˆ–ä½¿ç”¨é”®ç›˜æ–¹å‘é”®"
        ].forEach((text) => {
          const li = document.createElement("li");
          li.textContent = text;
          ol.appendChild(li);
        });
        instructions.appendChild(ol);
        container.appendChild(instructions);

        // è¿›åº¦æ¡
        const progress = document.createElement("div");
        progress.className = "progress";
        for (let i = 0; i < snellenLevels.length; i++) {
          const dot = document.createElement("div");
          dot.className = "progress-dot";
          if (i < testState.level) dot.classList.add("done");
          if (i === testState.level) dot.classList.add("current");
          progress.appendChild(dot);
        }
        container.appendChild(progress);

        // æµ‹è¯•åŒºåŸŸ
        const testArea = document.createElement("div");
        testArea.className = "test-area";

        if (testState.level >= snellenLevels.length || testState.results.length >= 12) {
          // æ˜¾ç¤ºç»“æœ
          const bestLevel = Math.max(0, testState.level - 1);
          const result = snellenLevels[Math.min(bestLevel, snellenLevels.length - 1)];

          const resultDiv = document.createElement("div");
          resultDiv.style.cssText = "text-align: center; color: #333;";

          const completeText = document.createElement("div");
          completeText.style.cssText = "font-size: 1.2rem; margin-bottom: 16px;";
          completeText.textContent = "æµ‹è¯•å®Œæˆ";

          const visionText = document.createElement("div");
          visionText.style.cssText = "font-size: 3rem; font-weight: 700; color: #3b82f6;";
          visionText.textContent = result.vision;

          const equivText = document.createElement("div");
          equivText.style.cssText = "font-size: 1rem; color: #666; margin-top: 8px;";
          equivText.textContent = result.equiv;

          resultDiv.appendChild(completeText);
          resultDiv.appendChild(visionText);
          resultDiv.appendChild(equivText);
          testArea.appendChild(resultDiv);

          container.appendChild(testArea);

          const hero = document.createElement("div");
          hero.className = "result-hero";

          const heroLabel = document.createElement("div");
          heroLabel.className = "label";
          heroLabel.textContent = "æ‚¨çš„è§†åŠ›çº¦ä¸º";

          const heroBig = document.createElement("div");
          heroBig.className = "big";
          heroBig.textContent = result.vision;

          const heroSub = document.createElement("div");
          heroSub.className = "sub";
          heroSub.textContent =
            "æ­£ç¡®ç‡: " + Math.round((testState.correct / testState.total) * 100) + "%";

          hero.appendChild(heroLabel);
          hero.appendChild(heroBig);
          hero.appendChild(heroSub);
          container.appendChild(hero);
        } else {
          // æ˜¾ç¤ºEå­—
          testState.currentDirection = Math.floor(Math.random() * 4);
          const level = snellenLevels[testState.level];
          const dir = directions[testState.currentDirection];

          const eChart = document.createElement("div");
          eChart.className = "e-chart";
          const eChar = document.createElement("div");
          eChar.className = "e-char";
          eChar.style.cssText =
            "font-size: " + level.size + "px; transform: rotate(" + dir.angle + "deg);";
          eChar.textContent = "E";
          eChart.appendChild(eChar);
          testArea.appendChild(eChart);

          const levelInfo = document.createElement("div");
          levelInfo.style.cssText = "margin-top: 20px; color: #666; font-size: 0.9rem;";
          levelInfo.textContent = "å½“å‰æµ‹è¯•: " + level.vision + " (" + level.equiv + ")";
          testArea.appendChild(levelInfo);

          container.appendChild(testArea);

          // æ–¹å‘æŒ‰é’®
          const dirPad = document.createElement("div");
          dirPad.className = "direction-pad";

          const layout = [null, 3, null, 2, null, 0, null, 1, null];
          layout.forEach((dirIndex, i) => {
            const btn = document.createElement("button");
            btn.className = "direction-btn";
            if (dirIndex === null) {
              btn.classList.add("center");
            } else {
              btn.textContent = directions[dirIndex].arrow;
              btn.onclick = () => checkAnswer(dirIndex);
            }
            dirPad.appendChild(btn);
          });
          container.appendChild(dirPad);
        }

        // æ§åˆ¶æŒ‰é’®
        const controls = document.createElement("div");
        controls.className = "controls";

        const restartBtn = document.createElement("button");
        restartBtn.className = "secondary";
        restartBtn.textContent = "é‡æ–°å¼€å§‹";
        restartBtn.onclick = () => {
          resetTest();
          renderTest();
        };
        controls.appendChild(restartBtn);

        container.appendChild(controls);
      }

      function checkAnswer(selected) {
        testState.total++;
        testState.results.push({
          level: testState.level,
          correct: selected === testState.currentDirection
        });

        if (selected === testState.currentDirection) {
          testState.correct++;
          const recentResults = testState.results.slice(-3);
          if (
            recentResults.length === 3 &&
            recentResults.every((r) => r.correct && r.level === testState.level)
          ) {
            testState.level++;
          }
        } else {
          const recentResults = testState.results.slice(-2);
          if (recentResults.length === 2 && recentResults.every((r) => !r.correct)) {
            testState.level = snellenLevels.length;
          }
        }

        renderTest();
      }

      function renderAstigmatismTest(container) {
        const instructions = document.createElement("div");
        instructions.className = "instructions";
        const h3 = document.createElement("h3");
        h3.textContent = "æ•£å…‰æµ‹è¯•è¯´æ˜";
        instructions.appendChild(h3);
        const ol = document.createElement("ol");
        [
          "ä¸å±å¹•ä¿æŒæ­£å¸¸é˜…è¯»è·ç¦»",
          "åˆ†åˆ«é®ä½å·¦çœ¼å’Œå³çœ¼æµ‹è¯•",
          "è§‚å¯Ÿä¸‹æ–¹çš„æ”¾å°„çº¿å›¾",
          "å¦‚æœæŸäº›æ–¹å‘çš„çº¿æ¡æ¯”å…¶ä»–æ–¹å‘æ›´æ¸…æ™°æˆ–æ›´é»‘ï¼Œå¯èƒ½å­˜åœ¨æ•£å…‰"
        ].forEach((text) => {
          const li = document.createElement("li");
          li.textContent = text;
          ol.appendChild(li);
        });
        instructions.appendChild(ol);
        container.appendChild(instructions);

        const testArea = document.createElement("div");
        testArea.className = "test-area";

        const canvas = document.createElement("canvas");
        canvas.width = 300;
        canvas.height = 300;
        canvas.className = "astigmatism-chart";

        const ctx = canvas.getContext("2d");
        const centerX = 150;
        const centerY = 150;
        const radius = 140;

        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;

        for (let i = 0; i < 24; i++) {
          const angle = (i * 15 * Math.PI) / 180;
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.lineTo(centerX + radius * Math.cos(angle), centerY + radius * Math.sin(angle));
          ctx.stroke();
        }

        ctx.beginPath();
        ctx.arc(centerX, centerY, 10, 0, Math.PI * 2);
        ctx.fillStyle = "#000";
        ctx.fill();

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.stroke();

        testArea.appendChild(canvas);

        const resultText = document.createElement("div");
        resultText.style.cssText =
          "text-align: center; color: #333; margin-top: 20px; max-width: 400px;";

        const p1 = document.createElement("p");
        const strong = document.createElement("strong");
        strong.textContent = "å¦‚ä½•åˆ¤æ–­ï¼š";
        p1.appendChild(strong);

        const p2 = document.createElement("p");
        p2.style.marginTop = "8px";
        p2.textContent = "æ­£å¸¸è§†åŠ›ï¼šæ‰€æœ‰çº¿æ¡æ¸…æ™°åº¦ç›¸åŒ";

        const p3 = document.createElement("p");
        p3.textContent = "æ•£å…‰è¿¹è±¡ï¼šæŸäº›æ–¹å‘çš„çº¿æ¡æ¯”å…¶ä»–æ–¹å‘æ›´æ¸…æ™°ã€æ›´é»‘æˆ–æ›´ç²—";

        resultText.appendChild(p1);
        resultText.appendChild(p2);
        resultText.appendChild(p3);
        testArea.appendChild(resultText);

        container.appendChild(testArea);
      }

      function renderContrastTest(container) {
        const instructions = document.createElement("div");
        instructions.className = "instructions";
        const h3 = document.createElement("h3");
        h3.textContent = "å¯¹æ¯”æ•æ„Ÿåº¦æµ‹è¯•è¯´æ˜";
        instructions.appendChild(h3);
        const ol = document.createElement("ol");
        [
          "ä¸å±å¹•ä¿æŒæ­£å¸¸é˜…è¯»è·ç¦»",
          "è§‚å¯Ÿä¸‹æ–¹çš„å­—æ¯",
          "ä»å·¦åˆ°å³ï¼Œå­—æ¯çš„å¯¹æ¯”åº¦é€æ¸é™ä½",
          "è®°å½•æ‚¨èƒ½æ¸…æ™°è¾¨è®¤çš„æœ€åä¸€ä¸ªå­—æ¯"
        ].forEach((text) => {
          const li = document.createElement("li");
          li.textContent = text;
          ol.appendChild(li);
        });
        instructions.appendChild(ol);
        container.appendChild(instructions);

        const testArea = document.createElement("div");
        testArea.className = "test-area";

        const contrastTest = document.createElement("div");
        contrastTest.className = "contrast-test";

        const letters = ["C", "D", "H", "K", "N", "O", "R", "S", "V", "Z"];
        const contrastLevels = [100, 80, 60, 45, 30, 20, 15, 10, 7, 5];

        for (let row = 0; row < 3; row++) {
          const rowDiv = document.createElement("div");
          rowDiv.className = "contrast-row";

          for (let col = 0; col < 4; col++) {
            const index = row * 4 + col;
            if (index < 10) {
              const letterDiv = document.createElement("div");
              letterDiv.className = "contrast-letter";
              letterDiv.textContent = letters[index];
              const gray = 255 - Math.round((255 * contrastLevels[index]) / 100);
              letterDiv.style.color = "rgb(" + gray + "," + gray + "," + gray + ")";
              rowDiv.appendChild(letterDiv);
            }
          }

          contrastTest.appendChild(rowDiv);
        }

        testArea.appendChild(contrastTest);

        const resultText = document.createElement("div");
        resultText.style.cssText = "text-align: center; color: #333; margin-top: 20px;";

        const p1 = document.createElement("p");
        p1.textContent = "å¯¹æ¯”åº¦ä»å·¦åˆ°å³é€’å‡ï¼š100% â†’ 5%";

        const p2 = document.createElement("p");
        p2.style.marginTop = "8px";
        p2.textContent = "æ­£å¸¸è§†åŠ›åº”èƒ½è¯†åˆ«åˆ°çº¦15%-20%å¯¹æ¯”åº¦çš„å­—æ¯";

        resultText.appendChild(p1);
        resultText.appendChild(p2);
        testArea.appendChild(resultText);

        container.appendChild(testArea);
      }

      document.addEventListener("keydown", (e) => {
        if (currentTest === "snellen" && testState.level < snellenLevels.length) {
          const keyMap = { ArrowRight: 0, ArrowDown: 1, ArrowLeft: 2, ArrowUp: 3 };
          if (keyMap.hasOwnProperty(e.key)) {
            e.preventDefault();
            checkAnswer(keyMap[e.key]);
          }
        }
      });

      renderTest();

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", newTheme);
      }

      // Load saved theme
      const savedTheme = localStorage.getItem("theme") || "dark";
      if (savedTheme === "light") {
        document.documentElement.setAttribute("data-theme", "light");
        document.getElementById("theme-icon").textContent = "â˜€ï¸";
      }
    </script>
  </body>
</html>

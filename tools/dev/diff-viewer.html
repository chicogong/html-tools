<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Diff æŸ¥çœ‹å™¨ - WebUtils</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --add-bg: #dcfce7; --add-color: #166534; --del-bg: #fee2e2; --del-color: #991b1b; --hunk-bg: #e0f2fe; --hunk-color: #0369a1; }
        [data-theme="dark"] { --add-bg: #14532d; --add-color: #86efac; --del-bg: #7f1d1d; --del-color: #fca5a5; --hunk-bg: #0c4a6e; --hunk-color: #7dd3fc; }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .input-section { background: var(--pico-card-background-color); border-radius: 10px; padding: 1rem; margin-bottom: 1rem; }
        .input-section textarea { min-height: 150px; font-family: monospace; font-size: 0.85rem; }
        .input-section .actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .stats { display: flex; gap: 1.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .stat { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        .stat .badge { padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 600; }
        .stat .badge.add { background: var(--add-bg); color: var(--add-color); }
        .stat .badge.del { background: var(--del-bg); color: var(--del-color); }
        .stat .badge.files { background: var(--hunk-bg); color: var(--hunk-color); }
        .diff-output { background: var(--pico-card-background-color); border-radius: 10px; overflow: hidden; }
        .diff-file { margin-bottom: 1rem; }
        .diff-file:last-child { margin-bottom: 0; }
        .diff-header { padding: 0.75rem 1rem; background: var(--pico-muted-border-color); font-family: monospace; font-size: 0.85rem; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .diff-content { font-family: monospace; font-size: 0.8rem; line-height: 1.5; overflow-x: auto; }
        .diff-line { display: flex; white-space: pre; }
        .diff-line .line-num { min-width: 80px; padding: 0 0.5rem; text-align: right; color: var(--pico-muted-color); user-select: none; background: var(--pico-muted-border-color); }
        .diff-line .line-content { flex: 1; padding: 0 0.5rem; }
        .diff-line.add { background: var(--add-bg); }
        .diff-line.add .line-content { color: var(--add-color); }
        .diff-line.del { background: var(--del-bg); }
        .diff-line.del .line-content { color: var(--del-color); }
        .diff-line.hunk { background: var(--hunk-bg); }
        .diff-line.hunk .line-content { color: var(--hunk-color); font-weight: 600; }
        .empty-state { text-align: center; padding: 3rem; color: var(--pico-muted-color); }
        .sample-btn { font-size: 0.8rem; padding: 0.3rem 0.6rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š Git Diff æŸ¥çœ‹å™¨</h1>
            <button id="themeToggle" class="outline">ğŸŒ™</button>
        </header>
        <div class="input-section">
            <textarea id="diffInput" placeholder="ç²˜è´´ git diff è¾“å‡ºæˆ– unified diff æ ¼å¼å†…å®¹..."></textarea>
            <div class="actions">
                <button onclick="parseDiff()" class="primary">è§£æ Diff</button>
                <button onclick="loadSample()" class="outline sample-btn">åŠ è½½ç¤ºä¾‹</button>
                <button onclick="clearAll()" class="secondary">æ¸…ç©º</button>
            </div>
        </div>
        <div class="stats" id="stats" style="display:none;">
            <div class="stat"><span class="badge files" id="fileCount">0</span> æ–‡ä»¶ä¿®æ”¹</div>
            <div class="stat"><span class="badge add" id="addCount">+0</span> è¡Œæ·»åŠ </div>
            <div class="stat"><span class="badge del" id="delCount">-0</span> è¡Œåˆ é™¤</div>
        </div>
        <div class="diff-output" id="diffOutput">
            <div class="empty-state">ç²˜è´´ diff å†…å®¹åç‚¹å‡»"è§£æ Diff"æŸ¥çœ‹ç»“æœ</div>
        </div>
    </div>
    <script>
        const $ = id => document.getElementById(id);
        function parseDiff() {
            const input = $('diffInput').value.trim();
            if (!input) { $('diffOutput').innerHTML = '<div class="empty-state">è¯·è¾“å…¥ diff å†…å®¹</div>'; $('stats').style.display = 'none'; return; }
            const lines = input.split('\n');
            const files = [];
            let currentFile = null;
            let totalAdd = 0, totalDel = 0;
            lines.forEach(line => {
                if (line.startsWith('diff --git') || line.startsWith('--- ') && !currentFile) {
                    if (currentFile) files.push(currentFile);
                    const match = line.match(/diff --git a\/(.+) b\/(.+)/) || line.match(/--- a?\/?(.*)/);
                    currentFile = { name: match ? match[2] || match[1] : 'unknown', lines: [], add: 0, del: 0 };
                } else if (line.startsWith('+++ ') && currentFile) {
                    const match = line.match(/\+\+\+ b?\/?(.*)/);
                    if (match && match[1]) currentFile.name = match[1];
                } else if (currentFile) {
                    let type = 'normal';
                    if (line.startsWith('@@')) type = 'hunk';
                    else if (line.startsWith('+') && !line.startsWith('+++')) { type = 'add'; currentFile.add++; totalAdd++; }
                    else if (line.startsWith('-') && !line.startsWith('---')) { type = 'del'; currentFile.del++; totalDel++; }
                    currentFile.lines.push({ content: line, type });
                }
            });
            if (currentFile) files.push(currentFile);
            if (files.length === 0) { $('diffOutput').innerHTML = '<div class="empty-state">æœªèƒ½è§£æåˆ°æœ‰æ•ˆçš„ diff å†…å®¹</div>'; $('stats').style.display = 'none'; return; }
            $('fileCount').textContent = files.length;
            $('addCount').textContent = '+' + totalAdd;
            $('delCount').textContent = '-' + totalDel;
            $('stats').style.display = 'flex';
            $('diffOutput').innerHTML = files.map(f => {
                let oldLine = 0, newLine = 0;
                return '<div class="diff-file"><div class="diff-header"><span>'+escapeHtml(f.name)+'</span><span style="font-weight:normal;"><span style="color:var(--add-color)">+'+f.add+'</span> / <span style="color:var(--del-color)">-'+f.del+'</span></span></div><div class="diff-content">'+
                f.lines.map(l => {
                    let lineNum = '';
                    if (l.type === 'hunk') {
                        const m = l.content.match(/@@ -(\d+),?\d* \+(\d+),?\d* @@/);
                        if (m) { oldLine = parseInt(m[1]) - 1; newLine = parseInt(m[2]) - 1; }
                        lineNum = '...';
                    } else if (l.type === 'add') { newLine++; lineNum = '  ' + newLine; }
                    else if (l.type === 'del') { oldLine++; lineNum = oldLine + '  '; }
                    else { oldLine++; newLine++; lineNum = oldLine + ' ' + newLine; }
                    return '<div class="diff-line '+l.type+'"><span class="line-num">'+lineNum+'</span><span class="line-content">'+escapeHtml(l.content)+'</span></div>';
                }).join('')+'</div></div>';
            }).join('');
        }
        window.loadSample = function() {
            $('diffInput').value = `diff --git a/src/app.js b/src/app.js
index 1234567..abcdefg 100644
--- a/src/app.js
+++ b/src/app.js
@@ -10,7 +10,8 @@ function init() {
     console.log('Starting app...');
-    const config = loadConfig();
+    const config = loadConfig('./config.json');
+    validateConfig(config);
     setupRoutes(config);
 }
 
@@ -25,6 +26,10 @@ function loadConfig() {
     return JSON.parse(data);
 }
 
+function validateConfig(config) {
+    if (!config.port) throw new Error('Port is required');
+}
+
 module.exports = { init };`;
            parseDiff();
        };
        window.clearAll = function() { $('diffInput').value = ''; $('diffOutput').innerHTML = '<div class="empty-state">ç²˜è´´ diff å†…å®¹åç‚¹å‡»"è§£æ Diff"æŸ¥çœ‹ç»“æœ</div>'; $('stats').style.display = 'none'; };
        window.escapeHtml = function(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); };
        function loadTheme() { const t = localStorage.getItem('theme') || 'light'; document.documentElement.setAttribute('data-theme', t); $('themeToggle').textContent = t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; }
        window.toggleTheme = function() { const c = document.documentElement.getAttribute('data-theme'); const n = c === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('theme', n); $('themeToggle').textContent = n === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; };
        $('themeToggle').onclick = toggleTheme;
        loadTheme();
    </script>
</body>
</html>

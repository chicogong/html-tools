<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—ç¬¦ä¸²æ‹¼æ¥å™¨ - WebUtils</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --primary: #8b5cf6; }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } }
        .panel { background: var(--pico-card-background-color); border-radius: 10px; padding: 1rem; }
        .panel h3 { margin: 0 0 1rem; font-size: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .panel h3 .count { font-weight: normal; font-size: 0.8rem; color: var(--pico-muted-color); }
        .parts-list { max-height: 400px; overflow-y: auto; }
        .part-item { display: flex; gap: 0.5rem; align-items: center; padding: 0.5rem; background: var(--pico-muted-border-color); border-radius: 6px; margin-bottom: 0.5rem; }
        .part-item .drag-handle { cursor: grab; opacity: 0.5; }
        .part-item input { flex: 1; margin: 0; font-family: monospace; font-size: 0.85rem; }
        .part-item .type-select { width: 80px; margin: 0; font-size: 0.8rem; padding: 0.3rem; }
        .part-item .remove-btn { background: none; border: none; color: #ef4444; cursor: pointer; padding: 0.25rem; font-size: 1rem; }
        .add-part { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .add-part input { flex: 1; margin: 0; }
        .add-part button { margin: 0; }
        .settings { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; align-items: center; }
        .settings label { font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; }
        .settings input, .settings select { margin: 0; width: auto; }
        .output-area { font-family: monospace; font-size: 0.85rem; min-height: 150px; white-space: pre-wrap; word-break: break-all; background: var(--pico-code-background-color); padding: 1rem; border-radius: 6px; margin-bottom: 1rem; }
        .actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .actions button { margin: 0; }
        .presets { margin-bottom: 1rem; }
        .presets button { margin: 0 0.25rem 0.25rem 0; padding: 0.3rem 0.6rem; font-size: 0.75rem; }
        .template-vars { font-size: 0.8rem; color: var(--pico-muted-color); margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”— å­—ç¬¦ä¸²æ‹¼æ¥å™¨</h1>
            <button id="themeToggle" class="outline">ğŸŒ™</button>
        </header>
        <div class="main-grid">
            <div class="panel">
                <h3>å­—ç¬¦ä¸²ç‰‡æ®µ <span class="count" id="partCount">0 ä¸ª</span></h3>
                <div class="presets">
                    <button onclick="addPreset('prefix')">å‰ç¼€</button>
                    <button onclick="addPreset('suffix')">åç¼€</button>
                    <button onclick="addPreset('quote')">å¼•å·åŒ…è£¹</button>
                    <button onclick="addPreset('bracket')">æ‹¬å·åŒ…è£¹</button>
                    <button onclick="addPreset('newline')">æ¢è¡Œç¬¦</button>
                    <button onclick="addPreset('tab')">åˆ¶è¡¨ç¬¦</button>
                </div>
                <div class="parts-list" id="partsList"></div>
                <div class="add-part">
                    <input type="text" id="newPartInput" placeholder="è¾“å…¥æ–°ç‰‡æ®µ...">
                    <button onclick="addPart()" class="primary">æ·»åŠ </button>
                </div>
            </div>
            <div class="panel">
                <h3>è¾“å‡ºç»“æœ</h3>
                <div class="settings">
                    <label>åˆ†éš”ç¬¦ï¼š<input type="text" id="delimiter" value="" style="width:60px;" placeholder="æ— "></label>
                    <label>æ¯è¡Œä¸ªæ•°ï¼š<input type="number" id="perLine" value="0" min="0" style="width:60px;"></label>
                    <label><input type="checkbox" id="addQuotes"> å¼•å·åŒ…è£¹</label>
                </div>
                <div class="output-area" id="outputArea"></div>
                <div class="actions">
                    <button onclick="copyOutput()" class="primary">å¤åˆ¶ç»“æœ</button>
                    <button onclick="clearAll()" class="secondary">æ¸…ç©ºå…¨éƒ¨</button>
                    <button onclick="downloadOutput()" class="outline">ä¸‹è½½</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let parts = [];
        const $ = id => document.getElementById(id);
        function render() {
            $('partCount').textContent = parts.length + ' ä¸ª';
            $('partsList').innerHTML = parts.map((p, i) => 
                '<div class="part-item" draggable="true" data-index="'+i+'">'+
                '<span class="drag-handle">â˜°</span>'+
                '<input type="text" value="'+escapeHtml(p)+'" onchange="updatePart('+i+', this.value)">'+
                '<button class="remove-btn" onclick="removePart('+i+')">Ã—</button>'+
                '</div>'
            ).join('');
            updateOutput();
            setupDragDrop();
        }
        function updateOutput() {
            const delimiter = $('delimiter').value;
            const perLine = parseInt($('perLine').value) || 0;
            const addQuotes = $('addQuotes').checked;
            let result = parts.map(p => addQuotes ? '"'+p+'"' : p);
            if (perLine > 0) {
                const lines = [];
                for (let i = 0; i < result.length; i += perLine) {
                    lines.push(result.slice(i, i + perLine).join(delimiter));
                }
                $('outputArea').textContent = lines.join('\n');
            } else {
                $('outputArea').textContent = result.join(delimiter);
            }
        }
        function addPart(value) {
            const v = value || $('newPartInput').value.trim();
            if (v) { parts.push(v); $('newPartInput').value = ''; render(); }
        }
        window.updatePart = function(i, v) { parts[i] = v; updateOutput(); };
        window.removePart = function(i) { parts.splice(i, 1); render(); };
        window.addPreset = function(type) {
            switch(type) {
                case 'prefix': parts.unshift('PREFIX_'); break;
                case 'suffix': parts.push('_SUFFIX'); break;
                case 'quote': parts.unshift('"'); parts.push('"'); break;
                case 'bracket': parts.unshift('('); parts.push(')'); break;
                case 'newline': parts.push('\\n'); break;
                case 'tab': parts.push('\\t'); break;
            }
            render();
        };
        window.copyOutput = function() {
            navigator.clipboard.writeText($('outputArea').textContent);
            alert('å·²å¤åˆ¶');
        };
        window.clearAll = function() { if(confirm('ç¡®å®šæ¸…ç©º?')) { parts = []; render(); } };
        window.downloadOutput = function() {
            const blob = new Blob([$('outputArea').textContent], {type:'text/plain'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = 'string-output.txt'; a.click();
        };
        function setupDragDrop() {
            const items = document.querySelectorAll('.part-item');
            items.forEach(item => {
                item.ondragstart = e => { e.dataTransfer.setData('text/plain', item.dataset.index); item.style.opacity = '0.5'; };
                item.ondragend = () => { item.style.opacity = '1'; };
                item.ondragover = e => e.preventDefault();
                item.ondrop = e => {
                    e.preventDefault();
                    const from = parseInt(e.dataTransfer.getData('text/plain'));
                    const to = parseInt(item.dataset.index);
                    if (from !== to) {
                        const [moved] = parts.splice(from, 1);
                        parts.splice(to, 0, moved);
                        render();
                    }
                };
            });
        }
        window.escapeHtml = function(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); };
        $('delimiter').oninput = updateOutput;
        $('perLine').oninput = updateOutput;
        $('addQuotes').onchange = updateOutput;
        $('newPartInput').onkeypress = e => { if (e.key === 'Enter') addPart(); };
        function loadTheme() { const t = localStorage.getItem('theme') || 'light'; document.documentElement.setAttribute('data-theme', t); $('themeToggle').textContent = t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; }
        window.toggleTheme = function() { const c = document.documentElement.getAttribute('data-theme'); const n = c === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('theme', n); $('themeToggle').textContent = n === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; };
        $('themeToggle').onclick = toggleTheme;
        loadTheme(); render();
    </script>
</body>
</html>

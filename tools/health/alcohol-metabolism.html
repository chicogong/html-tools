<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>酒精代谢计算器 - WebUtils</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #f59e0b; --accent2: #ef4444; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text2); }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        input:focus, select:focus { outline: none; border-color: var(--accent); }
        .radio-group { display: flex; gap: 12px; }
        .radio-btn { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); cursor: pointer; text-align: center; transition: all 0.2s; }
        .radio-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        button { padding: 12px 24px; border: none; border-radius: 8px; background: var(--accent); color: white; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; width: 100%; }
        button:hover { opacity: 0.9; }
        .drink-item { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; }
        .drink-item select { flex: 2; }
        .drink-item input { flex: 1; }
        .drink-item .remove { padding: 12px; background: var(--accent2); color: white; border: none; border-radius: 8px; cursor: pointer; width: auto; }
        .result-hero { border-radius: 12px; padding: 28px; text-align: center; color: white; margin-bottom: 20px; }
        .result-hero.safe { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .result-hero.caution { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .result-hero.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .result-hero .label { opacity: 0.9; margin-bottom: 8px; }
        .result-hero .big { font-size: 2.5rem; font-weight: 700; }
        .result-hero .unit { font-size: 1rem; opacity: 0.8; }
        .result-hero .status { margin-top: 12px; font-size: 1.1rem; font-weight: 600; }
        .timeline { position: relative; padding-left: 24px; }
        .timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: var(--border); }
        .timeline-item { position: relative; padding: 12px 0; }
        .timeline-item::before { content: ''; position: absolute; left: -20px; top: 16px; width: 12px; height: 12px; border-radius: 50%; background: var(--accent); }
        .timeline-item.passed::before { background: #22c55e; }
        .timeline-time { font-weight: 600; color: var(--accent); }
        .timeline-desc { font-size: 0.9rem; color: var(--text2); margin-top: 4px; }
        .timeline-bac { font-size: 0.85rem; }
        .result-row { display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
        .result-row .label { color: var(--text2); }
        .result-row .value { font-weight: 600; }
        .warning { padding: 16px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 12px; margin-bottom: 20px; }
        .warning-title { color: #ef4444; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .warning-text { font-size: 0.9rem; color: var(--text2); }
        .note { margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px; font-size: 0.85rem; color: var(--text2); }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← 返回</a>
        <h1>酒精代谢计算器</h1>
        <p class="subtitle">估算血液酒精浓度及代谢时间</p>
        
        <div class="warning">
            <div class="warning-title">
                <span>⚠️</span> 重要提示
            </div>
            <div class="warning-text">
                本计算器仅供参考，实际酒精代谢因人而异。任何饮酒后都不应驾驶。请遵守当地法律法规，保护自己和他人安全。
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">个人信息</div>
                <div class="form-group">
                    <label>性别</label>
                    <div class="radio-group">
                        <div class="radio-btn active" data-value="male" onclick="setGender('male')">男性</div>
                        <div class="radio-btn" data-value="female" onclick="setGender('female')">女性</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>体重 (kg)</label>
                    <input type="number" id="weight" value="70" min="30" max="200" oninput="calculate()">
                </div>
                <div class="form-group">
                    <label>开始饮酒时间</label>
                    <input type="time" id="startTime" value="20:00" oninput="calculate()">
                </div>
                <div class="form-group">
                    <label>是否空腹</label>
                    <div class="radio-group">
                        <div class="radio-btn" data-value="empty" onclick="setStomach('empty')">空腹</div>
                        <div class="radio-btn active" data-value="full" onclick="setStomach('full')">饱腹</div>
                    </div>
                </div>
                
                <div class="card-title" style="margin-top: 24px;">饮酒记录</div>
                <div id="drinks"></div>
                <button onclick="addDrink()" style="margin-top: 12px;">+ 添加饮品</button>
            </div>
            
            <div>
                <div class="result-hero" id="resultHero">
                    <div class="label">预估血液酒精浓度</div>
                    <div class="big"><span id="bac">0.00</span><span class="unit"> %</span></div>
                    <div class="status" id="status">未饮酒</div>
                </div>
                
                <div class="card">
                    <div class="card-title">酒精数据</div>
                    <div class="result-row">
                        <span class="label">摄入酒精量</span>
                        <span class="value" id="totalAlcohol">0 g</span>
                    </div>
                    <div class="result-row">
                        <span class="label">酒精饮品单位</span>
                        <span class="value" id="standardDrinks">0 杯</span>
                    </div>
                    <div class="result-row">
                        <span class="label">峰值BAC</span>
                        <span class="value" id="peakBAC">0.00%</span>
                    </div>
                    <div class="result-row">
                        <span class="label">完全清醒时间</span>
                        <span class="value" id="soberTime">-</span>
                    </div>
                    <div class="result-row">
                        <span class="label">可安全驾驶时间</span>
                        <span class="value" id="driveTime">-</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">代谢时间线</div>
                    <div class="timeline" id="timeline"></div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">常见饮品酒精含量参考</div>
            <div class="grid">
                <div class="result-row">
                    <span class="label">啤酒 (330ml, 5%)</span>
                    <span class="value">13g 酒精</span>
                </div>
                <div class="result-row">
                    <span class="label">红酒 (150ml, 12%)</span>
                    <span class="value">14g 酒精</span>
                </div>
                <div class="result-row">
                    <span class="label">白酒 (50ml, 52%)</span>
                    <span class="value">21g 酒精</span>
                </div>
                <div class="result-row">
                    <span class="label">威士忌 (30ml, 40%)</span>
                    <span class="value">9.5g 酒精</span>
                </div>
            </div>
        </div>
        
        <div class="note">
            酒精代谢速率约为每小时0.015%BAC。实际代谢受年龄、肝功能、药物、疲劳等多种因素影响。中国法定酒驾标准：BAC≥0.02%（20mg/100ml）为饮酒驾驶，BAC≥0.08%为醉酒驾驶。
        </div>
    </div>
    
    <script>
        let gender = 'male';
        let stomach = 'full';
        let drinks = [{ type: 'beer', amount: 330 }];
        
        const drinkTypes = {
            beer: { name: '啤酒', abv: 5, unit: 'ml' },
            wine: { name: '红酒', abv: 12, unit: 'ml' },
            baijiu: { name: '白酒', abv: 52, unit: 'ml' },
            whisky: { name: '威士忌', abv: 40, unit: 'ml' },
            cocktail: { name: '鸡尾酒', abv: 15, unit: 'ml' },
            sake: { name: '清酒', abv: 15, unit: 'ml' }
        };
        
        function setGender(g) {
            gender = g;
            document.querySelectorAll('.form-group:first-of-type .radio-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === g);
            });
            calculate();
        }
        
        function setStomach(s) {
            stomach = s;
            document.querySelectorAll('.form-group:last-of-type .radio-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === s);
            });
            calculate();
        }
        
        function renderDrinks() {
            const container = document.getElementById('drinks');
            container.textContent = '';
            
            drinks.forEach((drink, index) => {
                const div = document.createElement('div');
                div.className = 'drink-item';
                
                const select = document.createElement('select');
                select.onchange = (e) => {
                    drinks[index].type = e.target.value;
                    calculate();
                };
                Object.entries(drinkTypes).forEach(([key, val]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = val.name + ' (' + val.abv + '%)';
                    option.selected = key === drink.type;
                    select.appendChild(option);
                });
                
                const input = document.createElement('input');
                input.type = 'number';
                input.value = drink.amount;
                input.min = 0;
                input.placeholder = 'ml';
                input.oninput = (e) => {
                    drinks[index].amount = parseFloat(e.target.value) || 0;
                    calculate();
                };
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove';
                removeBtn.textContent = '×';
                removeBtn.onclick = () => {
                    drinks.splice(index, 1);
                    if (drinks.length === 0) drinks.push({ type: 'beer', amount: 0 });
                    renderDrinks();
                    calculate();
                };
                
                div.appendChild(select);
                div.appendChild(input);
                div.appendChild(removeBtn);
                container.appendChild(div);
            });
        }
        
        function addDrink() {
            drinks.push({ type: 'beer', amount: 330 });
            renderDrinks();
            calculate();
        }
        
        function calculate() {
            const weight = parseFloat(document.getElementById('weight').value) || 70;
            const startTimeStr = document.getElementById('startTime').value;
            
            // 计算总酒精摄入量（克）
            let totalAlcohol = 0;
            drinks.forEach(drink => {
                const drinkInfo = drinkTypes[drink.type];
                // 酒精克数 = 体积(ml) × 酒精度(%) × 0.789(酒精密度)
                totalAlcohol += drink.amount * (drinkInfo.abv / 100) * 0.789;
            });
            
            // Widmark公式计算BAC
            // BAC = (酒精克数 / (体重kg × r)) × 100
            // r: 男性0.68, 女性0.55
            const r = gender === 'male' ? 0.68 : 0.55;
            
            // 空腹吸收更快，峰值更高
            const absorptionFactor = stomach === 'empty' ? 1.2 : 1.0;
            
            // 计算峰值BAC
            const peakBAC = (totalAlcohol / (weight * 1000 * r)) * 100 * absorptionFactor;
            
            // 假设饮酒持续1小时，代谢率0.015%/小时
            const metabolismRate = 0.015;
            const drinkingDuration = 1; // 小时
            
            // 计算当前BAC（假设从开始饮酒到现在）
            const now = new Date();
            const [startHour, startMin] = startTimeStr.split(':').map(Number);
            const startTime = new Date();
            startTime.setHours(startHour, startMin, 0, 0);
            
            let hoursPassed = (now - startTime) / (1000 * 60 * 60);
            if (hoursPassed < 0) hoursPassed += 24; // 跨天处理
            
            // 吸收时间（约1小时达到峰值）
            const absorptionTime = stomach === 'empty' ? 0.5 : 1;
            
            let currentBAC;
            if (hoursPassed < absorptionTime) {
                // 吸收阶段
                currentBAC = peakBAC * (hoursPassed / absorptionTime);
            } else {
                // 代谢阶段
                const metabolized = (hoursPassed - absorptionTime) * metabolismRate;
                currentBAC = Math.max(0, peakBAC - metabolized);
            }
            
            // 标准饮品单位（约14克酒精）
            const standardDrinks = totalAlcohol / 14;
            
            // 完全清醒时间
            const soberHours = peakBAC / metabolismRate + absorptionTime;
            const soberTime = new Date(startTime.getTime() + soberHours * 60 * 60 * 1000);
            
            // 可驾驶时间（BAC < 0.02%）
            const driveBAC = 0.02;
            const driveHours = Math.max(0, (peakBAC - driveBAC) / metabolismRate + absorptionTime);
            const driveTime = new Date(startTime.getTime() + driveHours * 60 * 60 * 1000);
            
            // 更新显示
            document.getElementById('bac').textContent = currentBAC.toFixed(3);
            document.getElementById('totalAlcohol').textContent = totalAlcohol.toFixed(1) + ' g';
            document.getElementById('standardDrinks').textContent = standardDrinks.toFixed(1) + ' 杯';
            document.getElementById('peakBAC').textContent = peakBAC.toFixed(3) + '%';
            document.getElementById('soberTime').textContent = totalAlcohol > 0 ? formatTime(soberTime) : '-';
            document.getElementById('driveTime').textContent = totalAlcohol > 0 ? formatTime(driveTime) : '-';
            
            // 状态显示
            const hero = document.getElementById('resultHero');
            const status = document.getElementById('status');
            
            if (currentBAC < 0.02) {
                hero.className = 'result-hero safe';
                status.textContent = totalAlcohol > 0 ? '轻微影响' : '未饮酒';
            } else if (currentBAC < 0.08) {
                hero.className = 'result-hero caution';
                status.textContent = '饮酒状态 - 禁止驾驶';
            } else {
                hero.className = 'result-hero danger';
                status.textContent = '醉酒状态 - 严禁驾驶';
            }
            
            // 时间线
            renderTimeline(startTime, peakBAC, absorptionTime, metabolismRate);
        }
        
        function formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const nextDay = date.getDate() !== new Date().getDate();
            return hours + ':' + minutes + (nextDay ? ' (次日)' : '');
        }
        
        function renderTimeline(startTime, peakBAC, absorptionTime, metabolismRate) {
            const container = document.getElementById('timeline');
            container.textContent = '';
            
            if (peakBAC <= 0) {
                const div = document.createElement('div');
                div.style.cssText = 'text-align: center; color: var(--text2); padding: 20px;';
                div.textContent = '请添加饮酒记录';
                container.appendChild(div);
                return;
            }
            
            const now = new Date();
            const events = [
                { time: startTime, bac: 0, desc: '开始饮酒' },
                { time: new Date(startTime.getTime() + absorptionTime * 60 * 60 * 1000), bac: peakBAC, desc: '血液酒精浓度达到峰值' }
            ];
            
            // 添加关键BAC点
            const keyPoints = [0.08, 0.05, 0.02, 0];
            keyPoints.forEach(targetBAC => {
                if (peakBAC > targetBAC) {
                    const hours = (peakBAC - targetBAC) / metabolismRate + absorptionTime;
                    const time = new Date(startTime.getTime() + hours * 60 * 60 * 1000);
                    let desc = '';
                    if (targetBAC === 0.08) desc = '低于醉驾标准';
                    else if (targetBAC === 0.05) desc = '轻度影响';
                    else if (targetBAC === 0.02) desc = '低于酒驾标准，可驾驶';
                    else desc = '完全清醒';
                    events.push({ time, bac: targetBAC, desc });
                }
            });
            
            // 排序
            events.sort((a, b) => a.time - b.time);
            
            events.forEach(event => {
                const div = document.createElement('div');
                div.className = 'timeline-item';
                if (event.time <= now) div.classList.add('passed');
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'timeline-time';
                timeDiv.textContent = formatTime(event.time);
                
                const descDiv = document.createElement('div');
                descDiv.className = 'timeline-desc';
                descDiv.textContent = event.desc;
                
                const bacDiv = document.createElement('div');
                bacDiv.className = 'timeline-bac';
                bacDiv.textContent = 'BAC: ' + event.bac.toFixed(3) + '%';
                
                div.appendChild(timeDiv);
                div.appendChild(descDiv);
                div.appendChild(bacDiv);
                container.appendChild(div);
            });
        }
        
        renderDrinks();
        calculate();
    </script>
</body>
</html>

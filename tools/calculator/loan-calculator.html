<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´·æ¬¾è®¡ç®—å™¨ - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-tertiary: #1a1a25; --text-primary: #fff; --text-secondary: #88a; --accent: #6366f1; --border: #2a2a3a; --success: #22c55e; }
        [data-theme="light"] { --bg-primary: #f8fafc; --bg-secondary: #fff; --bg-tertiary: #f1f5f9; --text-primary: #1e293b; --text-secondary: #64748b; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(135deg, #f59e0b, #ef4444); padding: 2rem; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .nav { display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 1rem; }
        .back-link { color: rgba(255,255,255,0.9); text-decoration: none; }
        .theme-toggle { background: rgba(255,255,255,0.2); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; color: white; cursor: pointer; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; }
        .card-title { font-size: 1.1rem; margin-bottom: 1rem; color: var(--text-secondary); }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; }
        input, select { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-tertiary); color: var(--text-primary); font-size: 1rem; }
        .type-selector { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
        .type-btn { flex: 1; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; text-align: center; }
        .type-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        .result-item { display: flex; justify-content: space-between; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem; margin-bottom: 0.75rem; }
        .result-item .label { color: var(--text-secondary); }
        .result-item .value { font-weight: 600; font-size: 1.1rem; }
        .highlight { color: var(--accent); }
        .chart-container { margin-top: 1rem; }
        .pie-chart { width: 200px; height: 200px; margin: 0 auto; position: relative; }
        .pie-legend { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem; font-size: 0.85rem; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; }
        .legend-dot { width: 12px; height: 12px; border-radius: 2px; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 1rem; max-height: 300px; overflow-y: auto; display: block; }
        .schedule-table th, .schedule-table td { padding: 0.5rem; text-align: right; border-bottom: 1px solid var(--border); }
        .schedule-table th { position: sticky; top: 0; background: var(--bg-secondary); color: var(--text-secondary); }
        .schedule-table td:first-child, .schedule-table th:first-child { text-align: left; }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="../../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
        </div>
        <h1>ğŸ¦ è´·æ¬¾è®¡ç®—å™¨</h1>
        <p>ç­‰é¢æœ¬æ¯ / ç­‰é¢æœ¬é‡‘è®¡ç®—</p>
    </div>
    <div class="container">
        <div class="type-selector">
            <button class="type-btn active" data-type="equal-payment" onclick="setType('equal-payment')">ç­‰é¢æœ¬æ¯</button>
            <button class="type-btn" data-type="equal-principal" onclick="setType('equal-principal')">ç­‰é¢æœ¬é‡‘</button>
        </div>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">è´·æ¬¾å‚æ•°</div>
                <div class="input-group">
                    <label>è´·æ¬¾é‡‘é¢ (å…ƒ)</label>
                    <input type="number" id="principal" value="1000000" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>å¹´åˆ©ç‡ (%)</label>
                    <input type="number" id="rate" value="4.2" step="0.01" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>è´·æ¬¾æœŸé™ (æœˆ)</label>
                    <input type="number" id="months" value="360" oninput="calculate()">
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                    <button onclick="setMonths(60)" style="padding: 0.25rem 0.75rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 0.25rem; color: var(--text-primary); cursor: pointer;">5å¹´</button>
                    <button onclick="setMonths(120)" style="padding: 0.25rem 0.75rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 0.25rem; color: var(--text-primary); cursor: pointer;">10å¹´</button>
                    <button onclick="setMonths(240)" style="padding: 0.25rem 0.75rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 0.25rem; color: var(--text-primary); cursor: pointer;">20å¹´</button>
                    <button onclick="setMonths(360)" style="padding: 0.25rem 0.75rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 0.25rem; color: var(--text-primary); cursor: pointer;">30å¹´</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">è®¡ç®—ç»“æœ</div>
                <div class="result-item">
                    <span class="label">æœˆä¾›</span>
                    <span class="value highlight" id="monthlyPayment">Â¥0</span>
                </div>
                <div class="result-item">
                    <span class="label">æ€»è¿˜æ¬¾é¢</span>
                    <span class="value" id="totalPayment">Â¥0</span>
                </div>
                <div class="result-item">
                    <span class="label">æ€»åˆ©æ¯</span>
                    <span class="value" id="totalInterest">Â¥0</span>
                </div>
                <div class="result-item">
                    <span class="label">åˆ©æ¯å æ¯”</span>
                    <span class="value" id="interestRatio">0%</span>
                </div>
                
                <div class="chart-container">
                    <canvas id="pieChart" class="pie-chart"></canvas>
                    <div class="pie-legend">
                        <div class="legend-item"><span class="legend-dot" style="background: #6366f1"></span>æœ¬é‡‘</div>
                        <div class="legend-item"><span class="legend-dot" style="background: #f59e0b"></span>åˆ©æ¯</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 1.5rem;">
            <div class="card-title">è¿˜æ¬¾è®¡åˆ’è¡¨ (å‰12æœŸ)</div>
            <table class="schedule-table" id="scheduleTable">
                <thead><tr><th>æœŸæ•°</th><th>æœˆä¾›</th><th>æœ¬é‡‘</th><th>åˆ©æ¯</th><th>å‰©ä½™æœ¬é‡‘</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <script>
        let loanType = 'equal-payment';
        
        window.setType = function(type) {
            loanType = type;
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            calculate();
        };
        
        window.setMonths = function(m) {
            document.getElementById('months').value = m;
            calculate();
        };
        
        window.calculate = function() {
            const P = parseFloat(document.getElementById('principal').value) || 0;
            const annualRate = parseFloat(document.getElementById('rate').value) || 0;
            const n = parseInt(document.getElementById('months').value) || 0;
            const r = annualRate / 100 / 12;
            
            let monthlyPayment, totalPayment, totalInterest;
            const schedule = [];
            
            if (loanType === 'equal-payment') {
                // ç­‰é¢æœ¬æ¯
                if (r > 0) {
                    monthlyPayment = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
                } else {
                    monthlyPayment = P / n;
                }
                totalPayment = monthlyPayment * n;
                totalInterest = totalPayment - P;
                
                let remaining = P;
                for (let i = 1; i <= Math.min(n, 12); i++) {
                    const interest = remaining * r;
                    const principal = monthlyPayment - interest;
                    remaining -= principal;
                    schedule.push({ period: i, payment: monthlyPayment, principal, interest, remaining: Math.max(0, remaining) });
                }
            } else {
                // ç­‰é¢æœ¬é‡‘
                const monthlyPrincipal = P / n;
                let remaining = P;
                totalInterest = 0;
                
                for (let i = 1; i <= n; i++) {
                    const interest = remaining * r;
                    const payment = monthlyPrincipal + interest;
                    remaining -= monthlyPrincipal;
                    totalInterest += interest;
                    if (i <= 12) {
                        schedule.push({ period: i, payment, principal: monthlyPrincipal, interest, remaining: Math.max(0, remaining) });
                    }
                }
                
                monthlyPayment = schedule[0]?.payment || 0;
                totalPayment = P + totalInterest;
            }
            
            const fmt = (n) => 'Â¥' + n.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            document.getElementById('monthlyPayment').textContent = fmt(monthlyPayment) + (loanType === 'equal-principal' ? ' (é¦–æœˆ)' : '');
            document.getElementById('totalPayment').textContent = fmt(totalPayment);
            document.getElementById('totalInterest').textContent = fmt(totalInterest);
            document.getElementById('interestRatio').textContent = ((totalInterest / totalPayment) * 100).toFixed(1) + '%';
            
            // Draw pie chart
            drawPieChart(P, totalInterest);
            
            // Update schedule table
            const tbody = document.querySelector('#scheduleTable tbody');
            tbody.innerHTML = schedule.map(s => `
                <tr>
                    <td>ç¬¬${s.period}æœŸ</td>
                    <td>${fmt(s.payment)}</td>
                    <td>${fmt(s.principal)}</td>
                    <td>${fmt(s.interest)}</td>
                    <td>${fmt(s.remaining)}</td>
                </tr>
            `).join('');
        };
        
        function drawPieChart(principal, interest) {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const total = principal + interest;
            const principalAngle = (principal / total) * Math.PI * 2;
            
            canvas.width = 200;
            canvas.height = 200;
            const cx = 100, cy = 100, r = 80;
            
            ctx.clearRect(0, 0, 200, 200);
            
            // Principal
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, r, -Math.PI / 2, -Math.PI / 2 + principalAngle);
            ctx.closePath();
            ctx.fillStyle = '#6366f1';
            ctx.fill();
            
            // Interest
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, r, -Math.PI / 2 + principalAngle, -Math.PI / 2 + Math.PI * 2);
            ctx.closePath();
            ctx.fillStyle = '#f59e0b';
            ctx.fill();
            
            // Center circle
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, Math.PI * 2);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg-secondary');
            ctx.fill();
        }
        
        window.toggleTheme = function() {
            const t = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
            calculate();
        };

        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
        calculate();
    </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AES åŠ å¯†è§£å¯† - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="ä½¿ç”¨ AES-GCM ç®—æ³•è¿›è¡Œæ–‡æœ¬åŠ å¯†å’Œè§£å¯†" />
    <meta name="keywords" content="aes åŠ å¯† è§£å¯† å¯†ç  å®‰å…¨" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/privacy/encrypt-decrypt.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="AES åŠ å¯†è§£å¯† - WebUtils" />
    <meta property="og:description" content="ä½¿ç”¨ AES-GCM ç®—æ³•è¿›è¡Œæ–‡æœ¬åŠ å¯†å’Œè§£å¯†" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/privacy/encrypt-decrypt.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="AES åŠ å¯†è§£å¯† - WebUtils" />
    <meta name="twitter:description" content="ä½¿ç”¨ AES-GCM ç®—æ³•è¿›è¡Œæ–‡æœ¬åŠ å¯†å’Œè§£å¯†" />
    <!-- OG Image -->
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-card: #12121a;
        --bg-input: #1a1a24;
        --border-default: #2a2a3a;
        --border-focus: #4a4a6a;
        --text-primary: #e0e0e0;
        --text-secondary: #888;
        --accent-cyan: #00d4ff;
        --accent-magenta: #f0a;
        --accent-yellow: #fc0;
        --accent-green: #0f8;
        --accent-red: #f44;
        --font-mono: "SF Mono", "Consolas", "Monaco", monospace;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-hover: #f5f5f5;
        --bg-input: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-default: #e5e5e5;
        --border-subtle: #e5e5e5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-default);
        background: var(--bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-mono);
        background: var(--bg-deep);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 2rem;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      header {
        margin-bottom: 2rem;
      }

      .back-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.875rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        transition: color 0.2s;
      }
      .back-link:hover {
        color: var(--accent-cyan);
      }

      h1 {
        font-size: 1.75rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .card {
        background: var(--bg-card);
        border: 1px solid var(--border-default);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .mode-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .mode-tab {
        flex: 1;
        padding: 0.75rem 1rem;
        background: var(--bg-input);
        border: 2px solid var(--border-default);
        color: var(--text-secondary);
        font-family: var(--font-mono);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .mode-tab:hover {
        border-color: var(--border-focus);
        color: var(--text-primary);
      }

      .mode-tab.active {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
        background: rgb(0, 212, 255, 0.1);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      label {
        display: block;
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 0.75rem;
        background: var(--bg-input);
        border: 1px solid var(--border-default);
        color: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 0.875rem;
        transition: border-color 0.2s;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: var(--accent-cyan);
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      @media (width <= 600px) {
        .row {
          grid-template-columns: 1fr;
        }
      }

      .btn-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .btn {
        flex: 1;
        padding: 0.75rem 1.5rem;
        font-family: var(--font-mono);
        font-size: 0.875rem;
        font-weight: 600;
        border: 2px solid;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: var(--accent-cyan);
        border-color: var(--accent-cyan);
        color: var(--bg-deep);
      }

      .btn-primary:hover {
        background: transparent;
        color: var(--accent-cyan);
      }

      .btn-secondary {
        background: transparent;
        border-color: var(--border-default);
        color: var(--text-secondary);
      }

      .btn-secondary:hover {
        border-color: var(--text-primary);
        color: var(--text-primary);
      }

      .output-section {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-default);
      }

      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .output-box {
        background: var(--bg-input);
        border: 1px solid var(--border-default);
        padding: 1rem;
        font-size: 0.875rem;
        word-break: break-all;
        min-height: 80px;
        position: relative;
      }

      .copy-btn {
        padding: 0.25rem 0.75rem;
        background: transparent;
        border: 1px solid var(--border-default);
        color: var(--text-secondary);
        font-family: var(--font-mono);
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-btn:hover {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
      }

      .copy-btn.copied {
        border-color: var(--accent-green);
        color: var(--accent-green);
      }

      .error {
        color: var(--accent-red);
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      .info-box {
        background: rgb(0, 212, 255, 0.1);
        border: 1px solid rgb(0, 212, 255, 0.3);
        padding: 1rem;
        margin-top: 1rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .info-box strong {
        color: var(--accent-cyan);
      }

      .password-wrapper {
        position: relative;
      }

      .toggle-password {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.75rem;
      }

      .toggle-password:hover {
        color: var(--accent-cyan);
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      AES åŠ å¯†è§£å¯†
    </nav>
    <div class="container">
      <header>
        <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
        <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        <h1>AES åŠ å¯†è§£å¯†</h1>
        <p class="subtitle">ä½¿ç”¨ AES-GCM ç®—æ³•è¿›è¡Œæ–‡æœ¬åŠ å¯†å’Œè§£å¯†</p>
      </header>

      <div class="card">
        <div class="mode-tabs">
          <button class="mode-tab active" data-mode="encrypt">åŠ å¯†</button>
          <button class="mode-tab" data-mode="decrypt">è§£å¯†</button>
        </div>

        <div class="form-group">
          <label id="input-label">æ˜æ–‡</label>
          <textarea id="input" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬..."></textarea>
        </div>

        <div class="form-group">
          <label>å¯†ç </label>
          <div class="password-wrapper">
            <input type="password" id="password" placeholder="è¾“å…¥åŠ å¯†å¯†ç " />
            <button type="button" class="toggle-password" id="togglePassword">æ˜¾ç¤º</button>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label>å¯†é’¥é•¿åº¦</label>
            <select id="keyLength">
              <option value="128">AES-128 (128 ä½)</option>
              <option value="256" selected>AES-256 (256 ä½)</option>
            </select>
          </div>
          <div class="form-group">
            <label>è¾“å‡ºæ ¼å¼</label>
            <select id="outputFormat">
              <option value="base64" selected>Base64</option>
              <option value="hex">Hex</option>
            </select>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="processBtn">åŠ å¯†</button>
          <button class="btn btn-secondary" id="clearBtn">æ¸…ç©º</button>
        </div>

        <div class="output-section">
          <div class="output-header">
            <label id="output-label">å¯†æ–‡</label>
            <button class="copy-btn" id="copyBtn">å¤åˆ¶</button>
          </div>
          <div class="output-box" id="output"></div>
          <div class="error" id="error"></div>
        </div>

        <div class="info-box">
          <strong>å®‰å…¨è¯´æ˜ï¼š</strong>
          ä½¿ç”¨ AES-GCM æ¨¡å¼ï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœº IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰å’Œç›å€¼ã€‚ è¾“å‡ºæ ¼å¼ï¼š
          <code>ç›å€¼(16å­—èŠ‚) + IV(12å­—èŠ‚) + å¯†æ–‡ + è®¤è¯æ ‡ç­¾(16å­—èŠ‚)</code>
          ã€‚ æ‰€æœ‰åŠ å¯†æ“ä½œå‡åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚
        </div>
      </div>
    </div>

    <script>
      const state = {
        mode: "encrypt"
      };

      const elements = {
        input: document.getElementById("input"),
        password: document.getElementById("password"),
        keyLength: document.getElementById("keyLength"),
        outputFormat: document.getElementById("outputFormat"),
        output: document.getElementById("output"),
        error: document.getElementById("error"),
        processBtn: document.getElementById("processBtn"),
        clearBtn: document.getElementById("clearBtn"),
        copyBtn: document.getElementById("copyBtn"),
        togglePassword: document.getElementById("togglePassword"),
        inputLabel: document.getElementById("input-label"),
        outputLabel: document.getElementById("output-label"),
        modeTabs: document.querySelectorAll(".mode-tab")
      };

      // Utility functions
      function arrayBufferToBase64(buffer) {
        const bytes = new Uint8Array(buffer);
        let binary = "";
        for (let i = 0; i < bytes.length; i++) {
          binary += String.fromCharCode(bytes[i]);
        }
        return btoa(binary);
      }

      function base64ToArrayBuffer(base64) {
        const binary = atob(base64);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) {
          bytes[i] = binary.charCodeAt(i);
        }
        return bytes.buffer;
      }

      function arrayBufferToHex(buffer) {
        const bytes = new Uint8Array(buffer);
        return Array.from(bytes)
          .map((b) => b.toString(16).padStart(2, "0"))
          .join("");
      }

      function hexToArrayBuffer(hex) {
        if (hex.length % 2 !== 0) {
          throw new Error("Hex å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»ä¸ºå¶æ•°");
        }
        const bytes = new Uint8Array(hex.length / 2);
        for (let i = 0; i < hex.length; i += 2) {
          bytes[i / 2] = parseInt(hex.substr(i, 2), 16);
        }
        return bytes.buffer;
      }

      // Derive key from password using PBKDF2
      async function deriveKey(password, salt, keyLength) {
        const encoder = new TextEncoder();
        const passwordKey = await crypto.subtle.importKey(
          "raw",
          encoder.encode(password),
          "PBKDF2",
          false,
          ["deriveKey"]
        );

        return crypto.subtle.deriveKey(
          {
            name: "PBKDF2",
            salt: salt,
            iterations: 100000,
            hash: "SHA-256"
          },
          passwordKey,
          { name: "AES-GCM", length: keyLength },
          false,
          ["encrypt", "decrypt"]
        );
      }

      // Encrypt function
      async function encrypt(plaintext, password, keyLength, format) {
        const encoder = new TextEncoder();
        const data = encoder.encode(plaintext);

        // Generate random salt and IV
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));

        // Derive key
        const key = await deriveKey(password, salt, keyLength);

        // Encrypt
        const encrypted = await crypto.subtle.encrypt({ name: "AES-GCM", iv: iv }, key, data);

        // Combine salt + iv + ciphertext
        const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
        combined.set(salt, 0);
        combined.set(iv, salt.length);
        combined.set(new Uint8Array(encrypted), salt.length + iv.length);

        // Return in specified format
        if (format === "hex") {
          return arrayBufferToHex(combined.buffer);
        }
        return arrayBufferToBase64(combined.buffer);
      }

      // Decrypt function
      async function decrypt(ciphertext, password, keyLength, format) {
        // Parse input
        let combined;
        if (format === "hex") {
          combined = new Uint8Array(hexToArrayBuffer(ciphertext));
        } else {
          combined = new Uint8Array(base64ToArrayBuffer(ciphertext));
        }

        // Extract salt, iv, and encrypted data
        const salt = combined.slice(0, 16);
        const iv = combined.slice(16, 28);
        const data = combined.slice(28);

        // Derive key
        const key = await deriveKey(password, salt, keyLength);

        // Decrypt
        const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, key, data);

        const decoder = new TextDecoder();
        return decoder.decode(decrypted);
      }

      // Update UI for mode
      function updateMode(mode) {
        state.mode = mode;
        elements.modeTabs.forEach((tab) => {
          tab.classList.toggle("active", tab.dataset.mode === mode);
        });

        if (mode === "encrypt") {
          elements.inputLabel.textContent = "æ˜æ–‡";
          elements.outputLabel.textContent = "å¯†æ–‡";
          elements.input.placeholder = "è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬...";
          elements.processBtn.textContent = "åŠ å¯†";
        } else {
          elements.inputLabel.textContent = "å¯†æ–‡";
          elements.outputLabel.textContent = "æ˜æ–‡";
          elements.input.placeholder = "è¾“å…¥è¦è§£å¯†çš„å¯†æ–‡...";
          elements.processBtn.textContent = "è§£å¯†";
        }

        clearOutput();
      }

      window.clearOutput = function () {
        elements.output.textContent = "";
        elements.error.textContent = "";
      };

      function showError(message) {
        elements.error.textContent = message;
        elements.output.textContent = "";
      }

      function showOutput(text) {
        elements.output.textContent = text;
        elements.error.textContent = "";
      }

      // Event handlers
      elements.modeTabs.forEach((tab) => {
        tab.addEventListener("click", () => updateMode(tab.dataset.mode));
      });

      elements.processBtn.addEventListener("click", async () => {
        const input = elements.input.value.trim();
        const password = elements.password.value;
        const keyLength = parseInt(elements.keyLength.value);
        const format = elements.outputFormat.value;

        if (!input) {
          showError("è¯·è¾“å…¥å†…å®¹");
          return;
        }

        if (!password) {
          showError("è¯·è¾“å…¥å¯†ç ");
          return;
        }

        try {
          if (state.mode === "encrypt") {
            const result = await encrypt(input, password, keyLength, format);
            showOutput(result);
          } else {
            const result = await decrypt(input, password, keyLength, format);
            showOutput(result);
          }
        } catch (error) {
          if (state.mode === "decrypt") {
            showError("è§£å¯†å¤±è´¥ï¼šå¯†ç é”™è¯¯æˆ–å¯†æ–‡æ ¼å¼ä¸æ­£ç¡®");
          } else {
            showError("åŠ å¯†å¤±è´¥ï¼š" + error.message);
          }
        }
      });

      elements.clearBtn.addEventListener("click", () => {
        elements.input.value = "";
        elements.password.value = "";
        clearOutput();
      });

      elements.copyBtn.addEventListener("click", async () => {
        const text = elements.output.textContent;
        if (!text) return;

        try {
          await navigator.clipboard.writeText(text);
          elements.copyBtn.textContent = "å·²å¤åˆ¶";
          elements.copyBtn.classList.add("copied");
          setTimeout(() => {
            elements.copyBtn.textContent = "å¤åˆ¶";
            elements.copyBtn.classList.remove("copied");
          }, 2000);
        } catch (err) {
          showError("å¤åˆ¶å¤±è´¥");
        }
      });

      elements.togglePassword.addEventListener("click", () => {
        const isPassword = elements.password.type === "password";
        elements.password.type = isPassword ? "text" : "password";
        elements.togglePassword.textContent = isPassword ? "éšè—" : "æ˜¾ç¤º";
      });

      // Initialize
      updateMode("encrypt");

      window.toggleTheme = function () {
        const html = document.documentElement;
        const btn = document.querySelector(".theme-toggle");
        const next = html.getAttribute("data-theme") === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        btn.textContent = next === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", next);
      };

      (function () {
        const saved = localStorage.getItem("theme");
        if (saved) {
          document.documentElement.setAttribute("data-theme", saved);
          const btn = document.querySelector(".theme-toggle");
          if (btn) btn.textContent = saved === "light" ? "â˜€ï¸" : "ğŸŒ™";
        }
      })();
    </script>
  </body>
</html>

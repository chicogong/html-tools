<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAè®°è´¦åˆ†æ‘Šå™¨ - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #06b6d4; --green: #10b981; --red: #ef4444; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 8px 16px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text); cursor: pointer; font-size: 0.85rem; }
        .btn:hover { border-color: var(--accent); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: white; }
        .person-item { background: var(--bg); border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .person-item input { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--card); color: var(--text); }
        .person-item .amount { width: 100px; text-align: right; }
        .remove-btn { background: none; border: none; color: var(--red); cursor: pointer; font-size: 1.2rem; padding: 4px 8px; }
        .expense-item { background: var(--bg); border-radius: 8px; padding: 12px; margin-bottom: 8px; }
        .expense-row { display: flex; gap: 12px; margin-bottom: 8px; }
        .expense-row input, .expense-row select { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--card); color: var(--text); }
        .expense-row input[type="number"] { width: 100px; flex: none; }
        .summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .summary-item { background: var(--bg); padding: 16px; border-radius: 8px; text-align: center; }
        .summary-item .value { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
        .summary-item .label { font-size: 0.8rem; color: var(--text2); margin-top: 4px; }
        .settlement-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
        .settlement-arrow { color: var(--accent); font-weight: 600; }
        .owes { color: var(--red); }
        .owed { color: var(--green); }
        .balance-bar { display: flex; align-items: center; gap: 8px; margin-top: 4px; }
        .balance-indicator { height: 4px; border-radius: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¾ AAè®°è´¦åˆ†æ‘Šå™¨</h1>
        <p class="subtitle">èšé¤ã€æ—…è¡Œè´¹ç”¨åˆ†æ‘Šè®¡ç®—</p>
        
        <div class="summary-grid">
            <div class="summary-item">
                <div class="value" id="totalExpense">Â¥0</div>
                <div class="label">æ€»æ”¯å‡º</div>
            </div>
            <div class="summary-item">
                <div class="value" id="perPerson">Â¥0</div>
                <div class="label">äººå‡</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span>å‚ä¸äººå‘˜</span>
                <button class="btn" onclick="addPerson()">+ æ·»åŠ </button>
            </div>
            <div id="personList"></div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span>æ”¯å‡ºè®°å½•</span>
                <button class="btn" onclick="addExpense()">+ æ·»åŠ æ”¯å‡º</button>
            </div>
            <div id="expenseList"></div>
        </div>
        
        <div class="card">
            <div class="card-title">ä¸ªäººæ”¶æ”¯æƒ…å†µ</div>
            <div id="balanceList"></div>
        </div>
        
        <div class="card">
            <div class="card-title">ç»“ç®—æ–¹æ¡ˆï¼ˆæœ€å°‘è½¬è´¦æ¬¡æ•°ï¼‰</div>
            <div id="settlementList"></div>
        </div>
    </div>
    
    <script>
        let people = [
            { id: 1, name: 'å°æ˜' },
            { id: 2, name: 'å°çº¢' },
            { id: 3, name: 'å°åˆš' }
        ];
        let expenses = [
            { id: 1, desc: 'åˆé¤', amount: 300, paidBy: 1 },
            { id: 2, desc: 'æ‰“è½¦', amount: 50, paidBy: 2 }
        ];
        let nextPersonId = 4;
        let nextExpenseId = 3;
        
        function renderPeople() {
            const container = document.getElementById('personList');
            container.textContent = '';
            
            people.forEach(person => {
                const div = document.createElement('div');
                div.className = 'person-item';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.value = person.name;
                input.oninput = function() { person.name = this.value; calculate(); };
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'Ã—';
                removeBtn.onclick = function() { removePerson(person.id); };
                
                div.appendChild(input);
                div.appendChild(removeBtn);
                container.appendChild(div);
            });
        }
        
        function renderExpenses() {
            const container = document.getElementById('expenseList');
            container.textContent = '';
            
            expenses.forEach(expense => {
                const div = document.createElement('div');
                div.className = 'expense-item';
                
                const row = document.createElement('div');
                row.className = 'expense-row';
                
                const descInput = document.createElement('input');
                descInput.type = 'text';
                descInput.value = expense.desc;
                descInput.placeholder = 'æ”¯å‡ºè¯´æ˜';
                descInput.oninput = function() { expense.desc = this.value; };
                
                const amountInput = document.createElement('input');
                amountInput.type = 'number';
                amountInput.value = expense.amount;
                amountInput.placeholder = 'é‡‘é¢';
                amountInput.oninput = function() { expense.amount = parseFloat(this.value) || 0; calculate(); };
                
                const paidBySelect = document.createElement('select');
                people.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = p.name + ' æ”¯ä»˜';
                    option.selected = p.id === expense.paidBy;
                    paidBySelect.appendChild(option);
                });
                paidBySelect.onchange = function() { expense.paidBy = parseInt(this.value); calculate(); };
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'Ã—';
                removeBtn.onclick = function() { removeExpense(expense.id); };
                
                row.appendChild(descInput);
                row.appendChild(amountInput);
                row.appendChild(paidBySelect);
                row.appendChild(removeBtn);
                div.appendChild(row);
                container.appendChild(div);
            });
        }
        
        function addPerson() {
            people.push({ id: nextPersonId++, name: 'æ–°æˆå‘˜' });
            renderPeople();
            renderExpenses();
            calculate();
        }
        
        function removePerson(id) {
            if (people.length <= 2) return alert('è‡³å°‘éœ€è¦2ä¸ªäºº');
            people = people.filter(p => p.id !== id);
            expenses = expenses.filter(e => e.paidBy !== id);
            renderPeople();
            renderExpenses();
            calculate();
        }
        
        function addExpense() {
            expenses.push({ id: nextExpenseId++, desc: '', amount: 0, paidBy: people[0]?.id || 1 });
            renderExpenses();
            calculate();
        }
        
        function removeExpense(id) {
            expenses = expenses.filter(e => e.id !== id);
            renderExpenses();
            calculate();
        }
        
        function calculate() {
            const total = expenses.reduce((sum, e) => sum + e.amount, 0);
            const perPerson = people.length > 0 ? total / people.length : 0;
            
            document.getElementById('totalExpense').textContent = 'Â¥' + total.toFixed(2);
            document.getElementById('perPerson').textContent = 'Â¥' + perPerson.toFixed(2);
            
            // è®¡ç®—æ¯ä¸ªäººçš„æ”¶æ”¯æƒ…å†µ
            const balances = {};
            people.forEach(p => { balances[p.id] = { name: p.name, paid: 0, shouldPay: perPerson }; });
            
            expenses.forEach(e => {
                if (balances[e.paidBy]) {
                    balances[e.paidBy].paid += e.amount;
                }
            });
            
            // æ¸²æŸ“ä¸ªäººæ”¶æ”¯
            const balanceContainer = document.getElementById('balanceList');
            balanceContainer.textContent = '';
            
            const maxBalance = Math.max(...Object.values(balances).map(b => Math.abs(b.paid - b.shouldPay)));
            
            Object.values(balances).forEach(b => {
                const diff = b.paid - b.shouldPay;
                const div = document.createElement('div');
                div.className = 'settlement-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = b.name;
                
                const rightDiv = document.createElement('div');
                rightDiv.style.textAlign = 'right';
                
                const statusSpan = document.createElement('div');
                statusSpan.className = diff >= 0 ? 'owed' : 'owes';
                statusSpan.textContent = diff >= 0 ? 'åº”æ”¶ Â¥' + diff.toFixed(2) : 'åº”ä»˜ Â¥' + Math.abs(diff).toFixed(2);
                
                const detailSpan = document.createElement('div');
                detailSpan.style.fontSize = '0.8rem';
                detailSpan.style.color = 'var(--text2)';
                detailSpan.textContent = 'å·²ä»˜ Â¥' + b.paid.toFixed(2) + ' / åº”ä»˜ Â¥' + b.shouldPay.toFixed(2);
                
                rightDiv.appendChild(statusSpan);
                rightDiv.appendChild(detailSpan);
                div.appendChild(nameSpan);
                div.appendChild(rightDiv);
                balanceContainer.appendChild(div);
            });
            
            // è®¡ç®—ç»“ç®—æ–¹æ¡ˆ
            calculateSettlements(balances);
        }
        
        function calculateSettlements(balances) {
            const container = document.getElementById('settlementList');
            container.textContent = '';
            
            // ç®€åŒ–çš„ç»“ç®—ç®—æ³•
            const debtors = []; // æ¬ é’±çš„äºº
            const creditors = []; // è¢«æ¬ é’±çš„äºº
            
            Object.entries(balances).forEach(([id, b]) => {
                const diff = b.paid - b.shouldPay;
                if (diff < -0.01) {
                    debtors.push({ id, name: b.name, amount: -diff });
                } else if (diff > 0.01) {
                    creditors.push({ id, name: b.name, amount: diff });
                }
            });
            
            // æ’åº
            debtors.sort((a, b) => b.amount - a.amount);
            creditors.sort((a, b) => b.amount - a.amount);
            
            const settlements = [];
            
            while (debtors.length > 0 && creditors.length > 0) {
                const debtor = debtors[0];
                const creditor = creditors[0];
                
                const amount = Math.min(debtor.amount, creditor.amount);
                
                if (amount > 0.01) {
                    settlements.push({
                        from: debtor.name,
                        to: creditor.name,
                        amount: amount
                    });
                }
                
                debtor.amount -= amount;
                creditor.amount -= amount;
                
                if (debtor.amount < 0.01) debtors.shift();
                if (creditor.amount < 0.01) creditors.shift();
            }
            
            if (settlements.length === 0) {
                const div = document.createElement('div');
                div.style.cssText = 'text-align: center; color: var(--text2); padding: 20px;';
                div.textContent = 'æ— éœ€ç»“ç®—ï¼Œè´¹ç”¨å·²å¹³è¡¡';
                container.appendChild(div);
            } else {
                settlements.forEach(s => {
                    const div = document.createElement('div');
                    div.className = 'settlement-item';
                    
                    const text = document.createElement('span');
                    text.textContent = s.from + ' â†’ ' + s.to;
                    
                    const amount = document.createElement('span');
                    amount.className = 'settlement-arrow';
                    amount.textContent = 'Â¥' + s.amount.toFixed(2);
                    
                    div.appendChild(text);
                    div.appendChild(amount);
                    container.appendChild(div);
                });
            }
        }
        
        renderPeople();
        renderExpenses();
        calculate();
    </script>
</body>
</html>

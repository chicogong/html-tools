<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬åˆ—å¤„ç†å™¨ - WebUtils</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --spacing-compact: 0.5rem;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.75rem;
        }
        
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        
        .settings-panel {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .settings-grid label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .settings-grid input,
        .settings-grid select {
            margin-bottom: 0;
        }
        
        .operation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--pico-muted-border-color);
        }
        
        .operation-buttons button {
            flex: 1;
            min-width: 140px;
        }
        
        .editor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .editor-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .editor-panel {
            display: flex;
            flex-direction: column;
        }
        
        .editor-panel label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            font-family: Consolas, Monaco, monospace;
            font-size: 0.9rem;
            resize: vertical;
        }
        
        .panel-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .panel-actions button {
            flex: 1;
        }
        
        .preview-table {
            margin-top: 1.5rem;
            overflow-x: auto;
        }
        
        .preview-table h3 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .preview-table table {
            margin-bottom: 0;
        }
        
        .preview-table th {
            background: var(--pico-primary);
            color: white;
            padding: 0.5rem;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }
        
        .preview-table th:hover {
            opacity: 0.9;
        }
        
        .preview-table th.selected {
            background: var(--pico-secondary);
        }
        
        .preview-table td {
            padding: 0.5rem;
            white-space: nowrap;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .column-info {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--pico-muted-color);
        }
        
        .column-info span {
            background: var(--pico-card-background-color);
            padding: 0.25rem 0.75rem;
            border-radius: var(--pico-border-radius);
            border: 1px solid var(--pico-muted-border-color);
        }
        
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--pico-primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--pico-border-radius);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .help-text {
            font-size: 0.8rem;
            color: var(--pico-muted-color);
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>æ–‡æœ¬åˆ—å¤„ç†å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        </header>
        
        <div class="settings-panel">
            <div class="settings-grid">
                <div>
                    <label for="delimiter">åˆ—åˆ†éš”ç¬¦</label>
                    <select id="delimiter">
                        <option value="\t">Tabåˆ¶è¡¨ç¬¦</option>
                        <option value=",">é€—å· (,)</option>
                        <option value=";">åˆ†å· (;)</option>
                        <option value="|">ç«–çº¿ (|)</option>
                        <option value=" ">ç©ºæ ¼</option>
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>
                <div>
                    <label for="customDelimiter">è‡ªå®šä¹‰åˆ†éš”ç¬¦</label>
                    <input type="text" id="customDelimiter" placeholder="è¾“å…¥è‡ªå®šä¹‰åˆ†éš”ç¬¦" disabled>
                </div>
                <div>
                    <label for="outputDelimiter">è¾“å‡ºåˆ†éš”ç¬¦</label>
                    <select id="outputDelimiter">
                        <option value="\t">Tabåˆ¶è¡¨ç¬¦</option>
                        <option value=",">é€—å· (,)</option>
                        <option value=";">åˆ†å· (;)</option>
                        <option value="|">ç«–çº¿ (|)</option>
                        <option value=" ">ç©ºæ ¼</option>
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>
                <div>
                    <label for="customOutputDelimiter">è‡ªå®šä¹‰è¾“å‡ºåˆ†éš”ç¬¦</label>
                    <input type="text" id="customOutputDelimiter" placeholder="è¾“å…¥è‡ªå®šä¹‰åˆ†éš”ç¬¦" disabled>
                </div>
            </div>
            
            <div class="settings-grid">
                <div>
                    <label for="columnSelect">é€‰æ‹©åˆ— (ç‚¹å‡»è¡¨å¤´æˆ–è¾“å…¥)</label>
                    <input type="text" id="columnSelect" placeholder="ä¾‹å¦‚: 1,3,5 æˆ– 1-3 æˆ– 1,3-5">
                    <p class="help-text">æ”¯æŒï¼šå•åˆ—(1)ã€å¤šåˆ—(1,3)ã€èŒƒå›´(1-3)ã€ç»„åˆ(1,3-5)</p>
                </div>
                <div>
                    <label for="sortColumn">æ’åºåˆ—</label>
                    <input type="number" id="sortColumn" value="1" min="1">
                </div>
                <div>
                    <label for="sortOrder">æ’åºæ–¹å¼</label>
                    <select id="sortOrder">
                        <option value="asc">å‡åº</option>
                        <option value="desc">é™åº</option>
                    </select>
                </div>
                <div>
                    <label for="sortType">æ’åºç±»å‹</label>
                    <select id="sortType">
                        <option value="string">å­—ç¬¦ä¸²</option>
                        <option value="number">æ•°å­—</option>
                    </select>
                </div>
            </div>
            
            <div class="operation-buttons">
                <button onclick="extractColumns()">æå–é€‰ä¸­åˆ—</button>
                <button onclick="deleteColumns()">åˆ é™¤é€‰ä¸­åˆ—</button>
                <button onclick="swapColumns()">äº¤æ¢åˆ—é¡ºåº</button>
                <button onclick="sortByColumn()">æŒ‰åˆ—æ’åº</button>
                <button onclick="removeDuplicates()">å»é™¤é‡å¤è¡Œ</button>
                <button onclick="transposeData()">è¡Œåˆ—è½¬ç½®</button>
            </div>
        </div>
        
        <div class="editor-grid">
            <div class="editor-panel">
                <label for="input">è¾“å…¥æ–‡æœ¬</label>
                <textarea id="input" placeholder="ç²˜è´´åŒ…å«åˆ—çš„æ–‡æœ¬æ•°æ®...&#10;&#10;ä¾‹å¦‚ï¼ˆTabåˆ†éš”ï¼‰ï¼š&#10;å§“å	å¹´é¾„	åŸå¸‚&#10;å¼ ä¸‰	25	åŒ—äº¬&#10;æå››	30	ä¸Šæµ·&#10;ç‹äº”	28	å¹¿å·"></textarea>
                <div class="panel-actions">
                    <button class="secondary" onclick="parseInput()">è§£ææ•°æ®</button>
                    <button class="secondary" onclick="clearInput()">æ¸…ç©º</button>
                </div>
            </div>
            
            <div class="editor-panel">
                <label for="output">è¾“å‡ºç»“æœ</label>
                <textarea id="output" readonly placeholder="å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                <div class="panel-actions">
                    <button class="secondary" onclick="copyOutput()">å¤åˆ¶ç»“æœ</button>
                    <button class="secondary" onclick="useAsInput()">ä½œä¸ºè¾“å…¥</button>
                </div>
            </div>
        </div>
        
        <div class="preview-table">
            <h3>æ•°æ®é¢„è§ˆ <small>(ç‚¹å‡»è¡¨å¤´é€‰æ‹©åˆ—)</small></h3>
            <div style="overflow-x: auto;">
                <table id="previewTable">
                    <thead id="previewHead"></thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>
            <div class="column-info" id="columnInfo"></div>
        </div>
    </main>
    
    <div class="toast" id="toast"></div>
    
    <script>
        let parsedData = [];
        let selectedColumns = new Set();
        
        // è·å–åˆ†éš”ç¬¦
        function getDelimiter(selectId, customId) {
            const select = document.getElementById(selectId);
            const custom = document.getElementById(customId);
            if (select.value === 'custom') {
                return custom.value || '\t';
            }
            return select.value === '\\t' ? '\t' : select.value;
        }
        
        // å¯ç”¨/ç¦ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦è¾“å…¥
        document.getElementById('delimiter').addEventListener('change', function() {
            document.getElementById('customDelimiter').disabled = this.value !== 'custom';
        });
        
        document.getElementById('outputDelimiter').addEventListener('change', function() {
            document.getElementById('customOutputDelimiter').disabled = this.value !== 'custom';
        });
        
        // è§£æè¾“å…¥
        function parseInput() {
            const input = document.getElementById('input').value.trim();
            if (!input) {
                showToast('è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
                return;
            }
            
            const delimiter = getDelimiter('delimiter', 'customDelimiter');
            const lines = input.split('\n').filter(line => line.trim());
            
            parsedData = lines.map(line => line.split(delimiter));
            selectedColumns.clear();
            
            renderPreview();
            updateColumnInfo();
        }
        
        // æ¸²æŸ“é¢„è§ˆè¡¨æ ¼
        function renderPreview() {
            const thead = document.getElementById('previewHead');
            const tbody = document.getElementById('previewBody');
            
            thead.textContent = '';
            tbody.textContent = '';
            
            if (parsedData.length === 0) return;
            
            const maxCols = Math.max(...parsedData.map(row => row.length));
            
            // è¡¨å¤´
            const headerRow = document.createElement('tr');
            for (let i = 0; i < maxCols; i++) {
                const th = document.createElement('th');
                th.textContent = 'åˆ—' + (i + 1);
                th.dataset.col = i;
                th.onclick = function() { toggleColumnSelection(i, th); };
                if (selectedColumns.has(i)) {
                    th.classList.add('selected');
                }
                headerRow.appendChild(th);
            }
            thead.appendChild(headerRow);
            
            // æ•°æ®è¡Œï¼ˆæœ€å¤šæ˜¾ç¤º20è¡Œï¼‰
            const displayRows = parsedData.slice(0, 20);
            displayRows.forEach(row => {
                const tr = document.createElement('tr');
                for (let i = 0; i < maxCols; i++) {
                    const td = document.createElement('td');
                    td.textContent = row[i] || '';
                    td.title = row[i] || '';
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            });
            
            if (parsedData.length > 20) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = maxCols;
                td.textContent = '... è¿˜æœ‰ ' + (parsedData.length - 20) + ' è¡Œ';
                td.style.textAlign = 'center';
                td.style.color = 'var(--pico-muted-color)';
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
        
        // åˆ‡æ¢åˆ—é€‰æ‹©
        function toggleColumnSelection(colIndex, th) {
            if (selectedColumns.has(colIndex)) {
                selectedColumns.delete(colIndex);
                th.classList.remove('selected');
            } else {
                selectedColumns.add(colIndex);
                th.classList.add('selected');
            }
            updateColumnSelectInput();
        }
        
        // æ›´æ–°åˆ—é€‰æ‹©è¾“å…¥æ¡†
        function updateColumnSelectInput() {
            const sorted = Array.from(selectedColumns).sort((a, b) => a - b);
            document.getElementById('columnSelect').value = sorted.map(c => c + 1).join(',');
        }
        
        // ä»è¾“å…¥æ¡†è§£æåˆ—é€‰æ‹©
        function parseColumnSelection() {
            const input = document.getElementById('columnSelect').value.trim();
            if (!input) return [];
            
            const cols = new Set();
            const parts = input.split(',');
            
            for (const part of parts) {
                if (part.includes('-')) {
                    const range = part.split('-').map(n => parseInt(n.trim()) - 1);
                    const start = range[0];
                    const end = range[1];
                    for (let i = start; i <= end; i++) {
                        if (i >= 0) cols.add(i);
                    }
                } else {
                    const col = parseInt(part.trim()) - 1;
                    if (col >= 0) cols.add(col);
                }
            }
            
            return Array.from(cols).sort((a, b) => a - b);
        }
        
        // æ›´æ–°åˆ—ä¿¡æ¯
        function updateColumnInfo() {
            const info = document.getElementById('columnInfo');
            info.textContent = '';
            
            if (parsedData.length === 0) {
                return;
            }
            
            const maxCols = Math.max(...parsedData.map(row => row.length));
            
            const span1 = document.createElement('span');
            span1.textContent = 'æ€»è¡Œæ•°: ' + parsedData.length;
            info.appendChild(span1);
            
            const span2 = document.createElement('span');
            span2.textContent = 'æ€»åˆ—æ•°: ' + maxCols;
            info.appendChild(span2);
            
            const span3 = document.createElement('span');
            span3.textContent = 'å·²é€‰æ‹©: ' + selectedColumns.size + ' åˆ—';
            info.appendChild(span3);
        }
        
        // æå–é€‰ä¸­åˆ—
        window.extractColumns = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const cols = parseColumnSelection();
            if (cols.length === 0) {
                showToast('è¯·é€‰æ‹©è¦æå–çš„åˆ—');
                return;
            }
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const result = parsedData.map(row => {
                return cols.map(c => row[c] || '').join(delimiter);
            }).join('\n');
            
            document.getElementById('output').value = result;
            showToast('å·²æå– ' + cols.length + ' åˆ—');
        };
        
        // åˆ é™¤é€‰ä¸­åˆ—
        window.deleteColumns = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const colsToDelete = new Set(parseColumnSelection());
            if (colsToDelete.size === 0) {
                showToast('è¯·é€‰æ‹©è¦åˆ é™¤çš„åˆ—');
                return;
            }
            
            const maxCols = Math.max(...parsedData.map(row => row.length));
            const remainingCols = [];
            for (let i = 0; i < maxCols; i++) {
                if (!colsToDelete.has(i)) {
                    remainingCols.push(i);
                }
            }
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const result = parsedData.map(row => {
                return remainingCols.map(c => row[c] || '').join(delimiter);
            }).join('\n');
            
            document.getElementById('output').value = result;
            showToast('å·²åˆ é™¤ ' + colsToDelete.size + ' åˆ—');
        };
        
        // äº¤æ¢åˆ—é¡ºåº
        window.swapColumns = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const cols = parseColumnSelection();
            if (cols.length < 2) {
                showToast('è¯·è‡³å°‘é€‰æ‹©2åˆ—è¿›è¡Œäº¤æ¢');
                return;
            }
            
            const maxCols = Math.max(...parsedData.map(row => row.length));
            const newOrder = Array.from({length: maxCols}, (_, i) => i);
            
            // äº¤æ¢é€‰ä¸­çš„åˆ—ï¼ˆåè½¬é¡ºåºï¼‰
            for (let i = 0; i < cols.length; i++) {
                newOrder[cols[i]] = cols[cols.length - 1 - i];
            }
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const result = parsedData.map(row => {
                return newOrder.map(c => row[c] || '').join(delimiter);
            }).join('\n');
            
            document.getElementById('output').value = result;
            showToast('åˆ—é¡ºåºå·²äº¤æ¢');
        };
        
        // æŒ‰åˆ—æ’åº
        window.sortByColumn = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const sortCol = parseInt(document.getElementById('sortColumn').value) - 1;
            const sortOrder = document.getElementById('sortOrder').value;
            const sortType = document.getElementById('sortType').value;
            
            const sorted = parsedData.slice().sort((a, b) => {
                let valA = a[sortCol] || '';
                let valB = b[sortCol] || '';
                
                if (sortType === 'number') {
                    valA = parseFloat(valA) || 0;
                    valB = parseFloat(valB) || 0;
                }
                
                let result;
                if (sortType === 'number') {
                    result = valA - valB;
                } else {
                    result = valA.localeCompare(valB, 'zh-CN');
                }
                
                return sortOrder === 'desc' ? -result : result;
            });
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const result = sorted.map(row => row.join(delimiter)).join('\n');
            
            document.getElementById('output').value = result;
            showToast('å·²æŒ‰ç¬¬ ' + (sortCol + 1) + ' åˆ—' + (sortOrder === 'asc' ? 'å‡åº' : 'é™åº') + 'æ’åº');
        };
        
        // å»é™¤é‡å¤è¡Œ
        window.removeDuplicates = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const seen = new Set();
            const unique = [];
            
            for (const row of parsedData) {
                const key = row.join('\0');
                if (!seen.has(key)) {
                    seen.add(key);
                    unique.push(row);
                }
            }
            
            const result = unique.map(row => row.join(delimiter)).join('\n');
            document.getElementById('output').value = result;
            showToast('å·²å»é™¤ ' + (parsedData.length - unique.length) + ' è¡Œé‡å¤');
        };
        
        // è¡Œåˆ—è½¬ç½®
        window.transposeData = function() {
            if (parsedData.length === 0) {
                showToast('è¯·å…ˆè§£ææ•°æ®');
                return;
            }
            
            const maxCols = Math.max(...parsedData.map(row => row.length));
            const transposed = [];
            
            for (let i = 0; i < maxCols; i++) {
                transposed.push(parsedData.map(row => row[i] || ''));
            }
            
            const delimiter = getDelimiter('outputDelimiter', 'customOutputDelimiter');
            const result = transposed.map(row => row.join(delimiter)).join('\n');
            
            document.getElementById('output').value = result;
            showToast('è¡Œåˆ—å·²è½¬ç½®');
        };
        
        // å¤åˆ¶è¾“å‡º
        window.copyOutput = function() {
            const output = document.getElementById('output').value;
            if (output) {
                navigator.clipboard.writeText(output).then(() => {
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                });
            }
        };
        
        // ä½œä¸ºè¾“å…¥ä½¿ç”¨
        window.useAsInput = function() {
            const output = document.getElementById('output').value;
            if (output) {
                document.getElementById('input').value = output;
                document.getElementById('output').value = '';
                parseInput();
            }
        };
        
        // æ¸…ç©ºè¾“å…¥
        window.clearInput = function() {
            document.getElementById('input').value = '';
            parsedData = [];
            selectedColumns.clear();
            renderPreview();
            updateColumnInfo();
        };
        
        // æ˜¾ç¤ºæç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
        
        // ä¸»é¢˜åˆ‡æ¢
        window.toggleTheme = function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        };
        
        // åˆå§‹åŒ–ä¸»é¢˜
        (function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        })();
        
        // è‡ªåŠ¨è§£æè¾“å…¥
        document.getElementById('input').addEventListener('input', function() {
            // å»¶è¿Ÿè§£æï¼Œé¿å…é¢‘ç¹æ“ä½œ
            clearTimeout(this.parseTimeout);
            this.parseTimeout = setTimeout(parseInput, 500);
        });
        
        // åˆ—é€‰æ‹©è¾“å…¥å˜åŒ–
        document.getElementById('columnSelect').addEventListener('input', function() {
            selectedColumns = new Set(parseColumnSelection());
            renderPreview();
            updateColumnInfo();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶é—´åŠ å‡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }
        .time-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-sm);
            align-items: end;
            margin-bottom: var(--spacing-md);
        }
        .operation-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }
        .operation-row select {
            width: auto;
            min-width: 80px;
        }
        .result-box {
            background: var(--pico-primary-focus);
            border: 2px solid var(--pico-primary);
            border-radius: var(--pico-border-radius);
            padding: var(--spacing-lg);
            text-align: center;
            margin: var(--spacing-md) 0;
        }
        .result-box h2 {
            margin: 0;
            font-size: 2rem;
        }
        .result-box p {
            margin: var(--spacing-sm) 0 0 0;
            color: var(--pico-muted-color);
        }
        .btn-group {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: var(--spacing-md);
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .quick-btn {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        .history-section {
            margin-top: var(--spacing-lg);
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
        }
        .history-item {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--pico-muted-border-color);
            font-family: monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .history-item button {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        .tab-container {
            margin-bottom: var(--spacing-md);
        }
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            border-bottom: 2px solid var(--pico-muted-border-color);
            margin-bottom: var(--spacing-md);
        }
        .tab {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            border-bottom-color: var(--pico-primary);
            color: var(--pico-primary);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <main class="container">
        <div class="header">
            <h1>æ—¶é—´åŠ å‡è®¡ç®—å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
        </div>

        <article>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('duration')">æ—¶é—´æ®µè®¡ç®—</button>
                <button class="tab" onclick="switchTab('datetime')">æ—¥æœŸæ—¶é—´è®¡ç®—</button>
                <button class="tab" onclick="switchTab('diff')">æ—¶é—´å·®è®¡ç®—</button>
            </div>

            <!-- Duration Calculation Tab -->
            <div id="duration-tab" class="tab-content active">
                <h3>åŸºå‡†æ—¶é—´</h3>
                <div class="time-input-group">
                    <label>
                        å°æ—¶
                        <input type="number" id="baseHours" value="0" min="0">
                    </label>
                    <label>
                        åˆ†é’Ÿ
                        <input type="number" id="baseMinutes" value="0" min="0" max="59">
                    </label>
                    <label>
                        ç§’
                        <input type="number" id="baseSeconds" value="0" min="0" max="59">
                    </label>
                    <button class="secondary" onclick="setCurrentTime()">å½“å‰æ—¶é—´</button>
                </div>

                <h3>æ“ä½œ</h3>
                <div class="operation-row">
                    <select id="operation">
                        <option value="add">åŠ  (+)</option>
                        <option value="subtract">å‡ (-)</option>
                    </select>
                </div>

                <div class="time-input-group">
                    <label>
                        å¤©
                        <input type="number" id="addDays" value="0" min="0">
                    </label>
                    <label>
                        å°æ—¶
                        <input type="number" id="addHours" value="1" min="0">
                    </label>
                    <label>
                        åˆ†é’Ÿ
                        <input type="number" id="addMinutes" value="30" min="0">
                    </label>
                    <label>
                        ç§’
                        <input type="number" id="addSeconds" value="0" min="0">
                    </label>
                </div>

                <h4>å¿«é€Ÿæ·»åŠ </h4>
                <div class="quick-buttons">
                    <button class="quick-btn secondary" onclick="quickAdd(0, 0, 15, 0)">+15åˆ†é’Ÿ</button>
                    <button class="quick-btn secondary" onclick="quickAdd(0, 0, 30, 0)">+30åˆ†é’Ÿ</button>
                    <button class="quick-btn secondary" onclick="quickAdd(0, 1, 0, 0)">+1å°æ—¶</button>
                    <button class="quick-btn secondary" onclick="quickAdd(0, 2, 0, 0)">+2å°æ—¶</button>
                    <button class="quick-btn secondary" onclick="quickAdd(1, 0, 0, 0)">+1å¤©</button>
                    <button class="quick-btn secondary" onclick="quickAdd(7, 0, 0, 0)">+1å‘¨</button>
                </div>

                <div class="btn-group">
                    <button onclick="calculateDuration()">è®¡ç®—</button>
                    <button class="secondary" onclick="clearDuration()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- DateTime Calculation Tab -->
            <div id="datetime-tab" class="tab-content">
                <h3>åŸºå‡†æ—¥æœŸæ—¶é—´</h3>
                <div class="time-input-group">
                    <label>
                        æ—¥æœŸ
                        <input type="date" id="baseDate">
                    </label>
                    <label>
                        æ—¶é—´
                        <input type="time" id="baseTime" step="1">
                    </label>
                    <button class="secondary" onclick="setCurrentDateTime()">å½“å‰æ—¶é—´</button>
                </div>

                <h3>æ“ä½œ</h3>
                <div class="operation-row">
                    <select id="dateOperation">
                        <option value="add">åŠ  (+)</option>
                        <option value="subtract">å‡ (-)</option>
                    </select>
                </div>

                <div class="time-input-group">
                    <label>
                        å¹´
                        <input type="number" id="addYears" value="0" min="0">
                    </label>
                    <label>
                        æœˆ
                        <input type="number" id="addMonths" value="0" min="0">
                    </label>
                    <label>
                        å¤©
                        <input type="number" id="addDateDays" value="0" min="0">
                    </label>
                    <label>
                        å°æ—¶
                        <input type="number" id="addDateHours" value="0" min="0">
                    </label>
                    <label>
                        åˆ†é’Ÿ
                        <input type="number" id="addDateMinutes" value="0" min="0">
                    </label>
                </div>

                <div class="btn-group">
                    <button onclick="calculateDateTime()">è®¡ç®—</button>
                    <button class="secondary" onclick="clearDateTime()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- Time Difference Tab -->
            <div id="diff-tab" class="tab-content">
                <h3>å¼€å§‹æ—¶é—´</h3>
                <div class="time-input-group">
                    <label>
                        æ—¥æœŸ
                        <input type="date" id="startDate">
                    </label>
                    <label>
                        æ—¶é—´
                        <input type="time" id="startTime" step="1">
                    </label>
                    <button class="secondary" onclick="setStartNow()">å½“å‰æ—¶é—´</button>
                </div>

                <h3>ç»“æŸæ—¶é—´</h3>
                <div class="time-input-group">
                    <label>
                        æ—¥æœŸ
                        <input type="date" id="endDate">
                    </label>
                    <label>
                        æ—¶é—´
                        <input type="time" id="endTime" step="1">
                    </label>
                    <button class="secondary" onclick="setEndNow()">å½“å‰æ—¶é—´</button>
                </div>

                <div class="btn-group">
                    <button onclick="calculateDiff()">è®¡ç®—å·®å€¼</button>
                    <button class="secondary" onclick="swapTimes()">äº¤æ¢æ—¶é—´</button>
                    <button class="secondary" onclick="clearDiff()">æ¸…ç©º</button>
                </div>
            </div>

            <div class="result-box">
                <h2 id="result">--:--:--</h2>
                <p id="resultDetail">è¾“å…¥æ—¶é—´å¹¶ç‚¹å‡»è®¡ç®—</p>
            </div>

            <details class="history-section">
                <summary>è®¡ç®—å†å²</summary>
                <div class="history-list" id="historyList">
                    <div class="history-item" style="color: var(--pico-muted-color);">æš‚æ— å†å²è®°å½•</div>
                </div>
                <button class="secondary" onclick="clearHistory()" style="margin-top: var(--spacing-sm);">æ¸…ç©ºå†å²</button>
            </details>
        </article>
    </main>

    <script>
        let history = [];

        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[onclick="switchTab(\'' + tabName + '\')"]').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function setCurrentTime() {
            const now = new Date();
            document.getElementById('baseHours').value = now.getHours();
            document.getElementById('baseMinutes').value = now.getMinutes();
            document.getElementById('baseSeconds').value = now.getSeconds();
        }

        function setCurrentDateTime() {
            const now = new Date();
            document.getElementById('baseDate').value = now.toISOString().split('T')[0];
            document.getElementById('baseTime').value = now.toTimeString().slice(0, 8);
        }

        function setStartNow() {
            const now = new Date();
            document.getElementById('startDate').value = now.toISOString().split('T')[0];
            document.getElementById('startTime').value = now.toTimeString().slice(0, 8);
        }

        function setEndNow() {
            const now = new Date();
            document.getElementById('endDate').value = now.toISOString().split('T')[0];
            document.getElementById('endTime').value = now.toTimeString().slice(0, 8);
        }

        function quickAdd(days, hours, minutes, seconds) {
            document.getElementById('addDays').value = days;
            document.getElementById('addHours').value = hours;
            document.getElementById('addMinutes').value = minutes;
            document.getElementById('addSeconds').value = seconds;
            calculateDuration();
        }

        function formatTime(hours, minutes, seconds) {
            const h = String(Math.floor(Math.abs(hours))).padStart(2, '0');
            const m = String(Math.floor(Math.abs(minutes))).padStart(2, '0');
            const s = String(Math.floor(Math.abs(seconds))).padStart(2, '0');
            return (hours < 0 ? '-' : '') + h + ':' + m + ':' + s;
        }

        function formatDuration(totalSeconds) {
            const negative = totalSeconds < 0;
            totalSeconds = Math.abs(totalSeconds);
            
            const days = Math.floor(totalSeconds / 86400);
            const hours = Math.floor((totalSeconds % 86400) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            let parts = [];
            if (days > 0) parts.push(days + 'å¤©');
            if (hours > 0) parts.push(hours + 'å°æ—¶');
            if (minutes > 0) parts.push(minutes + 'åˆ†é’Ÿ');
            if (seconds > 0 || parts.length === 0) parts.push(seconds + 'ç§’');

            return (negative ? '-' : '') + parts.join(' ');
        }

        function calculateDuration() {
            const baseH = parseInt(document.getElementById('baseHours').value) || 0;
            const baseM = parseInt(document.getElementById('baseMinutes').value) || 0;
            const baseS = parseInt(document.getElementById('baseSeconds').value) || 0;
            
            const addD = parseInt(document.getElementById('addDays').value) || 0;
            const addH = parseInt(document.getElementById('addHours').value) || 0;
            const addM = parseInt(document.getElementById('addMinutes').value) || 0;
            const addS = parseInt(document.getElementById('addSeconds').value) || 0;
            
            const operation = document.getElementById('operation').value;
            
            let baseTotalSeconds = baseH * 3600 + baseM * 60 + baseS;
            let addTotalSeconds = addD * 86400 + addH * 3600 + addM * 60 + addS;
            
            let resultSeconds;
            if (operation === 'add') {
                resultSeconds = baseTotalSeconds + addTotalSeconds;
            } else {
                resultSeconds = baseTotalSeconds - addTotalSeconds;
            }

            const resultH = Math.floor(resultSeconds / 3600);
            const resultM = Math.floor((Math.abs(resultSeconds) % 3600) / 60);
            const resultS = Math.abs(resultSeconds) % 60;

            const timeStr = formatTime(resultH, resultM, resultS);
            const detailStr = formatDuration(resultSeconds);

            document.getElementById('result').textContent = timeStr;
            document.getElementById('resultDetail').textContent = 'æ€»è®¡: ' + detailStr + ' (' + resultSeconds + ' ç§’)';

            addHistory(formatTime(baseH, baseM, baseS) + ' ' + (operation === 'add' ? '+' : '-') + ' ' + formatDuration(addTotalSeconds) + ' = ' + timeStr);
        }

        function calculateDateTime() {
            const baseDate = document.getElementById('baseDate').value;
            const baseTime = document.getElementById('baseTime').value || '00:00:00';
            
            if (!baseDate) {
                alert('è¯·é€‰æ‹©åŸºå‡†æ—¥æœŸ');
                return;
            }

            const base = new Date(baseDate + 'T' + baseTime);
            const operation = document.getElementById('dateOperation').value;
            const sign = operation === 'add' ? 1 : -1;

            const years = (parseInt(document.getElementById('addYears').value) || 0) * sign;
            const months = (parseInt(document.getElementById('addMonths').value) || 0) * sign;
            const days = (parseInt(document.getElementById('addDateDays').value) || 0) * sign;
            const hours = (parseInt(document.getElementById('addDateHours').value) || 0) * sign;
            const minutes = (parseInt(document.getElementById('addDateMinutes').value) || 0) * sign;

            const result = new Date(base);
            result.setFullYear(result.getFullYear() + years);
            result.setMonth(result.getMonth() + months);
            result.setDate(result.getDate() + days);
            result.setHours(result.getHours() + hours);
            result.setMinutes(result.getMinutes() + minutes);

            const resultStr = result.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const weekday = result.toLocaleDateString('zh-CN', { weekday: 'long' });

            document.getElementById('result').textContent = resultStr;
            document.getElementById('resultDetail').textContent = weekday;

            addHistory(base.toLocaleString('zh-CN') + ' ' + (operation === 'add' ? '+' : '-') + ' ... = ' + resultStr);
        }

        function calculateDiff() {
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value || '00:00:00';
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value || '00:00:00';

            if (!startDate || !endDate) {
                alert('è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ');
                return;
            }

            const start = new Date(startDate + 'T' + startTime);
            const end = new Date(endDate + 'T' + endTime);
            const diffMs = end - start;
            const diffSeconds = Math.floor(diffMs / 1000);

            const days = Math.floor(Math.abs(diffSeconds) / 86400);
            const hours = Math.floor((Math.abs(diffSeconds) % 86400) / 3600);
            const minutes = Math.floor((Math.abs(diffSeconds) % 3600) / 60);
            const seconds = Math.abs(diffSeconds) % 60;

            let resultParts = [];
            if (days > 0) resultParts.push(days + 'å¤©');
            if (hours > 0) resultParts.push(hours + 'å°æ—¶');
            if (minutes > 0) resultParts.push(minutes + 'åˆ†é’Ÿ');
            if (seconds > 0 || resultParts.length === 0) resultParts.push(seconds + 'ç§’');

            const prefix = diffMs < 0 ? '-' : '';
            document.getElementById('result').textContent = prefix + resultParts.join(' ');
            document.getElementById('resultDetail').textContent = 'æ€»è®¡ ' + Math.abs(diffSeconds).toLocaleString() + ' ç§’ | ' + Math.abs(Math.floor(diffMs / 60000)).toLocaleString() + ' åˆ†é’Ÿ | ' + Math.abs(Math.floor(diffMs / 3600000)).toLocaleString() + ' å°æ—¶';

            addHistory(start.toLocaleString('zh-CN') + ' â†’ ' + end.toLocaleString('zh-CN') + ' = ' + prefix + resultParts.join(' '));
        }

        function swapTimes() {
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;

            document.getElementById('startDate').value = endDate;
            document.getElementById('startTime').value = endTime;
            document.getElementById('endDate').value = startDate;
            document.getElementById('endTime').value = startTime;
        }

        function clearDuration() {
            document.getElementById('baseHours').value = 0;
            document.getElementById('baseMinutes').value = 0;
            document.getElementById('baseSeconds').value = 0;
            document.getElementById('addDays').value = 0;
            document.getElementById('addHours').value = 1;
            document.getElementById('addMinutes').value = 30;
            document.getElementById('addSeconds').value = 0;
            document.getElementById('result').textContent = '--:--:--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ—¶é—´å¹¶ç‚¹å‡»è®¡ç®—';
        }

        function clearDateTime() {
            document.getElementById('baseDate').value = '';
            document.getElementById('baseTime').value = '';
            document.getElementById('addYears').value = 0;
            document.getElementById('addMonths').value = 0;
            document.getElementById('addDateDays').value = 0;
            document.getElementById('addDateHours').value = 0;
            document.getElementById('addDateMinutes').value = 0;
            document.getElementById('result').textContent = '--:--:--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ—¶é—´å¹¶ç‚¹å‡»è®¡ç®—';
        }

        function clearDiff() {
            document.getElementById('startDate').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('endTime').value = '';
            document.getElementById('result').textContent = '--:--:--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ—¶é—´å¹¶ç‚¹å‡»è®¡ç®—';
        }

        function addHistory(entry) {
            history.unshift(entry);
            if (history.length > 20) history.pop();
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            while (list.firstChild) {
                list.removeChild(list.firstChild);
            }
            
            if (history.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'history-item';
                emptyDiv.style.color = 'var(--pico-muted-color)';
                emptyDiv.textContent = 'æš‚æ— å†å²è®°å½•';
                list.appendChild(emptyDiv);
                return;
            }
            
            history.forEach(function(item, index) {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const span = document.createElement('span');
                span.textContent = item;
                
                const btn = document.createElement('button');
                btn.className = 'secondary outline';
                btn.textContent = 'åˆ é™¤';
                btn.onclick = function() { removeHistory(index); };
                
                div.appendChild(span);
                div.appendChild(btn);
                list.appendChild(div);
            });
        }

        function removeHistory(index) {
            history.splice(index, 1);
            renderHistory();
        }

        function clearHistory() {
            history = [];
            renderHistory();
        }

        // Initialize
        setCurrentDateTime();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript ASTÊü•ÁúãÂô® - HTML Tools</title>
    <script src="https://cdn.jsdelivr.net/npm/acorn@8.11.2/dist/acorn.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --text-primary: #fff;
            --text-secondary: #88a;
            --accent: #f7df1e;
            --border: #2a2a3a;
            --success: #22c55e;
            --node-type: #f97316;
            --node-key: #3b82f6;
            --node-string: #22c55e;
            --node-number: #a855f7;
            --node-keyword: #ec4899;
        }
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #fff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #f7df1e, #d4c41a);
            padding: 2rem;
            text-align: center;
        }
        .header h1, .header p { color: #1a1a1a; }
        .nav {
            max-width: 1600px;
            margin: 0 auto 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .back-link {
            color: rgba(0,0,0,0.7);
            text-decoration: none;
            font-size: 0.9rem;
        }
        .theme-toggle {
            background: rgba(0,0,0,0.2);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: #1a1a1a;
            cursor: pointer;
        }
        .header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .header p { opacity: 0.8; }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            height: calc(100vh - 180px);
        }
        .panel {
            background: var(--bg-secondary);
            border-radius: 1rem;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .panel-header {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .panel-header h3 {
            font-size: 0.95rem;
            font-weight: 600;
        }
        .panel-actions {
            display: flex;
            gap: 0.5rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            background: var(--accent);
            color: #1a1a1a;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .btn:hover { opacity: 0.9; }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .panel-content {
            flex: 1;
            overflow: auto;
            position: relative;
        }
        textarea {
            width: 100%;
            height: 100%;
            padding: 1rem;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: Monaco, Menlo, Consolas, monospace;
            font-size: 0.9rem;
            resize: none;
            line-height: 1.6;
        }
        textarea:focus { outline: none; }
        .ast-tree {
            padding: 1rem;
            font-family: Monaco, Menlo, Consolas, monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        .ast-node {
            margin-left: 1.5rem;
            position: relative;
        }
        .ast-node::before {
            content: '';
            position: absolute;
            left: -1rem;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border);
        }
        .ast-node:last-child::before {
            height: 0.75rem;
        }
        .ast-node::after {
            content: '';
            position: absolute;
            left: -1rem;
            top: 0.75rem;
            width: 0.75rem;
            height: 1px;
            background: var(--border);
        }
        .node-toggle {
            cursor: pointer;
            user-select: none;
            display: inline-block;
            width: 1rem;
            color: var(--text-secondary);
        }
        .node-toggle:hover { color: var(--text-primary); }
        .node-type {
            color: var(--node-type);
            font-weight: 600;
        }
        .node-key {
            color: var(--node-key);
        }
        .node-string {
            color: var(--node-string);
        }
        .node-number {
            color: var(--node-number);
        }
        .node-keyword {
            color: var(--node-keyword);
        }
        .node-children {
            overflow: hidden;
        }
        .node-children.collapsed {
            display: none;
        }
        .node-line {
            padding: 0.125rem 0;
        }
        .node-line:hover {
            background: var(--bg-tertiary);
            border-radius: 0.25rem;
        }
        .examples {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
        }
        .example-btn {
            padding: 0.375rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
        }
        .example-btn:hover { border-color: var(--accent); color: var(--text-primary); }
        .error-message {
            padding: 1rem;
            color: #ef4444;
            font-family: monospace;
        }
        .stats {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            gap: 1.5rem;
        }
        .view-toggle {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-primary);
            padding: 0.25rem;
            border-radius: 0.375rem;
        }
        .view-btn {
            padding: 0.375rem 0.75rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            border-radius: 0.25rem;
        }
        .view-btn.active {
            background: var(--accent);
            color: #1a1a1a;
        }
        .json-view {
            white-space: pre-wrap;
            overflow-wrap: break-word;
        }
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
            .panel { min-height: 400px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="../../index.html" class="back-link">‚Üê ËøîÂõûÈ¶ñÈ°µ</a>
            <button class="theme-toggle" onclick="toggleTheme()">üåì ‰∏ªÈ¢ò</button>
        </div>
        <h1>üå≥ JavaScript ASTÊü•ÁúãÂô®</h1>
        <p>Ëß£ÊûêJavaScript‰ª£Á†ÅÂπ∂ÂèØËßÜÂåñÊäΩË±°ËØ≠Ê≥ïÊ†ë</p>
    </div>

    <div class="container">
        <div class="panel">
            <div class="panel-header">
                <h3>üìù JavaScript‰ª£Á†Å</h3>
                <div class="panel-actions">
                    <button class="btn btn-secondary" onclick="clearCode()">Ê∏ÖÁ©∫</button>
                    <button class="btn" onclick="parseCode()">Ëß£Êûê AST</button>
                </div>
            </div>
            <div class="examples">
                <button class="example-btn" onclick="loadExample('function')">ÂáΩÊï∞</button>
                <button class="example-btn" onclick="loadExample('class')">Á±ª</button>
                <button class="example-btn" onclick="loadExample('arrow')">ÁÆ≠Â§¥ÂáΩÊï∞</button>
                <button class="example-btn" onclick="loadExample('async')">Async/Await</button>
                <button class="example-btn" onclick="loadExample('destructure')">Ëß£ÊûÑ</button>
                <button class="example-btn" onclick="loadExample('spread')">Â±ïÂºÄËøêÁÆóÁ¨¶</button>
            </div>
            <div class="panel-content">
                <textarea id="codeEditor" placeholder="ËæìÂÖ•JavaScript‰ª£Á†Å...">function greet(name) {
  const message = `Hello, ${name}!`;
  console.log(message);
  return message;
}

greet('World');</textarea>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h3>üå≥ ASTÁªìÊûÑ</h3>
                <div class="panel-actions">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('tree')">Ê†ëÂΩ¢</button>
                        <button class="view-btn" onclick="setView('json')">JSON</button>
                    </div>
                    <button class="btn btn-secondary" onclick="expandAll()">Â±ïÂºÄÂÖ®ÈÉ®</button>
                    <button class="btn btn-secondary" onclick="collapseAll()">ÊäòÂè†ÂÖ®ÈÉ®</button>
                    <button class="btn btn-secondary" onclick="copyAST()">Â§çÂà∂</button>
                </div>
            </div>
            <div class="panel-content">
                <div class="ast-tree" id="astOutput">
                    <span style="color: var(--text-secondary);">ÁÇπÂáª"Ëß£Êûê AST"ÊåâÈíÆÊü•ÁúãËØ≠Ê≥ïÊ†ë</span>
                </div>
            </div>
            <div class="stats" id="stats">
                <span>ËäÇÁÇπÊï∞: -</span>
                <span>Ê∑±Â∫¶: -</span>
            </div>
        </div>
    </div>

    <script>
        window.toggleTheme = function() {
            const theme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        };
        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');

        let currentAST = null;
        let currentView = 'tree';

        function parseCode() {
            const code = document.getElementById('codeEditor').value;
            
            try {
                currentAST = acorn.parse(code, {
                    ecmaVersion: 2022,
                    sourceType: 'module',
                    locations: true
                });
                
                renderAST();
                updateStats();
            } catch (e) {
                document.getElementById('astOutput').innerHTML = `<div class="error-message">Ëß£ÊûêÈîôËØØ: ${escapeHtml(e.message)}</div>`;
                document.getElementById('stats').innerHTML = '<span>Ëß£ÊûêÂ§±Ë¥•</span>';
            }
        }

        function renderAST() {
            const output = document.getElementById('astOutput');
            
            if (currentView === 'tree') {
                output.innerHTML = renderTreeNode(currentAST, 'Program');
            } else {
                output.innerHTML = `<div class="json-view">${syntaxHighlight(JSON.stringify(currentAST, null, 2))}</div>`;
            }
        }

        function renderTreeNode(node, key = '', depth = 0) {
            if (node === null || node === undefined) {
                return '<span class="node-keyword">null</span>';
            }

            if (typeof node !== 'object') {
                if (typeof node === 'string') {
                    return `<span class="node-string">"${escapeHtml(node)}"</span>`;
                }
                if (typeof node === 'number') {
                    return `<span class="node-number">${node}</span>`;
                }
                if (typeof node === 'boolean') {
                    return `<span class="node-keyword">${node}</span>`;
                }
                return escapeHtml(String(node));
            }

            if (Array.isArray(node)) {
                if (node.length === 0) return '[]';
                
                const items = node.map((item, i) => `
                    <div class="ast-node">
                        <div class="node-line">
                            <span class="node-key">[${i}]</span>: ${renderTreeNode(item, '', depth + 1)}
                        </div>
                    </div>
                `).join('');
                
                return `[<div class="node-children">${items}</div>]`;
            }

            // Object node
            const type = node.type;
            const id = 'node-' + Math.random().toString(36).substr(2, 9);
            
            const entries = Object.entries(node).filter(([k]) => 
                !['loc', 'start', 'end', 'range'].includes(k)
            );

            if (entries.length === 0) return '{}';

            const content = entries.map(([k, v]) => {
                const isType = k === 'type';
                return `
                    <div class="ast-node">
                        <div class="node-line">
                            <span class="node-key">${k}</span>: ${isType ? `<span class="node-type">${escapeHtml(v)}</span>` : renderTreeNode(v, k, depth + 1)}
                        </div>
                    </div>
                `;
            }).join('');

            const header = type ? `<span class="node-type">${type}</span>` : '{';
            
            return `
                <span class="node-toggle" onclick="toggleNode('${id}')">‚ñº</span>
                ${header}
                <div class="node-children" id="${id}">
                    ${content}
                </div>
                }
            `;
        }

        window.toggleNode = function(id) {
            const node = document.getElementById(id);
            const toggle = node.previousElementSibling.previousElementSibling;
            node.classList.toggle('collapsed');
            toggle.textContent = node.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
        };

        window.expandAll = function() {
            document.querySelectorAll('.node-children').forEach(n => n.classList.remove('collapsed'));
            document.querySelectorAll('.node-toggle').forEach(t => t.textContent = '‚ñº');
        };

        window.collapseAll = function() {
            document.querySelectorAll('.node-children').forEach(n => n.classList.add('collapsed'));
            document.querySelectorAll('.node-toggle').forEach(t => t.textContent = '‚ñ∂');
        };

        window.setView = function(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if (currentAST) renderAST();
        };

        function updateStats() {
            let nodeCount = 0;
            let maxDepth = 0;

            function traverse(node, depth) {
                if (!node || typeof node !== 'object') return;
                
                if (node.type) {
                    nodeCount++;
                    maxDepth = Math.max(maxDepth, depth);
                }

                for (const key of Object.keys(node)) {
                    if (Array.isArray(node[key])) {
                        node[key].forEach(child => traverse(child, depth + 1));
                    } else if (typeof node[key] === 'object') {
                        traverse(node[key], depth + 1);
                    }
                }
            }

            traverse(currentAST, 0);
            document.getElementById('stats').innerHTML = `
                <span>ËäÇÁÇπÊï∞: ${nodeCount}</span>
                <span>ÊúÄÂ§ßÊ∑±Â∫¶: ${maxDepth}</span>
            `;
        }

        function syntaxHighlight(json) {
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
                let cls = 'node-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'node-key';
                    } else {
                        cls = 'node-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'node-keyword';
                } else if (/null/.test(match)) {
                    cls = 'node-keyword';
                }
                return `<span class="${cls}">${match}</span>`;
            });
        }

        window.escapeHtml = function(str) {
            return String(str).replace(/[&<>"']/g, m => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            })[m]);
        };

        window.copyAST = function() {
            if (!currentAST) return;
            navigator.clipboard.writeText(JSON.stringify(currentAST, null, 2));
            alert('ASTÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
        };

        window.clearCode = function() {
            document.getElementById('codeEditor').value = '';
            document.getElementById('astOutput').innerHTML = '<span style="color: var(--text-secondary);">ÁÇπÂáª"Ëß£Êûê AST"ÊåâÈíÆÊü•ÁúãËØ≠Ê≥ïÊ†ë</span>';
            document.getElementById('stats').innerHTML = '<span>ËäÇÁÇπÊï∞: -</span><span>Ê∑±Â∫¶: -</span>';
            currentAST = null;
        };

        window.loadExample = function(type) {
            const examples = {
                function: `function add(a, b) {
  return a + b;
}

const result = add(1, 2);`,
                class: `class Animal {
  constructor(name) {
    this.name = name;
  }
  
  speak() {
    console.log(\`\${this.name} makes a sound.\`);
  }
}

class Dog extends Animal {
  speak() {
    console.log(\`\${this.name} barks.\`);
  }
}`,
                arrow: `const add = (a, b) => a + b;

const multiply = (a, b) => {
  const result = a * b;
  return result;
};

const numbers = [1, 2, 3].map(n => n * 2);`,
                async: `async function fetchData(url) {
  try {
    const response = await fetch(url);
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
    throw error;
  }
}`,
                destructure: `const { name, age, address: { city } } = person;

const [first, second, ...rest] = numbers;

function greet({ name = 'Guest', greeting = 'Hello' }) {
  return \`\${greeting}, \${name}!\`;
}`,
                spread: `const arr1 = [1, 2, 3];
const arr2 = [...arr1, 4, 5];

const obj1 = { a: 1, b: 2 };
const obj2 = { ...obj1, c: 3 };

function sum(...numbers) {
  return numbers.reduce((a, b) => a + b, 0);
}`
            };

            document.getElementById('codeEditor').value = examples[type] || '';
            parseCode();
        };

        // Auto-parse on load
        parseCode();

        // Keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                parseCode();
            }
        });
    </script>
</body>
</html>

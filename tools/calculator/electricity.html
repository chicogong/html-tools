<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁîµË¥πËÆ°ÁÆóÂô®</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body {
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        .card {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1.5rem;
            border: 1px solid var(--pico-muted-border-color);
            margin-bottom: 1rem;
        }
        .card h3 {
            margin: 0 0 1rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        .form-group small {
            color: var(--pico-muted-color);
        }
        .input-with-unit {
            display: flex;
            align-items: center;
        }
        .input-with-unit input {
            flex: 1;
            margin: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-with-unit .unit {
            background: var(--pico-muted-border-color);
            padding: 0.5rem 1rem;
            border-top-right-radius: var(--pico-border-radius);
            border-bottom-right-radius: var(--pico-border-radius);
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .appliance-list {
            margin-bottom: 1rem;
        }
        .appliance-item {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--pico-code-background-color);
            border-radius: var(--pico-border-radius);
            margin-bottom: 0.5rem;
            align-items: center;
        }
        .appliance-item input {
            margin: 0;
            width: 80px;
            text-align: center;
        }
        .appliance-item .name {
            font-weight: 500;
        }
        .appliance-item .wattage {
            font-size: 0.85rem;
            color: var(--pico-muted-color);
        }
        .appliance-item .result {
            font-family: monospace;
            font-weight: bold;
            color: var(--pico-primary);
            text-align: right;
            min-width: 80px;
        }
        .add-custom {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .add-custom input {
            margin: 0;
        }
        .add-custom button {
            margin: 0;
            white-space: nowrap;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        .result-card {
            padding: 1rem;
            background: var(--pico-code-background-color);
            border-radius: var(--pico-border-radius);
            text-align: center;
        }
        .result-card.highlight {
            background: var(--pico-primary);
            color: var(--pico-primary-inverse);
            grid-column: span 2;
        }
        .result-card .label {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        .result-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
        }
        .result-card .unit {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        .rate-tiers {
            margin-top: 1rem;
        }
        .rate-tiers h4 {
            margin: 0 0 0.5rem;
            font-size: 0.9rem;
        }
        .tier-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
            font-size: 0.9rem;
        }
        .tier-item:last-child {
            border-bottom: none;
        }
        .tier-item.active {
            background: var(--pico-primary);
            color: var(--pico-primary-inverse);
            border-radius: var(--pico-border-radius);
        }
        .presets {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .presets button {
            margin: 0;
            padding: 0.25rem 0.75rem;
            font-size: 0.85rem;
        }
        .breakdown {
            margin-top: 1rem;
        }
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--pico-muted-border-color);
        }
        .breakdown-item .name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .breakdown-item .bar {
            width: 50px;
            height: 8px;
            background: var(--pico-muted-border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        .breakdown-item .bar-fill {
            height: 100%;
            background: var(--pico-primary);
        }
        .breakdown-item .cost {
            font-family: monospace;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">‚Üê ËøîÂõûÈ¶ñÈ°µ</a>
        <header>
            <h2>ÁîµË¥πËÆ°ÁÆóÂô®</h2>
            <button class="outline" onclick="toggleTheme()" id="themeBtn">üåô Ê∑±Ëâ≤</button>
        </header>

        <div class="main-grid">
            <div class="card">
                <h3>ÁîµÂô®Áî®ÁîµÈáè</h3>
                
                <div class="presets">
                    <span>Âø´ÈÄüÊ∑ªÂä†:</span>
                    <button class="outline secondary" onclick="addPreset('Á©∫Ë∞É', 1500)">Á©∫Ë∞É</button>
                    <button class="outline secondary" onclick="addPreset('ÂÜ∞ÁÆ±', 100)">ÂÜ∞ÁÆ±</button>
                    <button class="outline secondary" onclick="addPreset('ÁîµËßÜ', 150)">ÁîµËßÜ</button>
                    <button class="outline secondary" onclick="addPreset('Ê¥óË°£Êú∫', 500)">Ê¥óË°£Êú∫</button>
                    <button class="outline secondary" onclick="addPreset('ÁîµËÑë', 300)">ÁîµËÑë</button>
                    <button class="outline secondary" onclick="addPreset('ÁÉ≠Ê∞¥Âô®', 2000)">ÁÉ≠Ê∞¥Âô®</button>
                </div>
                
                <div class="appliance-list" id="applianceList">
                    <!-- Appliances will be added here -->
                </div>
                
                <div class="add-custom">
                    <input type="text" id="customName" placeholder="ÁîµÂô®ÂêçÁß∞">
                    <input type="number" id="customWattage" placeholder="ÂäüÁéá(W)" min="0">
                    <button class="secondary" onclick="addCustomAppliance()">Ê∑ªÂä†</button>
                </div>
                
                <div class="form-group" style="margin-top: 1rem;">
                    <label>ÊØèÂ§©‰ΩøÁî®Êó∂Èïø (ÈªòËÆ§)</label>
                    <div class="input-with-unit">
                        <input type="number" id="defaultHours" value="4" min="0" max="24" step="0.5" oninput="calculate()">
                        <span class="unit">Â∞èÊó∂/Â§©</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ÊØèÊúàÂ§©Êï∞</label>
                    <div class="input-with-unit">
                        <input type="number" id="daysPerMonth" value="30" min="1" max="31" step="1" oninput="calculate()">
                        <span class="unit">Â§©</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Áîµ‰ª∑ËÆæÁΩÆ</h3>
                
                <div class="form-group">
                    <label>ËÆ°Ë¥πÊñπÂºè</label>
                    <select id="rateType" onchange="updateRateType()">
                        <option value="flat">Áªü‰∏ÄÁîµ‰ª∑</option>
                        <option value="tiered" selected>Èò∂Ê¢ØÁîµ‰ª∑</option>
                        <option value="tou">Â≥∞Ë∞∑Áîµ‰ª∑</option>
                    </select>
                </div>
                
                <div id="flatRateSection" style="display: none;">
                    <div class="form-group">
                        <label>Áîµ‰ª∑</label>
                        <div class="input-with-unit">
                            <input type="number" id="flatRate" value="0.52" min="0" step="0.01" oninput="calculate()">
                            <span class="unit">ÂÖÉ/Â∫¶</span>
                        </div>
                    </div>
                </div>
                
                <div id="tieredRateSection">
                    <div class="rate-tiers">
                        <h4>Èò∂Ê¢ØÁîµ‰ª∑ (‰ª•Âπø‰∏ú‰∏∫‰æã)</h4>
                        <div class="tier-item" id="tier1">
                            <span>Á¨¨‰∏ÄÊ°£: 0-260Â∫¶</span>
                            <span>0.52ÂÖÉ/Â∫¶</span>
                        </div>
                        <div class="tier-item" id="tier2">
                            <span>Á¨¨‰∫åÊ°£: 261-600Â∫¶</span>
                            <span>0.57ÂÖÉ/Â∫¶</span>
                        </div>
                        <div class="tier-item" id="tier3">
                            <span>Á¨¨‰∏âÊ°£: 601Â∫¶‰ª•‰∏ä</span>
                            <span>0.82ÂÖÉ/Â∫¶</span>
                        </div>
                    </div>
                </div>
                
                <div id="touRateSection" style="display: none;">
                    <div class="form-group">
                        <label>Â≥∞Êó∂Áîµ‰ª∑ (8:00-22:00)</label>
                        <div class="input-with-unit">
                            <input type="number" id="peakRate" value="0.62" min="0" step="0.01" oninput="calculate()">
                            <span class="unit">ÂÖÉ/Â∫¶</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ë∞∑Êó∂Áîµ‰ª∑ (22:00-8:00)</label>
                        <div class="input-with-unit">
                            <input type="number" id="valleyRate" value="0.32" min="0" step="0.01" oninput="calculate()">
                            <span class="unit">ÂÖÉ/Â∫¶</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Â≥∞Êó∂‰ΩøÁî®ÊØî‰æã</label>
                        <div class="input-with-unit">
                            <input type="number" id="peakRatio" value="70" min="0" max="100" step="5" oninput="calculate()">
                            <span class="unit">%</span>
                        </div>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="label">Êó•Áî®ÁîµÈáè</div>
                        <div class="value" id="dailyKwh">-</div>
                        <div class="unit">Â∫¶ (kWh)</div>
                    </div>
                    <div class="result-card">
                        <div class="label">ÊúàÁî®ÁîµÈáè</div>
                        <div class="value" id="monthlyKwh">-</div>
                        <div class="unit">Â∫¶ (kWh)</div>
                    </div>
                    <div class="result-card highlight">
                        <div class="label">È¢ÑËÆ°ÊúàÁîµË¥π</div>
                        <div class="value" id="monthlyCost">-</div>
                        <div class="unit">ÂÖÉ</div>
                    </div>
                </div>
                
                <div class="breakdown" id="breakdown">
                    <h4>Áî®ÁîµÊòéÁªÜ</h4>
                    <!-- Breakdown items will be added here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        let appliances = [];
        let applianceId = 0;
        
        // Tiered pricing (Guangdong example)
        const tieredRates = [
            { limit: 260, rate: 0.52 },
            { limit: 600, rate: 0.57 },
            { limit: Infinity, rate: 0.82 }
        ];
        
        window.addPreset = function(name, wattage) {
            addAppliance(name, wattage, parseFloat(document.getElementById('defaultHours').value));
        };
        
        window.addCustomAppliance = function() {
            const name = document.getElementById('customName').value.trim();
            const wattage = parseFloat(document.getElementById('customWattage').value);
            
            if (name && wattage > 0) {
                addAppliance(name, wattage, parseFloat(document.getElementById('defaultHours').value));
                document.getElementById('customName').value = '';
                document.getElementById('customWattage').value = '';
            }
        };
        
        window.addAppliance = function(name, wattage, hours) {
            const id = applianceId++;
            appliances.push({ id: id, name: name, wattage: wattage, hours: hours });
            renderAppliances();
            calculate();
        };
        
        function removeAppliance(id) {
            appliances = appliances.filter(function(a) { return a.id !== id; });
            renderAppliances();
            calculate();
        }
        
        function updateApplianceHours(id, hours) {
            const appliance = appliances.find(function(a) { return a.id === id; });
            if (appliance) {
                appliance.hours = parseFloat(hours) || 0;
                calculate();
            }
        }
        
        function renderAppliances() {
            const list = document.getElementById('applianceList');
            list.textContent = '';
            
            appliances.forEach(function(appliance) {
                const item = document.createElement('div');
                item.className = 'appliance-item';
                
                const info = document.createElement('div');
                const nameSpan = document.createElement('div');
                nameSpan.className = 'name';
                nameSpan.textContent = appliance.name;
                const wattageSpan = document.createElement('div');
                wattageSpan.className = 'wattage';
                wattageSpan.textContent = appliance.wattage + 'W';
                info.appendChild(nameSpan);
                info.appendChild(wattageSpan);
                
                const hoursInput = document.createElement('input');
                hoursInput.type = 'number';
                hoursInput.value = appliance.hours;
                hoursInput.min = '0';
                hoursInput.max = '24';
                hoursInput.step = '0.5';
                hoursInput.oninput = function() { updateApplianceHours(appliance.id, this.value); };
                
                const hoursLabel = document.createElement('span');
                hoursLabel.textContent = 'Â∞èÊó∂/Â§©';
                hoursLabel.style.fontSize = '0.85rem';
                hoursLabel.style.color = 'var(--pico-muted-color)';
                
                const result = document.createElement('div');
                result.className = 'result';
                result.id = 'result-' + appliance.id;
                result.textContent = '-';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'outline contrast';
                removeBtn.textContent = '√ó';
                removeBtn.style.padding = '0.25rem 0.5rem';
                removeBtn.style.margin = '0';
                removeBtn.onclick = function() { removeAppliance(appliance.id); };
                
                item.appendChild(info);
                item.appendChild(hoursInput);
                item.appendChild(hoursLabel);
                item.appendChild(result);
                item.appendChild(removeBtn);
                
                list.appendChild(item);
            });
        }
        
        window.updateRateType = function() {
            const type = document.getElementById('rateType').value;
            document.getElementById('flatRateSection').style.display = type === 'flat' ? 'block' : 'none';
            document.getElementById('tieredRateSection').style.display = type === 'tiered' ? 'block' : 'none';
            document.getElementById('touRateSection').style.display = type === 'tou' ? 'block' : 'none';
            calculate();
        };
        
        window.calculate = function() {
            const daysPerMonth = parseInt(document.getElementById('daysPerMonth').value) || 30;
            const rateType = document.getElementById('rateType').value;
            
            // Calculate each appliance's consumption
            let totalDailyKwh = 0;
            let breakdownData = [];
            
            appliances.forEach(function(appliance) {
                const dailyKwh = (appliance.wattage * appliance.hours) / 1000;
                const monthlyKwh = dailyKwh * daysPerMonth;
                totalDailyKwh += dailyKwh;
                
                breakdownData.push({
                    name: appliance.name,
                    dailyKwh: dailyKwh,
                    monthlyKwh: monthlyKwh
                });
                
                const resultEl = document.getElementById('result-' + appliance.id);
                if (resultEl) {
                    resultEl.textContent = monthlyKwh.toFixed(1) + 'Â∫¶';
                }
            });
            
            const totalMonthlyKwh = totalDailyKwh * daysPerMonth;
            
            // Calculate cost based on rate type
            let monthlyCost = 0;
            
            if (rateType === 'flat') {
                const rate = parseFloat(document.getElementById('flatRate').value) || 0;
                monthlyCost = totalMonthlyKwh * rate;
            } else if (rateType === 'tiered') {
                monthlyCost = calculateTieredCost(totalMonthlyKwh);
                updateTierHighlight(totalMonthlyKwh);
            } else if (rateType === 'tou') {
                const peakRate = parseFloat(document.getElementById('peakRate').value) || 0;
                const valleyRate = parseFloat(document.getElementById('valleyRate').value) || 0;
                const peakRatio = parseFloat(document.getElementById('peakRatio').value) / 100 || 0.7;
                
                const peakKwh = totalMonthlyKwh * peakRatio;
                const valleyKwh = totalMonthlyKwh * (1 - peakRatio);
                monthlyCost = peakKwh * peakRate + valleyKwh * valleyRate;
            }
            
            // Update display
            document.getElementById('dailyKwh').textContent = totalDailyKwh.toFixed(2);
            document.getElementById('monthlyKwh').textContent = totalMonthlyKwh.toFixed(1);
            document.getElementById('monthlyCost').textContent = monthlyCost.toFixed(2);
            
            // Update breakdown
            renderBreakdown(breakdownData, totalMonthlyKwh);
        };
        
        function calculateTieredCost(kwh) {
            let cost = 0;
            let remaining = kwh;
            let prevLimit = 0;
            
            for (let i = 0; i < tieredRates.length; i++) {
                const tier = tieredRates[i];
                const tierKwh = Math.min(remaining, tier.limit - prevLimit);
                if (tierKwh > 0) {
                    cost += tierKwh * tier.rate;
                    remaining -= tierKwh;
                }
                prevLimit = tier.limit;
                if (remaining <= 0) break;
            }
            
            return cost;
        }
        
        function updateTierHighlight(kwh) {
            document.getElementById('tier1').classList.remove('active');
            document.getElementById('tier2').classList.remove('active');
            document.getElementById('tier3').classList.remove('active');
            
            if (kwh <= 260) {
                document.getElementById('tier1').classList.add('active');
            } else if (kwh <= 600) {
                document.getElementById('tier2').classList.add('active');
            } else {
                document.getElementById('tier3').classList.add('active');
            }
        }
        
        function renderBreakdown(data, total) {
            const container = document.getElementById('breakdown');
            container.textContent = '';
            
            const title = document.createElement('h4');
            title.textContent = 'Áî®ÁîµÊòéÁªÜ';
            container.appendChild(title);
            
            if (data.length === 0) {
                const empty = document.createElement('div');
                empty.style.color = 'var(--pico-muted-color)';
                empty.style.fontSize = '0.9rem';
                empty.textContent = 'Ê∑ªÂä†ÁîµÂô®ÂºÄÂßãËÆ°ÁÆó';
                container.appendChild(empty);
                return;
            }
            
            // Sort by consumption
            data.sort(function(a, b) { return b.monthlyKwh - a.monthlyKwh; });
            
            data.forEach(function(item) {
                const percentage = total > 0 ? (item.monthlyKwh / total) * 100 : 0;
                
                const row = document.createElement('div');
                row.className = 'breakdown-item';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name;
                
                const barDiv = document.createElement('div');
                barDiv.className = 'bar';
                const barFill = document.createElement('div');
                barFill.className = 'bar-fill';
                barFill.style.width = percentage + '%';
                barDiv.appendChild(barFill);
                
                nameDiv.appendChild(nameSpan);
                nameDiv.appendChild(barDiv);
                
                const costSpan = document.createElement('span');
                costSpan.className = 'cost';
                costSpan.textContent = item.monthlyKwh.toFixed(1) + 'Â∫¶ (' + percentage.toFixed(0) + '%)';
                
                row.appendChild(nameDiv);
                row.appendChild(costSpan);
                container.appendChild(row);
            });
        }
        
        window.toggleTheme = function() {
            const html = document.documentElement;
            const btn = document.getElementById('themeBtn');
            if (html.getAttribute('data-theme') === 'light') {
                html.setAttribute('data-theme', 'dark');
                btn.textContent = '‚òÄÔ∏è ÊµÖËâ≤';
            } else {
                html.setAttribute('data-theme', 'light');
                btn.textContent = 'üåô Ê∑±Ëâ≤';
            }
        };
        
        // Initialize with some default appliances
        addAppliance('LEDÁÖßÊòé', 50, 6);
        addAppliance('ÂÜ∞ÁÆ±', 100, 24);
        addAppliance('Ë∑ØÁî±Âô®', 10, 24);
    </script>
</body>
</html>

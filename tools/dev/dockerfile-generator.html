<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dockerfile ç”Ÿæˆå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="å¯è§†åŒ–ç”Ÿæˆ Dockerfileï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œæ¡†æ¶æ¨¡æ¿" />
    <meta
      name="keywords"
      content="dockerfile docker å®¹å™¨ ç”Ÿæˆå™¨ node python go java nginx alpine"
    />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/dev/dockerfile-generator.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="Dockerfile ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:description" content="å¯è§†åŒ–ç”Ÿæˆ Dockerfileï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œæ¡†æ¶æ¨¡æ¿" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/dev/dockerfile-generator.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Dockerfile ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:description" content="å¯è§†åŒ–ç”Ÿæˆ Dockerfileï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œæ¡†æ¶æ¨¡æ¿" />

    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --bg: #f8f9fa;
        --card-bg: #fff;
        --text: #212529;
        --text-muted: #6c757d;
        --border: #dee2e6;
        --primary: #0d6efd;
        --primary-hover: #0b5ed7;
        --success: #198754;
        --danger: #dc3545;
        --shadow: 0 2px 8px rgb(0 0 0 / 8%);
        --radius: 8px;
      }
      [data-theme="dark"] {
        --bg: #0a0a0f;
        --card-bg: #1a1a24;
        --text: #e8e8ed;
        --text-muted: #8888a0;
        --border: #2a2a3a;
        --shadow: 0 2px 8px rgb(0 0 0 / 30%);
      }
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border);
        background: var(--card-bg);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }
      .theme-toggle:hover {
        transform: scale(1.1);
      }
      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 24px;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .back-link {
        display: inline-block;
        margin-bottom: 16px;
        color: var(--primary);
        text-decoration: none;
        font-size: 0.9rem;
      }

      .back-link:hover {
        text-decoration: underline;
      }

      h1 {
        font-size: 1.75rem;
        margin: 0 0 8px;
      }

      .desc {
        color: var(--text-muted);
        margin: 0 0 24px;
        font-size: 0.95rem;
      }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
        margin-bottom: 20px;
      }

      .main-layout {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 20px;
      }

      @media (width <= 900px) {
        .main-layout {
          grid-template-columns: 1fr;
        }
      }

      .form-section h3 {
        font-size: 0.95rem;
        margin: 0 0 16px;
        color: var(--text);
        border-bottom: 1px solid var(--border);
        padding-bottom: 8px;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group label {
        display: block;
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 6px;
      }

      .form-group select,
      .form-group input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--card-bg);
        color: var(--text);
        font-size: 0.9rem;
      }

      .form-group select:focus,
      .form-group input:focus {
        outline: none;
        border-color: var(--primary);
      }

      .form-group textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--card-bg);
        color: var(--text);
        font-size: 0.9rem;
        font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
        resize: vertical;
      }

      .form-group textarea:focus {
        outline: none;
        border-color: var(--primary);
      }

      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
      }

      .checkbox-item input[type="checkbox"] {
        width: auto;
      }

      .templates {
        margin-bottom: 20px;
      }

      .template-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      @media (width <= 500px) {
        .template-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      .template-btn {
        padding: 10px 12px;
        font-size: 0.8rem;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--card-bg);
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
      }

      .template-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
      }

      .template-btn.active {
        border-color: var(--primary);
        background: var(--primary);
        color: #fff;
      }

      .template-btn .icon {
        display: block;
        font-size: 1.2rem;
        margin-bottom: 4px;
      }

      .output-section h3 {
        font-size: 0.95rem;
        margin: 0 0 12px;
        color: var(--text);
      }

      .btn-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      button {
        padding: 10px 16px;
        font-size: 0.95rem;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--card-bg);
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
      }

      button:hover {
        border-color: var(--primary);
        color: var(--primary);
      }

      button.primary {
        background: var(--primary);
        border-color: var(--primary);
        color: #fff;
      }

      button.primary:hover {
        background: var(--primary-hover);
        border-color: var(--primary-hover);
        color: #fff;
      }

      .code-block {
        background: #1a1a2e;
        color: #e8e8ed;
        padding: 16px;
        border-radius: var(--radius);
        font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        white-space: pre;
        line-height: 1.6;
        min-height: 300px;
        max-height: 500px;
        overflow-y: auto;
      }

      [data-theme="light"] .code-block {
        background: #f5f5f5;
        color: #333;
      }

      .code-block .comment {
        color: #6c757d;
      }

      .code-block .keyword {
        color: #0dcaf0;
      }

      .code-block .string {
        color: #20c997;
      }

      .status {
        font-size: 0.85rem;
        margin-top: 12px;
        min-height: 20px;
      }

      .status.success {
        color: var(--success);
      }

      .status.error {
        color: var(--danger);
      }

      .tips {
        margin-top: 20px;
        padding: 16px;
        background: var(--bg);
        border-radius: var(--radius);
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .tips h4 {
        margin: 0 0 8px;
        color: var(--text);
        font-size: 0.9rem;
      }

      .tips ul {
        margin: 0;
        padding-left: 20px;
      }

      .tips li {
        margin-bottom: 4px;
      }

      footer {
        text-align: center;
        margin-top: 32px;
        padding-top: 16px;
        border-top: 1px solid var(--border);
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      footer a {
        color: var(--primary);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      Dockerfile ç”Ÿæˆå™¨
    </nav>
    <div class="container">
      <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">â˜€ï¸</button>
      <h1>Dockerfile ç”Ÿæˆå™¨</h1>
      <p class="desc">å¯è§†åŒ–ç”Ÿæˆ Dockerfileï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œæ¡†æ¶çš„æœ€ä½³å®è·µæ¨¡æ¿</p>

      <div class="card">
        <div class="main-layout">
          <div class="config-panel">
            <div class="templates">
              <h3>å¿«é€Ÿæ¨¡æ¿</h3>
              <div class="template-grid">
                <button class="template-btn" data-template="node">
                  <span class="icon">ğŸ“¦</span>
                  Node.js
                </button>
                <button class="template-btn" data-template="python">
                  <span class="icon">ğŸ</span>
                  Python
                </button>
                <button class="template-btn" data-template="go">
                  <span class="icon">ğŸ¹</span>
                  Go
                </button>
                <button class="template-btn" data-template="java">
                  <span class="icon">â˜•</span>
                  Java
                </button>
                <button class="template-btn" data-template="nginx">
                  <span class="icon">ğŸŒ</span>
                  Nginx
                </button>
                <button class="template-btn" data-template="static">
                  <span class="icon">ğŸ“„</span>
                  Static
                </button>
              </div>
            </div>

            <div class="form-section">
              <h3>åŸºç¡€é…ç½®</h3>

              <div class="form-group">
                <label>åŸºç¡€é•œåƒ</label>
                <select id="baseImage">
                  <option value="node:20-alpine">node:20-alpine</option>
                  <option value="node:20-slim">node:20-slim</option>
                  <option value="node:20">node:20</option>
                  <option value="python:3.12-alpine">python:3.12-alpine</option>
                  <option value="python:3.12-slim">python:3.12-slim</option>
                  <option value="python:3.12">python:3.12</option>
                  <option value="golang:1.22-alpine">golang:1.22-alpine</option>
                  <option value="golang:1.22">golang:1.22</option>
                  <option value="openjdk:21-slim">openjdk:21-slim</option>
                  <option value="maven:3.9-eclipse-temurin-21">maven:3.9-eclipse-temurin-21</option>
                  <option value="nginx:alpine">nginx:alpine</option>
                  <option value="nginx:latest">nginx:latest</option>
                  <option value="alpine:3.19">alpine:3.19</option>
                  <option value="ubuntu:22.04">ubuntu:22.04</option>
                  <option value="debian:bookworm-slim">debian:bookworm-slim</option>
                </select>
              </div>

              <div class="form-group">
                <label>å·¥ä½œç›®å½•</label>
                <input type="text" id="workdir" value="/app" placeholder="/app" />
              </div>

              <div class="form-group">
                <label>æš´éœ²ç«¯å£</label>
                <input type="text" id="port" value="3000" placeholder="3000, 8080" />
              </div>

              <div class="form-group">
                <label>å¯åŠ¨å‘½ä»¤</label>
                <input type="text" id="cmd" value="node server.js" placeholder="node server.js" />
              </div>
            </div>

            <div class="form-section">
              <h3>é«˜çº§é€‰é¡¹</h3>

              <div class="form-group">
                <label>ç¯å¢ƒå˜é‡ (æ¯è¡Œä¸€ä¸ª: KEY=value)</label>
                <textarea id="envVars" placeholder="NODE_ENV=production&#10;PORT=3000"></textarea>
              </div>

              <div class="form-group">
                <label>é¢å¤–ä¾èµ–å®‰è£…</label>
                <textarea
                  id="runCommands"
                  placeholder="apk add --no-cache curl&#10;npm install -g pm2"
                ></textarea>
              </div>

              <div class="form-group checkbox-group">
                <label class="checkbox-item">
                  <input type="checkbox" id="useMultiStage" />
                  å¤šé˜¶æ®µæ„å»º
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" id="nonRoot" checked />
                  é root ç”¨æˆ·
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" id="healthCheck" />
                  å¥åº·æ£€æŸ¥
                </label>
              </div>
            </div>
          </div>

          <div class="output-panel">
            <div class="output-section">
              <h3>ç”Ÿæˆçš„ Dockerfile</h3>
              <div class="btn-row">
                <button class="primary" id="btnGenerate">ç”Ÿæˆ</button>
                <button id="btnCopy">å¤åˆ¶</button>
                <button id="btnDownload">ä¸‹è½½</button>
                <button id="btnShare">åˆ†äº«</button>
              </div>
              <div class="code-block" id="output"># é€‰æ‹©æ¨¡æ¿æˆ–é…ç½®é€‰é¡¹åç‚¹å‡»"ç”Ÿæˆ"</div>
              <div id="status" class="status"></div>
            </div>

            <div class="tips">
              <h4>æœ€ä½³å®è·µæç¤º</h4>
              <ul>
                <li>ä½¿ç”¨ alpine é•œåƒå¯ä»¥å¤§å¹…å‡å°é•œåƒä½“ç§¯</li>
                <li>å¤šé˜¶æ®µæ„å»ºå¯ä»¥åˆ†ç¦»æ„å»ºç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒ</li>
                <li>ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œä»¥æé«˜å®‰å…¨æ€§</li>
                <li>åˆç†ä½¿ç”¨ .dockerignore æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶</li>
                <li>å°†ä¸å¸¸å˜åŒ–çš„å±‚æ”¾åœ¨å‰é¢ä»¥åˆ©ç”¨ç¼“å­˜</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <a href="https://github.com/chicogong/html-tools" target="_blank" rel="noreferrer">
          GitHub
        </a>
        Â· çº¯å‰ç«¯å·¥å…· Â· æ— æœåŠ¡å™¨ Â·
        <a href="../../index.html">WebUtils</a>
      </footer>
    </div>

    <script>
      var baseImageEl = document.getElementById("baseImage");
      var workdirEl = document.getElementById("workdir");
      var portEl = document.getElementById("port");
      var cmdEl = document.getElementById("cmd");
      var envVarsEl = document.getElementById("envVars");
      var runCommandsEl = document.getElementById("runCommands");
      var useMultiStageEl = document.getElementById("useMultiStage");
      var nonRootEl = document.getElementById("nonRoot");
      var healthCheckEl = document.getElementById("healthCheck");
      var outputEl = document.getElementById("output");
      var statusEl = document.getElementById("status");

      var templates = {
        node: {
          baseImage: "node:20-alpine",
          workdir: "/app",
          port: "3000",
          cmd: "node server.js",
          envVars: "NODE_ENV=production",
          runCommands: "",
          multiStage: true,
          nonRoot: true,
          healthCheck: true
        },
        python: {
          baseImage: "python:3.12-slim",
          workdir: "/app",
          port: "8000",
          cmd: "python -m uvicorn main:app --host 0.0.0.0 --port 8000",
          envVars: "PYTHONDONTWRITEBYTECODE=1\nPYTHONUNBUFFERED=1",
          runCommands: "",
          multiStage: false,
          nonRoot: true,
          healthCheck: true
        },
        go: {
          baseImage: "golang:1.22-alpine",
          workdir: "/app",
          port: "8080",
          cmd: "./main",
          envVars: "GIN_MODE=release",
          runCommands: "",
          multiStage: true,
          nonRoot: true,
          healthCheck: true
        },
        java: {
          baseImage: "maven:3.9-eclipse-temurin-21",
          workdir: "/app",
          port: "8080",
          cmd: "java -jar app.jar",
          envVars: "JAVA_OPTS=-Xmx512m",
          runCommands: "",
          multiStage: true,
          nonRoot: true,
          healthCheck: true
        },
        nginx: {
          baseImage: "nginx:alpine",
          workdir: "/usr/share/nginx/html",
          port: "80",
          cmd: 'nginx -g "daemon off;"',
          envVars: "",
          runCommands: "",
          multiStage: false,
          nonRoot: false,
          healthCheck: true
        },
        static: {
          baseImage: "nginx:alpine",
          workdir: "/usr/share/nginx/html",
          port: "80",
          cmd: "",
          envVars: "",
          runCommands: "",
          multiStage: false,
          nonRoot: false,
          healthCheck: false
        }
      };

      function applyTemplate(name) {
        var t = templates[name];
        if (!t) return;

        baseImageEl.value = t.baseImage;
        workdirEl.value = t.workdir;
        portEl.value = t.port;
        cmdEl.value = t.cmd;
        envVarsEl.value = t.envVars;
        runCommandsEl.value = t.runCommands;
        useMultiStageEl.checked = t.multiStage;
        nonRootEl.checked = t.nonRoot;
        healthCheckEl.checked = t.healthCheck;

        document.querySelectorAll(".template-btn").forEach(function (btn) {
          btn.classList.toggle("active", btn.dataset.template === name);
        });

        generate();
      }

      window.generate = function () {
        var baseImage = baseImageEl.value;
        var workdir = workdirEl.value || "/app";
        var port = portEl.value;
        var cmd = cmdEl.value;
        var envVars = envVarsEl.value.trim();
        var runCommands = runCommandsEl.value.trim();
        var useMultiStage = useMultiStageEl.checked;
        var nonRoot = nonRootEl.checked;
        var healthCheck = healthCheckEl.checked;

        var lines = [];

        // Detect language/framework
        var isNode = baseImage.includes("node");
        var isPython = baseImage.includes("python");
        var isGo = baseImage.includes("golang");
        var isJava = baseImage.includes("maven") || baseImage.includes("openjdk");
        var isNginx = baseImage.includes("nginx");

        if (useMultiStage) {
          // Multi-stage build
          lines.push("# Build stage");

          if (isNode) {
            lines.push("FROM " + baseImage + " AS builder");
            lines.push("WORKDIR " + workdir);
            lines.push("");
            lines.push("# Install dependencies first (better caching)");
            lines.push("COPY package*.json ./");
            lines.push("RUN npm ci --only=production");
            lines.push("");
            lines.push("# Copy source code");
            lines.push("COPY . .");
            lines.push("");
            lines.push("# Production stage");
            lines.push("FROM " + baseImage + " AS production");
            lines.push("WORKDIR " + workdir);
          } else if (isGo) {
            lines.push("FROM " + baseImage + " AS builder");
            lines.push("WORKDIR " + workdir);
            lines.push("");
            lines.push("# Download dependencies");
            lines.push("COPY go.mod go.sum ./");
            lines.push("RUN go mod download");
            lines.push("");
            lines.push("# Build");
            lines.push("COPY . .");
            lines.push("RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .");
            lines.push("");
            lines.push("# Production stage");
            lines.push("FROM alpine:3.19 AS production");
            lines.push("RUN apk --no-cache add ca-certificates");
            lines.push("WORKDIR " + workdir);
            lines.push("COPY --from=builder " + workdir + "/main .");
          } else if (isJava) {
            lines.push("FROM " + baseImage + " AS builder");
            lines.push("WORKDIR " + workdir);
            lines.push("");
            lines.push("# Copy pom.xml and download dependencies");
            lines.push("COPY pom.xml .");
            lines.push("RUN mvn dependency:go-offline");
            lines.push("");
            lines.push("# Build");
            lines.push("COPY src ./src");
            lines.push("RUN mvn package -DskipTests");
            lines.push("");
            lines.push("# Production stage");
            lines.push("FROM eclipse-temurin:21-jre-alpine AS production");
            lines.push("WORKDIR " + workdir);
            lines.push("COPY --from=builder " + workdir + "/target/*.jar app.jar");
          }
        } else {
          // Single stage build
          lines.push("FROM " + baseImage);
          lines.push("");
          lines.push("WORKDIR " + workdir);
        }

        // Environment variables
        if (envVars) {
          lines.push("");
          lines.push("# Environment variables");
          envVars.split("\n").forEach(function (env) {
            env = env.trim();
            if (env && env.includes("=")) {
              lines.push("ENV " + env);
            }
          });
        }

        // Additional run commands
        if (runCommands) {
          lines.push("");
          lines.push("# Additional setup");
          runCommands.split("\n").forEach(function (cmd) {
            cmd = cmd.trim();
            if (cmd) {
              lines.push("RUN " + cmd);
            }
          });
        }

        // Copy files (for single stage or after multi-stage)
        if (!useMultiStage) {
          lines.push("");
          lines.push("# Copy application files");

          if (isNode) {
            lines.push("COPY package*.json ./");
            lines.push("RUN npm ci --only=production");
            lines.push("COPY . .");
          } else if (isPython) {
            lines.push("COPY requirements.txt .");
            lines.push("RUN pip install --no-cache-dir -r requirements.txt");
            lines.push("COPY . .");
          } else if (isNginx) {
            lines.push("COPY . .");
          } else {
            lines.push("COPY . .");
          }
        } else if (isNode) {
          lines.push("");
          lines.push("# Copy from builder");
          lines.push("COPY --from=builder " + workdir + "/node_modules ./node_modules");
          lines.push("COPY --from=builder " + workdir + " .");
        }

        // Non-root user
        if (nonRoot && !isNginx) {
          lines.push("");
          lines.push("# Create non-root user");
          if (baseImage.includes("alpine")) {
            lines.push("RUN addgroup -g 1001 -S nodejs && adduser -S nextjs -u 1001");
          } else {
            lines.push(
              "RUN groupadd -g 1001 nodejs && useradd -u 1001 -g nodejs -s /bin/sh nextjs"
            );
          }
          lines.push("USER nextjs");
        }

        // Expose port
        if (port) {
          lines.push("");
          lines.push("# Expose port");
          port.split(",").forEach(function (p) {
            p = p.trim();
            if (p) {
              lines.push("EXPOSE " + p);
            }
          });
        }

        // Health check
        if (healthCheck && port) {
          var firstPort = port.split(",")[0].trim();
          lines.push("");
          lines.push("# Health check");
          if (isNginx) {
            lines.push("HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\");
            lines.push("  CMD curl -f http://localhost:" + firstPort + "/ || exit 1");
          } else {
            lines.push("HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\");
            lines.push(
              "  CMD wget --no-verbose --tries=1 --spider http://localhost:" +
                firstPort +
                "/health || exit 1"
            );
          }
        }

        // CMD
        if (cmd) {
          lines.push("");
          lines.push("# Start command");
          var cmdParts = cmd.split(" ").filter(Boolean);
          lines.push('CMD ["' + cmdParts.join('", "') + '"]');
        }

        outputEl.textContent = lines.join("\n");
        saveToUrl();
      };

      // Template buttons
      document.querySelectorAll(".template-btn").forEach(function (btn) {
        btn.addEventListener("click", function () {
          applyTemplate(btn.dataset.template);
        });
      });

      // Generate button
      document.getElementById("btnGenerate").addEventListener("click", generate);

      // Auto-generate on input change
      [
        baseImageEl,
        workdirEl,
        portEl,
        cmdEl,
        envVarsEl,
        runCommandsEl,
        useMultiStageEl,
        nonRootEl,
        healthCheckEl
      ].forEach(function (el) {
        el.addEventListener("change", generate);
        el.addEventListener("input", generate);
      });

      // Copy
      document.getElementById("btnCopy").addEventListener("click", async function () {
        try {
          await navigator.clipboard.writeText(outputEl.textContent);
          showStatus("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success");
        } catch (e) {
          showStatus("å¤åˆ¶å¤±è´¥", "error");
        }
      });

      // Download
      document.getElementById("btnDownload").addEventListener("click", function () {
        var content = outputEl.textContent;
        var blob = new Blob([content], { type: "text/plain" });
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download = "Dockerfile";
        a.click();
        URL.revokeObjectURL(url);
        showStatus("å·²ä¸‹è½½ Dockerfile", "success");
      });

      // Share
      document.getElementById("btnShare").addEventListener("click", async function () {
        saveToUrl();
        try {
          await navigator.clipboard.writeText(location.href);
          showStatus("åˆ†äº«é“¾æ¥å·²å¤åˆ¶", "success");
        } catch (e) {
          showStatus("å¤åˆ¶å¤±è´¥", "error");
        }
      });

      function showStatus(msg, type) {
        statusEl.textContent = msg;
        statusEl.className = "status " + (type || "");
      }

      // URL state
      function saveToUrl() {
        var state = {
          base: baseImageEl.value,
          work: workdirEl.value,
          port: portEl.value,
          cmd: cmdEl.value,
          env: envVarsEl.value,
          run: runCommandsEl.value,
          multi: useMultiStageEl.checked,
          nonRoot: nonRootEl.checked,
          health: healthCheckEl.checked
        };
        try {
          history.replaceState(null, "", "#" + btoa(encodeURIComponent(JSON.stringify(state))));
        } catch (e) {
          // ignore
        }
      }

      window.loadFromUrl = function () {
        var hash = location.hash.slice(1);
        if (!hash) return false;
        try {
          var state = JSON.parse(decodeURIComponent(atob(hash)));
          if (state.base) baseImageEl.value = state.base;
          if (state.work) workdirEl.value = state.work;
          if (state.port !== undefined) portEl.value = state.port;
          if (state.cmd !== undefined) cmdEl.value = state.cmd;
          if (state.env !== undefined) envVarsEl.value = state.env;
          if (state.run !== undefined) runCommandsEl.value = state.run;
          if (state.multi !== undefined) useMultiStageEl.checked = state.multi;
          if (state.nonRoot !== undefined) nonRootEl.checked = state.nonRoot;
          if (state.health !== undefined) healthCheckEl.checked = state.health;
          return true;
        } catch (e) {
          // ignore
        }
        return false;
      };

      // Theme
      window.toggleTheme = function () {
        var html = document.documentElement;
        var btn = document.querySelector(".theme-toggle");
        var next = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
        html.setAttribute("data-theme", next);
        btn.textContent = next === "dark" ? "ğŸŒ™" : "â˜€ï¸";
        localStorage.setItem("theme", next);
      };

      // Init
      (function () {
        var saved = localStorage.getItem("theme");
        if (saved) {
          document.documentElement.setAttribute("data-theme", saved);
          var btn = document.querySelector(".theme-toggle");
          if (btn) btn.textContent = saved === "dark" ? "ğŸŒ™" : "â˜€ï¸";
        }

        if (!loadFromUrl()) {
          applyTemplate("node");
        } else {
          generate();
        }
      })();
    </script>
  </body>
</html>

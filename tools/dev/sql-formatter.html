<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLæ ¼å¼åŒ–å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; min-height: 100vh; padding: 20px; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 20px; color: #00d9ff; }
        .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
        .card { background: #16213e; border-radius: 12px; padding: 20px; }
        h3 { color: #00d9ff; margin-bottom: 12px; font-size: 14px; }
        textarea { width: 100%; height: 350px; padding: 16px; background: #0f3460; border: 1px solid #00d9ff; border-radius: 8px; color: #e0e0e0; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; resize: vertical; }
        .output { width: 100%; height: 350px; padding: 16px; background: #0f3460; border: 1px solid #00d9ff; border-radius: 8px; color: #e0e0e0; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; overflow: auto; white-space: pre-wrap; }
        .options { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 16px; }
        .option { display: flex; align-items: center; gap: 8px; }
        .option label { font-size: 13px; color: #aaa; }
        select, input[type="number"] { padding: 8px 12px; background: #0f3460; border: 1px solid #00d9ff; border-radius: 6px; color: white; }
        .btn { padding: 10px 20px; background: #00d9ff; border: none; border-radius: 8px; color: #1a1a2e; font-weight: 600; cursor: pointer; margin-right: 8px; }
        .btn:hover { background: #00ff88; }
        .templates { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .template { padding: 6px 12px; background: #0f3460; border: 1px solid #555; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .template:hover { border-color: #00d9ff; }
        .keyword { color: #569cd6; font-weight: bold; }
        .string { color: #ce9178; }
        .number { color: #b5cea8; }
        .function { color: #dcdcaa; }
        .comment { color: #6a9955; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š SQLæ ¼å¼åŒ–å·¥å…·</h1>
        <div class="templates">
            <div class="template" onclick="setTemplate('select')">SELECTç¤ºä¾‹</div>
            <div class="template" onclick="setTemplate('join')">JOINç¤ºä¾‹</div>
            <div class="template" onclick="setTemplate('subquery')">å­æŸ¥è¯¢ç¤ºä¾‹</div>
            <div class="template" onclick="setTemplate('insert')">INSERTç¤ºä¾‹</div>
            <div class="template" onclick="setTemplate('update')">UPDATEç¤ºä¾‹</div>
            <div class="template" onclick="setTemplate('create')">CREATEç¤ºä¾‹</div>
        </div>
        <div class="layout">
            <div class="card">
                <h3>è¾“å…¥SQL</h3>
                <textarea id="sqlInput" oninput="formatSQL()" placeholder="è¾“å…¥SQLè¯­å¥...">SELECT u.id, u.name, u.email, o.order_id, o.total_amount FROM users u INNER JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' AND o.created_at >= '2024-01-01' ORDER BY o.total_amount DESC LIMIT 100;</textarea>
            </div>
            <div class="card">
                <h3>æ ¼å¼åŒ–ç»“æœ</h3>
                <div class="output" id="sqlOutput"></div>
            </div>
        </div>
        <div class="card" style="margin-top: 20px;">
            <div class="options">
                <div class="option">
                    <label>å…³é”®å­—å¤§å°å†™</label>
                    <select id="keywordCase" onchange="formatSQL()">
                        <option value="upper">å¤§å†™</option>
                        <option value="lower">å°å†™</option>
                        <option value="capitalize">é¦–å­—æ¯å¤§å†™</option>
                    </select>
                </div>
                <div class="option">
                    <label>ç¼©è¿›ç©ºæ ¼æ•°</label>
                    <input type="number" id="indentSize" value="2" min="1" max="8" onchange="formatSQL()">
                </div>
                <div class="option">
                    <label>æ¯ä¸ªå­å¥æ¢è¡Œ</label>
                    <input type="checkbox" id="newlineClause" checked onchange="formatSQL()">
                </div>
            </div>
            <button class="btn" onclick="copySQL()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
            <button class="btn" onclick="minifySQL()">å‹ç¼©SQL</button>
            <button class="btn" onclick="clearAll()">æ¸…ç©º</button>
        </div>
    </div>
    <script>
        const keywords = ['SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'NOT', 'IN', 'LIKE', 'BETWEEN', 'IS', 'NULL', 
            'JOIN', 'INNER', 'LEFT', 'RIGHT', 'OUTER', 'FULL', 'CROSS', 'ON', 'AS',
            'GROUP', 'BY', 'HAVING', 'ORDER', 'ASC', 'DESC', 'LIMIT', 'OFFSET',
            'INSERT', 'INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE',
            'CREATE', 'TABLE', 'ALTER', 'DROP', 'INDEX', 'VIEW', 'DATABASE',
            'PRIMARY', 'KEY', 'FOREIGN', 'REFERENCES', 'UNIQUE', 'DEFAULT', 'CHECK',
            'CONSTRAINT', 'CASCADE', 'TRUNCATE', 'DISTINCT', 'ALL', 'UNION', 'EXCEPT', 'INTERSECT',
            'CASE', 'WHEN', 'THEN', 'ELSE', 'END', 'EXISTS', 'ANY', 'SOME'];
        
        const functions = ['COUNT', 'SUM', 'AVG', 'MIN', 'MAX', 'COALESCE', 'NULLIF', 'CAST', 'CONVERT',
            'CONCAT', 'SUBSTRING', 'TRIM', 'UPPER', 'LOWER', 'LENGTH', 'REPLACE',
            'DATE', 'NOW', 'CURDATE', 'YEAR', 'MONTH', 'DAY', 'DATEDIFF', 'DATE_FORMAT',
            'ROUND', 'FLOOR', 'CEIL', 'ABS', 'MOD', 'POWER', 'SQRT',
            'IF', 'IFNULL', 'IIF', 'NVL', 'DECODE'];
        
        const mainClauses = ['SELECT', 'FROM', 'WHERE', 'GROUP BY', 'HAVING', 'ORDER BY', 'LIMIT', 
            'INNER JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'FULL JOIN', 'CROSS JOIN', 'JOIN', 'ON',
            'INSERT INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE FROM',
            'CREATE TABLE', 'ALTER TABLE', 'DROP TABLE', 'UNION', 'UNION ALL'];
        
        const templates = {
            select: "SELECT id, name, email FROM users WHERE status = 'active' ORDER BY created_at DESC LIMIT 10;",
            join: "SELECT u.name, o.order_id, o.total FROM users u INNER JOIN orders o ON u.id = o.user_id LEFT JOIN products p ON o.product_id = p.id WHERE u.status = 'active';",
            subquery: "SELECT * FROM users WHERE id IN (SELECT user_id FROM orders WHERE total_amount > 1000) AND created_at >= (SELECT MIN(created_at) FROM users WHERE status = 'vip');",
            insert: "INSERT INTO users (name, email, status, created_at) VALUES ('å¼ ä¸‰', 'zhangsan@example.com', 'active', NOW());",
            update: "UPDATE users SET status = 'inactive', updated_at = NOW() WHERE last_login < '2023-01-01' AND status = 'active';",
            create: "CREATE TABLE orders (id INT PRIMARY KEY AUTO_INCREMENT, user_id INT NOT NULL, product_name VARCHAR(255), quantity INT DEFAULT 1, total_amount DECIMAL(10,2), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (user_id) REFERENCES users(id));"
        };
        
        function setTemplate(name) {
            document.getElementById('sqlInput').value = templates[name];
            formatSQL();
        }
        
        function formatSQL() {
            let sql = document.getElementById('sqlInput').value.trim();
            if (!sql) {
                document.getElementById('sqlOutput').innerHTML = '';
                return;
            }
            
            const keywordCase = document.getElementById('keywordCase').value;
            const indentSize = parseInt(document.getElementById('indentSize').value);
            const newlineClause = document.getElementById('newlineClause').checked;
            const indent = ' '.repeat(indentSize);
            
            // Normalize whitespace
            sql = sql.replace(/\s+/g, ' ').trim();
            
            // Format main clauses
            if (newlineClause) {
                mainClauses.forEach(clause => {
                    const regex = new RegExp(`\\b(${clause})\\b`, 'gi');
                    sql = sql.replace(regex, '\n$1');
                });
                
                // Indent after some keywords
                sql = sql.replace(/\bAND\b/gi, '\n' + indent + 'AND');
                sql = sql.replace(/\bOR\b/gi, '\n' + indent + 'OR');
            }
            
            // Apply keyword case
            keywords.forEach(kw => {
                const regex = new RegExp(`\\b(${kw})\\b`, 'gi');
                sql = sql.replace(regex, (match) => {
                    switch (keywordCase) {
                        case 'upper': return kw.toUpperCase();
                        case 'lower': return kw.toLowerCase();
                        case 'capitalize': return kw.charAt(0).toUpperCase() + kw.slice(1).toLowerCase();
                        default: return match;
                    }
                });
            });
            
            // Clean up
            sql = sql.replace(/^\n+/, '').replace(/\n{3,}/g, '\n\n');
            
            // Syntax highlight
            document.getElementById('sqlOutput').innerHTML = highlightSQL(sql);
        }
        
        function highlightSQL(sql) {
            let result = escapeHtml(sql);
            
            // Highlight keywords
            keywords.forEach(kw => {
                const regex = new RegExp(`\\b(${kw})\\b`, 'gi');
                result = result.replace(regex, '<span class="keyword">$1</span>');
            });
            
            // Highlight functions
            functions.forEach(fn => {
                const regex = new RegExp(`\\b(${fn})\\s*\\(`, 'gi');
                result = result.replace(regex, '<span class="function">$1</span>(');
            });
            
            // Highlight strings
            result = result.replace(/'([^']*)'/g, '<span class="string">\'$1\'</span>');
            
            // Highlight numbers
            result = result.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // Highlight comments
            result = result.replace(/--(.*?)(\n|$)/g, '<span class="comment">--$1</span>$2');
            result = result.replace(/\/\*([\s\S]*?)\*\//g, '<span class="comment">/*$1*/</span>');
            
            return result;
        }
        
        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
        
        function minifySQL() {
            let sql = document.getElementById('sqlInput').value;
            sql = sql.replace(/\s+/g, ' ').replace(/\s*([,()])\s*/g, '$1').trim();
            document.getElementById('sqlInput').value = sql;
            formatSQL();
        }
        
        function copySQL() {
            const output = document.getElementById('sqlOutput').textContent;
            navigator.clipboard.writeText(output);
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');
        }
        
        function clearAll() {
            document.getElementById('sqlInput').value = '';
            document.getElementById('sqlOutput').innerHTML = '';
        }
        
        formatSQL();
    </script>
</body>
</html>
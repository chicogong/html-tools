<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç« ç”Ÿæˆå™¨ - WebUtils</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            --card-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        [data-theme="dark"] {
            --card-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        body {
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        header h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--primary-gradient);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .controls {
            background: var(--pico-card-background-color);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
        }
        
        .control-group {
            margin-bottom: 1.5rem;
        }
        
        .control-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .stamp-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        
        .type-btn {
            padding: 0.75rem 0.5rem;
            border: 2px solid var(--pico-muted-border-color);
            border-radius: 0.5rem;
            background: transparent;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .type-btn:hover, .type-btn.active {
            border-color: #c0392b;
            background: rgba(192, 57, 43, 0.1);
        }
        
        .color-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .color-row input[type="color"] {
            width: 50px;
            height: 40px;
            padding: 0;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        
        .color-presets {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .color-preset {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .color-preset:hover {
            transform: scale(1.2);
            border-color: var(--pico-primary);
        }
        
        .slider-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .slider-group input[type="range"] {
            flex: 1;
        }
        
        .slider-value {
            min-width: 50px;
            text-align: right;
        }
        
        .preview-area {
            background: var(--pico-card-background-color);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: repeating-conic-gradient(#ccc 0% 25%, #fff 0% 50%) 50% / 20px 20px;
            border-radius: 0.5rem;
            padding: 2rem;
            min-height: 500px;
        }
        
        [data-theme="dark"] .canvas-container {
            background: repeating-conic-gradient(#333 0% 25%, #444 0% 50%) 50% / 20px 20px;
        }
        
        #canvas {
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn-group button {
            flex: 1;
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            border: none;
        }
        
        .star-select {
            display: flex;
            gap: 0.5rem;
        }
        
        .star-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--pico-muted-border-color);
            border-radius: 0.5rem;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .star-btn:hover, .star-btn.active {
            border-color: #c0392b;
            background: rgba(192, 57, 43, 0.1);
        }
        
        .effect-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .effect-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--pico-muted-border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .effect-toggle.active {
            border-color: #c0392b;
            background: rgba(192, 57, 43, 0.1);
        }
    
        .breadcrumb { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span><a href="../../index.html#generator">ç”Ÿæˆå™¨</a><span>â€º</span>å°ç« ç”Ÿæˆå™¨</nav>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
    
    <div class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ğŸ”´ å°ç« ç”Ÿæˆå™¨</h1>
            <p>åˆ›å»ºä¸“ä¸šçš„ä¸­å¼å°ç« </p>
        </header>
        
        <div class="main-content">
            <div class="controls">
                <div class="control-group">
                    <label>ğŸ“ å°ç« ç±»å‹</label>
                    <div class="stamp-types">
                        <button class="type-btn active" data-type="circle">åœ†å½¢ç« </button>
                        <button class="type-btn" data-type="oval">æ¤­åœ†ç« </button>
                        <button class="type-btn" data-type="square">æ–¹å½¢ç« </button>
                        <button class="type-btn" data-type="personal">ç§ç« </button>
                        <button class="type-btn" data-type="date">æ—¥æœŸç« </button>
                        <button class="type-btn" data-type="contract">åˆåŒç« </button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>âœï¸ å…¬å¸/å§“å</label>
                    <input type="text" id="mainText" value="ç§‘æŠ€åˆ›æ–°æœ‰é™å…¬å¸" placeholder="è¾“å…¥å…¬å¸æˆ–å§“å">
                </div>
                
                <div class="control-group">
                    <label>âœï¸ ä¸­é—´æ–‡å­—</label>
                    <input type="text" id="centerText" value="å…¬ç« " placeholder="å¦‚ï¼šå…¬ç« ã€åˆåŒä¸“ç”¨ç« ç­‰">
                </div>
                
                <div class="control-group">
                    <label>âœï¸ åº•éƒ¨æ–‡å­—</label>
                    <input type="text" id="bottomText" placeholder="å¯é€‰ï¼Œå¦‚ç¼–å·ç­‰">
                </div>
                
                <div class="control-group">
                    <label>â­ ä¸­å¿ƒå›¾æ¡ˆ</label>
                    <div class="star-select">
                        <button class="star-btn active" data-star="star">äº”è§’æ˜Ÿ</button>
                        <button class="star-btn" data-star="none">æ— </button>
                        <button class="star-btn" data-star="circle">åœ†ç‚¹</button>
                        <button class="star-btn" data-star="diamond">è±å½¢</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ğŸ¨ å°ç« é¢œè‰²</label>
                    <div class="color-row">
                        <input type="color" id="stampColor" value="#c0392b">
                        <span>é€‰æ‹©é¢œè‰²</span>
                    </div>
                    <div class="color-presets">
                        <div class="color-preset" style="background: #c0392b" data-color="#c0392b"></div>
                        <div class="color-preset" style="background: #e74c3c" data-color="#e74c3c"></div>
                        <div class="color-preset" style="background: #922B21" data-color="#922B21"></div>
                        <div class="color-preset" style="background: #1a5276" data-color="#1a5276"></div>
                        <div class="color-preset" style="background: #196f3d" data-color="#196f3d"></div>
                        <div class="color-preset" style="background: #000" data-color="#000000"></div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ğŸ“ å°ç« å¤§å°</label>
                    <div class="slider-group">
                        <input type="range" id="stampSize" min="150" max="400" value="280">
                        <span class="slider-value" id="stampSizeValue">280px</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ğŸ“ è¾¹æ¡†ç²—ç»†</label>
                    <div class="slider-group">
                        <input type="range" id="borderWidth" min="2" max="12" value="5">
                        <span class="slider-value" id="borderWidthValue">5px</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>âœ¨ æ•ˆæœ</label>
                    <div class="effect-toggles">
                        <div class="effect-toggle active" data-effect="rough">åšæ—§æ•ˆæœ</div>
                        <div class="effect-toggle" data-effect="transparent">é€æ˜èƒŒæ™¯</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="downloadStamp()">ğŸ“¥ ä¸‹è½½å°ç« </button>
                </div>
            </div>
            
            <div class="preview-area">
                <h3>é¢„è§ˆ</h3>
                <div class="canvas-container">
                    <canvas id="canvas" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Theme management
        window.toggleTheme = function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        };
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let state = {
            type: 'circle',
            mainText: 'ç§‘æŠ€åˆ›æ–°æœ‰é™å…¬å¸',
            centerText: 'å…¬ç« ',
            bottomText: '',
            star: 'star',
            color: '#c0392b',
            size: 280,
            borderWidth: 5,
            rough: true,
            transparent: false
        };
        
        // Event listeners
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.type = btn.dataset.type;
                
                // Set default texts based on type
                switch (state.type) {
                    case 'personal':
                        state.mainText = 'å¼ ä¸‰';
                        state.centerText = 'å°';
                        document.getElementById('mainText').value = 'å¼ ä¸‰';
                        document.getElementById('centerText').value = 'å°';
                        break;
                    case 'date':
                        state.centerText = new Date().toLocaleDateString('zh-CN');
                        document.getElementById('centerText').value = state.centerText;
                        break;
                    case 'contract':
                        state.centerText = 'åˆåŒä¸“ç”¨ç« ';
                        document.getElementById('centerText').value = 'åˆåŒä¸“ç”¨ç« ';
                        break;
                }
                render();
            });
        });
        
        document.querySelectorAll('.star-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.star-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.star = btn.dataset.star;
                render();
            });
        });
        
        document.querySelectorAll('.color-preset').forEach(el => {
            el.addEventListener('click', () => {
                state.color = el.dataset.color;
                document.getElementById('stampColor').value = el.dataset.color;
                render();
            });
        });
        
        document.querySelectorAll('.effect-toggle').forEach(el => {
            el.addEventListener('click', () => {
                el.classList.toggle('active');
                state[el.dataset.effect] = el.classList.contains('active');
                render();
            });
        });
        
        document.getElementById('mainText').addEventListener('input', e => {
            state.mainText = e.target.value;
            render();
        });
        
        document.getElementById('centerText').addEventListener('input', e => {
            state.centerText = e.target.value;
            render();
        });
        
        document.getElementById('bottomText').addEventListener('input', e => {
            state.bottomText = e.target.value;
            render();
        });
        
        document.getElementById('stampColor').addEventListener('input', e => {
            state.color = e.target.value;
            render();
        });
        
        document.getElementById('stampSize').addEventListener('input', e => {
            state.size = parseInt(e.target.value);
            document.getElementById('stampSizeValue').textContent = e.target.value + 'px';
            render();
        });
        
        document.getElementById('borderWidth').addEventListener('input', e => {
            state.borderWidth = parseInt(e.target.value);
            document.getElementById('borderWidthValue').textContent = e.target.value + 'px';
            render();
        });
        
        function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            const step = Math.PI / spikes;
            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
                rot += step;
                ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
        }
        
        function drawTextOnArc(text, cx, cy, radius, startAngle, endAngle) {
            const chars = text.split('');
            const angleStep = (endAngle - startAngle) / (chars.length + 1);
            
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            chars.forEach((char, i) => {
                const angle = startAngle + angleStep * (i + 1);
                const x = cx + radius * Math.cos(angle);
                const y = cy + radius * Math.sin(angle);
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle + Math.PI / 2);
                ctx.fillText(char, 0, 0);
                ctx.restore();
            });
        }
        
        function addRoughEffect() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                if (data[i + 3] > 0) {
                    // Add random transparency
                    if (Math.random() > 0.85) {
                        data[i + 3] = Math.floor(data[i + 3] * (0.3 + Math.random() * 0.7));
                    }
                    // Add slight color variation
                    const variation = Math.floor(Math.random() * 30 - 15);
                    data[i] = Math.min(255, Math.max(0, data[i] + variation));
                    data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + variation));
                    data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + variation));
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
        }
        
        function render() {
            const size = state.size;
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const radius = size / 2 - state.borderWidth;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = state.color;
            ctx.strokeStyle = state.color;
            ctx.lineWidth = state.borderWidth;
            
            // Draw based on type
            switch (state.type) {
                case 'circle':
                case 'date':
                case 'contract':
                    drawCircleStamp(cx, cy, radius);
                    break;
                case 'oval':
                    drawOvalStamp(cx, cy, radius);
                    break;
                case 'square':
                    drawSquareStamp(cx, cy, radius);
                    break;
                case 'personal':
                    drawPersonalStamp(cx, cy, radius);
                    break;
            }
            
            // Apply rough effect
            if (state.rough) {
                addRoughEffect();
            }
        }
        
        function drawCircleStamp(cx, cy, radius) {
            // Outer circle
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.stroke();
            
            // Inner circle
            ctx.beginPath();
            ctx.arc(cx, cy, radius - state.borderWidth - 3, 0, Math.PI * 2);
            ctx.stroke();
            
            // Main text on arc
            const fontSize = Math.floor(radius / 6);
            ctx.font = 'bold ' + fontSize + 'px SimSun, serif';
            drawTextOnArc(state.mainText, cx, cy, radius - fontSize, Math.PI * 0.2, Math.PI * 1.8);
            
            // Center star or shape
            if (state.star === 'star') {
                drawStar(cx, cy, 5, radius * 0.25, radius * 0.1);
            } else if (state.star === 'circle') {
                ctx.beginPath();
                ctx.arc(cx, cy, radius * 0.15, 0, Math.PI * 2);
                ctx.fill();
            } else if (state.star === 'diamond') {
                ctx.beginPath();
                ctx.moveTo(cx, cy - radius * 0.2);
                ctx.lineTo(cx + radius * 0.15, cy);
                ctx.lineTo(cx, cy + radius * 0.2);
                ctx.lineTo(cx - radius * 0.15, cy);
                ctx.closePath();
                ctx.fill();
            }
            
            // Center text
            if (state.centerText && state.star !== 'none') {
                ctx.font = 'bold ' + Math.floor(fontSize * 0.8) + 'px SimSun, serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(state.centerText, cx, cy + radius * 0.45);
            } else if (state.centerText) {
                ctx.font = 'bold ' + Math.floor(fontSize * 1.2) + 'px SimSun, serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(state.centerText, cx, cy);
            }
            
            // Bottom text
            if (state.bottomText) {
                ctx.font = fontSize * 0.6 + 'px SimSun, serif';
                drawTextOnArc(state.bottomText, cx, cy, radius - fontSize, Math.PI * 1.2, Math.PI * 1.8);
            }
        }
        
        function drawOvalStamp(cx, cy, radius) {
            const rx = radius;
            const ry = radius * 0.6;
            
            // Outer oval
            ctx.beginPath();
            ctx.ellipse(cx, cy, rx, ry, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Inner oval
            ctx.beginPath();
            ctx.ellipse(cx, cy, rx - state.borderWidth - 3, ry - state.borderWidth - 3, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Center text
            const fontSize = Math.floor(ry / 2);
            ctx.font = 'bold ' + fontSize + 'px SimSun, serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const lines = [];
            if (state.mainText) lines.push(state.mainText);
            if (state.centerText) lines.push(state.centerText);
            
            lines.forEach((line, i) => {
                const y = cy + (i - (lines.length - 1) / 2) * (fontSize + 5);
                ctx.fillText(line, cx, y);
            });
        }
        
        function drawSquareStamp(cx, cy, radius) {
            const size = radius * 1.6;
            const x = cx - size / 2;
            const y = cy - size / 2;
            
            // Outer square
            ctx.strokeRect(x, y, size, size);
            
            // Inner square
            const innerOffset = state.borderWidth + 3;
            ctx.strokeRect(x + innerOffset, y + innerOffset, size - innerOffset * 2, size - innerOffset * 2);
            
            // Text
            const chars = (state.mainText + state.centerText).split('');
            const gridSize = Math.ceil(Math.sqrt(chars.length));
            const cellSize = (size - innerOffset * 4) / gridSize;
            const fontSize = Math.floor(cellSize * 0.8);
            
            ctx.font = 'bold ' + fontSize + 'px SimSun, serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            chars.forEach((char, i) => {
                const col = i % gridSize;
                const row = Math.floor(i / gridSize);
                const charX = x + innerOffset * 2 + cellSize / 2 + col * cellSize;
                const charY = y + innerOffset * 2 + cellSize / 2 + row * cellSize;
                ctx.fillText(char, charX, charY);
            });
        }
        
        function drawPersonalStamp(cx, cy, radius) {
            const size = radius * 1.2;
            
            // Simple square
            ctx.strokeRect(cx - size / 2, cy - size / 2, size, size);
            
            // Name vertically
            const chars = state.mainText.split('');
            const fontSize = size / (chars.length + 1);
            ctx.font = 'bold ' + fontSize + 'px SimSun, serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            chars.forEach((char, i) => {
                ctx.fillText(char, cx, cy - size / 2 + fontSize + i * fontSize);
            });
            
            // Add "å°" if set
            if (state.centerText) {
                ctx.font = 'bold ' + (fontSize * 0.8) + 'px SimSun, serif';
                ctx.fillText(state.centerText, cx, cy + size / 2 - fontSize * 0.5);
            }
        }
        
        window.downloadStamp = function() {
            // Create a clean version for download
            const downloadCanvas = document.createElement('canvas');
            downloadCanvas.width = state.size;
            downloadCanvas.height = state.size;
            const downloadCtx = downloadCanvas.getContext('2d');
            
            // Draw stamp centered on smaller canvas
            downloadCtx.drawImage(
                canvas,
                (canvas.width - state.size) / 2,
                (canvas.height - state.size) / 2,
                state.size,
                state.size,
                0,
                0,
                state.size,
                state.size
            );
            
            const link = document.createElement('a');
            link.download = 'stamp-' + state.mainText + '.png';
            link.href = downloadCanvas.toDataURL('image/png');
            link.click();
        };
        
        // Initialize
        render();
    </script>
</body>
</html>

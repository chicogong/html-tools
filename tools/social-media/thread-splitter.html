<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>é•¿æ–‡åˆ†å‰²å™¨ - WebUtils</title>
    <meta name="description" content="å°†é•¿æ–‡åˆ†å‰²ä¸ºé€‚åˆ Twitter/X çº¿ç¨‹çš„å¤šæ¡æ¨æ–‡" />
    <meta name="keywords" content="thread splitter twitter çº¿ç¨‹ é•¿æ–‡åˆ†å‰²" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-pink: #f72585;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-blue: #1da1f2;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }
      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Space Grotesk", system-ui, sans-serif;
        background: var(--bg-deep);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }
      .bg-grid {
        position: fixed;
        inset: 0;
        background-image:
          linear-gradient(rgb(0, 245, 212, 0.02) 1px, transparent 1px),
          linear-gradient(90deg, rgb(0, 245, 212, 0.02) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }
      .container {
        position: relative;
        z-index: 1;
        max-width: 900px;
        margin: 0 auto;
        padding: 24px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }
      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        padding: 8px 14px;
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
      }
      .breadcrumb a {
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }
      .breadcrumb a:hover {
        color: var(--accent-cyan);
      }
      .breadcrumb-separator {
        color: var(--text-muted);
      }
      .breadcrumb-current {
        color: var(--text-primary);
        font-weight: 500;
      }
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }
      .theme-toggle:hover {
        transform: scale(1.1);
      }
      .title-section {
        flex: 1;
      }
      .title-section h1 {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .title-icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--accent-blue), #4cc9f0);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: #fff;
      }
      .title-section .desc {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-top: 4px;
      }
      .main-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 24px;
        flex: 1;
      }
      .input-section {
        margin-bottom: 20px;
      }
      .input-section label {
        display: block;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 8px;
      }
      textarea {
        width: 100%;
        min-height: 200px;
        padding: 16px;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.9rem;
        line-height: 1.6;
        background: var(--bg-input);
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        resize: vertical;
        transition: all 0.2s;
      }
      textarea:focus {
        outline: none;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 0 4px var(--glow-cyan);
      }
      textarea::placeholder {
        color: var(--text-muted);
      }
      .options {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-subtle);
      }
      .options label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }
      .options select,
      .options input[type="number"] {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        padding: 8px 12px;
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
      }
      .options input[type="number"] {
        width: 80px;
      }
      .options input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: var(--accent-cyan);
      }
      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }
      button {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        font-weight: 500;
        padding: 10px 16px;
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }
      button:hover {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
      }
      button.primary {
        background: var(--accent-cyan);
        border-color: var(--accent-cyan);
        color: var(--bg-deep);
      }
      button.primary:hover {
        background: #00dfc4;
        box-shadow: 0 0 20px var(--glow-cyan);
      }
      .stats {
        display: flex;
        gap: 24px;
        flex-wrap: wrap;
        padding: 16px;
        background: var(--bg-surface);
        border-radius: var(--radius-md);
        margin-bottom: 20px;
      }
      .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .stat-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--accent-cyan);
      }
      .stat-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
      }
      .output-section {
        margin-top: 20px;
      }
      .output-label {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 12px;
      }
      .thread-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .tweet-card {
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 16px;
        position: relative;
      }
      .tweet-card:hover {
        border-color: var(--accent-blue);
      }
      .tweet-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      .tweet-number {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 4px 10px;
        background: var(--accent-blue);
        border-radius: 12px;
        color: #fff;
      }
      .tweet-length {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.75rem;
        color: var(--text-muted);
      }
      .tweet-length.warning {
        color: var(--accent-red);
      }
      .tweet-content {
        font-size: 0.95rem;
        line-height: 1.7;
        color: var(--text-primary);
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
      .tweet-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border-subtle);
      }
      .tweet-action {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.7rem;
        padding: 6px 12px;
        background: transparent;
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        cursor: pointer;
      }
      .tweet-action:hover {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
      }
      .status {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-top: 16px;
      }
      .status.success {
        color: var(--accent-green);
      }
      .status.error {
        color: var(--accent-red);
      }
      footer {
        text-align: center;
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid var(--border-subtle);
      }
      footer p {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      footer a {
        color: var(--accent-cyan);
        text-decoration: none;
      }
      footer a:hover {
        color: var(--text-primary);
      }
      @media (max-width: 640px) {
        .container {
          padding: 16px;
        }
        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }
        .options {
          flex-direction: column;
          gap: 12px;
        }
        .stats {
          gap: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-grid"></div>

    <div class="container">
      <div class="header">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../../index.html">é¦–é¡µ</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">é•¿æ–‡åˆ†å‰²å™¨</span>
        </nav>
        <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        <div class="title-section">
          <h1>
            <span class="title-icon">ğŸ“</span>
            é•¿æ–‡åˆ†å‰²å™¨
          </h1>
          <p class="desc">å°†é•¿æ–‡æ™ºèƒ½åˆ†å‰²ä¸º Twitter/X çº¿ç¨‹ï¼Œæ”¯æŒè‡ªå®šä¹‰å­—æ•°é™åˆ¶</p>
        </div>
      </div>

      <div class="main-card">
        <div class="input-section">
          <label>è¾“å…¥é•¿æ–‡å†…å®¹</label>
          <textarea id="input" placeholder="åœ¨æ­¤ç²˜è´´æˆ–è¾“å…¥ä½ çš„é•¿æ–‡å†…å®¹..."></textarea>
        </div>

        <div class="options">
          <label>
            å­—æ•°ä¸Šé™:
            <input type="number" id="charLimit" value="280" min="100" max="500" />
          </label>
          <label>
            <input type="checkbox" id="addNumbers" checked />
            æ·»åŠ åºå· (1/n)
          </label>
          <label>
            <input type="checkbox" id="smartBreak" checked />
            æ™ºèƒ½æ–­å¥
          </label>
          <label>
            åˆ†éš”ç¬¦:
            <select id="separator">
              <option value="paragraph">æŒ‰æ®µè½</option>
              <option value="sentence">æŒ‰å¥å­</option>
              <option value="char">æŒ‰å­—ç¬¦</option>
            </select>
          </label>
        </div>

        <div class="toolbar">
          <button id="btnPaste">ç²˜è´´</button>
          <button class="primary" id="btnSplit">åˆ†å‰²</button>
          <button id="btnCopyAll">å¤åˆ¶å…¨éƒ¨</button>
          <button id="btnShare">åˆ†äº«</button>
          <button id="btnClear">æ¸…ç©º</button>
        </div>

        <div class="stats" id="stats" style="display: none">
          <div class="stat-item">
            <span class="stat-value" id="statTotal">0</span>
            <span class="stat-label">æ€»å­—ç¬¦</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="statTweets">0</span>
            <span class="stat-label">æ¨æ–‡æ•°</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="statAvg">0</span>
            <span class="stat-label">å¹³å‡å­—ç¬¦</span>
          </div>
        </div>

        <div class="output-section">
          <div class="output-label">åˆ†å‰²ç»“æœ</div>
          <div class="thread-container" id="threadContainer"></div>
        </div>

        <div id="status" class="status"></div>
      </div>

      <footer>
        <p>
          <a href="https://github.com/nicogong/html-tools" target="_blank" rel="noreferrer">
            GitHub
          </a>
          <span>Â·</span>
          <span>çº¯å‰ç«¯ Â· æ— æœåŠ¡å™¨</span>
          <span>Â·</span>
          <a href="../../index.html">WebUtils</a>
        </p>
      </footer>
    </div>

    <script>
      const inputEl = document.getElementById("input");
      const charLimitEl = document.getElementById("charLimit");
      const addNumbersEl = document.getElementById("addNumbers");
      const smartBreakEl = document.getElementById("smartBreak");
      const separatorEl = document.getElementById("separator");
      const threadContainerEl = document.getElementById("threadContainer");
      const statsEl = document.getElementById("stats");
      const statusEl = document.getElementById("status");

      const LS_KEY = "thread_splitter_v1";

      function splitText() {
        const text = inputEl.value.trim();
        if (!text) {
          showStatus("è¯·è¾“å…¥æ–‡æœ¬å†…å®¹", "error");
          return;
        }

        const charLimit = parseInt(charLimitEl.value, 10) || 280;
        const addNumbers = addNumbersEl.checked;
        const smartBreak = smartBreakEl.checked;
        const separator = separatorEl.value;

        let chunks = [];

        if (separator === "paragraph") {
          chunks = splitByParagraph(text, charLimit, smartBreak);
        } else if (separator === "sentence") {
          chunks = splitBySentence(text, charLimit);
        } else {
          chunks = splitByChar(text, charLimit);
        }

        if (addNumbers) {
          const total = chunks.length;
          chunks = chunks.map(function (chunk, i) {
            const prefix = i + 1 + "/" + total + "\n\n";
            return prefix + chunk;
          });
        }

        displayThread(chunks);
        updateStats(text, chunks);
        saveToStorage();
        showStatus("å·²åˆ†å‰²ä¸º " + chunks.length + " æ¡æ¨æ–‡", "success");
      }

      function splitByParagraph(text, limit, smart) {
        const paragraphs = text.split(/\n\n+/);
        const chunks = [];
        let current = "";

        for (const para of paragraphs) {
          const trimmedPara = para.trim();
          if (!trimmedPara) continue;

          if (current.length + trimmedPara.length + 2 <= limit) {
            current = current ? current + "\n\n" + trimmedPara : trimmedPara;
          } else {
            if (current) {
              chunks.push(current);
            }
            if (trimmedPara.length <= limit) {
              current = trimmedPara;
            } else {
              const subChunks = smart
                ? splitBySentence(trimmedPara, limit)
                : splitByChar(trimmedPara, limit);
              for (let i = 0; i < subChunks.length - 1; i++) {
                chunks.push(subChunks[i]);
              }
              current = subChunks[subChunks.length - 1];
            }
          }
        }

        if (current) {
          chunks.push(current);
        }

        return chunks;
      }

      function splitBySentence(text, limit) {
        const sentences = text.match(/[^ã€‚ï¼ï¼Ÿ.!?]+[ã€‚ï¼ï¼Ÿ.!?]?/g) || [text];
        const chunks = [];
        let current = "";

        for (const sentence of sentences) {
          const trimmedSentence = sentence.trim();
          if (!trimmedSentence) continue;

          if (current.length + trimmedSentence.length <= limit) {
            current = current + trimmedSentence;
          } else {
            if (current) {
              chunks.push(current.trim());
            }
            if (trimmedSentence.length <= limit) {
              current = trimmedSentence;
            } else {
              const subChunks = splitByChar(trimmedSentence, limit);
              for (let i = 0; i < subChunks.length - 1; i++) {
                chunks.push(subChunks[i]);
              }
              current = subChunks[subChunks.length - 1];
            }
          }
        }

        if (current) {
          chunks.push(current.trim());
        }

        return chunks;
      }

      function splitByChar(text, limit) {
        const chunks = [];
        let remaining = text;

        while (remaining.length > limit) {
          let breakPoint = limit;

          const spaceIndex = remaining.lastIndexOf(" ", limit);
          const newlineIndex = remaining.lastIndexOf("\n", limit);
          const bestBreak = Math.max(spaceIndex, newlineIndex);

          if (bestBreak > limit * 0.5) {
            breakPoint = bestBreak;
          }

          chunks.push(remaining.slice(0, breakPoint).trim());
          remaining = remaining.slice(breakPoint).trim();
        }

        if (remaining) {
          chunks.push(remaining);
        }

        return chunks;
      }

      function displayThread(chunks) {
        threadContainerEl.textContent = "";
        const charLimit = parseInt(charLimitEl.value, 10) || 280;

        for (let i = 0; i < chunks.length; i++) {
          const chunk = chunks[i];
          const card = document.createElement("div");
          card.className = "tweet-card";

          const header = document.createElement("div");
          header.className = "tweet-header";

          const number = document.createElement("span");
          number.className = "tweet-number";
          number.textContent = "Tweet " + (i + 1);

          const length = document.createElement("span");
          length.className = "tweet-length";
          if (chunk.length > charLimit) {
            length.classList.add("warning");
          }
          length.textContent = chunk.length + " / " + charLimit;

          header.appendChild(number);
          header.appendChild(length);

          const content = document.createElement("div");
          content.className = "tweet-content";
          content.textContent = chunk;

          const actions = document.createElement("div");
          actions.className = "tweet-actions";

          const copyBtn = document.createElement("button");
          copyBtn.className = "tweet-action";
          copyBtn.textContent = "å¤åˆ¶";
          copyBtn.addEventListener("click", function () {
            copyToClipboard(chunk);
          });

          actions.appendChild(copyBtn);

          card.appendChild(header);
          card.appendChild(content);
          card.appendChild(actions);
          threadContainerEl.appendChild(card);
        }
      }

      function updateStats(original, chunks) {
        document.getElementById("statTotal").textContent = original.length;
        document.getElementById("statTweets").textContent = chunks.length;
        const total = chunks.reduce(function (sum, c) {
          return sum + c.length;
        }, 0);
        document.getElementById("statAvg").textContent = Math.round(total / chunks.length);
        statsEl.style.display = "flex";
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(function () {
            showStatus("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success");
          })
          .catch(function () {
            showStatus("å¤åˆ¶å¤±è´¥", "error");
          });
      }

      function showStatus(msg, type) {
        statusEl.textContent = msg;
        statusEl.className = "status " + (type || "");
      }

      function saveToStorage() {
        const data = {
          input: inputEl.value,
          charLimit: charLimitEl.value,
          addNumbers: addNumbersEl.checked,
          smartBreak: smartBreakEl.checked,
          separator: separatorEl.value
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      }

      function loadFromStorage() {
        try {
          const saved = localStorage.getItem(LS_KEY);
          if (saved) {
            const data = JSON.parse(saved);
            if (data.input) inputEl.value = data.input;
            if (data.charLimit) charLimitEl.value = data.charLimit;
            if (typeof data.addNumbers === "boolean") addNumbersEl.checked = data.addNumbers;
            if (typeof data.smartBreak === "boolean") smartBreakEl.checked = data.smartBreak;
            if (data.separator) separatorEl.value = data.separator;
          }
        } catch (e) {}
      }

      function loadFromUrl() {
        const hash = location.hash.slice(1);
        if (!hash) return false;
        try {
          inputEl.value = decodeURIComponent(atob(hash));
          return true;
        } catch (e) {
          return false;
        }
      }

      document.getElementById("btnPaste").addEventListener("click", function () {
        navigator.clipboard
          .readText()
          .then(function (text) {
            inputEl.value = text;
            saveToStorage();
            showStatus("å·²ç²˜è´´", "success");
          })
          .catch(function () {
            showStatus("æ— æ³•è®¿é—®å‰ªè´´æ¿", "error");
          });
      });

      document.getElementById("btnSplit").addEventListener("click", splitText);

      document.getElementById("btnCopyAll").addEventListener("click", function () {
        const cards = threadContainerEl.querySelectorAll(".tweet-content");
        if (cards.length === 0) {
          showStatus("æ²¡æœ‰å†…å®¹å¯å¤åˆ¶", "error");
          return;
        }

        const allText = Array.from(cards)
          .map(function (c) {
            return c.textContent;
          })
          .join("\n\n---\n\n");

        copyToClipboard(allText);
      });

      document.getElementById("btnShare").addEventListener("click", function () {
        try {
          if (inputEl.value.length > 2000) {
            showStatus("æ–‡æœ¬è¿‡é•¿ï¼Œæ— æ³•åˆ†äº«", "error");
            return;
          }
          const encoded = btoa(encodeURIComponent(inputEl.value));
          history.replaceState(null, "", "#" + encoded);
          navigator.clipboard.writeText(location.href).then(function () {
            showStatus("é“¾æ¥å·²å¤åˆ¶", "success");
          });
        } catch (e) {
          showStatus("åˆ†äº«å¤±è´¥", "error");
        }
      });

      document.getElementById("btnClear").addEventListener("click", function () {
        inputEl.value = "";
        threadContainerEl.textContent = "";
        statsEl.style.display = "none";
        statusEl.textContent = "";
        statusEl.className = "status";
        localStorage.removeItem(LS_KEY);
        history.replaceState(null, "", location.pathname);
      });

      inputEl.addEventListener("input", function () {
        saveToStorage();
      });

      if (!loadFromUrl()) {
        loadFromStorage();
      }

      window.toggleTheme = function () {
        const html = document.documentElement;
        const btn = document.querySelector(".theme-toggle");
        const next = html.getAttribute("data-theme") === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        btn.textContent = next === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", next);
      };

      (function () {
        const saved = localStorage.getItem("theme");
        if (saved) {
          document.documentElement.setAttribute("data-theme", saved);
          const btn = document.querySelector(".theme-toggle");
          if (btn) btn.textContent = saved === "light" ? "â˜€ï¸" : "ğŸŒ™";
        }
      })();
    </script>
  </body>
</html>

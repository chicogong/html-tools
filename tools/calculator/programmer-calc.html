<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨‹åºå‘˜è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { min-height: 100vh; padding: 2rem 1rem; }
        .container { max-width: 700px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .display { background: var(--pico-muted-border-color); border-radius: var(--pico-border-radius); padding: 1rem; margin-bottom: 1rem; font-family: monospace; }
        .display-result { font-size: 1.8rem; font-weight: bold; word-break: break-all; }
        .base-displays { display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; font-size: 0.9rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--pico-muted-border-color); }
        .base-label { color: var(--pico-muted-color); font-weight: bold; }
        .base-value { font-family: monospace; word-break: break-all; cursor: pointer; }
        .base-value:hover { color: var(--pico-primary); }
        .btn-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; }
        .btn-grid button { padding: 0.75rem 0.5rem; font-size: 0.9rem; margin: 0; width: 100%; }
        .bit-display { display: grid; grid-template-columns: repeat(8, 1fr); gap: 2px; margin: 1rem 0; font-family: monospace; font-size: 0.8rem; }
        .bit-group { text-align: center; }
        .bit-group .bits { display: flex; gap: 1px; }
        .bit { background: var(--pico-muted-border-color); padding: 0.25rem; cursor: pointer; min-width: 1.2rem; text-align: center; }
        .bit.active { background: var(--pico-primary); color: var(--pico-primary-inverse); }
        .bit-index { font-size: 0.6rem; color: var(--pico-muted-color); }
        .base-selector { margin-bottom: 1rem; }
        .base-selector label { margin-right: 1rem; }
        .word-size { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç¨‹åºå‘˜è®¡ç®—å™¨</h1>
            <button id="themeToggle" class="outline" onclick="toggleTheme()">ğŸŒ™</button>
        </header>

        <div class="base-selector">
            <strong>è¿›åˆ¶ï¼š</strong>
            <label><input type="radio" name="base" value="16" onchange="setBase(16)"> HEX</label>
            <label><input type="radio" name="base" value="10" checked onchange="setBase(10)"> DEC</label>
            <label><input type="radio" name="base" value="8" onchange="setBase(8)"> OCT</label>
            <label><input type="radio" name="base" value="2" onchange="setBase(2)"> BIN</label>
        </div>

        <div class="word-size">
            <strong>ä½æ•°ï¼š</strong>
            <select id="wordSize" onchange="setWordSize(this.value)">
                <option value="8">8ä½ (BYTE)</option>
                <option value="16">16ä½ (WORD)</option>
                <option value="32" selected>32ä½ (DWORD)</option>
                <option value="64">64ä½ (QWORD)</option>
            </select>
        </div>

        <div class="display">
            <div class="display-result" id="result">0</div>
            <div class="base-displays">
                <span class="base-label">HEX:</span><span class="base-value" id="hexValue" onclick="copyToClipboard(this)">0</span>
                <span class="base-label">DEC:</span><span class="base-value" id="decValue" onclick="copyToClipboard(this)">0</span>
                <span class="base-label">OCT:</span><span class="base-value" id="octValue" onclick="copyToClipboard(this)">0</span>
                <span class="base-label">BIN:</span><span class="base-value" id="binValue" onclick="copyToClipboard(this)">0</span>
            </div>
        </div>

        <div class="bit-display" id="bitDisplay"></div>

        <div class="btn-grid">
            <button class="secondary hex-btn" onclick="inputValue('A')">A</button>
            <button class="secondary hex-btn" onclick="inputValue('B')">B</button>
            <button class="secondary hex-btn" onclick="inputValue('C')">C</button>
            <button class="secondary hex-btn" onclick="inputValue('D')">D</button>
            <button class="secondary hex-btn" onclick="inputValue('E')">E</button>
            <button class="secondary hex-btn" onclick="inputValue('F')">F</button>

            <button class="secondary" onclick="bitwiseOp('AND')">AND</button>
            <button class="secondary" onclick="bitwiseOp('OR')">OR</button>
            <button class="secondary" onclick="bitwiseOp('XOR')">XOR</button>
            <button class="secondary" onclick="bitwiseOp('NOT')">NOT</button>
            <button class="secondary" onclick="bitwiseOp('NAND')">NAND</button>
            <button class="secondary" onclick="bitwiseOp('NOR')">NOR</button>

            <button class="secondary" onclick="shiftOp('LSH')">LSH</button>
            <button class="secondary" onclick="shiftOp('RSH')">RSH</button>
            <button class="secondary" onclick="shiftOp('ROL')">ROL</button>
            <button class="secondary" onclick="shiftOp('ROR')">ROR</button>
            <button class="contrast" onclick="clearAll()">C</button>
            <button class="contrast" onclick="backspace()">âŒ«</button>

            <button onclick="inputValue('7')">7</button>
            <button onclick="inputValue('8')">8</button>
            <button onclick="inputValue('9')">9</button>
            <button class="secondary" onclick="inputOp('/')">Ã·</button>
            <button class="secondary" onclick="inputOp('%')">MOD</button>
            <button class="secondary" onclick="inputOp('(')">(</button>

            <button onclick="inputValue('4')">4</button>
            <button onclick="inputValue('5')">5</button>
            <button onclick="inputValue('6')">6</button>
            <button class="secondary" onclick="inputOp('*')">Ã—</button>
            <button class="secondary" onclick="toggleSign()">Â±</button>
            <button class="secondary" onclick="inputOp(')')">)</button>

            <button onclick="inputValue('1')">1</button>
            <button onclick="inputValue('2')">2</button>
            <button onclick="inputValue('3')">3</button>
            <button class="secondary" onclick="inputOp('-')">âˆ’</button>
            <button class="secondary" onclick="inputOp('+')">+</button>
            <button class="primary" onclick="calculate()">=</button>

            <button onclick="inputValue('0')">0</button>
            <button onclick="inputValue('00')">00</button>
            <button onclick="inputValue('FF')">FF</button>
            <button></button><button></button><button></button>
        </div>

        <article style="margin-top: 2rem;">
            <h4>ä½¿ç”¨è¯´æ˜</h4>
            <ul>
                <li><strong>è¿›åˆ¶è½¬æ¢</strong>ï¼šåœ¨ä¸åŒè¿›åˆ¶é—´å®æ—¶è½¬æ¢</li>
                <li><strong>ä½è¿ç®—</strong>ï¼šAND, OR, XOR, NOT, NAND, NOR</li>
                <li><strong>ç§»ä½æ“ä½œ</strong>ï¼šLSH(å·¦ç§»), RSH(å³ç§»), ROL(å¾ªç¯å·¦ç§»), ROR(å¾ªç¯å³ç§»)</li>
                <li><strong>ä½æ˜¾ç¤º</strong>ï¼šç‚¹å‡»ä½å¯ä»¥ç›´æ¥åˆ‡æ¢0/1</li>
            </ul>
        </article>
    </main>

    <script>
        let currentValue = 0n;
        let currentBase = 10;
        let wordSize = 32;
        let pendingOp = null;
        let storedValue = 0n;
        let inputBuffer = '';

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function setBase(base) {
            currentBase = base;
            updateHexButtons();
            updateDisplay();
        }

        function setWordSize(size) {
            wordSize = parseInt(size);
            currentValue = maskValue(currentValue);
            updateDisplay();
            renderBitDisplay();
        }

        function maskValue(value) {
            const mask = (1n << BigInt(wordSize)) - 1n;
            return value & mask;
        }

        function updateHexButtons() {
            document.querySelectorAll('.hex-btn').forEach(btn => { btn.disabled = currentBase < 16; });
            document.querySelectorAll('.btn-grid button').forEach(btn => {
                const text = btn.textContent;
                if (/^[0-9]$/.test(text)) btn.disabled = parseInt(text) >= currentBase;
            });
        }

        function updateDisplay() {
            const displayValue = currentBase === 10 ? inputBuffer || currentValue.toString(10) : inputBuffer || currentValue.toString(currentBase).toUpperCase();
            document.getElementById('result').textContent = displayValue;
            document.getElementById('hexValue').textContent = currentValue.toString(16).toUpperCase();
            document.getElementById('decValue').textContent = currentValue.toString(10);
            document.getElementById('octValue').textContent = currentValue.toString(8);
            document.getElementById('binValue').textContent = currentValue.toString(2).padStart(wordSize, '0');
            updateBitDisplay();
        }

        function renderBitDisplay() {
            const container = document.getElementById('bitDisplay');
            container.textContent = '';
            const groups = wordSize / 4;
            for (let g = groups - 1; g >= 0; g--) {
                const group = document.createElement('div');
                group.className = 'bit-group';
                const bits = document.createElement('div');
                bits.className = 'bits';
                for (let b = 3; b >= 0; b--) {
                    const bitIndex = g * 4 + b;
                    const bit = document.createElement('div');
                    bit.className = 'bit';
                    bit.dataset.index = bitIndex;
                    bit.onclick = () => toggleBit(bitIndex);
                    bits.appendChild(bit);
                }
                const index = document.createElement('div');
                index.className = 'bit-index';
                index.textContent = (g * 4 + 3) + '-' + (g * 4);
                group.appendChild(bits);
                group.appendChild(index);
                container.appendChild(group);
            }
            updateBitDisplay();
        }

        function updateBitDisplay() {
            for (let i = 0; i < wordSize; i++) {
                const bit = document.querySelector('.bit[data-index="' + i + '"]');
                if (bit) {
                    const isSet = (currentValue >> BigInt(i)) & 1n;
                    bit.textContent = isSet ? '1' : '0';
                    bit.classList.toggle('active', isSet === 1n);
                }
            }
        }

        function toggleBit(index) {
            currentValue ^= (1n << BigInt(index));
            currentValue = maskValue(currentValue);
            inputBuffer = '';
            updateDisplay();
        }

        function inputValue(val) {
            inputBuffer += val;
            try {
                currentValue = BigInt(parseInt(inputBuffer, currentBase));
                currentValue = maskValue(currentValue);
            } catch (e) { inputBuffer = inputBuffer.slice(0, -val.length); }
            updateDisplay();
        }

        function inputOp(op) {
            if (pendingOp) calculate();
            storedValue = currentValue;
            pendingOp = op;
            inputBuffer = '';
        }

        function bitwiseOp(op) {
            if (op === 'NOT') {
                currentValue = maskValue(~currentValue);
                inputBuffer = '';
                updateDisplay();
            } else {
                if (pendingOp) calculate();
                storedValue = currentValue;
                pendingOp = op;
                inputBuffer = '';
            }
        }

        function shiftOp(op) {
            if (pendingOp) calculate();
            storedValue = currentValue;
            pendingOp = op;
            inputBuffer = '';
        }

        function calculate() {
            if (!pendingOp) return;
            let result;
            const a = storedValue, b = currentValue;
            switch (pendingOp) {
                case '+': result = a + b; break;
                case '-': result = a - b; break;
                case '*': result = a * b; break;
                case '/': result = b !== 0n ? a / b : 0n; break;
                case '%': result = b !== 0n ? a % b : 0n; break;
                case 'AND': result = a & b; break;
                case 'OR': result = a | b; break;
                case 'XOR': result = a ^ b; break;
                case 'NAND': result = ~(a & b); break;
                case 'NOR': result = ~(a | b); break;
                case 'LSH': result = a << b; break;
                case 'RSH': result = a >> b; break;
                case 'ROL': { const shift = Number(b) % wordSize; result = ((a << BigInt(shift)) | (a >> BigInt(wordSize - shift))); break; }
                case 'ROR': { const shift = Number(b) % wordSize; result = ((a >> BigInt(shift)) | (a << BigInt(wordSize - shift))); break; }
                default: result = b;
            }
            currentValue = maskValue(result);
            pendingOp = null;
            inputBuffer = '';
            updateDisplay();
        }

        function clearAll() { currentValue = 0n; storedValue = 0n; pendingOp = null; inputBuffer = ''; updateDisplay(); }
        function backspace() {
            if (inputBuffer.length > 0) {
                inputBuffer = inputBuffer.slice(0, -1);
                currentValue = inputBuffer.length > 0 ? BigInt(parseInt(inputBuffer, currentBase)) : 0n;
                currentValue = maskValue(currentValue);
                updateDisplay();
            }
        }
        function toggleSign() { currentValue = maskValue(-currentValue); inputBuffer = ''; updateDisplay(); }
        function copyToClipboard(element) { navigator.clipboard.writeText(element.textContent); }

        document.addEventListener('keydown', function(e) {
            const key = e.key.toUpperCase();
            if (/^[0-9]$/.test(key) && parseInt(key) < currentBase) inputValue(key);
            else if (/^[A-F]$/.test(key) && currentBase === 16) inputValue(key);
            else if (e.key === '+') inputOp('+');
            else if (e.key === '-') inputOp('-');
            else if (e.key === '*') inputOp('*');
            else if (e.key === '/') inputOp('/');
            else if (e.key === '%') inputOp('%');
            else if (e.key === 'Enter' || e.key === '=') calculate();
            else if (e.key === 'Escape') clearAll();
            else if (e.key === 'Backspace') backspace();
        });

        loadTheme();
        renderBitDisplay();
        updateHexButtons();
        updateDisplay();
    </script>
</body>
</html>

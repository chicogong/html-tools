<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils" />
    <meta name="keywords" content="typing-test,text,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/text/typing-test.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils" />
    <meta property="og:description" content="æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/text/typing-test.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils" />
    <meta name="twitter:description" content="æ‰“å­—é€Ÿåº¦æµ‹è¯• - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --primary-color: #e67e22;
        --correct-color: #27ae60;
        --error-color: #e74c3c;
        --current-color: #3498db;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      h1 {
        margin-bottom: 0;
        color: var(--primary-color);
      }

      .theme-toggle {
        cursor: pointer;
        background: none;
        border: 2px solid var(--pico-muted-border-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .settings-bar {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
        align-items: center;
      }

      .settings-bar label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .stat-card {
        background: var(--pico-card-background-color);
        border: 1px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        padding: 1rem;
        text-align: center;
      }

      .stat-card .value {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .stat-card .label {
        font-size: 0.8rem;
        color: var(--pico-muted-color);
      }

      .typing-area {
        background: var(--pico-card-background-color);
        border: 2px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
      }

      .sample-text {
        font-size: 1.2rem;
        line-height: 2;
        margin-bottom: 1rem;
        user-select: none;
        word-break: break-all;
      }

      .sample-text .char {
        transition: all 0.1s;
      }

      .sample-text .char.correct {
        color: var(--correct-color);
      }

      .sample-text .char.error {
        color: var(--error-color);
        text-decoration: underline;
      }

      .sample-text .char.current {
        background: var(--current-color);
        color: white;
        border-radius: 2px;
      }

      .sample-text .char.pending {
        color: var(--pico-muted-color);
      }

      .input-area {
        position: relative;
      }

      #typing-input {
        width: 100%;
        font-size: 1.1rem;
        padding: 1rem;
      }

      .btn-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin: 1rem 0;
      }

      .progress-bar {
        height: 8px;
        background: var(--pico-muted-border-color);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 1rem;
      }

      .progress-bar-inner {
        height: 100%;
        background: var(--primary-color);
        transition: width 0.3s;
        border-radius: 4px;
      }

      .timer {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1rem;
        color: var(--primary-color);
      }

      .timer.warning {
        color: var(--error-color);
      }

      .result-panel {
        background: var(--pico-card-background-color);
        border: 2px solid var(--correct-color);
        border-radius: var(--pico-border-radius);
        padding: 2rem;
        text-align: center;
        display: none;
      }

      .result-panel.show {
        display: block;
      }

      .result-panel h2 {
        color: var(--correct-color);
        margin-bottom: 1rem;
      }

      .result-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .result-stat {
        padding: 1rem;
        background: var(--pico-background-color);
        border-radius: var(--pico-border-radius);
      }

      .result-stat .value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .result-stat .label {
        font-size: 0.85rem;
        color: var(--pico-muted-color);
      }

      .history-panel {
        margin-top: 2rem;
      }

      .history-list {
        max-height: 200px;
        overflow-y: auto;
      }

      .history-item {
        display: grid;
        grid-template-columns: 1fr repeat(4, auto);
        gap: 1rem;
        padding: 0.5rem;
        border-bottom: 1px solid var(--pico-muted-border-color);
        font-size: 0.9rem;
      }

      .history-item:last-child {
        border-bottom: none;
      }

      footer {
        text-align: center;
        margin-top: 3rem;
        padding-top: 1rem;
        border-top: 1px solid var(--pico-muted-border-color);
        color: var(--pico-muted-color);
      }

      .keyboard-hint {
        text-align: center;
        color: var(--pico-muted-color);
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      æ‰“å­—é€Ÿåº¦æµ‹è¯•
    </nav>
    <main class="container">
      <header>
        <h1>æ‰“å­—é€Ÿåº¦æµ‹è¯•</h1>
        <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
          <span id="theme-icon">ğŸŒ™</span>
        </button>
      </header>

      <article>
        <div class="settings-bar">
          <label>
            æ–‡æœ¬ç±»å‹:
            <select id="text-type" onchange="loadSampleText()">
              <option value="chinese">ä¸­æ–‡</option>
              <option value="english">è‹±æ–‡</option>
              <option value="mixed">ä¸­è‹±æ··åˆ</option>
              <option value="code">ä»£ç </option>
              <option value="custom">è‡ªå®šä¹‰</option>
            </select>
          </label>
          <label>
            æµ‹è¯•æ—¶é•¿:
            <select id="test-duration">
              <option value="30">30ç§’</option>
              <option value="60" selected>60ç§’</option>
              <option value="120">120ç§’</option>
              <option value="300">5åˆ†é’Ÿ</option>
            </select>
          </label>
          <label>
            <input type="checkbox" id="show-keyboard" />
            é”®ç›˜æç¤º
          </label>
        </div>

        <!-- å®æ—¶ç»Ÿè®¡ -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="value" id="live-wpm">0</div>
            <div class="label">WPM (æ¯åˆ†é’Ÿè¯æ•°)</div>
          </div>
          <div class="stat-card">
            <div class="value" id="live-cpm">0</div>
            <div class="label">CPM (æ¯åˆ†é’Ÿå­—ç¬¦)</div>
          </div>
          <div class="stat-card">
            <div class="value" id="live-accuracy">100%</div>
            <div class="label">å‡†ç¡®ç‡</div>
          </div>
          <div class="stat-card">
            <div class="value" id="live-errors">0</div>
            <div class="label">é”™è¯¯æ•°</div>
          </div>
        </div>

        <!-- å€’è®¡æ—¶ -->
        <div class="timer" id="timer">60</div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar">
          <div class="progress-bar-inner" id="progress-bar" style="width: 0%"></div>
        </div>

        <!-- æ‰“å­—åŒºåŸŸ -->
        <div class="typing-area" id="typing-area">
          <div class="sample-text" id="sample-text"></div>
          <div class="input-area">
            <input
              type="text"
              id="typing-input"
              placeholder="ç‚¹å‡»æ­¤å¤„å¼€å§‹æ‰“å­—..."
              autocomplete="off"
              autocorrect="off"
              autocapitalize="off"
              spellcheck="false"
            />
          </div>
          <p class="keyboard-hint" id="keyboard-hint"></p>
        </div>

        <div class="btn-group">
          <button onclick="startTest()" id="start-btn">å¼€å§‹æµ‹è¯•</button>
          <button onclick="resetTest()" class="secondary">é‡æ–°å¼€å§‹</button>
          <button onclick="loadSampleText()" class="outline">æ¢ä¸€æ®µæ–‡æœ¬</button>
        </div>

        <!-- ç»“æœé¢æ¿ -->
        <div class="result-panel" id="result-panel">
          <h2>æµ‹è¯•å®Œæˆ!</h2>
          <div class="result-stats">
            <div class="result-stat">
              <div class="value" id="result-wpm">0</div>
              <div class="label">WPM</div>
            </div>
            <div class="result-stat">
              <div class="value" id="result-cpm">0</div>
              <div class="label">CPM</div>
            </div>
            <div class="result-stat">
              <div class="value" id="result-accuracy">0%</div>
              <div class="label">å‡†ç¡®ç‡</div>
            </div>
            <div class="result-stat">
              <div class="value" id="result-chars">0</div>
              <div class="label">æ€»å­—ç¬¦</div>
            </div>
            <div class="result-stat">
              <div class="value" id="result-correct">0</div>
              <div class="label">æ­£ç¡®å­—ç¬¦</div>
            </div>
            <div class="result-stat">
              <div class="value" id="result-errors">0</div>
              <div class="label">é”™è¯¯å­—ç¬¦</div>
            </div>
          </div>
          <button onclick="resetTest()">å†æ¥ä¸€æ¬¡</button>
        </div>

        <!-- å†å²è®°å½• -->
        <details class="history-panel">
          <summary>å†å²è®°å½•</summary>
          <div class="history-list" id="history-list">
            <p style="color: var(--pico-muted-color); text-align: center">æš‚æ— å†å²è®°å½•</p>
          </div>
        </details>
      </article>

      <footer>
        <p>æ‰“å­—é€Ÿåº¦æµ‹è¯• - çº¯å®¢æˆ·ç«¯è¿è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨æœ¬åœ°</p>
      </footer>
    </main>

    <script>
      // ç¤ºä¾‹æ–‡æœ¬åº“
      const sampleTexts = {
        chinese: [
          "ç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”ï¼Œè¿˜æœ‰è¯—å’Œè¿œæ–¹çš„ç”°é‡ã€‚ä½ èµ¤æ‰‹ç©ºæ‹³æ¥åˆ°äººä¸–é—´ï¼Œä¸ºäº†æ‰¾åˆ°é‚£ç‰‡æµ·ä¸é¡¾ä¸€åˆ‡ã€‚",
          "æ—¶é—´å°±åƒæµ·ç»µé‡Œçš„æ°´ï¼Œåªè¦æ„¿æ„æŒ¤ï¼Œæ€»è¿˜æ˜¯æœ‰çš„ã€‚é²è¿…å…ˆç”Ÿçš„è¿™å¥è¯æ¿€åŠ±äº†æ— æ•°äººçæƒœæ—¶é—´ã€‚",
          "äººç”Ÿè‹¥åªå¦‚åˆè§ï¼Œä½•äº‹ç§‹é£æ‚²ç”»æ‰‡ã€‚ç­‰é—²å˜å´æ•…äººå¿ƒï¼Œå´é“æ•…äººå¿ƒæ˜“å˜ã€‚éªŠå±±è¯­ç½¢æ¸…å®µåŠã€‚",
          "è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²ã€‚æ¸”èˆŸå”±æ™šï¼Œå“ç©·å½­è ¡ä¹‹æ»¨ï¼›é›é˜µæƒŠå¯’ï¼Œå£°æ–­è¡¡é˜³ä¹‹æµ¦ã€‚",
          "å¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯ã€‚åœ°åŠ¿å¤ï¼Œå›å­ä»¥åšå¾·è½½ç‰©ã€‚è¿™æ˜¯ä¸­åæ°‘æ—çš„ç²¾ç¥æ ¸å¿ƒæ‰€åœ¨ã€‚"
        ],
        english: [
          "The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs. How vexingly quick daft zebras jump!",
          "To be or not to be, that is the question. Whether it is nobler in the mind to suffer the slings and arrows of outrageous fortune.",
          "In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face.",
          "It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness.",
          "All human beings are born free and equal in dignity and rights. They are endowed with reason and conscience."
        ],
        mixed: [
          "ä»Šå¤©çš„weatherå¾ˆå¥½ï¼Œé€‚åˆå‡ºå»walkingã€‚Let us go to the parkï¼Œäº«å—è¿™ç¾å¥½çš„sunshineå§ï¼",
          "Programmingç¼–ç¨‹æ˜¯ä¸€é—¨artè‰ºæœ¯ï¼Œéœ€è¦ä¸æ–­practiceç»ƒä¹ æ‰èƒ½masteræŒæ¡ã€‚Keep codingæ¯å¤©è¿›æ­¥ï¼",
          "åœ¨è¿™ä¸ªdigitalæ•°å­—æ—¶ä»£ï¼Œå­¦ä¹ new skillsæ–°æŠ€èƒ½å˜å¾—è¶Šæ¥è¶Šimportanté‡è¦ã€‚Never stop learningï¼",
          "Good morningæ—©ä¸Šå¥½ï¼ä»Šå¤©æ˜¯wonderfulç¾å¥½çš„ä¸€å¤©ã€‚Let us startå¼€å§‹æˆ‘ä»¬çš„journeyæ—…ç¨‹å§ï¼",
          "The Internetäº’è”ç½‘æ”¹å˜äº†æˆ‘ä»¬çš„lifeç”Ÿæ´»æ–¹å¼ã€‚We can learnå­¦ä¹ anythingä»»ä½•ä¸œè¥¿onlineåœ¨çº¿ä¸Šã€‚"
        ],
        code: [
          'function hello() { console.log("Hello, World!"); return true; }',
          "const arr = [1, 2, 3, 4, 5]; const sum = arr.reduce((a, b) => a + b, 0);",
          "for (let i = 0; i < 10; i++) { if (i % 2 === 0) { console.log(i); } }",
          "class Person { constructor(name) { this.name = name; } sayHello() { return `Hi, ${this.name}`; } }",
          "const fetchData = async (url) => { const response = await fetch(url); return response.json(); };"
        ]
      };

      // çŠ¶æ€å˜é‡
      let currentText = "";
      let currentPosition = 0;
      let startTime = null;
      let endTime = null;
      let timerInterval = null;
      let isRunning = false;
      let correctChars = 0;
      let errorChars = 0;
      let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");

      // åŠ è½½ç¤ºä¾‹æ–‡æœ¬
      function loadSampleText() {
        const type = document.getElementById("text-type").value;

        if (type === "custom") {
          currentText = prompt("è¯·è¾“å…¥è‡ªå®šä¹‰æ–‡æœ¬:", "") || "";
          if (!currentText) {
            document.getElementById("text-type").value = "chinese";
            loadSampleText();
            return;
          }
        } else {
          const texts = sampleTexts[type];
          currentText = texts[Math.floor(Math.random() * texts.length)];
        }

        renderSampleText();
        resetTest();
      }

      // æ¸²æŸ“ç¤ºä¾‹æ–‡æœ¬
      function renderSampleText() {
        const container = document.getElementById("sample-text");
        container.textContent = "";

        currentText.split("").forEach((char, index) => {
          const span = document.createElement("span");
          span.className = "char" + (index === 0 ? " current" : " pending");
          span.textContent = char;
          span.dataset.index = index;
          container.appendChild(span);
        });
      }

      // å¼€å§‹æµ‹è¯•
      function startTest() {
        if (isRunning) return;

        isRunning = true;
        startTime = Date.now();
        currentPosition = 0;
        correctChars = 0;
        errorChars = 0;

        const duration = parseInt(document.getElementById("test-duration").value);
        let timeLeft = duration;

        document.getElementById("timer").textContent = timeLeft;
        document.getElementById("timer").classList.remove("warning");
        document.getElementById("typing-input").focus();
        document.getElementById("typing-input").value = "";
        document.getElementById("start-btn").disabled = true;
        document.getElementById("result-panel").classList.remove("show");

        renderSampleText();

        timerInterval = setInterval(() => {
          timeLeft--;
          document.getElementById("timer").textContent = timeLeft;

          if (timeLeft <= 10) {
            document.getElementById("timer").classList.add("warning");
          }

          // æ›´æ–°è¿›åº¦
          const progress = ((duration - timeLeft) / duration) * 100;
          document.getElementById("progress-bar").style.width = progress + "%";

          if (timeLeft <= 0) {
            endTest();
          }
        }, 1000);
      }

      // ç»“æŸæµ‹è¯•
      function endTest() {
        if (!isRunning) return;

        isRunning = false;
        endTime = Date.now();
        clearInterval(timerInterval);

        // è®¡ç®—ç»“æœ
        const duration = (endTime - startTime) / 1000 / 60; // åˆ†é’Ÿ
        const totalChars = correctChars + errorChars;
        const wpm = Math.round(correctChars / 5 / duration); // æ ‡å‡†: 5å­—ç¬¦=1è¯
        const cpm = Math.round(correctChars / duration);
        const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 0;

        // æ˜¾ç¤ºç»“æœ
        document.getElementById("result-wpm").textContent = wpm;
        document.getElementById("result-cpm").textContent = cpm;
        document.getElementById("result-accuracy").textContent = accuracy + "%";
        document.getElementById("result-chars").textContent = totalChars;
        document.getElementById("result-correct").textContent = correctChars;
        document.getElementById("result-errors").textContent = errorChars;
        document.getElementById("result-panel").classList.add("show");

        // ä¿å­˜å†å²
        saveHistory({
          date: new Date().toLocaleString(),
          wpm: wpm,
          cpm: cpm,
          accuracy: accuracy,
          type: document.getElementById("text-type").value
        });

        document.getElementById("start-btn").disabled = false;
      }

      // é‡ç½®æµ‹è¯•
      function resetTest() {
        isRunning = false;
        clearInterval(timerInterval);
        startTime = null;
        endTime = null;
        currentPosition = 0;
        correctChars = 0;
        errorChars = 0;

        const duration = document.getElementById("test-duration").value;
        document.getElementById("timer").textContent = duration;
        document.getElementById("timer").classList.remove("warning");
        document.getElementById("progress-bar").style.width = "0%";
        document.getElementById("typing-input").value = "";
        document.getElementById("start-btn").disabled = false;
        document.getElementById("result-panel").classList.remove("show");

        // é‡ç½®ç»Ÿè®¡
        document.getElementById("live-wpm").textContent = "0";
        document.getElementById("live-cpm").textContent = "0";
        document.getElementById("live-accuracy").textContent = "100%";
        document.getElementById("live-errors").textContent = "0";

        renderSampleText();
      }

      // å¤„ç†è¾“å…¥
      document.getElementById("typing-input").addEventListener("input", function (e) {
        if (!isRunning) {
          startTest();
        }

        const inputValue = this.value;
        const chars = document.querySelectorAll(".sample-text .char");

        // æ£€æŸ¥è¾“å…¥çš„æ¯ä¸ªå­—ç¬¦
        for (let i = 0; i < inputValue.length && i < currentText.length; i++) {
          const char = chars[i];
          char.classList.remove("current", "pending");

          if (inputValue[i] === currentText[i]) {
            char.classList.add("correct");
            if (i >= currentPosition) {
              correctChars++;
            }
          } else {
            char.classList.add("error");
            if (i >= currentPosition) {
              errorChars++;
            }
          }
        }

        currentPosition = inputValue.length;

        // æ ‡è®°å½“å‰ä½ç½®
        if (currentPosition < chars.length) {
          chars[currentPosition].classList.add("current");
          chars[currentPosition].classList.remove("pending");

          // é”®ç›˜æç¤º
          if (document.getElementById("show-keyboard").checked) {
            document.getElementById("keyboard-hint").textContent =
              "ä¸‹ä¸€ä¸ªå­—ç¬¦: " + currentText[currentPosition];
          }
        }

        // é‡ç½®åç»­å­—ç¬¦çŠ¶æ€
        for (let i = currentPosition + 1; i < chars.length; i++) {
          chars[i].classList.remove("correct", "error", "current");
          chars[i].classList.add("pending");
        }

        // æ›´æ–°å®æ—¶ç»Ÿè®¡
        updateLiveStats();

        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
        if (currentPosition >= currentText.length) {
          endTest();
        }
      });

      // æ›´æ–°å®æ—¶ç»Ÿè®¡
      function updateLiveStats() {
        if (!startTime) return;

        const duration = (Date.now() - startTime) / 1000 / 60; // åˆ†é’Ÿ
        const totalChars = correctChars + errorChars;

        const wpm = duration > 0 ? Math.round(correctChars / 5 / duration) : 0;
        const cpm = duration > 0 ? Math.round(correctChars / duration) : 0;
        const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;

        document.getElementById("live-wpm").textContent = wpm;
        document.getElementById("live-cpm").textContent = cpm;
        document.getElementById("live-accuracy").textContent = accuracy + "%";
        document.getElementById("live-errors").textContent = errorChars;
      }

      // ä¿å­˜å†å²
      function saveHistory(record) {
        history.unshift(record);
        if (history.length > 50) history.pop();
        localStorage.setItem("typingHistory", JSON.stringify(history));
        updateHistoryList();
      }

      // æ›´æ–°å†å²åˆ—è¡¨
      function updateHistoryList() {
        const container = document.getElementById("history-list");
        container.textContent = "";

        if (history.length === 0) {
          const p = document.createElement("p");
          p.style.color = "var(--pico-muted-color)";
          p.style.textAlign = "center";
          p.textContent = "æš‚æ— å†å²è®°å½•";
          container.appendChild(p);
          return;
        }

        history.slice(0, 20).forEach((record) => {
          const item = document.createElement("div");
          item.className = "history-item";

          const dateSpan = document.createElement("span");
          dateSpan.textContent = record.date;

          const typeSpan = document.createElement("span");
          typeSpan.textContent = record.type;

          const wpmSpan = document.createElement("span");
          wpmSpan.textContent = record.wpm + " WPM";

          const cpmSpan = document.createElement("span");
          cpmSpan.textContent = record.cpm + " CPM";

          const accSpan = document.createElement("span");
          accSpan.textContent = record.accuracy + "%";

          item.appendChild(dateSpan);
          item.appendChild(typeSpan);
          item.appendChild(wpmSpan);
          item.appendChild(cpmSpan);
          item.appendChild(accSpan);

          container.appendChild(item);
        });
      }

      // ä¸»é¢˜åˆ‡æ¢
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "ğŸŒ™" : "â˜€ï¸";
        localStorage.setItem("theme", newTheme);
      };

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        // åˆå§‹åŒ–ä¸»é¢˜
        const savedTheme = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", savedTheme);
        document.getElementById("theme-icon").textContent = savedTheme === "light" ? "ğŸŒ™" : "â˜€ï¸";

        // åŠ è½½ç¤ºä¾‹æ–‡æœ¬
        loadSampleText();

        // æ›´æ–°å†å²
        updateHistoryList();
      });

      // é˜²æ­¢ç²˜è´´
      document.getElementById("typing-input").addEventListener("paste", function (e) {
        e.preventDefault();
      });

      // é”®ç›˜å¿«æ·é”®
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          resetTest();
        }
      });
    </script>
  </body>
</html>

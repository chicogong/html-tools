<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punycode è½¬æ¢å™¨ | HTML Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --primary: #06b6d4; }
        body { padding: 1rem; }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        h1 { margin: 0; font-size: 1.5rem; }
        .panel { background: var(--pico-card-background-color); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        textarea { width: 100%; min-height: 120px; font-family: monospace; resize: vertical; }
        .btn-row { display: flex; gap: 0.5rem; margin: 1rem 0; justify-content: center; }
        .btn-row button { padding: 0.5rem 1.5rem; }
        .arrow { font-size: 1.5rem; color: var(--pico-muted-color); }
        .examples { margin-top: 1rem; }
        .examples h3 { font-size: 1rem; margin-bottom: 0.5rem; }
        .example-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .example-btn { padding: 0.25rem 0.75rem; font-size: 0.85rem; background: var(--pico-muted-border-color); border: none; border-radius: 4px; cursor: pointer; }
        .example-btn:hover { background: var(--primary); color: white; }
        .info { padding: 1rem; background: rgba(6,182,212,0.1); border-radius: 6px; font-size: 0.9rem; }
        .info h4 { margin: 0 0 0.5rem; font-size: 0.95rem; }
        .info p { margin: 0; color: var(--pico-muted-color); }
        .result-info { margin-top: 0.5rem; font-size: 0.85rem; color: var(--pico-muted-color); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ Punycode è½¬æ¢å™¨</h1>
            <button id="themeToggle" class="outline">ğŸŒ™</button>
        </header>

        <div class="panel">
            <div class="grid">
                <div class="input-group">
                    <label>Unicode åŸŸå (ä¸­æ–‡/å›½é™…åŒ–)</label>
                    <textarea id="unicodeInput" placeholder="ä¾‹å¦‚: ä¸­æ–‡.com æˆ– mÃ¼nchen.de">ä¸­æ–‡åŸŸå.ä¸­å›½</textarea>
                    <div class="result-info" id="unicodeInfo"></div>
                </div>
                <div class="input-group">
                    <label>Punycode (ASCII)</label>
                    <textarea id="punycodeInput" placeholder="ä¾‹å¦‚: xn--fiq228c.com"></textarea>
                    <div class="result-info" id="punycodeInfo"></div>
                </div>
            </div>
            <div class="btn-row">
                <button onclick="toPunycode()">è½¬ä¸º Punycode â†’</button>
                <button onclick="toUnicode()">â† è½¬ä¸º Unicode</button>
                <button onclick="copyResult()" class="outline">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
            </div>
        </div>

        <div class="panel examples">
            <h3>ç¤ºä¾‹åŸŸå</h3>
            <div class="example-list">
                <button class="example-btn" data-unicode="ä¸­æ–‡.com">ä¸­æ–‡.com</button>
                <button class="example-btn" data-unicode="åŒ—äº¬.ä¸­å›½">åŒ—äº¬.ä¸­å›½</button>
                <button class="example-btn" data-unicode="mÃ¼nchen.de">mÃ¼nchen.de</button>
                <button class="example-btn" data-unicode="æ—¥æœ¬èª.jp">æ—¥æœ¬èª.jp</button>
                <button class="example-btn" data-unicode="í•œêµ­.kr">í•œêµ­.kr</button>
                <button class="example-btn" data-unicode="Ğ¼Ğ¾ÑĞºĞ²Ğ°.Ñ€Ñ„">Ğ¼Ğ¾ÑĞºĞ²Ğ°.Ñ€Ñ„</button>
                <button class="example-btn" data-unicode="Î±Î²Î³.ÎµÎ»">Î±Î²Î³.ÎµÎ»</button>
                <button class="example-btn" data-unicode="Ù…Ø«Ø§Ù„.Ù…ØµØ±">Ù…Ø«Ø§Ù„.Ù…ØµØ±</button>
            </div>
        </div>

        <div class="panel info">
            <h4>ä»€ä¹ˆæ˜¯ Punycodeï¼Ÿ</h4>
            <p>Punycode æ˜¯ä¸€ç§å°† Unicode å­—ç¬¦ç¼–ç ä¸º ASCII çš„æ–¹æ³•ï¼Œä¸»è¦ç”¨äºå›½é™…åŒ–åŸŸå (IDN)ã€‚ç”±äº DNS ç³»ç»Ÿåªæ”¯æŒ ASCII å­—ç¬¦ï¼Œå› æ­¤ä¸­æ–‡ã€æ—¥æ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ç­‰é ASCII åŸŸåéœ€è¦è½¬æ¢ä¸º Punycode æ ¼å¼ï¼ˆä»¥ xn-- å¼€å¤´ï¼‰æ‰èƒ½åœ¨ DNS ä¸­ä½¿ç”¨ã€‚</p>
        </div>
    </div>

    <script>
        // Punycode implementation
        const punycode = {
            base: 36, tmin: 1, tmax: 26, skew: 38, damp: 700, initialBias: 72, initialN: 128, delimiter: '-',
            
            decode(input) {
                const output = [];
                let i = 0, n = this.initialN, bias = this.initialBias;
                let basic = input.lastIndexOf(this.delimiter);
                if (basic < 0) basic = 0;
                for (let j = 0; j < basic; ++j) {
                    output.push(input.charCodeAt(j));
                }
                for (let index = basic > 0 ? basic + 1 : 0; index < input.length;) {
                    let oldi = i;
                    for (let w = 1, k = this.base; ; k += this.base) {
                        const digit = this.digitToBasic(input.charCodeAt(index++));
                        i += digit * w;
                        const t = k <= bias ? this.tmin : k >= bias + this.tmax ? this.tmax : k - bias;
                        if (digit < t) break;
                        w *= this.base - t;
                    }
                    const out = output.length + 1;
                    bias = this.adapt(i - oldi, out, oldi === 0);
                    n += Math.floor(i / out);
                    i %= out;
                    output.splice(i++, 0, n);
                }
                return String.fromCodePoint(...output);
            },
            
            encode(input) {
                const output = [];
                input = [...input].map(c => c.codePointAt(0));
                let n = this.initialN, delta = 0, bias = this.initialBias;
                for (const c of input) if (c < 128) output.push(String.fromCharCode(c));
                const basicLength = output.length;
                let handledCPCount = basicLength;
                if (basicLength) output.push(this.delimiter);
                while (handledCPCount < input.length) {
                    let m = Infinity;
                    for (const c of input) if (c >= n && c < m) m = c;
                    delta += (m - n) * (handledCPCount + 1);
                    n = m;
                    for (const c of input) {
                        if (c < n) ++delta;
                        if (c === n) {
                            let q = delta;
                            for (let k = this.base; ; k += this.base) {
                                const t = k <= bias ? this.tmin : k >= bias + this.tmax ? this.tmax : k - bias;
                                if (q < t) break;
                                output.push(String.fromCharCode(this.basicToDigit(t + (q - t) % (this.base - t))));
                                q = Math.floor((q - t) / (this.base - t));
                            }
                            output.push(String.fromCharCode(this.basicToDigit(q)));
                            bias = this.adapt(delta, handledCPCount + 1, handledCPCount === basicLength);
                            delta = 0;
                            ++handledCPCount;
                        }
                    }
                    ++delta; ++n;
                }
                return output.join('');
            },
            
            adapt(delta, numPoints, firstTime) {
                delta = firstTime ? Math.floor(delta / this.damp) : delta >> 1;
                delta += Math.floor(delta / numPoints);
                let k = 0;
                while (delta > ((this.base - this.tmin) * this.tmax) >> 1) {
                    delta = Math.floor(delta / (this.base - this.tmin));
                    k += this.base;
                }
                return Math.floor(k + (this.base - this.tmin + 1) * delta / (delta + this.skew));
            },
            
            digitToBasic(cp) {
                return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : this.base;
            },
            
            basicToDigit(digit) {
                return digit + 22 + 75 * (digit < 26);
            }
        };

        function domainToPunycode(domain) {
            return domain.split('.').map(label => {
                if (/[^\x00-\x7F]/.test(label)) {
                    return 'xn--' + punycode.encode(label);
                }
                return label;
            }).join('.');
        }

        function domainToUnicode(domain) {
            return domain.split('.').map(label => {
                if (label.toLowerCase().startsWith('xn--')) {
                    try {
                        return punycode.decode(label.slice(4));
                    } catch (e) {
                        return label;
                    }
                }
                return label;
            }).join('.');
        }

        function toPunycode() {
            const input = document.getElementById('unicodeInput').value.trim();
            if (!input) return;
            const result = domainToPunycode(input);
            document.getElementById('punycodeInput').value = result;
            updateInfo();
        }

        window.toUnicode = function() {
            const input = document.getElementById('punycodeInput').value.trim();
            if (!input) return;
            const result = domainToUnicode(input);
            document.getElementById('unicodeInput').value = result;
            updateInfo();
        };

        function updateInfo() {
            const unicode = document.getElementById('unicodeInput').value;
            const puny = document.getElementById('punycodeInput').value;
            document.getElementById('unicodeInfo').textContent = unicode ? `å­—ç¬¦æ•°: ${[...unicode].length}` : '';
            document.getElementById('punycodeInfo').textContent = puny ? `é•¿åº¦: ${puny.length} å­—ç¬¦` : '';
        }

        window.copyResult = function() {
            const puny = document.getElementById('punycodeInput').value;
            if (puny) {
                navigator.clipboard.writeText(puny);
                event.target.textContent = 'âœ“ å·²å¤åˆ¶';
                setTimeout(() => event.target.textContent = 'ğŸ“‹ å¤åˆ¶ç»“æœ', 2000);
            }
        };

        // Example buttons
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.onclick = () => {
                document.getElementById('unicodeInput').value = btn.dataset.unicode;
                toPunycode();
            };
        });

        // Auto convert on input
        document.getElementById('unicodeInput').addEventListener('input', () => {
            clearTimeout(window.convertTimeout);
            window.convertTimeout = setTimeout(toPunycode, 300);
        });

        // Theme toggle
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
        document.getElementById('themeToggle').textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        document.getElementById('themeToggle').onclick = () => {
            const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            document.getElementById('themeToggle').textContent = next === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        };

        // Initial conversion
        toPunycode();
    </script>
</body>
</html>

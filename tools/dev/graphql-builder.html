<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL æŸ¥è¯¢æ„å»ºå™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { padding: 1rem; }
        .container { max-width: 1600px; }
        .grid-layout {
            display: grid;
            grid-template-columns: 300px 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 1200px) {
            .grid-layout {
                grid-template-columns: 1fr 1fr;
            }
            .schema-panel { display: none; }
        }
        @media (max-width: 768px) {
            .grid-layout { grid-template-columns: 1fr; }
        }
        .field-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: var(--pico-border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .field-item:hover {
            background: var(--pico-primary-focus);
        }
        .field-item.selected {
            background: var(--pico-primary-background);
        }
        .field-type {
            font-size: 0.75rem;
            color: var(--pico-muted-color);
            margin-left: auto;
        }
        .nested-fields {
            margin-left: 1.5rem;
            border-left: 2px solid var(--pico-muted-border-color);
            padding-left: 0.5rem;
        }
        pre {
            background: var(--pico-code-background-color);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            overflow-x: auto;
            font-size: 0.85rem;
            tab-size: 2;
        }
        .query-output {
            min-height: 300px;
            max-height: 50vh;
        }
        .variables-output {
            min-height: 100px;
            max-height: 200px;
        }
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
        .output-section { position: sticky; top: 1rem; }
        .template-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        details { margin-bottom: 0.5rem; }
        .arg-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        .arg-row input, .arg-row select { margin-bottom: 0; }
        .type-badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            background: var(--pico-secondary-background);
        }
        .type-badge.query { background: #4CAF50; color: white; }
        .type-badge.mutation { background: #FF9800; color: white; }
        .type-badge.subscription { background: #2196F3; color: white; }
        .operation-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .operation-tabs button {
            flex: 1;
        }
        .operation-tabs button.active {
            background: var(--pico-primary);
            color: white;
        }
        .schema-type {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
        }
        .schema-type h5 {
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .field-checkbox {
            width: auto;
            margin: 0;
        }
        .alias-input {
            width: 80px;
            font-size: 0.8rem;
            padding: 0.2rem 0.4rem;
        }
    </style>
</head>
<body>
    <button class="theme-toggle outline" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
    
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <h1>ğŸ”® GraphQL æŸ¥è¯¢æ„å»ºå™¨</h1>
        <p>å¯è§†åŒ–æ„å»º GraphQL Queryã€Mutation å’Œ Subscription</p>

        <div class="grid-layout">
            <!-- Schema Panel -->
            <section class="schema-panel">
                <article>
                    <header>
                        <h3>Schema å®šä¹‰</h3>
                    </header>
                    <label>
                        ç²˜è´´ Schema (SDL)
                        <textarea id="schemaInput" rows="10" placeholder="type User {
  id: ID!
  name: String!
  email: String
  posts: [Post!]!
}

type Post {
  id: ID!
  title: String!
  content: String
  author: User!
}

type Query {
  user(id: ID!): User
  users: [User!]!
  post(id: ID!): Post
  posts(limit: Int): [Post!]!
}

type Mutation {
  createUser(name: String!, email: String): User!
  createPost(title: String!, content: String, authorId: ID!): Post!
}"></textarea>
                    </label>
                    <button onclick="parseSchema()">è§£æ Schema</button>
                    
                    <details open>
                        <summary>å¿«é€Ÿç¤ºä¾‹</summary>
                        <div class="btn-group">
                            <button class="template-btn outline" onclick="loadExample('blog')">åšå®¢</button>
                            <button class="template-btn outline" onclick="loadExample('ecommerce')">ç”µå•†</button>
                            <button class="template-btn outline" onclick="loadExample('social')">ç¤¾äº¤</button>
                        </div>
                    </details>
                </article>
            </section>

            <!-- Builder Panel -->
            <section>
                <article>
                    <header>
                        <h3>æ“ä½œç±»å‹</h3>
                    </header>
                    <div class="operation-tabs">
                        <button class="active" onclick="setOperationType('query')" id="queryTab">Query</button>
                        <button onclick="setOperationType('mutation')" id="mutationTab">Mutation</button>
                        <button onclick="setOperationType('subscription')" id="subscriptionTab">Subscription</button>
                    </div>
                    
                    <label>
                        æ“ä½œåç§°
                        <input type="text" id="operationName" placeholder="GetUser" onchange="generateQuery()">
                    </label>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>å˜é‡å®šä¹‰</h3>
                            <button class="outline" onclick="addVariable()">+ æ·»åŠ å˜é‡</button>
                        </div>
                    </header>
                    <div id="variablesContainer"></div>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>å­—æ®µé€‰æ‹©</h3>
                            <button class="outline" onclick="addRootField()">+ æ·»åŠ æ ¹å­—æ®µ</button>
                        </div>
                    </header>
                    <div id="fieldsContainer"></div>
                </article>

                <article>
                    <header>
                        <h3>Fragment å®šä¹‰</h3>
                    </header>
                    <div id="fragmentsContainer"></div>
                    <button class="outline" onclick="addFragment()">+ æ·»åŠ  Fragment</button>
                </article>
            </section>

            <!-- Output Panel -->
            <section class="output-section">
                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ç”Ÿæˆçš„æŸ¥è¯¢</h3>
                            <div class="btn-group">
                                <button class="outline" onclick="copyQuery()">ğŸ“‹ å¤åˆ¶</button>
                                <button class="outline" onclick="formatQuery()">ğŸ¨ æ ¼å¼åŒ–</button>
                            </div>
                        </div>
                    </header>
                    <pre class="query-output"><code id="queryOutput"></code></pre>
                </article>

                <article>
                    <header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>å˜é‡ JSON</h3>
                            <button class="outline" onclick="copyVariables()">ğŸ“‹ å¤åˆ¶</button>
                        </div>
                    </header>
                    <pre class="variables-output"><code id="variablesOutput">{}</code></pre>
                </article>

                <article>
                    <header>
                        <h3>cURL å‘½ä»¤</h3>
                    </header>
                    <label>
                        GraphQL Endpoint
                        <input type="text" id="endpoint" value="https://api.example.com/graphql" onchange="generateCurl()">
                    </label>
                    <pre style="max-height:150px;"><code id="curlOutput"></code></pre>
                    <button class="outline" onclick="copyCurl()">ğŸ“‹ å¤åˆ¶ cURL</button>
                </article>
            </section>
        </div>
    </main>

    <script>
        let operationType = 'query';
        let variables = [];
        let rootFields = [];
        let fragments = [];
        let schema = null;
        let variableId = 0;
        let fieldId = 0;
        let fragmentId = 0;

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        const examples = {
            blog: `type User {
  id: ID!
  name: String!
  email: String
  posts: [Post!]!
}

type Post {
  id: ID!
  title: String!
  content: String
  published: Boolean!
  author: User!
  comments: [Comment!]!
}

type Comment {
  id: ID!
  text: String!
  author: User!
}

type Query {
  user(id: ID!): User
  users(limit: Int, offset: Int): [User!]!
  post(id: ID!): Post
  posts(published: Boolean, limit: Int): [Post!]!
}

type Mutation {
  createUser(name: String!, email: String): User!
  createPost(title: String!, content: String, authorId: ID!): Post!
  publishPost(id: ID!): Post
}

type Subscription {
  postPublished: Post!
}`,
            ecommerce: `type Product {
  id: ID!
  name: String!
  description: String
  price: Float!
  inStock: Boolean!
  category: Category!
}

type Category {
  id: ID!
  name: String!
  products: [Product!]!
}

type Order {
  id: ID!
  items: [OrderItem!]!
  total: Float!
  status: String!
}

type OrderItem {
  product: Product!
  quantity: Int!
  price: Float!
}

type Query {
  product(id: ID!): Product
  products(category: ID, inStock: Boolean, minPrice: Float, maxPrice: Float): [Product!]!
  categories: [Category!]!
  order(id: ID!): Order
  orders(status: String): [Order!]!
}

type Mutation {
  createProduct(name: String!, price: Float!, categoryId: ID!): Product!
  createOrder(items: [OrderItemInput!]!): Order!
  updateOrderStatus(id: ID!, status: String!): Order!
}

input OrderItemInput {
  productId: ID!
  quantity: Int!
}`,
            social: `type User {
  id: ID!
  username: String!
  displayName: String
  avatar: String
  followers: [User!]!
  following: [User!]!
  posts: [Post!]!
}

type Post {
  id: ID!
  content: String!
  author: User!
  likes: Int!
  likedBy: [User!]!
  createdAt: String!
}

type Query {
  me: User
  user(id: ID, username: String): User
  feed(limit: Int, cursor: String): [Post!]!
  search(query: String!): [User!]!
}

type Mutation {
  follow(userId: ID!): User!
  unfollow(userId: ID!): User!
  createPost(content: String!): Post!
  likePost(postId: ID!): Post!
}

type Subscription {
  newPost: Post!
  newFollower: User!
}`
        };

        function loadExample(type) {
            document.getElementById('schemaInput').value = examples[type];
            parseSchema();
        }

        function setOperationType(type) {
            operationType = type;
            document.querySelectorAll('.operation-tabs button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(type + 'Tab').classList.add('active');
            generateQuery();
        }

        // Variable management
        function addVariable() {
            const id = variableId++;
            variables.push({
                id,
                name: '',
                type: 'String',
                required: false,
                defaultValue: ''
            });
            renderVariables();
            generateQuery();
        }

        function removeVariable(id) {
            variables = variables.filter(v => v.id !== id);
            renderVariables();
            generateQuery();
        }

        function renderVariables() {
            const container = document.getElementById('variablesContainer');
            container.replaceChildren();

            variables.forEach(v => {
                const row = document.createElement('div');
                row.className = 'arg-row';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = v.name;
                nameInput.placeholder = 'å˜é‡å';
                nameInput.style.flex = '1';
                nameInput.onchange = (e) => { v.name = e.target.value; generateQuery(); };

                const typeSelect = document.createElement('select');
                typeSelect.style.flex = '1';
                ['String', 'Int', 'Float', 'Boolean', 'ID', '[String]', '[Int]', '[ID]'].forEach(t => {
                    const opt = document.createElement('option');
                    opt.value = t;
                    opt.textContent = t;
                    opt.selected = v.type === t;
                    typeSelect.appendChild(opt);
                });
                typeSelect.onchange = (e) => { v.type = e.target.value; generateQuery(); };

                const reqLabel = document.createElement('label');
                reqLabel.style.cssText = 'margin:0;display:flex;align-items:center;gap:0.25rem;white-space:nowrap;';
                const reqCheck = document.createElement('input');
                reqCheck.type = 'checkbox';
                reqCheck.checked = v.required;
                reqCheck.onchange = (e) => { v.required = e.target.checked; generateQuery(); };
                reqLabel.appendChild(reqCheck);
                reqLabel.appendChild(document.createTextNode('å¿…å¡«'));

                const defaultInput = document.createElement('input');
                defaultInput.type = 'text';
                defaultInput.value = v.defaultValue;
                defaultInput.placeholder = 'é»˜è®¤å€¼';
                defaultInput.style.flex = '1';
                defaultInput.onchange = (e) => { v.defaultValue = e.target.value; generateQuery(); };

                const delBtn = document.createElement('button');
                delBtn.className = 'outline secondary';
                delBtn.style.padding = '0.25rem 0.5rem';
                delBtn.textContent = 'Ã—';
                delBtn.onclick = () => removeVariable(v.id);

                row.appendChild(nameInput);
                row.appendChild(typeSelect);
                row.appendChild(reqLabel);
                row.appendChild(defaultInput);
                row.appendChild(delBtn);
                container.appendChild(row);
            });
        }

        // Root field management
        function addRootField() {
            const id = fieldId++;
            rootFields.push({
                id,
                name: '',
                alias: '',
                args: [],
                fields: []
            });
            renderFields();
            generateQuery();
        }

        function removeRootField(id) {
            rootFields = rootFields.filter(f => f.id !== id);
            renderFields();
            generateQuery();
        }

        function renderFields() {
            const container = document.getElementById('fieldsContainer');
            container.replaceChildren();

            rootFields.forEach(field => {
                const fieldEl = createFieldElement(field, true);
                container.appendChild(fieldEl);
            });
        }

        function createFieldElement(field, isRoot = false) {
            const div = document.createElement('div');
            div.className = 'schema-type';

            const header = document.createElement('div');
            header.style.cssText = 'display:flex;gap:0.5rem;align-items:center;margin-bottom:0.5rem;';

            const aliasInput = document.createElement('input');
            aliasInput.type = 'text';
            aliasInput.className = 'alias-input';
            aliasInput.value = field.alias || '';
            aliasInput.placeholder = 'åˆ«å';
            aliasInput.onchange = (e) => { field.alias = e.target.value; generateQuery(); };

            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = field.name;
            nameInput.placeholder = 'å­—æ®µå';
            nameInput.style.flex = '1';
            nameInput.onchange = (e) => { field.name = e.target.value; generateQuery(); };

            const delBtn = document.createElement('button');
            delBtn.className = 'outline secondary';
            delBtn.style.padding = '0.25rem 0.5rem';
            delBtn.textContent = 'Ã—';
            delBtn.onclick = () => {
                if (isRoot) {
                    removeRootField(field.id);
                } else {
                    field.removed = true;
                    renderFields();
                    generateQuery();
                }
            };

            header.appendChild(aliasInput);
            header.appendChild(nameInput);
            header.appendChild(delBtn);
            div.appendChild(header);

            // Arguments
            const argsDetails = document.createElement('details');
            const argsSummary = document.createElement('summary');
            argsSummary.textContent = 'å‚æ•° (' + field.args.length + ')';
            argsDetails.appendChild(argsSummary);

            const argsContainer = document.createElement('div');
            field.args.forEach((arg, i) => {
                const argRow = document.createElement('div');
                argRow.className = 'arg-row';

                const argName = document.createElement('input');
                argName.type = 'text';
                argName.value = arg.name;
                argName.placeholder = 'å‚æ•°å';
                argName.style.flex = '1';
                argName.onchange = (e) => { arg.name = e.target.value; generateQuery(); };

                const argValue = document.createElement('input');
                argValue.type = 'text';
                argValue.value = arg.value;
                argValue.placeholder = 'å€¼ (ä½¿ç”¨ $å˜é‡å å¼•ç”¨å˜é‡)';
                argValue.style.flex = '2';
                argValue.onchange = (e) => { arg.value = e.target.value; generateQuery(); };

                const argDel = document.createElement('button');
                argDel.className = 'outline secondary';
                argDel.style.padding = '0.25rem 0.5rem';
                argDel.textContent = 'Ã—';
                argDel.onclick = () => {
                    field.args.splice(i, 1);
                    renderFields();
                    generateQuery();
                };

                argRow.appendChild(argName);
                argRow.appendChild(argValue);
                argRow.appendChild(argDel);
                argsContainer.appendChild(argRow);
            });
            argsDetails.appendChild(argsContainer);

            const addArgBtn = document.createElement('button');
            addArgBtn.className = 'outline';
            addArgBtn.style.cssText = 'padding:0.25rem 0.5rem;font-size:0.8rem;';
            addArgBtn.textContent = '+ å‚æ•°';
            addArgBtn.onclick = () => {
                field.args.push({ name: '', value: '' });
                renderFields();
                generateQuery();
            };
            argsDetails.appendChild(addArgBtn);
            div.appendChild(argsDetails);

            // Nested fields
            const fieldsDetails = document.createElement('details');
            fieldsDetails.open = true;
            const fieldsSummary = document.createElement('summary');
            fieldsSummary.textContent = 'å­å­—æ®µ (' + field.fields.filter(f => !f.removed).length + ')';
            fieldsDetails.appendChild(fieldsSummary);

            const fieldsContainer = document.createElement('div');
            fieldsContainer.className = 'nested-fields';

            field.fields.filter(f => !f.removed).forEach(subField => {
                const subEl = createFieldElement(subField, false);
                fieldsContainer.appendChild(subEl);
            });
            fieldsDetails.appendChild(fieldsContainer);

            // Simple field input for quick add
            const quickAddRow = document.createElement('div');
            quickAddRow.style.cssText = 'display:flex;gap:0.5rem;margin-top:0.5rem;';
            
            const quickInput = document.createElement('input');
            quickInput.type = 'text';
            quickInput.placeholder = 'å¿«é€Ÿæ·»åŠ å­—æ®µ (ç©ºæ ¼åˆ†éš”å¤šä¸ª)';
            quickInput.style.flex = '1';

            const quickAddBtn = document.createElement('button');
            quickAddBtn.className = 'outline';
            quickAddBtn.style.cssText = 'padding:0.25rem 0.5rem;font-size:0.8rem;';
            quickAddBtn.textContent = '+ æ·»åŠ ';
            quickAddBtn.onclick = () => {
                const names = quickInput.value.trim().split(/\s+/).filter(n => n);
                names.forEach(name => {
                    field.fields.push({
                        id: fieldId++,
                        name: name,
                        alias: '',
                        args: [],
                        fields: []
                    });
                });
                quickInput.value = '';
                renderFields();
                generateQuery();
            };

            quickAddRow.appendChild(quickInput);
            quickAddRow.appendChild(quickAddBtn);
            fieldsDetails.appendChild(quickAddRow);

            // Add nested object field button
            const addNestedBtn = document.createElement('button');
            addNestedBtn.className = 'outline';
            addNestedBtn.style.cssText = 'padding:0.25rem 0.5rem;font-size:0.8rem;margin-left:0.5rem;';
            addNestedBtn.textContent = '+ åµŒå¥—å¯¹è±¡';
            addNestedBtn.onclick = () => {
                field.fields.push({
                    id: fieldId++,
                    name: '',
                    alias: '',
                    args: [],
                    fields: []
                });
                renderFields();
                generateQuery();
            };
            quickAddRow.appendChild(addNestedBtn);

            div.appendChild(fieldsDetails);

            return div;
        }

        // Fragment management
        function addFragment() {
            const id = fragmentId++;
            fragments.push({
                id,
                name: 'Fragment' + id,
                onType: '',
                fields: []
            });
            renderFragments();
            generateQuery();
        }

        function removeFragment(id) {
            fragments = fragments.filter(f => f.id !== id);
            renderFragments();
            generateQuery();
        }

        function renderFragments() {
            const container = document.getElementById('fragmentsContainer');
            container.replaceChildren();

            fragments.forEach(frag => {
                const div = document.createElement('div');
                div.className = 'schema-type';

                const header = document.createElement('div');
                header.style.cssText = 'display:flex;gap:0.5rem;align-items:center;margin-bottom:0.5rem;';

                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = frag.name;
                nameInput.placeholder = 'Fragment åç§°';
                nameInput.style.flex = '1';
                nameInput.onchange = (e) => { frag.name = e.target.value; generateQuery(); };

                const onLabel = document.createElement('span');
                onLabel.textContent = 'on';
                onLabel.style.padding = '0 0.25rem';

                const typeInput = document.createElement('input');
                typeInput.type = 'text';
                typeInput.value = frag.onType;
                typeInput.placeholder = 'ç±»å‹å';
                typeInput.style.flex = '1';
                typeInput.onchange = (e) => { frag.onType = e.target.value; generateQuery(); };

                const delBtn = document.createElement('button');
                delBtn.className = 'outline secondary';
                delBtn.style.padding = '0.25rem 0.5rem';
                delBtn.textContent = 'Ã—';
                delBtn.onclick = () => removeFragment(frag.id);

                header.appendChild(nameInput);
                header.appendChild(onLabel);
                header.appendChild(typeInput);
                header.appendChild(delBtn);
                div.appendChild(header);

                // Fields
                const fieldsLabel = document.createElement('label');
                fieldsLabel.textContent = 'å­—æ®µ (æ¯è¡Œä¸€ä¸ª)';
                const fieldsArea = document.createElement('textarea');
                fieldsArea.rows = 3;
                fieldsArea.value = frag.fields.join('\n');
                fieldsArea.onchange = (e) => { frag.fields = e.target.value.split('\n').filter(f => f.trim()); generateQuery(); };
                fieldsLabel.appendChild(fieldsArea);
                div.appendChild(fieldsLabel);

                container.appendChild(div);
            });
        }

        // Query generation
        function generateQuery() {
            let query = '';
            const opName = document.getElementById('operationName').value.trim();

            // Build variable definition
            let varDef = '';
            if (variables.length > 0) {
                const validVars = variables.filter(v => v.name);
                if (validVars.length > 0) {
                    const varParts = validVars.map(v => {
                        let def = '$' + v.name + ': ' + v.type;
                        if (v.required) def += '!';
                        if (v.defaultValue) def += ' = ' + formatValue(v.defaultValue, v.type);
                        return def;
                    });
                    varDef = '(' + varParts.join(', ') + ')';
                }
            }

            // Operation line
            query += operationType;
            if (opName || varDef) {
                query += ' ' + (opName || '');
                query += varDef;
            }
            query += ' {\n';

            // Root fields
            rootFields.forEach(field => {
                query += generateFieldQuery(field, 1);
            });

            query += '}\n';

            // Fragments
            fragments.forEach(frag => {
                if (frag.name && frag.onType) {
                    query += '\nfragment ' + frag.name + ' on ' + frag.onType + ' {\n';
                    frag.fields.forEach(f => {
                        query += '  ' + f + '\n';
                    });
                    query += '}\n';
                }
            });

            document.getElementById('queryOutput').textContent = query;

            // Generate variables JSON
            const varsJson = {};
            variables.filter(v => v.name && v.defaultValue).forEach(v => {
                varsJson[v.name] = parseDefaultValue(v.defaultValue, v.type);
            });
            document.getElementById('variablesOutput').textContent = JSON.stringify(varsJson, null, 2);

            generateCurl();
        }

        function generateFieldQuery(field, indent) {
            if (!field.name) return '';

            const spaces = '  '.repeat(indent);
            let line = spaces;

            // Alias
            if (field.alias) {
                line += field.alias + ': ';
            }

            line += field.name;

            // Arguments
            if (field.args.length > 0) {
                const validArgs = field.args.filter(a => a.name && a.value);
                if (validArgs.length > 0) {
                    const argParts = validArgs.map(a => {
                        let val = a.value;
                        if (!val.startsWith('$') && !val.startsWith('"') && !val.startsWith('[') && 
                            val !== 'true' && val !== 'false' && val !== 'null' && isNaN(val)) {
                            val = '"' + val + '"';
                        }
                        return a.name + ': ' + val;
                    });
                    line += '(' + argParts.join(', ') + ')';
                }
            }

            // Nested fields
            const nestedFields = field.fields.filter(f => !f.removed);
            if (nestedFields.length > 0) {
                line += ' {\n';
                nestedFields.forEach(subField => {
                    if (subField.fields && subField.fields.length > 0) {
                        line += generateFieldQuery(subField, indent + 1);
                    } else if (subField.name) {
                        line += '  '.repeat(indent + 1);
                        if (subField.alias) line += subField.alias + ': ';
                        line += subField.name + '\n';
                    }
                });
                line += spaces + '}\n';
            } else {
                line += '\n';
            }

            return line;
        }

        function formatValue(value, type) {
            if (type === 'String' || type === '[String]') {
                return '"' + value + '"';
            }
            if (type === 'Boolean') {
                return value.toLowerCase() === 'true' ? 'true' : 'false';
            }
            return value;
        }

        function parseDefaultValue(value, type) {
            if (type === 'Int') return parseInt(value) || 0;
            if (type === 'Float') return parseFloat(value) || 0;
            if (type === 'Boolean') return value.toLowerCase() === 'true';
            if (type.startsWith('[')) {
                try {
                    return JSON.parse(value);
                } catch {
                    return value.split(',').map(v => v.trim());
                }
            }
            return value;
        }

        function generateCurl() {
            const endpoint = document.getElementById('endpoint').value;
            const query = document.getElementById('queryOutput').textContent;
            const vars = document.getElementById('variablesOutput').textContent;

            const body = JSON.stringify({
                query: query,
                variables: JSON.parse(vars || '{}')
            });

            const curl = `curl -X POST '${endpoint}' \\
  -H 'Content-Type: application/json' \\
  -d '${body.replace(/'/g, "'\\''")}'`;

            document.getElementById('curlOutput').textContent = curl;
        }

        function copyQuery() {
            const query = document.getElementById('queryOutput').textContent;
            navigator.clipboard.writeText(query).then(() => {
                alert('æŸ¥è¯¢å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function copyVariables() {
            const vars = document.getElementById('variablesOutput').textContent;
            navigator.clipboard.writeText(vars).then(() => {
                alert('å˜é‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function copyCurl() {
            const curl = document.getElementById('curlOutput').textContent;
            navigator.clipboard.writeText(curl).then(() => {
                alert('cURL å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function formatQuery() {
            // Query is already formatted by generation
            generateQuery();
        }

        function parseSchema() {
            const sdl = document.getElementById('schemaInput').value;
            // Basic SDL parsing - this is simplified
            // In production, you'd use a proper GraphQL parser

            // Extract types and fields
            const typeRegex = /type\s+(\w+)\s*\{([^}]+)\}/g;
            let match;
            schema = { types: {} };

            while ((match = typeRegex.exec(sdl)) !== null) {
                const typeName = match[1];
                const fieldsStr = match[2];
                const fields = [];

                const fieldRegex = /(\w+)(?:\(([^)]+)\))?:\s*([\[\]\w!]+)/g;
                let fieldMatch;
                while ((fieldMatch = fieldRegex.exec(fieldsStr)) !== null) {
                    fields.push({
                        name: fieldMatch[1],
                        args: fieldMatch[2] || '',
                        type: fieldMatch[3]
                    });
                }

                schema.types[typeName] = fields;
            }

            alert('Schema å·²è§£æï¼å‘ç° ' + Object.keys(schema.types).length + ' ä¸ªç±»å‹ã€‚');
        }

        // Initialize
        addRootField();
        generateQuery();
    </script>
</body>
</html>

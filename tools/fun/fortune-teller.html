<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä»Šæ—¥è¿åŠ¿ - WebUtils</title>
  <meta name="description" content="æ¯æ—¥è¿åŠ¿ç­¾æ–‡ï¼Œè·å–ä»Šæ—¥çš„å¥½è¿æŒ‡å¼•" />
  <meta name="keywords" content="è¿åŠ¿,ç­¾æ–‡,æ¯æ—¥è¿åŠ¿,å¥½è¿,fortune" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-elevated: #1a1a24;
      --border-subtle: #2a2a3a;
      --text-primary: #e8e8ed;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
      --accent-cyan: #00f5d4;
      --accent-purple: #bf5af2;
      --accent-green: #30d158;
      --accent-orange: #ff9f0a;
      --accent-red: #ff453a;
      --accent-gold: #ffd700;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Space Grotesk', -apple-system, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 20px;
      transition: color 0.2s;
    }

    .back-link:hover { color: var(--accent-cyan); }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 15px;
    }

    .fortune-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 40px 32px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .fortune-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange), var(--accent-purple));
    }

    .fortune-date {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .fortune-icon {
      font-size: 64px;
      margin-bottom: 24px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .fortune-level {
      display: inline-block;
      padding: 8px 24px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 24px;
    }

    .fortune-level.great {
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
      color: #000;
    }

    .fortune-level.good {
      background: var(--accent-green);
      color: #000;
    }

    .fortune-level.normal {
      background: var(--accent-cyan);
      color: #000;
    }

    .fortune-level.bad {
      background: var(--accent-purple);
      color: #fff;
    }

    .fortune-message {
      font-size: 20px;
      line-height: 1.8;
      margin-bottom: 32px;
      color: var(--text-primary);
    }

    .fortune-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .detail-item {
      background: var(--bg-elevated);
      border-radius: var(--radius-md);
      padding: 16px;
      text-align: left;
    }

    .detail-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 16px;
      font-weight: 600;
    }

    .detail-value.good { color: var(--accent-green); }
    .detail-value.bad { color: var(--accent-red); }
    .detail-value.neutral { color: var(--accent-cyan); }

    .lucky-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 32px;
    }

    .lucky-item {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 8px 16px;
      font-size: 14px;
    }

    .lucky-item span {
      margin-right: 6px;
    }

    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .share-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border-subtle);
    }

    .share-btn {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      padding: 10px 20px;
    }

    .share-btn:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .history-section {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-top: 24px;
    }

    .history-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-secondary);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg-elevated);
      border-radius: var(--radius-sm);
    }

    .history-date {
      font-size: 14px;
      color: var(--text-muted);
    }

    .history-level {
      font-size: 14px;
      font-weight: 600;
    }

    .countdown {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 16px;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      75% { transform: rotate(10deg); }
    }

    .fortune-icon.shaking {
      animation: shake 0.5s ease-in-out;
    }

    @media (max-width: 480px) {
      .fortune-details {
        grid-template-columns: 1fr;
      }

      .fortune-message {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      è¿”å›å·¥å…·åˆ—è¡¨
    </a>

    <h1>ä»Šæ—¥è¿åŠ¿</h1>
    <p class="subtitle">æ¯æ—¥ä¸€ç­¾ï¼Œå‘ç°ä»Šå¤©çš„å¥½è¿æ°”</p>

    <div class="fortune-card">
      <div class="fortune-date" id="fortuneDate"></div>
      <div class="fortune-icon" id="fortuneIcon">ğŸ”®</div>
      <div class="fortune-level" id="fortuneLevel">ç‚¹å‡»æ±‚ç­¾</div>
      <div class="fortune-message" id="fortuneMessage">æ‘‡åŠ¨æ°´æ™¶çƒï¼Œæ­ç¤ºä»Šæ—¥è¿åŠ¿</div>
      
      <div class="fortune-details" id="fortuneDetails" style="display: none;">
        <div class="detail-item">
          <div class="detail-label">å®œ</div>
          <div class="detail-value good" id="goodThing">-</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">å¿Œ</div>
          <div class="detail-value bad" id="badThing">-</div>
        </div>
      </div>

      <div class="lucky-items" id="luckyItems" style="display: none;"></div>

      <button class="btn btn-primary" id="drawBtn">æ±‚ç­¾</button>
      <div class="countdown" id="countdown" style="display: none;"></div>

      <div class="share-section" id="shareSection" style="display: none;">
        <button class="btn share-btn" id="shareBtn">å¤åˆ¶åˆ†äº«æ–‡æ¡ˆ</button>
      </div>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
      <div class="history-title">å†å²è®°å½•</div>
      <div class="history-list" id="historyList"></div>
    </div>
  </div>

  <script>
    ;(function() {
      'use strict';

      const FORTUNE_DATA = {
        levels: [
          { name: 'å¤§å‰', class: 'great', icon: 'ğŸŒŸ', weight: 10 },
          { name: 'ä¸­å‰', class: 'good', icon: 'âœ¨', weight: 25 },
          { name: 'å°å‰', class: 'good', icon: 'ğŸ€', weight: 30 },
          { name: 'å¹³', class: 'normal', icon: 'â˜¯ï¸', weight: 25 },
          { name: 'å°å‡¶', class: 'bad', icon: 'ğŸŒ™', weight: 10 }
        ],
        messages: {
          great: [
            'ä»Šæ—¥è¿åŠ¿æä½³ï¼Œä¸‡äº‹é¡ºé‚ï¼Œè´µäººç›¸åŠ©ã€‚',
            'æ˜Ÿå…‰ç’€ç’¨ç…§å‰ç¨‹ï¼Œä¸€åˆ‡åŠªåŠ›çš†æœ‰å›æŠ¥ã€‚',
            'å¥½è¿çˆ†æ£šçš„ä¸€å¤©ï¼ŒæŠŠæ¡æœºä¼šå‹‡å¾€ç›´å‰ï¼',
            'ä»Šæ—¥å®œå¤§èƒ†è¡ŒåŠ¨ï¼ŒæˆåŠŸå°±åœ¨çœ¼å‰ã€‚'
          ],
          good: [
            'ä»Šæ—¥è¿åŠ¿è‰¯å¥½ï¼Œä¿æŒç§¯æå¿ƒæ€ã€‚',
            'ç¨³ä¸­æ±‚è¿›ï¼Œå°äº‹é¡ºåˆ©ï¼Œå¤§äº‹å¯æœŸã€‚',
            'ä»Šæ—¥é€‚åˆå­¦ä¹ æ–°æŠ€èƒ½ï¼Œä¼šæœ‰æ„å¤–æ”¶è·ã€‚',
            'äººé™…å…³ç³»å’Œè°ï¼Œé€‚åˆç¤¾äº¤æ´»åŠ¨ã€‚'
          ],
          normal: [
            'ä»Šæ—¥è¿åŠ¿å¹³ç¨³ï¼Œå®œé™ä¸å®œåŠ¨ã€‚',
            'å¹³å‡¡çš„ä¸€å¤©ä¹Ÿæœ‰å°ç¡®å¹¸ç­‰ç€ä½ ã€‚',
            'ä¿æŒå¹³å¸¸å¿ƒï¼Œé¡ºå…¶è‡ªç„¶æœ€å¥½ã€‚',
            'ä»Šæ—¥é€‚åˆæ•´ç†æ€ç»ªï¼Œä¸ºæœªæ¥åšå‡†å¤‡ã€‚'
          ],
          bad: [
            'ä»Šæ—¥å®œä½è°ƒè¡Œäº‹ï¼Œé¿å…å†²çªã€‚',
            'å°å¿ƒé©¶å¾—ä¸‡å¹´èˆ¹ï¼Œè°¨æ…ä¸ºä¸Šã€‚',
            'é€†å¢ƒä¸­è•´è—æœºé‡ï¼Œä¿æŒä¹è§‚ã€‚',
            'ä»Šæ—¥ä¸å®œå†’é™©ï¼Œç¨³æ‰ç¨³æ‰“æœ€é‡è¦ã€‚'
          ]
        },
        goodThings: [
          'å†™ä»£ç ', 'å­¦ä¹ ', 'è¿åŠ¨', 'é˜…è¯»', 'å†¥æƒ³', 'æ—©èµ·',
          'å–å’–å•¡', 'å¬éŸ³ä¹', 'æ•£æ­¥', 'æ•´ç†', 'åˆ›ä½œ', 'æ²Ÿé€š',
          'è§„åˆ’', 'å¤ç›˜', 'å°è¯•æ–°äº‹ç‰©', 'å¸®åŠ©ä»–äºº'
        ],
        badThings: [
          'ç†¬å¤œ', 'æ‹–å»¶', 'å†²åŠ¨æ¶ˆè´¹', 'äº‰åµ', 'è¿‡åº¦åŠ³ç´¯',
          'è·³è¿‡æµ‹è¯•', 'å¿½ç•¥æ–‡æ¡£', 'æ•·è¡äº†äº‹', 'é’»ç‰›è§’å°–'
        ],
        luckyColors: [
          { name: 'è“è‰²', emoji: 'ğŸ’™' },
          { name: 'ç»¿è‰²', emoji: 'ğŸ’š' },
          { name: 'ç´«è‰²', emoji: 'ğŸ’œ' },
          { name: 'é‡‘è‰²', emoji: 'ğŸ’›' },
          { name: 'ç™½è‰²', emoji: 'ğŸ¤' },
          { name: 'æ©™è‰²', emoji: 'ğŸ§¡' }
        ],
        luckyNumbers: ['1', '3', '5', '7', '8', '9', '11', '13', '21', '42'],
        luckyDirections: ['ä¸œ', 'å—', 'è¥¿', 'åŒ—', 'ä¸œå—', 'è¥¿å—', 'ä¸œåŒ—', 'è¥¿åŒ—']
      };

      // DOM Elements
      const fortuneDate = document.getElementById('fortuneDate');
      const fortuneIcon = document.getElementById('fortuneIcon');
      const fortuneLevel = document.getElementById('fortuneLevel');
      const fortuneMessage = document.getElementById('fortuneMessage');
      const fortuneDetails = document.getElementById('fortuneDetails');
      const goodThing = document.getElementById('goodThing');
      const badThing = document.getElementById('badThing');
      const luckyItems = document.getElementById('luckyItems');
      const drawBtn = document.getElementById('drawBtn');
      const countdown = document.getElementById('countdown');
      const shareSection = document.getElementById('shareSection');
      const shareBtn = document.getElementById('shareBtn');
      const historySection = document.getElementById('historySection');
      const historyList = document.getElementById('historyList');

      function getDateString(date = new Date()) {
        return date.toLocaleDateString('zh-CN', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          weekday: 'long'
        });
      }

      function getTodayKey() {
        const d = new Date();
        return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
      }

      function seededRandom(seed) {
        const x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      }

      function pickRandom(arr, seed) {
        return arr[Math.floor(seededRandom(seed) * arr.length)];
      }

      function pickWeighted(items, seed) {
        const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
        let random = seededRandom(seed) * totalWeight;
        
        for (const item of items) {
          random -= item.weight;
          if (random <= 0) return item;
        }
        return items[items.length - 1];
      }

      function generateFortune(dateKey) {
        // Use date as seed for reproducible results
        const seed = dateKey.split('-').reduce((a, b) => a + parseInt(b), 0);
        
        const level = pickWeighted(FORTUNE_DATA.levels, seed);
        const messageType = level.class === 'great' ? 'great' : 
                          level.class === 'good' ? 'good' :
                          level.class === 'normal' ? 'normal' : 'bad';
        
        const message = pickRandom(FORTUNE_DATA.messages[messageType], seed + 1);
        const good = pickRandom(FORTUNE_DATA.goodThings, seed + 2);
        const bad = pickRandom(FORTUNE_DATA.badThings, seed + 3);
        const color = pickRandom(FORTUNE_DATA.luckyColors, seed + 4);
        const number = pickRandom(FORTUNE_DATA.luckyNumbers, seed + 5);
        const direction = pickRandom(FORTUNE_DATA.luckyDirections, seed + 6);

        return {
          level,
          message,
          good,
          bad,
          luckyColor: color,
          luckyNumber: number,
          luckyDirection: direction,
          date: dateKey
        };
      }

      function displayFortune(fortune) {
        fortuneIcon.textContent = fortune.level.icon;
        fortuneLevel.textContent = fortune.level.name;
        fortuneLevel.className = `fortune-level ${fortune.level.class}`;
        fortuneMessage.textContent = fortune.message;
        
        goodThing.textContent = fortune.good;
        badThing.textContent = fortune.bad;
        fortuneDetails.style.display = 'grid';

        luckyItems.innerHTML = `
          <div class="lucky-item"><span>${fortune.luckyColor.emoji}</span>å¹¸è¿è‰²: ${fortune.luckyColor.name}</div>
          <div class="lucky-item"><span>ğŸ”¢</span>å¹¸è¿æ•°: ${fortune.luckyNumber}</div>
          <div class="lucky-item"><span>ğŸ§­</span>å¹¸è¿æ–¹ä½: ${fortune.luckyDirection}</div>
        `;
        luckyItems.style.display = 'flex';

        shareSection.style.display = 'block';
        drawBtn.textContent = 'ä»Šæ—¥å·²æ±‚ç­¾';
        drawBtn.disabled = true;
      }

      function saveFortune(fortune) {
        const history = JSON.parse(localStorage.getItem('fortuneHistory') || '[]');
        
        // Check if already exists
        if (history.some(h => h.date === fortune.date)) return;
        
        history.unshift({
          date: fortune.date,
          level: fortune.level.name,
          levelClass: fortune.level.class
        });

        // Keep last 7 days
        localStorage.setItem('fortuneHistory', JSON.stringify(history.slice(0, 7)));
        localStorage.setItem('lastFortune', JSON.stringify(fortune));
        localStorage.setItem('lastFortuneDate', fortune.date);
      }

      function loadHistory() {
        const history = JSON.parse(localStorage.getItem('fortuneHistory') || '[]');
        
        if (history.length === 0) {
          historySection.style.display = 'none';
          return;
        }

        historySection.style.display = 'block';
        historyList.innerHTML = history.map(h => `
          <div class="history-item">
            <span class="history-date">${h.date}</span>
            <span class="history-level ${h.levelClass}">${h.level}</span>
          </div>
        `).join('');
      }

      function checkTodayFortune() {
        const todayKey = getTodayKey();
        const lastDate = localStorage.getItem('lastFortuneDate');
        
        if (lastDate === todayKey) {
          const fortune = JSON.parse(localStorage.getItem('lastFortune'));
          displayFortune(fortune);
          updateCountdown();
        }
      }

      function updateCountdown() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        
        const diff = tomorrow - now;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        countdown.textContent = `è·ç¦»ä¸‹æ¬¡æ±‚ç­¾: ${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
        countdown.style.display = 'block';
      }

      function drawFortune() {
        const todayKey = getTodayKey();
        
        // Animation
        fortuneIcon.classList.add('shaking');
        drawBtn.disabled = true;
        drawBtn.textContent = 'æ±‚ç­¾ä¸­...';

        setTimeout(() => {
          fortuneIcon.classList.remove('shaking');
          
          const fortune = generateFortune(todayKey);
          displayFortune(fortune);
          saveFortune(fortune);
          loadHistory();
          updateCountdown();
        }, 1000);
      }

      function copyShareText() {
        const lastFortune = JSON.parse(localStorage.getItem('lastFortune'));
        if (!lastFortune) return;

        const text = `ğŸ”® ä»Šæ—¥è¿åŠ¿ - ${lastFortune.level.name}

${lastFortune.message}

âœ… å®œ: ${lastFortune.good}
âŒ å¿Œ: ${lastFortune.bad}
${lastFortune.luckyColor.emoji} å¹¸è¿è‰²: ${lastFortune.luckyColor.name}
ğŸ”¢ å¹¸è¿æ•°: ${lastFortune.luckyNumber}
ğŸ§­ å¹¸è¿æ–¹ä½: ${lastFortune.luckyDirection}

â€” æ¥è‡ª WebUtils ä»Šæ—¥è¿åŠ¿`;

        navigator.clipboard.writeText(text).then(() => {
          shareBtn.textContent = 'å·²å¤åˆ¶!';
          setTimeout(() => {
            shareBtn.textContent = 'å¤åˆ¶åˆ†äº«æ–‡æ¡ˆ';
          }, 2000);
        });
      }

      // Event Listeners
      drawBtn.addEventListener('click', drawFortune);
      shareBtn.addEventListener('click', copyShareText);

      // Initialize
      fortuneDate.textContent = getDateString();
      checkTodayFortune();
      loadHistory();
    })();
  </script>
</body>
</html>

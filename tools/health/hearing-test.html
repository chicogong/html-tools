<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="keywords" content="hearing-test,health,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/health/hearing-test.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta property="og:description" content="å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/health/hearing-test.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="twitter:description" content="å¬åŠ›æµ‹è¯•å·¥å…· - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme='light'] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      :root {
        --bg: #0a0a0f;
        --card: #12121a;
        --border: #2a2a3a;
        --text: #fff;
        --text2: #888;
        --accent: #8b5cf6;
        --accent2: #a855f7;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f5f5f5;
          --card: #fff;
          --border: #e0e0e0;
          --text: #333;
          --text2: #666;
        }
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        text-align: center;
        margin-bottom: 8px;
        font-size: 1.8rem;
      }
      .subtitle {
        text-align: center;
        color: var(--text2);
        margin-bottom: 24px;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
      }
      .card-title {
        font-size: 1rem;
        color: var(--text2);
        margin-bottom: 16px;
      }
      button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        background: var(--accent);
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      button:hover {
        opacity: 0.9;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      button.secondary {
        background: var(--border);
        color: var(--text);
      }
      button.success {
        background: var(--success);
      }
      button.danger {
        background: var(--danger);
      }
      .test-area {
        min-height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
      }
      .frequency-display {
        font-size: 3rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 8px;
      }
      .volume-display {
        font-size: 1.2rem;
        color: var(--text2);
        margin-bottom: 24px;
      }
      .play-btn {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        font-size: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 24px;
      }
      .play-btn.playing {
        animation: pulse 0.5s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      .response-btns {
        display: flex;
        gap: 16px;
      }
      .response-btns button {
        min-width: 120px;
      }
      .progress {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
      }
      .progress-dot {
        flex: 1;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
      }
      .progress-dot.done {
        background: var(--success);
      }
      .progress-dot.failed {
        background: var(--danger);
      }
      .progress-dot.current {
        background: var(--accent);
        animation: blink 1s infinite;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .result-hero {
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        padding: 28px;
        border-radius: 12px;
        text-align: center;
        color: white;
        margin-bottom: 20px;
      }
      .result-hero .label {
        opacity: 0.9;
        margin-bottom: 8px;
      }
      .result-hero .big {
        font-size: 2rem;
        font-weight: 700;
      }
      .audiogram {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
      }
      .audiogram canvas {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: 8px;
      }
      .freq-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-top: 20px;
      }
      @media (max-width: 768px) {
        .freq-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      .freq-item {
        padding: 16px;
        background: var(--bg);
        border-radius: 12px;
        text-align: center;
      }
      .freq-item .hz {
        font-size: 1.2rem;
        font-weight: 600;
      }
      .freq-item .db {
        font-size: 0.9rem;
        color: var(--text2);
        margin-top: 4px;
      }
      .freq-item .status {
        margin-top: 8px;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
      }
      .freq-item .status.good {
        background: var(--success);
        color: white;
      }
      .freq-item .status.mild {
        background: var(--warning);
        color: white;
      }
      .freq-item .status.moderate {
        background: #f97316;
        color: white;
      }
      .freq-item .status.severe {
        background: var(--danger);
        color: white;
      }
      .instructions {
        padding: 20px;
        background: var(--bg);
        border-radius: 12px;
        margin-bottom: 20px;
      }
      .instructions h3 {
        margin-bottom: 12px;
      }
      .instructions ol {
        padding-left: 20px;
      }
      .instructions li {
        margin-bottom: 8px;
        color: var(--text2);
      }
      .ear-select {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .ear-btn {
        padding: 12px 32px;
        border: 2px solid var(--border);
        border-radius: 8px;
        background: var(--bg);
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
      }
      .ear-btn.active {
        border-color: var(--accent);
        background: var(--accent);
        color: white;
      }
      .warning {
        padding: 16px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--danger);
        border-radius: 12px;
        margin-bottom: 20px;
      }
      .warning-title {
        color: var(--danger);
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .note {
        margin-top: 16px;
        padding: 12px;
        background: var(--bg);
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--text2);
      }
      .back-link {
        display: inline-block;
        margin-bottom: 16px;
        color: var(--accent);
        text-decoration: none;
        font-size: 0.9rem;
      }
      .back-link:hover {
        text-decoration: underline;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      å¬åŠ›æµ‹è¯•å·¥å…·
    </nav>
    <div class="container">
      <a href="../../index.html" class="back-link">â† è¿”å›</a>
      <h1>å¬åŠ›æµ‹è¯•å·¥å…·</h1>
      <p class="subtitle">åœ¨çº¿å¬åŠ›è‡ªæµ‹ï¼ˆè¯·ä½¿ç”¨è€³æœºä»¥è·å¾—å‡†ç¡®ç»“æœï¼‰</p>

      <div class="warning">
        <div class="warning-title">ä½¿ç”¨æç¤º</div>
        <div style="font-size: 0.9rem; color: var(--text2)">
          <p>1. è¯·åœ¨å®‰é™ç¯å¢ƒä¸­ä½¿ç”¨è€³æœºè¿›è¡Œæµ‹è¯•</p>
          <p>2. å°†è®¾å¤‡éŸ³é‡è°ƒè‡³ä¸­ç­‰æ°´å¹³ï¼ˆçº¦50%ï¼‰</p>
          <p>3. æœ¬æµ‹è¯•ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šå¬åŠ›æ£€æŸ¥</p>
        </div>
      </div>

      <div class="card">
        <div class="card-title">é€‰æ‹©æµ‹è¯•è€³æœµ</div>
        <div class="ear-select">
          <button class="ear-btn active" data-ear="left" onclick="selectEar('left')">å·¦è€³</button>
          <button class="ear-btn" data-ear="right" onclick="selectEar('right')">å³è€³</button>
          <button class="ear-btn" data-ear="both" onclick="selectEar('both')">åŒè€³</button>
        </div>

        <div class="progress" id="progress"></div>

        <div class="test-area" id="testArea"></div>
      </div>

      <div class="card" id="resultsCard" style="display: none">
        <div class="card-title">æµ‹è¯•ç»“æœ</div>
        <div class="audiogram">
          <canvas id="audiogramCanvas" width="600" height="300"></canvas>
        </div>
        <div class="freq-grid" id="freqResults"></div>
      </div>

      <div class="card">
        <div class="card-title">å¬åŠ›åˆ†çº§å‚è€ƒ</div>
        <div class="freq-grid">
          <div class="freq-item">
            <div class="hz">æ­£å¸¸</div>
            <div class="db">0-25 dB</div>
            <div class="status good">è‰¯å¥½</div>
          </div>
          <div class="freq-item">
            <div class="hz">è½»åº¦æŸå¤±</div>
            <div class="db">26-40 dB</div>
            <div class="status mild">è½»åº¦</div>
          </div>
          <div class="freq-item">
            <div class="hz">ä¸­åº¦æŸå¤±</div>
            <div class="db">41-55 dB</div>
            <div class="status moderate">ä¸­åº¦</div>
          </div>
          <div class="freq-item">
            <div class="hz">é‡åº¦æŸå¤±</div>
            <div class="db">&gt;55 dB</div>
            <div class="status severe">é‡åº¦</div>
          </div>
        </div>
      </div>

      <div class="note">
        æœ¬å·¥å…·ä½¿ç”¨Web Audio
        APIç”Ÿæˆæµ‹è¯•éŸ³é¢‘ï¼Œç»“æœå—è®¾å¤‡ã€è€³æœºè´¨é‡å’Œç¯å¢ƒå™ªéŸ³å½±å“ã€‚å¦‚æœ‰å¬åŠ›é—®é¢˜ï¼Œè¯·åˆ°åŒ»é™¢è¿›è¡Œä¸“ä¸šçš„çº¯éŸ³å¬åŠ›æµ‹è¯•ã€‚
      </div>
    </div>

    <script>
      let audioContext = null;
      let currentEar = 'left';
      let testState = {
        running: false,
        currentFreqIndex: 0,
        currentVolume: 0,
        results: {}
      };

      const frequencies = [250, 500, 1000, 2000, 4000, 8000];
      const volumeLevels = [0.5, 0.3, 0.2, 0.1, 0.05, 0.02, 0.01, 0.005];
      const dbLevels = [10, 20, 30, 40, 50, 60, 70, 80];

      function selectEar(ear) {
        currentEar = ear;
        document.querySelectorAll('.ear-btn').forEach((btn) => {
          btn.classList.toggle('active', btn.dataset.ear === ear);
        });
      }

      function initAudio() {
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
          audioContext.resume();
        }
      }

      function playTone(frequency, volume, duration) {
        duration = duration || 1;
        return new Promise(function (resolve) {
          initAudio();

          var oscillator = audioContext.createOscillator();
          var gainNode = audioContext.createGain();
          var panNode = audioContext.createStereoPanner();

          oscillator.type = 'sine';
          oscillator.frequency.value = frequency;

          if (currentEar === 'left') {
            panNode.pan.value = -1;
          } else if (currentEar === 'right') {
            panNode.pan.value = 1;
          } else {
            panNode.pan.value = 0;
          }

          gainNode.gain.setValueAtTime(0, audioContext.currentTime);
          gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.1);
          gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + duration - 0.1);
          gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);

          oscillator.connect(gainNode);
          gainNode.connect(panNode);
          panNode.connect(audioContext.destination);

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);

          setTimeout(resolve, duration * 1000);
        });
      }

      function startTest() {
        testState = {
          running: true,
          currentFreqIndex: 0,
          currentVolume: 0,
          results: {}
        };

        frequencies.forEach(function (f) {
          testState.results[f] = null;
        });

        renderProgress();
        runTest();
      }

      async function runTest() {
        var testArea = document.getElementById('testArea');

        while (testState.currentFreqIndex < frequencies.length && testState.running) {
          var freq = frequencies[testState.currentFreqIndex];
          testState.currentVolume = 0;

          var lastHeardVolume = -1;

          for (var volIndex = 0; volIndex < volumeLevels.length && testState.running; volIndex++) {
            testState.currentVolume = volIndex;
            renderProgress();

            renderPlayingState(testArea, freq, volIndex);

            await playTone(freq, volumeLevels[volIndex], 1);

            renderResponseState(testArea, freq, volIndex);

            var response = await waitForResponse();

            if (response) {
              lastHeardVolume = volIndex;
            } else {
              break;
            }
          }

          if (lastHeardVolume >= 0) {
            testState.results[freq] = dbLevels[lastHeardVolume];
          } else {
            testState.results[freq] = dbLevels[dbLevels.length - 1];
          }

          testState.currentFreqIndex++;
        }

        if (testState.running) {
          showResults();
        }
      }

      function renderPlayingState(container, freq, volIndex) {
        container.textContent = '';

        var freqDiv = document.createElement('div');
        freqDiv.className = 'frequency-display';
        freqDiv.textContent = freq + ' Hz';

        var volDiv = document.createElement('div');
        volDiv.className = 'volume-display';
        volDiv.textContent = 'éŸ³é‡ç­‰çº§: ' + (volIndex + 1) + '/' + volumeLevels.length;

        var playBtn = document.createElement('button');
        playBtn.className = 'play-btn playing';
        playBtn.disabled = true;
        playBtn.textContent = 'ğŸ”Š';

        var statusText = document.createElement('p');
        statusText.style.cssText = 'color: var(--text2); margin-bottom: 16px;';
        statusText.textContent = 'æ­£åœ¨æ’­æ”¾...';

        container.appendChild(freqDiv);
        container.appendChild(volDiv);
        container.appendChild(playBtn);
        container.appendChild(statusText);
      }

      function renderResponseState(container, freq, volIndex) {
        container.textContent = '';

        var freqDiv = document.createElement('div');
        freqDiv.className = 'frequency-display';
        freqDiv.textContent = freq + ' Hz';

        var volDiv = document.createElement('div');
        volDiv.className = 'volume-display';
        volDiv.textContent = 'éŸ³é‡ç­‰çº§: ' + (volIndex + 1) + '/' + volumeLevels.length;

        var playBtn = document.createElement('button');
        playBtn.className = 'play-btn';
        playBtn.textContent = 'ğŸ”Š';
        playBtn.onclick = function () {
          playTone(freq, volumeLevels[volIndex], 1);
        };

        var statusText = document.createElement('p');
        statusText.style.cssText = 'color: var(--text2); margin-bottom: 16px;';
        statusText.textContent = 'æ‚¨èƒ½å¬åˆ°å£°éŸ³å—ï¼Ÿ';

        var btnContainer = document.createElement('div');
        btnContainer.className = 'response-btns';

        var yesBtn = document.createElement('button');
        yesBtn.className = 'success';
        yesBtn.textContent = 'èƒ½å¬åˆ°';
        yesBtn.onclick = function () {
          respond(true);
        };

        var noBtn = document.createElement('button');
        noBtn.className = 'danger';
        noBtn.textContent = 'å¬ä¸åˆ°';
        noBtn.onclick = function () {
          respond(false);
        };

        btnContainer.appendChild(yesBtn);
        btnContainer.appendChild(noBtn);

        container.appendChild(freqDiv);
        container.appendChild(volDiv);
        container.appendChild(playBtn);
        container.appendChild(statusText);
        container.appendChild(btnContainer);
      }

      var responseResolver = null;

      function waitForResponse() {
        return new Promise(function (resolve) {
          responseResolver = resolve;
          setTimeout(function () {
            if (responseResolver) {
              responseResolver(false);
              responseResolver = null;
            }
          }, 10000);
        });
      }

      function respond(heard) {
        if (responseResolver) {
          responseResolver(heard);
          responseResolver = null;
        }
      }

      function renderProgress() {
        var container = document.getElementById('progress');
        container.textContent = '';

        frequencies.forEach(function (freq, index) {
          var dot = document.createElement('div');
          dot.className = 'progress-dot';

          if (testState.results[freq] !== null && testState.results[freq] !== undefined) {
            dot.classList.add(testState.results[freq] <= 25 ? 'done' : 'failed');
          } else if (index === testState.currentFreqIndex) {
            dot.classList.add('current');
          }

          container.appendChild(dot);
        });
      }

      function showResults() {
        testState.running = false;

        var testArea = document.getElementById('testArea');
        testArea.textContent = '';

        var resultDiv = document.createElement('div');
        resultDiv.style.textAlign = 'center';

        var title = document.createElement('h2');
        title.style.marginBottom = '16px';
        title.textContent = 'æµ‹è¯•å®Œæˆï¼';

        var desc = document.createElement('p');
        desc.style.color = 'var(--text2)';
        desc.textContent = 'æŸ¥çœ‹ä¸‹æ–¹çš„è¯¦ç»†ç»“æœ';

        var restartBtn = document.createElement('button');
        restartBtn.style.marginTop = '20px';
        restartBtn.textContent = 'é‡æ–°æµ‹è¯•';
        restartBtn.onclick = startTest;

        resultDiv.appendChild(title);
        resultDiv.appendChild(desc);
        resultDiv.appendChild(restartBtn);
        testArea.appendChild(resultDiv);

        document.getElementById('resultsCard').style.display = 'block';

        drawAudiogram();
        renderFreqResults();

        document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth' });
      }

      function drawAudiogram() {
        var canvas = document.getElementById('audiogramCanvas');
        var ctx = canvas.getContext('2d');
        var width = canvas.width;
        var height = canvas.height;

        ctx.clearRect(0, 0, width, height);

        ctx.fillStyle =
          getComputedStyle(document.body).getPropertyValue('--bg').trim() || '#f5f5f5';
        ctx.fillRect(0, 0, width, height);

        var padding = 60;
        var graphWidth = width - padding * 2;
        var graphHeight = height - padding * 2;

        ctx.strokeStyle =
          getComputedStyle(document.body).getPropertyValue('--border').trim() || '#e0e0e0';
        ctx.lineWidth = 1;

        for (var db = 0; db <= 80; db += 20) {
          var y = padding + (db / 80) * graphHeight;
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(width - padding, y);
          ctx.stroke();

          ctx.fillStyle =
            getComputedStyle(document.body).getPropertyValue('--text2').trim() || '#666';
          ctx.font = '12px sans-serif';
          ctx.textAlign = 'right';
          ctx.fillText(db + ' dB', padding - 10, y + 4);
        }

        frequencies.forEach(function (freq, index) {
          var x = padding + (index / (frequencies.length - 1)) * graphWidth;
          ctx.beginPath();
          ctx.moveTo(x, padding);
          ctx.lineTo(x, height - padding);
          ctx.stroke();

          ctx.fillStyle =
            getComputedStyle(document.body).getPropertyValue('--text2').trim() || '#666';
          ctx.textAlign = 'center';
          ctx.fillText(freq >= 1000 ? freq / 1000 + 'k' : freq, x, height - padding + 20);
        });

        ctx.fillStyle = 'rgba(34, 197, 94, 0.2)';
        ctx.fillRect(padding, padding, graphWidth, (25 / 80) * graphHeight);

        ctx.strokeStyle =
          getComputedStyle(document.body).getPropertyValue('--accent').trim() || '#8b5cf6';
        ctx.lineWidth = 3;
        ctx.beginPath();

        frequencies.forEach(function (freq, index) {
          var x = padding + (index / (frequencies.length - 1)) * graphWidth;
          var dbVal = testState.results[freq] || 0;
          var y = padding + (dbVal / 80) * graphHeight;

          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });
        ctx.stroke();

        frequencies.forEach(function (freq, index) {
          var x = padding + (index / (frequencies.length - 1)) * graphWidth;
          var dbVal = testState.results[freq] || 0;
          var y = padding + (dbVal / 80) * graphHeight;

          ctx.beginPath();
          ctx.arc(x, y, 6, 0, Math.PI * 2);
          ctx.fillStyle = dbVal <= 25 ? '#22c55e' : dbVal <= 40 ? '#f59e0b' : '#ef4444';
          ctx.fill();
        });

        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text').trim() || '#333';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('é¢‘ç‡ (Hz)', width / 2, height - 10);
      }

      function renderFreqResults() {
        var container = document.getElementById('freqResults');
        container.textContent = '';

        frequencies.forEach(function (freq) {
          var db = testState.results[freq] || 0;
          var status, statusClass;

          if (db <= 25) {
            status = 'æ­£å¸¸';
            statusClass = 'good';
          } else if (db <= 40) {
            status = 'è½»åº¦æŸå¤±';
            statusClass = 'mild';
          } else if (db <= 55) {
            status = 'ä¸­åº¦æŸå¤±';
            statusClass = 'moderate';
          } else {
            status = 'é‡åº¦æŸå¤±';
            statusClass = 'severe';
          }

          var item = document.createElement('div');
          item.className = 'freq-item';

          var hzDiv = document.createElement('div');
          hzDiv.className = 'hz';
          hzDiv.textContent = freq >= 1000 ? freq / 1000 + ' kHz' : freq + ' Hz';

          var dbDiv = document.createElement('div');
          dbDiv.className = 'db';
          dbDiv.textContent = db + ' dB';

          var statusDiv = document.createElement('div');
          statusDiv.className = 'status ' + statusClass;
          statusDiv.textContent = status;

          item.appendChild(hzDiv);
          item.appendChild(dbDiv);
          item.appendChild(statusDiv);
          container.appendChild(item);
        });
      }

      function renderInitialTestArea() {
        var testArea = document.getElementById('testArea');
        testArea.textContent = '';

        var instructions = document.createElement('div');
        instructions.className = 'instructions';

        var h3 = document.createElement('h3');
        h3.textContent = 'æµ‹è¯•è¯´æ˜';
        instructions.appendChild(h3);

        var ol = document.createElement('ol');
        [
          'ç¡®ä¿æ‚¨åœ¨å®‰é™çš„ç¯å¢ƒä¸­',
          'æˆ´ä¸Šè€³æœºå¹¶å°†éŸ³é‡è°ƒè‡³èˆ’é€‚æ°´å¹³',
          'ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®',
          'æ¯æ¬¡æ’­æ”¾å£°éŸ³åï¼Œå¦‚æœèƒ½å¬åˆ°è¯·ç‚¹å‡»"èƒ½å¬åˆ°"',
          'å¦‚æœå¬ä¸åˆ°ï¼Œç‚¹å‡»"å¬ä¸åˆ°"æˆ–ç­‰å¾…è‡ªåŠ¨è·³è¿‡'
        ].forEach(function (text) {
          var li = document.createElement('li');
          li.textContent = text;
          ol.appendChild(li);
        });
        instructions.appendChild(ol);
        testArea.appendChild(instructions);

        var startBtn = document.createElement('button');
        startBtn.style.cssText = 'margin-top: 20px; padding: 16px 48px; font-size: 1.1rem;';
        startBtn.textContent = 'å¼€å§‹æµ‹è¯•';
        startBtn.onclick = startTest;
        testArea.appendChild(startBtn);
      }

      renderProgress();
      renderInitialTestArea();

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        html.setAttribute('data-theme', newTheme);
        document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
        localStorage.setItem('theme', newTheme);
      }

      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        document.getElementById('theme-icon').textContent = 'â˜€ï¸';
      }
    </script>
  </body>
</html>

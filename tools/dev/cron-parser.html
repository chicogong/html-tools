<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron è¡¨è¾¾å¼è§£æå™¨ - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-tertiary: #1a1a25; --text-primary: #fff; --text-secondary: #88a; --accent: #6366f1; --border: #2a2a3a; --success: #22c55e; }
        [data-theme="light"] { --bg-primary: #f8fafc; --bg-secondary: #fff; --bg-tertiary: #f1f5f9; --text-primary: #1e293b; --text-secondary: #64748b; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(135deg, #0ea5e9, #3b82f6); padding: 2rem; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .nav { display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 1rem; }
        .back-link { color: rgba(255,255,255,0.9); text-decoration: none; }
        .theme-toggle { background: rgba(255,255,255,0.2); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; color: white; cursor: pointer; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        .card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .cron-input { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .cron-field { flex: 1; text-align: center; }
        .cron-field label { display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; }
        .cron-field input { width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-tertiary); color: var(--text-primary); font-size: 1.1rem; text-align: center; font-family: monospace; }
        .cron-field input:focus { outline: none; border-color: var(--accent); }
        .description { padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem; text-align: center; font-size: 1.1rem; margin-bottom: 1rem; }
        .description.error { color: #ef4444; }
        .presets { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem; }
        .preset-btn { padding: 0.5rem 1rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); cursor: pointer; font-size: 0.85rem; transition: all 0.2s; }
        .preset-btn:hover { border-color: var(--accent); background: var(--accent); color: white; }
        .next-runs { margin-top: 1rem; }
        .next-runs h3 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem; }
        .run-item { display: flex; justify-content: space-between; padding: 0.5rem 0.75rem; background: var(--bg-tertiary); border-radius: 0.25rem; margin-bottom: 0.5rem; font-family: monospace; font-size: 0.9rem; }
        .run-item .relative { color: var(--text-secondary); }
        .reference { margin-top: 1.5rem; }
        .reference h3 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem; }
        .ref-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .ref-table th, .ref-table td { padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--border); }
        .ref-table th { color: var(--text-secondary); font-weight: 500; }
        .ref-table code { background: var(--bg-tertiary); padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-family: monospace; }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="../../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
        </div>
        <h1>â° Cron è¡¨è¾¾å¼è§£æå™¨</h1>
        <p>è§£æå’Œç”Ÿæˆ Cron å®šæ—¶è¡¨è¾¾å¼</p>
    </div>
    <div class="container">
        <div class="card">
            <div class="cron-input">
                <div class="cron-field">
                    <label>åˆ†é’Ÿ</label>
                    <input type="text" id="minute" value="0" oninput="parseCron()">
                </div>
                <div class="cron-field">
                    <label>å°æ—¶</label>
                    <input type="text" id="hour" value="*" oninput="parseCron()">
                </div>
                <div class="cron-field">
                    <label>æ—¥</label>
                    <input type="text" id="day" value="*" oninput="parseCron()">
                </div>
                <div class="cron-field">
                    <label>æœˆ</label>
                    <input type="text" id="month" value="*" oninput="parseCron()">
                </div>
                <div class="cron-field">
                    <label>æ˜ŸæœŸ</label>
                    <input type="text" id="weekday" value="*" oninput="parseCron()">
                </div>
            </div>
            
            <div class="description" id="description">æ¯å°æ—¶çš„ç¬¬ 0 åˆ†é’Ÿæ‰§è¡Œ</div>
            
            <div class="presets">
                <button class="preset-btn" onclick="setPreset('0 * * * *')">æ¯å°æ—¶</button>
                <button class="preset-btn" onclick="setPreset('0 0 * * *')">æ¯å¤©åˆå¤œ</button>
                <button class="preset-btn" onclick="setPreset('0 9 * * *')">æ¯å¤©9ç‚¹</button>
                <button class="preset-btn" onclick="setPreset('0 0 * * 1')">æ¯å‘¨ä¸€</button>
                <button class="preset-btn" onclick="setPreset('0 0 1 * *')">æ¯æœˆ1å·</button>
                <button class="preset-btn" onclick="setPreset('*/5 * * * *')">æ¯5åˆ†é’Ÿ</button>
                <button class="preset-btn" onclick="setPreset('*/15 * * * *')">æ¯15åˆ†é’Ÿ</button>
                <button class="preset-btn" onclick="setPreset('0 */2 * * *')">æ¯2å°æ—¶</button>
                <button class="preset-btn" onclick="setPreset('0 9-18 * * 1-5')">å·¥ä½œæ—¶é—´</button>
            </div>
            
            <div class="next-runs">
                <h3>æ¥ä¸‹æ¥5æ¬¡æ‰§è¡Œæ—¶é—´</h3>
                <div id="nextRuns"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="reference">
                <h3>Cron è¯­æ³•å‚è€ƒ</h3>
                <table class="ref-table">
                    <tr><th>å­—æ®µ</th><th>èŒƒå›´</th><th>ç‰¹æ®Šå­—ç¬¦</th></tr>
                    <tr><td>åˆ†é’Ÿ</td><td>0-59</td><td><code>*</code> <code>,</code> <code>-</code> <code>/</code></td></tr>
                    <tr><td>å°æ—¶</td><td>0-23</td><td><code>*</code> <code>,</code> <code>-</code> <code>/</code></td></tr>
                    <tr><td>æ—¥</td><td>1-31</td><td><code>*</code> <code>,</code> <code>-</code> <code>/</code></td></tr>
                    <tr><td>æœˆ</td><td>1-12</td><td><code>*</code> <code>,</code> <code>-</code> <code>/</code></td></tr>
                    <tr><td>æ˜ŸæœŸ</td><td>0-6 (0=å‘¨æ—¥)</td><td><code>*</code> <code>,</code> <code>-</code> <code>/</code></td></tr>
                </table>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: var(--text-secondary);">
                    <code>*</code> ä»»æ„å€¼ | <code>,</code> åˆ—è¡¨ | <code>-</code> èŒƒå›´ | <code>/</code> æ­¥é•¿
                </p>
            </div>
        </div>
    </div>
    <script>
        const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
        const months = ['', '1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
        
        window.setPreset = function(cron) {
            const parts = cron.split(' ');
            document.getElementById('minute').value = parts[0];
            document.getElementById('hour').value = parts[1];
            document.getElementById('day').value = parts[2];
            document.getElementById('month').value = parts[3];
            document.getElementById('weekday').value = parts[4];
            parseCron();
        };
        
        function parseField(value, min, max) {
            if (value === '*') return Array.from({ length: max - min + 1 }, (_, i) => min + i);
            
            const values = new Set();
            const parts = value.split(',');
            
            for (const part of parts) {
                if (part.includes('/')) {
                    const [range, step] = part.split('/');
                    const stepNum = parseInt(step);
                    let start = min, end = max;
                    if (range !== '*') {
                        if (range.includes('-')) {
                            [start, end] = range.split('-').map(Number);
                        } else {
                            start = parseInt(range);
                        }
                    }
                    for (let i = start; i <= end; i += stepNum) {
                        if (i >= min && i <= max) values.add(i);
                    }
                } else if (part.includes('-')) {
                    const [start, end] = part.split('-').map(Number);
                    for (let i = start; i <= end; i++) {
                        if (i >= min && i <= max) values.add(i);
                    }
                } else {
                    const num = parseInt(part);
                    if (num >= min && num <= max) values.add(num);
                }
            }
            
            return Array.from(values).sort((a, b) => a - b);
        }
        
        function describeCron() {
            const minute = document.getElementById('minute').value;
            const hour = document.getElementById('hour').value;
            const day = document.getElementById('day').value;
            const month = document.getElementById('month').value;
            const weekday = document.getElementById('weekday').value;
            
            let parts = [];
            
            // Time description
            if (minute === '*' && hour === '*') {
                parts.push('æ¯åˆ†é’Ÿ');
            } else if (minute.startsWith('*/')) {
                parts.push(`æ¯ ${minute.slice(2)} åˆ†é’Ÿ`);
            } else if (hour === '*') {
                parts.push(`æ¯å°æ—¶çš„ç¬¬ ${minute} åˆ†é’Ÿ`);
            } else if (hour.startsWith('*/')) {
                parts.push(`æ¯ ${hour.slice(2)} å°æ—¶çš„ç¬¬ ${minute} åˆ†é’Ÿ`);
            } else if (hour.includes('-')) {
                parts.push(`${hour} ç‚¹ä¹‹é—´çš„ç¬¬ ${minute} åˆ†é’Ÿ`);
            } else {
                parts.push(`${hour}:${minute.padStart(2, '0')}`);
            }
            
            // Day description
            if (day !== '*') {
                if (day.includes('-')) {
                    parts.push(`æ¯æœˆ ${day} æ—¥`);
                } else {
                    parts.push(`æ¯æœˆ ${day} æ—¥`);
                }
            }
            
            // Month description
            if (month !== '*') {
                const monthVals = parseField(month, 1, 12);
                parts.push(monthVals.map(m => months[m]).join('ã€'));
            }
            
            // Weekday description
            if (weekday !== '*') {
                const weekdayVals = parseField(weekday, 0, 6);
                parts.push(weekdayVals.map(w => weekdays[w]).join('ã€'));
            }
            
            return parts.join(' ') + ' æ‰§è¡Œ';
        }
        
        function getNextRuns(count = 5) {
            const minute = parseField(document.getElementById('minute').value, 0, 59);
            const hour = parseField(document.getElementById('hour').value, 0, 23);
            const day = parseField(document.getElementById('day').value, 1, 31);
            const month = parseField(document.getElementById('month').value, 1, 12);
            const weekday = parseField(document.getElementById('weekday').value, 0, 6);
            
            const runs = [];
            const now = new Date();
            let current = new Date(now);
            
            while (runs.length < count && current.getFullYear() < now.getFullYear() + 2) {
                current.setSeconds(0, 0);
                
                if (!month.includes(current.getMonth() + 1)) {
                    current.setMonth(current.getMonth() + 1, 1);
                    current.setHours(0, 0);
                    continue;
                }
                
                if (!day.includes(current.getDate())) {
                    current.setDate(current.getDate() + 1);
                    current.setHours(0, 0);
                    continue;
                }
                
                if (!weekday.includes(current.getDay())) {
                    current.setDate(current.getDate() + 1);
                    current.setHours(0, 0);
                    continue;
                }
                
                if (!hour.includes(current.getHours())) {
                    current.setHours(current.getHours() + 1, 0);
                    continue;
                }
                
                if (!minute.includes(current.getMinutes())) {
                    current.setMinutes(current.getMinutes() + 1);
                    continue;
                }
                
                if (current > now) {
                    runs.push(new Date(current));
                }
                current.setMinutes(current.getMinutes() + 1);
            }
            
            return runs;
        }
        
        function formatRelative(date) {
            const diff = date - new Date();
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days} å¤©å`;
            if (hours > 0) return `${hours} å°æ—¶å`;
            return `${minutes} åˆ†é’Ÿå`;
        }
        
        function parseCron() {
            try {
                const description = describeCron();
                document.getElementById('description').textContent = description;
                document.getElementById('description').classList.remove('error');
                
                const runs = getNextRuns(5);
                document.getElementById('nextRuns').innerHTML = runs.map(run => `
                    <div class="run-item">
                        <span>${run.toLocaleString('zh-CN')}</span>
                        <span class="relative">${formatRelative(run)}</span>
                    </div>
                `).join('');
            } catch (e) {
                document.getElementById('description').textContent = 'æ— æ•ˆçš„ Cron è¡¨è¾¾å¼';
                document.getElementById('description').classList.add('error');
                document.getElementById('nextRuns').innerHTML = '';
            }
        }
        
        window.toggleTheme = function() {
            const t = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
        };

        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
        parseCron();
    </script>
</body>
</html>

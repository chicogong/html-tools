<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Docker Compose ç”Ÿæˆå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="keywords" content="docker-compose-generator,dev,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/dev/docker-compose-generator.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/dev/docker-compose-generator.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <meta name="description" content="å¯è§†åŒ–ç”Ÿæˆ Docker Compose é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå¸¸è§æœåŠ¡æ¨¡æ¿" />
    <meta name="keywords" content="Docker,Compose,YAML,å®¹å™¨,é…ç½®ç”Ÿæˆ" />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --bg-color: #0a0a0a;
        --card-bg: #141414;
        --border-color: #262626;
        --text-primary: #fafafa;
        --text-secondary: #a1a1aa;
        --accent-color: #0db7ed;
        --accent-hover: #0a9ac9;
        --success-color: #22c55e;
        --warning-color: #eab308;
        --error-color: #ef4444;
        --code-bg: #1e1e1e;
      }

      [data-theme="light"] {
        --bg-color: #f5f5f5;
        --card-bg: #fff;
        --border-color: #e5e5e5;
        --text-primary: #171717;
        --text-secondary: #525252;
        --code-bg: #f8f8f8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg-color);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: var(--accent-color);
      }

      .subtitle {
        color: var(--text-secondary);
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        z-index: 100;
      }

      .back-link {
        position: fixed;
        top: 1rem;
        left: 1rem;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.9rem;
        z-index: 100;
      }

      .back-link:hover {
        color: var(--accent-color);
      }

      .main-grid {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 1.5rem;
      }

      @media (max-width: 900px) {
        .main-grid {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        padding: 1.5rem;
      }

      .panel h2 {
        font-size: 1.1rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border-color);
      }

      /* æœåŠ¡æ¨¡æ¿ */
      .templates {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .template-btn {
        padding: 0.75rem;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        color: var(--text-primary);
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
        text-align: left;
      }

      .template-btn:hover {
        border-color: var(--accent-color);
        background: var(--card-bg);
      }

      .template-btn .icon {
        font-size: 1.2rem;
        margin-right: 0.25rem;
      }

      /* æœåŠ¡åˆ—è¡¨ */
      .services-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .service-item {
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
      }

      .service-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .service-name {
        font-weight: 600;
        color: var(--accent-color);
      }

      .service-actions {
        display: flex;
        gap: 0.25rem;
      }

      .service-actions button {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0.25rem;
        font-size: 0.9rem;
      }

      .service-actions button:hover {
        color: var(--error-color);
      }

      .service-detail {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* è¡¨å• */
      .form-section {
        margin-bottom: 1.5rem;
      }

      .form-section h3 {
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
        color: var(--text-secondary);
      }

      .form-group {
        margin-bottom: 0.75rem;
      }

      .form-group label {
        display: block;
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
        color: var(--text-secondary);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.5rem;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        color: var(--text-primary);
        font-size: 0.9rem;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--accent-color);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }

      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }

      .btn-primary {
        background: var(--accent-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--accent-hover);
      }

      .btn-secondary {
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        border-color: var(--accent-color);
      }

      .btn-block {
        width: 100%;
      }

      /* è¾“å‡ºåŒºåŸŸ */
      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .output-actions {
        display: flex;
        gap: 0.5rem;
      }

      #output {
        width: 100%;
        min-height: 500px;
        background: var(--code-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        font-family: Monaco, Menlo, monospace;
        font-size: 0.85rem;
        color: var(--text-primary);
        resize: vertical;
        line-height: 1.5;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 200;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        padding: 1.5rem;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .modal-header h3 {
        font-size: 1.1rem;
      }

      .modal-close {
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 1.5rem;
        cursor: pointer;
      }

      /* ç«¯å£/ç¯å¢ƒå˜é‡åˆ—è¡¨ */
      .list-items {
        margin-top: 0.5rem;
      }

      .list-item {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .list-item input {
        flex: 1;
      }

      .list-item button {
        padding: 0.25rem 0.5rem;
        background: var(--error-color);
        color: white;
        border: none;
        border-radius: 0.25rem;
        cursor: pointer;
      }

      .add-item-btn {
        font-size: 0.85rem;
        color: var(--accent-color);
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.25rem 0;
      }

      .add-item-btn:hover {
        text-decoration: underline;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      Docker Compose ç”Ÿæˆå™¨ | åœ¨çº¿å·¥å…·
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>

    <div class="container">
      <header>
        <h1>ğŸ³ Docker Compose ç”Ÿæˆå™¨</h1>
        <p class="subtitle">å¯è§†åŒ–ç”Ÿæˆ docker-compose.yml é…ç½®æ–‡ä»¶</p>
      </header>

      <div class="main-grid">
        <div class="panel">
          <h2>å¿«é€Ÿæ·»åŠ æœåŠ¡</h2>
          <div class="templates">
            <button class="template-btn" onclick="addTemplate('nginx')">
              <span class="icon">ğŸŒ</span>
              Nginx
            </button>
            <button class="template-btn" onclick="addTemplate('mysql')">
              <span class="icon">ğŸ¬</span>
              MySQL
            </button>
            <button class="template-btn" onclick="addTemplate('postgres')">
              <span class="icon">ğŸ˜</span>
              PostgreSQL
            </button>
            <button class="template-btn" onclick="addTemplate('redis')">
              <span class="icon">ğŸ”´</span>
              Redis
            </button>
            <button class="template-btn" onclick="addTemplate('mongo')">
              <span class="icon">ğŸƒ</span>
              MongoDB
            </button>
            <button class="template-btn" onclick="addTemplate('node')">
              <span class="icon">ğŸ’š</span>
              Node.js
            </button>
            <button class="template-btn" onclick="addTemplate('python')">
              <span class="icon">ğŸ</span>
              Python
            </button>
            <button class="template-btn" onclick="addTemplate('php')">
              <span class="icon">ğŸ˜</span>
              PHP
            </button>
            <button class="template-btn" onclick="addTemplate('rabbitmq')">
              <span class="icon">ğŸ°</span>
              RabbitMQ
            </button>
            <button class="template-btn" onclick="addTemplate('elasticsearch')">
              <span class="icon">ğŸ”</span>
              Elastic
            </button>
            <button class="template-btn" onclick="addTemplate('minio')">
              <span class="icon">ğŸ“¦</span>
              MinIO
            </button>
            <button class="template-btn" onclick="addTemplate('custom')">
              <span class="icon">â•</span>
              è‡ªå®šä¹‰
            </button>
          </div>

          <h2>å·²æ·»åŠ çš„æœåŠ¡</h2>
          <div class="services-list" id="servicesList">
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem">
              ç‚¹å‡»ä¸Šæ–¹æ¨¡æ¿æ·»åŠ æœåŠ¡
            </p>
          </div>

          <div style="margin-top: 1rem">
            <button class="btn btn-secondary btn-block" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰æœåŠ¡</button>
          </div>
        </div>

        <div class="panel">
          <div class="output-header">
            <h2>docker-compose.yml</h2>
            <div class="output-actions">
              <button class="btn btn-secondary" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶</button>
              <button class="btn btn-primary" onclick="downloadOutput()">ğŸ’¾ ä¸‹è½½</button>
            </div>
          </div>
          <textarea id="output" readonly>
version: '3.8'

services:
  # ç‚¹å‡»å·¦ä¾§æ¨¡æ¿æ·»åŠ æœåŠ¡

networks:
  default:
    driver: bridge
</textarea
          >
        </div>
      </div>
    </div>

    <!-- ç¼–è¾‘æœåŠ¡ Modal -->
    <div class="modal" id="editModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">ç¼–è¾‘æœåŠ¡</h3>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>

        <div class="form-section">
          <div class="form-group">
            <label>æœåŠ¡åç§°</label>
            <input type="text" id="serviceName" placeholder="ä¾‹å¦‚: web, db, cache" />
          </div>
          <div class="form-group">
            <label>é•œåƒ</label>
            <input type="text" id="serviceImage" placeholder="ä¾‹å¦‚: nginx:latest" />
          </div>
          <div class="form-group">
            <label>å®¹å™¨åç§° (å¯é€‰)</label>
            <input type="text" id="containerName" placeholder="ä¾‹å¦‚: my-nginx" />
          </div>
        </div>

        <div class="form-section">
          <h3>ç«¯å£æ˜ å°„</h3>
          <div class="list-items" id="portsList"></div>
          <button class="add-item-btn" onclick="addPort()">+ æ·»åŠ ç«¯å£</button>
        </div>

        <div class="form-section">
          <h3>ç¯å¢ƒå˜é‡</h3>
          <div class="list-items" id="envList"></div>
          <button class="add-item-btn" onclick="addEnv()">+ æ·»åŠ ç¯å¢ƒå˜é‡</button>
        </div>

        <div class="form-section">
          <h3>å·æŒ‚è½½</h3>
          <div class="list-items" id="volumesList"></div>
          <button class="add-item-btn" onclick="addVolume()">+ æ·»åŠ å·</button>
        </div>

        <div class="form-section">
          <div class="form-group">
            <label>é‡å¯ç­–ç•¥</label>
            <select id="restartPolicy">
              <option value="">ä¸è®¾ç½®</option>
              <option value="always">always</option>
              <option value="unless-stopped">unless-stopped</option>
              <option value="on-failure">on-failure</option>
              <option value="no">no</option>
            </select>
          </div>
          <div class="form-group">
            <label>ä¾èµ–æœåŠ¡ (depends_on)</label>
            <input type="text" id="dependsOn" placeholder="é€—å·åˆ†éš”ï¼Œä¾‹å¦‚: db, redis" />
          </div>
        </div>

        <div style="display: flex; gap: 0.5rem">
          <button class="btn btn-primary" style="flex: 1" onclick="saveService()">ä¿å­˜</button>
          <button class="btn btn-secondary" style="flex: 1" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
      </div>
    </div>

    <script>
      // æœåŠ¡æ•°æ®
      let services = [];
      let editingIndex = -1;
      let tempPorts = [];
      let tempEnvs = [];
      let tempVolumes = [];

      // æœåŠ¡æ¨¡æ¿
      const templates = {
        nginx: {
          name: "nginx",
          image: "nginx:alpine",
          ports: ["80:80", "443:443"],
          volumes: ["./nginx.conf:/etc/nginx/nginx.conf:ro", "./html:/usr/share/nginx/html"],
          restart: "unless-stopped"
        },
        mysql: {
          name: "mysql",
          image: "mysql:8.0",
          ports: ["3306:3306"],
          environment: ["MYSQL_ROOT_PASSWORD=root123", "MYSQL_DATABASE=app"],
          volumes: ["mysql_data:/var/lib/mysql"],
          restart: "unless-stopped"
        },
        postgres: {
          name: "postgres",
          image: "postgres:15-alpine",
          ports: ["5432:5432"],
          environment: ["POSTGRES_USER=postgres", "POSTGRES_PASSWORD=postgres", "POSTGRES_DB=app"],
          volumes: ["postgres_data:/var/lib/postgresql/data"],
          restart: "unless-stopped"
        },
        redis: {
          name: "redis",
          image: "redis:7-alpine",
          ports: ["6379:6379"],
          volumes: ["redis_data:/data"],
          restart: "unless-stopped"
        },
        mongo: {
          name: "mongo",
          image: "mongo:6",
          ports: ["27017:27017"],
          environment: ["MONGO_INITDB_ROOT_USERNAME=root", "MONGO_INITDB_ROOT_PASSWORD=root123"],
          volumes: ["mongo_data:/data/db"],
          restart: "unless-stopped"
        },
        node: {
          name: "app",
          image: "node:20-alpine",
          ports: ["3000:3000"],
          volumes: [".:/app", "/app/node_modules"],
          environment: ["NODE_ENV=development"],
          command: "npm run dev"
        },
        python: {
          name: "app",
          image: "python:3.11-slim",
          ports: ["8000:8000"],
          volumes: [".:/app"],
          environment: ["PYTHONUNBUFFERED=1"],
          command: "python main.py"
        },
        php: {
          name: "php",
          image: "php:8.2-fpm",
          volumes: ["./src:/var/www/html"],
          restart: "unless-stopped"
        },
        rabbitmq: {
          name: "rabbitmq",
          image: "rabbitmq:3-management-alpine",
          ports: ["5672:5672", "15672:15672"],
          environment: ["RABBITMQ_DEFAULT_USER=admin", "RABBITMQ_DEFAULT_PASS=admin123"],
          volumes: ["rabbitmq_data:/var/lib/rabbitmq"],
          restart: "unless-stopped"
        },
        elasticsearch: {
          name: "elasticsearch",
          image: "elasticsearch:8.11.0",
          ports: ["9200:9200"],
          environment: [
            "discovery.type=single-node",
            "ES_JAVA_OPTS=-Xms512m -Xmx512m",
            "xpack.security.enabled=false"
          ],
          volumes: ["es_data:/usr/share/elasticsearch/data"],
          restart: "unless-stopped"
        },
        minio: {
          name: "minio",
          image: "minio/minio:latest",
          ports: ["9000:9000", "9001:9001"],
          environment: ["MINIO_ROOT_USER=minioadmin", "MINIO_ROOT_PASSWORD=minioadmin"],
          volumes: ["minio_data:/data"],
          command: 'server /data --console-address ":9001"',
          restart: "unless-stopped"
        },
        custom: {
          name: "service",
          image: "",
          ports: [],
          environment: [],
          volumes: []
        }
      };

      window.addTemplate = function (type) {
        const template = JSON.parse(JSON.stringify(templates[type]));

        // ç¡®ä¿åç§°å”¯ä¸€
        let baseName = template.name;
        let counter = 1;
        while (services.some((s) => s.name === template.name)) {
          template.name = baseName + counter;
          counter++;
        }

        editingIndex = -1;
        openModal(template);
      };

      function openModal(service) {
        document.getElementById("modalTitle").textContent =
          editingIndex === -1 ? "æ·»åŠ æœåŠ¡" : "ç¼–è¾‘æœåŠ¡";
        document.getElementById("serviceName").value = service.name || "";
        document.getElementById("serviceImage").value = service.image || "";
        document.getElementById("containerName").value = service.container_name || "";
        document.getElementById("restartPolicy").value = service.restart || "";
        document.getElementById("dependsOn").value = (service.depends_on || []).join(", ");

        tempPorts = service.ports || [];
        tempEnvs = service.environment || [];
        tempVolumes = service.volumes || [];

        renderPorts();
        renderEnvs();
        renderVolumes();

        document.getElementById("editModal").classList.add("active");
      }

      window.closeModal = function () {
        document.getElementById("editModal").classList.remove("active");
      };

      function renderPorts() {
        const container = document.getElementById("portsList");
        container.innerHTML = tempPorts
          .map(
            (port, i) => `
                <div class="list-item">
                    <input type="text" value="${port}" onchange="tempPorts[${i}]=this.value" placeholder="ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£">
                    <button onclick="tempPorts.splice(${i},1);renderPorts()">Ã—</button>
                </div>
            `
          )
          .join("");
      }

      window.addPort = function () {
        tempPorts.push("");
        renderPorts();
      };

      function renderEnvs() {
        const container = document.getElementById("envList");
        container.innerHTML = tempEnvs
          .map(
            (env, i) => `
                <div class="list-item">
                    <input type="text" value="${env}" onchange="tempEnvs[${i}]=this.value" placeholder="KEY=value">
                    <button onclick="tempEnvs.splice(${i},1);renderEnvs()">Ã—</button>
                </div>
            `
          )
          .join("");
      }

      window.addEnv = function () {
        tempEnvs.push("");
        renderEnvs();
      };

      function renderVolumes() {
        const container = document.getElementById("volumesList");
        container.innerHTML = tempVolumes
          .map(
            (vol, i) => `
                <div class="list-item">
                    <input type="text" value="${vol}" onchange="tempVolumes[${i}]=this.value" placeholder="ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„">
                    <button onclick="tempVolumes.splice(${i},1);renderVolumes()">Ã—</button>
                </div>
            `
          )
          .join("");
      }

      window.addVolume = function () {
        tempVolumes.push("");
        renderVolumes();
      };

      window.saveService = function () {
        const name = document.getElementById("serviceName").value.trim();
        const image = document.getElementById("serviceImage").value.trim();

        if (!name) {
          alert("è¯·è¾“å…¥æœåŠ¡åç§°");
          return;
        }
        if (!image) {
          alert("è¯·è¾“å…¥é•œåƒåç§°");
          return;
        }

        // æ£€æŸ¥åç§°é‡å¤
        const isDuplicate = services.some((s, i) => s.name === name && i !== editingIndex);
        if (isDuplicate) {
          alert("æœåŠ¡åç§°å·²å­˜åœ¨");
          return;
        }

        const service = {
          name,
          image,
          container_name: document.getElementById("containerName").value.trim(),
          ports: tempPorts.filter((p) => p.trim()),
          environment: tempEnvs.filter((e) => e.trim()),
          volumes: tempVolumes.filter((v) => v.trim()),
          restart: document.getElementById("restartPolicy").value,
          depends_on: document
            .getElementById("dependsOn")
            .value.split(",")
            .map((s) => s.trim())
            .filter((s) => s)
        };

        if (editingIndex === -1) {
          services.push(service);
        } else {
          services[editingIndex] = service;
        }

        closeModal();
        renderServices();
        generateOutput();
      };

      function renderServices() {
        const container = document.getElementById("servicesList");

        if (services.length === 0) {
          container.innerHTML =
            '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">ç‚¹å‡»ä¸Šæ–¹æ¨¡æ¿æ·»åŠ æœåŠ¡</p>';
          return;
        }

        container.innerHTML = services
          .map(
            (s, i) => `
                <div class="service-item">
                    <div class="service-header">
                        <span class="service-name">${s.name}</span>
                        <div class="service-actions">
                            <button onclick="editService(${i})" title="ç¼–è¾‘">âœï¸</button>
                            <button onclick="removeService(${i})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="service-detail">
                        ${s.image}
                        ${s.ports.length ? " â€¢ " + s.ports.join(", ") : ""}
                    </div>
                </div>
            `
          )
          .join("");
      }

      window.editService = function (index) {
        editingIndex = index;
        openModal(services[index]);
      };

      window.removeService = function (index) {
        services.splice(index, 1);
        renderServices();
        generateOutput();
      };

      window.clearAll = function () {
        if (services.length && confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰æœåŠ¡å—ï¼Ÿ")) {
          services = [];
          renderServices();
          generateOutput();
        }
      };

      function generateOutput() {
        if (services.length === 0) {
          document.getElementById("output").value = `version: '3.8'

services:
  # ç‚¹å‡»å·¦ä¾§æ¨¡æ¿æ·»åŠ æœåŠ¡

networks:
  default:
    driver: bridge
`;
          return;
        }

        let yaml = "version: '3.8'\n\nservices:\n";

        // æ”¶é›†å‘½åå·
        const namedVolumes = new Set();

        services.forEach((s) => {
          yaml += `  ${s.name}:\n`;
          yaml += `    image: ${s.image}\n`;

          if (s.container_name) {
            yaml += `    container_name: ${s.container_name}\n`;
          }

          if (s.ports && s.ports.length) {
            yaml += "    ports:\n";
            s.ports.forEach((p) => (yaml += `      - "${p}"\n`));
          }

          if (s.environment && s.environment.length) {
            yaml += "    environment:\n";
            s.environment.forEach((e) => (yaml += `      - ${e}\n`));
          }

          if (s.volumes && s.volumes.length) {
            yaml += "    volumes:\n";
            s.volumes.forEach((v) => {
              yaml += `      - ${v}\n`;
              // æ£€æµ‹å‘½åå·
              const parts = v.split(":");
              if (parts[0] && !parts[0].startsWith(".") && !parts[0].startsWith("/")) {
                namedVolumes.add(parts[0]);
              }
            });
          }

          if (s.restart) {
            yaml += `    restart: ${s.restart}\n`;
          }

          if (s.depends_on && s.depends_on.length) {
            yaml += "    depends_on:\n";
            s.depends_on.forEach((d) => (yaml += `      - ${d}\n`));
          }

          if (s.command) {
            yaml += `    command: ${s.command}\n`;
          }

          yaml += "\n";
        });

        // æ·»åŠ å‘½åå·å®šä¹‰
        if (namedVolumes.size > 0) {
          yaml += "volumes:\n";
          namedVolumes.forEach((v) => (yaml += `  ${v}:\n`));
          yaml += "\n";
        }

        yaml += "networks:\n  default:\n    driver: bridge\n";

        document.getElementById("output").value = yaml;
      }

      window.copyOutput = function () {
        const output = document.getElementById("output");
        navigator.clipboard.writeText(output.value).then(() => {
          alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        });
      };

      window.downloadOutput = function () {
        const output = document.getElementById("output").value;
        const blob = new Blob([output], { type: "text/yaml" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "docker-compose.yml";
        a.click();
        URL.revokeObjectURL(url);
      };

      window.toggleTheme = function () {
        const html = document.documentElement;
        const current = html.getAttribute("data-theme");
        const next = current === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
      };

      // åˆå§‹åŒ–
      (function () {
        const saved = localStorage.getItem("theme") || "dark";
        document.documentElement.setAttribute("data-theme", saved);
      })();
    </script>
  </body>
</html>

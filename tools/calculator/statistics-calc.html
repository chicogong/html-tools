<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿè®¡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --primary-color: #10b981;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .calculator {
            background: var(--pico-card-background-color);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .theme-toggle {
            background: none;
            border: 2px solid var(--pico-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .input-section {
            background: var(--pico-form-element-background-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .input-section label {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        
        .input-section textarea {
            width: 100%;
            min-height: 100px;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            resize: vertical;
        }
        
        .input-hint {
            font-size: 0.85rem;
            color: var(--pico-muted-color);
            margin-top: 10px;
        }
        
        .btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .btn {
            padding: 12px 20px;
            font-size: 0.9rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--pico-secondary-background);
            color: var(--pico-color);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .result-card {
            background: var(--pico-form-element-background-color);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .result-label {
            font-size: 0.85rem;
            color: var(--pico-muted-color);
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--pico-primary);
        }
        
        .chart-section {
            background: var(--pico-form-element-background-color);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .histogram {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            height: 200px;
            gap: 5px;
            padding: 20px 0;
        }
        
        .bar {
            background: linear-gradient(180deg, #10b981 0%, #059669 100%);
            border-radius: 5px 5px 0 0;
            min-width: 30px;
            transition: height 0.3s;
            position: relative;
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            white-space: nowrap;
        }
        
        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
        }
        
        .data-table {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th, .data-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid var(--pico-muted-border-color);
        }
        
        .sample-data {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .sample-data button {
            font-size: 0.8rem;
            padding: 8px 12px;
        }
    </style>
</head>
<body>
    <main class="container">
        <div class="calculator">
            <div class="header">
                <h1>ğŸ“ˆ ç»Ÿè®¡è®¡ç®—å™¨</h1>
                <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            </div>
            
            <div class="input-section">
                <label>è¾“å…¥æ•°æ®</label>
                <textarea id="dataInput" placeholder="è¯·è¾“å…¥æ•°æ®ï¼Œç”¨é€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”&#10;ä¾‹å¦‚: 1, 2, 3, 4, 5"></textarea>
                <div class="input-hint">æ”¯æŒé€—å·ã€ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦æˆ–æ¢è¡Œç¬¦åˆ†éš”çš„æ•°å­—</div>
                <div class="sample-data">
                    <button class="btn" onclick="loadSample('normal')">æ­£æ€åˆ†å¸ƒæ ·æœ¬</button>
                    <button class="btn" onclick="loadSample('uniform')">å‡åŒ€åˆ†å¸ƒæ ·æœ¬</button>
                    <button class="btn" onclick="loadSample('grades')">è€ƒè¯•æˆç»©æ ·æœ¬</button>
                </div>
            </div>
            
            <div class="btn-row">
                <button class="btn btn-primary" onclick="calculate()">è®¡ç®—ç»Ÿè®¡é‡</button>
                <button class="btn btn-secondary" onclick="clearAll()">æ¸…ç©º</button>
            </div>
            
            <div class="results" id="results">
                <div class="result-card">
                    <div class="result-label">æ ·æœ¬æ•°é‡ (n)</div>
                    <div class="result-value" id="count">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ€»å’Œ (Î£x)</div>
                    <div class="result-value" id="sum">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">å¹³å‡å€¼ (xÌ„)</div>
                    <div class="result-value" id="mean">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">ä¸­ä½æ•°</div>
                    <div class="result-value" id="median">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">ä¼—æ•°</div>
                    <div class="result-value" id="mode">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æœ€å°å€¼</div>
                    <div class="result-value" id="min">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æœ€å¤§å€¼</div>
                    <div class="result-value" id="max">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æå·®</div>
                    <div class="result-value" id="range">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ€»ä½“æ–¹å·® (ÏƒÂ²)</div>
                    <div class="result-value" id="varianceP">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ ·æœ¬æ–¹å·® (sÂ²)</div>
                    <div class="result-value" id="varianceS">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ€»ä½“æ ‡å‡†å·® (Ïƒ)</div>
                    <div class="result-value" id="stdP">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ ·æœ¬æ ‡å‡†å·® (s)</div>
                    <div class="result-value" id="stdS">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">å˜å¼‚ç³»æ•° (CV)</div>
                    <div class="result-value" id="cv">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">æ ‡å‡†è¯¯å·® (SE)</div>
                    <div class="result-value" id="se">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">ååº¦</div>
                    <div class="result-value" id="skewness">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">å³°åº¦</div>
                    <div class="result-value" id="kurtosis">-</div>
                </div>
            </div>
            
            <div class="chart-section">
                <h3>é¢‘ç‡åˆ†å¸ƒç›´æ–¹å›¾</h3>
                <div class="histogram" id="histogram"></div>
            </div>
            
            <div class="chart-section">
                <h3>äº”æ•°æ¦‚æ‹¬</h3>
                <div class="data-table" id="fiveNumber"></div>
            </div>
        </div>
    </main>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }

        function parseData() {
            const input = document.getElementById('dataInput').value;
            const numbers = input.split(/[\s,\t\n]+/)
                .map(s => parseFloat(s.trim()))
                .filter(n => !isNaN(n));
            return numbers;
        }

        function formatNumber(n) {
            if (n === undefined || n === null || isNaN(n)) return '-';
            return Number.isInteger(n) ? n.toString() : n.toFixed(4);
        }

        function mean(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        function median(arr) {
            const sorted = [...arr].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

        function mode(arr) {
            const freq = {};
            arr.forEach(n => freq[n] = (freq[n] || 0) + 1);
            const maxFreq = Math.max(...Object.values(freq));
            const modes = Object.keys(freq).filter(k => freq[k] === maxFreq).map(Number);
            return modes.length === arr.length ? 'æ— ' : modes.join(', ');
        }

        function variance(arr, sample = false) {
            const m = mean(arr);
            const sq = arr.map(n => Math.pow(n - m, 2));
            return sq.reduce((a, b) => a + b, 0) / (arr.length - (sample ? 1 : 0));
        }

        function standardDeviation(arr, sample = false) {
            return Math.sqrt(variance(arr, sample));
        }

        function skewness(arr) {
            const m = mean(arr);
            const s = standardDeviation(arr, true);
            const n = arr.length;
            const sum = arr.reduce((acc, x) => acc + Math.pow((x - m) / s, 3), 0);
            return (n / ((n - 1) * (n - 2))) * sum;
        }

        function kurtosis(arr) {
            const m = mean(arr);
            const s = standardDeviation(arr, true);
            const n = arr.length;
            const sum = arr.reduce((acc, x) => acc + Math.pow((x - m) / s, 4), 0);
            return ((n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3))) * sum - 
                   (3 * Math.pow(n - 1, 2)) / ((n - 2) * (n - 3));
        }

        function percentile(arr, p) {
            const sorted = [...arr].sort((a, b) => a - b);
            const index = (p / 100) * (sorted.length - 1);
            const lower = Math.floor(index);
            const upper = Math.ceil(index);
            if (lower === upper) return sorted[lower];
            return sorted[lower] + (index - lower) * (sorted[upper] - sorted[lower]);
        }

        function calculate() {
            const data = parseData();
            
            if (data.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°æ®');
                return;
            }
            
            const sorted = [...data].sort((a, b) => a - b);
            
            document.getElementById('count').textContent = data.length;
            document.getElementById('sum').textContent = formatNumber(data.reduce((a, b) => a + b, 0));
            document.getElementById('mean').textContent = formatNumber(mean(data));
            document.getElementById('median').textContent = formatNumber(median(data));
            document.getElementById('mode').textContent = mode(data);
            document.getElementById('min').textContent = formatNumber(Math.min(...data));
            document.getElementById('max').textContent = formatNumber(Math.max(...data));
            document.getElementById('range').textContent = formatNumber(Math.max(...data) - Math.min(...data));
            document.getElementById('varianceP').textContent = formatNumber(variance(data, false));
            document.getElementById('varianceS').textContent = formatNumber(variance(data, true));
            document.getElementById('stdP').textContent = formatNumber(standardDeviation(data, false));
            document.getElementById('stdS').textContent = formatNumber(standardDeviation(data, true));
            
            const cv = (standardDeviation(data, true) / mean(data)) * 100;
            document.getElementById('cv').textContent = formatNumber(cv) + '%';
            document.getElementById('se').textContent = formatNumber(standardDeviation(data, true) / Math.sqrt(data.length));
            
            if (data.length >= 3) {
                document.getElementById('skewness').textContent = formatNumber(skewness(data));
                document.getElementById('kurtosis').textContent = formatNumber(kurtosis(data));
            }
            
            drawHistogram(data);
            showFiveNumber(data);
        }

        function drawHistogram(data) {
            const container = document.getElementById('histogram');
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min;
            const binCount = Math.min(10, Math.ceil(Math.sqrt(data.length)));
            const binWidth = range / binCount;
            
            const bins = Array(binCount).fill(0);
            data.forEach(d => {
                let binIndex = Math.floor((d - min) / binWidth);
                if (binIndex >= binCount) binIndex = binCount - 1;
                bins[binIndex]++;
            });
            
            const maxBin = Math.max(...bins);
            const maxHeight = 180;
            
            container.innerHTML = bins.map((count, i) => {
                const height = maxBin > 0 ? (count / maxBin) * maxHeight : 0;
                const start = min + i * binWidth;
                const end = start + binWidth;
                return `<div class="bar" style="height: ${height}px;">
                    <span class="bar-value">${count}</span>
                    <span class="bar-label">${formatNumber(start)}</span>
                </div>`;
            }).join('');
        }

        function showFiveNumber(data) {
            const container = document.getElementById('fiveNumber');
            const q1 = percentile(data, 25);
            const q2 = percentile(data, 50);
            const q3 = percentile(data, 75);
            const iqr = q3 - q1;
            
            container.innerHTML = `
                <table>
                    <tr>
                        <th>ç»Ÿè®¡é‡</th>
                        <th>æœ€å°å€¼</th>
                        <th>Q1 (25%)</th>
                        <th>ä¸­ä½æ•° (50%)</th>
                        <th>Q3 (75%)</th>
                        <th>æœ€å¤§å€¼</th>
                        <th>IQR</th>
                    </tr>
                    <tr>
                        <td>æ•°å€¼</td>
                        <td>${formatNumber(Math.min(...data))}</td>
                        <td>${formatNumber(q1)}</td>
                        <td>${formatNumber(q2)}</td>
                        <td>${formatNumber(q3)}</td>
                        <td>${formatNumber(Math.max(...data))}</td>
                        <td>${formatNumber(iqr)}</td>
                    </tr>
                </table>
            `;
        }

        function loadSample(type) {
            let data;
            switch (type) {
                case 'normal':
                    // Box-Muller transform for normal distribution
                    data = Array(50).fill(0).map(() => {
                        const u1 = Math.random();
                        const u2 = Math.random();
                        return 50 + 10 * Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    }).map(n => Math.round(n * 10) / 10);
                    break;
                case 'uniform':
                    data = Array(30).fill(0).map(() => Math.round(Math.random() * 100));
                    break;
                case 'grades':
                    data = [85, 90, 78, 92, 88, 76, 95, 82, 89, 91, 73, 87, 84, 79, 93, 86, 81, 77, 94, 80, 72, 88, 85, 91, 83];
                    break;
            }
            document.getElementById('dataInput').value = data.join(', ');
            calculate();
        }

        function clearAll() {
            document.getElementById('dataInput').value = '';
            ['count', 'sum', 'mean', 'median', 'mode', 'min', 'max', 'range', 
             'varianceP', 'varianceS', 'stdP', 'stdS', 'cv', 'se', 'skewness', 'kurtosis']
                .forEach(id => document.getElementById(id).textContent = '-');
            document.getElementById('histogram').innerHTML = '';
            document.getElementById('fiveNumber').innerHTML = '';
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
    </script>
</body>
</html>

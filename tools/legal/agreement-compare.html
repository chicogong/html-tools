<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åè®®å¯¹æ¯”å·¥å…· - WebUtils</title>
  <meta name="description" content="å¯¹æ¯”ä¸¤ä»½åè®®æˆ–åˆåŒçš„å·®å¼‚ï¼Œé«˜äº®æ˜¾ç¤ºä¿®æ”¹å†…å®¹" />
  <meta name="keywords" content="åè®®å¯¹æ¯” åˆåŒæ¯”è¾ƒ æ–‡æ¡£å·®å¼‚ æ³•å¾‹æ–‡æ¡£ diff" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="åè®®å¯¹æ¯”å·¥å…· - WebUtils" />
  <meta property="og:description" content="å¯¹æ¯”ä¸¤ä»½åè®®æˆ–åˆåŒçš„å·®å¼‚ï¼Œé«˜äº®æ˜¾ç¤ºä¿®æ”¹å†…å®¹" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="åè®®å¯¹æ¯”å·¥å…· - WebUtils" />
  <meta name="twitter:description" content="å¯¹æ¯”ä¸¤ä»½åè®®æˆ–åˆåŒçš„å·®å¼‚ï¼Œé«˜äº®æ˜¾ç¤ºä¿®æ”¹å†…å®¹" />

  <style>
    :root {
      --bg: #f8f9fa;
      --card-bg: #fff;
      --text: #212529;
      --text-muted: #6c757d;
      --border: #dee2e6;
      --primary: #6366f1;
      --primary-hover: #4f46e5;
      --success: #198754;
      --danger: #dc3545;
      --warning: #ffc107;
      --shadow: 0 2px 8px rgb(0,0,0,0.08);
      --radius: 8px;
      --added-bg: #d4edda;
      --added-text: #155724;
      --removed-bg: #f8d7da;
      --removed-text: #721c24;
      --changed-bg: #fff3cd;
      --changed-text: #856404;
    }

    [data-theme="dark"] {
      --bg: #0a0a0f;
      --card-bg: #1a1a24;
      --text: #e8e8ed;
      --text-muted: #9898a4;
      --border: #2a2a36;
      --primary: #818cf8;
      --primary-hover: #6366f1;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --shadow: 0 2px 8px rgb(0,0,0,0.3);
      --added-bg: #064e3b;
      --added-text: #6ee7b7;
      --removed-bg: #7f1d1d;
      --removed-text: #fca5a5;
      --changed-bg: #78350f;
      --changed-text: #fcd34d;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--card-bg);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all .2s;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    h1 {
      font-size: 1.75rem;
      margin: 0 0 8px;
    }

    .desc {
      color: var(--text-muted);
      margin: 0 0 24px;
      font-size: 0.95rem;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 900px) {
      .panels {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .panel-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }

    .panel-actions {
      display: flex;
      gap: 8px;
    }

    .panel-actions button {
      padding: 4px 10px;
      font-size: 0.8rem;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      padding: 12px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 0.9rem;
      line-height: 1.6;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      color: var(--text);
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(99,102,241,0.15);
    }

    .btn-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 0.95rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    button.primary {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    button.primary:hover {
      background: var(--primary-hover);
      border-color: var(--primary-hover);
      color: #fff;
    }

    .options {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 20px;
      font-size: 0.9rem;
    }

    .options label {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .options input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
    }

    .stats {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      padding: 16px;
      background: var(--bg);
      border-radius: var(--radius);
      margin-bottom: 20px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .stat-badge.added {
      background: var(--added-bg);
      color: var(--added-text);
    }

    .stat-badge.removed {
      background: var(--removed-bg);
      color: var(--removed-text);
    }

    .stat-badge.changed {
      background: var(--changed-bg);
      color: var(--changed-text);
    }

    .result-section {
      margin-top: 20px;
    }

    .result-section h3 {
      font-size: 1rem;
      margin: 0 0 12px;
      color: var(--text);
    }

    .diff-view {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 0.9rem;
      line-height: 1.8;
      max-height: 500px;
      overflow-y: auto;
    }

    .diff-line {
      padding: 2px 8px;
      margin: 2px 0;
      border-radius: 4px;
      white-space: pre-wrap;
      overflow-wrap: break-word;
    }

    .diff-line.added {
      background: var(--added-bg);
      color: var(--added-text);
    }

    .diff-line.removed {
      background: var(--removed-bg);
      color: var(--removed-text);
    }

    .diff-line.unchanged {
      color: var(--text-muted);
    }

    .side-by-side {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      .side-by-side {
        grid-template-columns: 1fr;
      }
    }

    .side-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      max-height: 500px;
      overflow-y: auto;
    }

    .side-panel h4 {
      margin: 0 0 12px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .status {
      font-size: 0.85rem;
      margin-top: 8px;
      min-height: 20px;
    }

    .status.success {
      color: var(--success);
    }

    .status.error {
      color: var(--danger);
    }

    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>

    <h1>åè®®å¯¹æ¯”å·¥å…·</h1>
    <p class="desc">å¯¹æ¯”ä¸¤ä»½åè®®æˆ–åˆåŒçš„å·®å¼‚ï¼Œé«˜äº®æ˜¾ç¤ºæ–°å¢ã€åˆ é™¤å’Œä¿®æ”¹çš„å†…å®¹</p>

    <div class="card">
      <div class="panels">
        <div class="panel">
          <div class="panel-header">
            <span class="panel-label">åŸå§‹åè®®ï¼ˆæ—§ç‰ˆæœ¬ï¼‰</span>
            <div class="panel-actions">
              <button type="button" onclick="pasteOriginal()">ç²˜è´´</button>
              <button type="button" onclick="clearOriginal()">æ¸…ç©º</button>
            </div>
          </div>
          <textarea id="originalText" placeholder="ç²˜è´´åŸå§‹åè®®å†…å®¹..."></textarea>
        </div>
        <div class="panel">
          <div class="panel-header">
            <span class="panel-label">ä¿®æ”¹ååè®®ï¼ˆæ–°ç‰ˆæœ¬ï¼‰</span>
            <div class="panel-actions">
              <button type="button" onclick="pasteModified()">ç²˜è´´</button>
              <button type="button" onclick="clearModified()">æ¸…ç©º</button>
            </div>
          </div>
          <textarea id="modifiedText" placeholder="ç²˜è´´ä¿®æ”¹åçš„åè®®å†…å®¹..."></textarea>
        </div>
      </div>

      <div class="options">
        <label>
          <input type="checkbox" id="ignoreWhitespace" />
          å¿½ç•¥ç©ºç™½å·®å¼‚
        </label>
        <label>
          <input type="checkbox" id="ignoreCase" />
          å¿½ç•¥å¤§å°å†™
        </label>
        <label>
          <input type="checkbox" id="showLineNumbers" checked />
          æ˜¾ç¤ºè¡Œå·
        </label>
        <label>
          <input type="checkbox" id="sideBySide" />
          å¹¶æ’è§†å›¾
        </label>
      </div>

      <div class="btn-row">
        <button class="primary" onclick="compareDocuments()">å¼€å§‹å¯¹æ¯”</button>
        <button onclick="swapDocuments()">äº¤æ¢æ–‡æ¡£</button>
        <button onclick="copyDiff()">å¤åˆ¶å·®å¼‚æŠ¥å‘Š</button>
        <button onclick="clearAll()">æ¸…ç©ºå…¨éƒ¨</button>
      </div>

      <div id="status" class="status"></div>

      <div id="statsSection" class="stats" style="display: none;">
        <div class="stat-item">
          <span class="stat-badge added" id="addedCount">+0 è¡Œæ–°å¢</span>
        </div>
        <div class="stat-item">
          <span class="stat-badge removed" id="removedCount">-0 è¡Œåˆ é™¤</span>
        </div>
        <div class="stat-item">
          <span class="stat-badge changed" id="changedCount">~0 è¡Œå¯èƒ½ä¿®æ”¹</span>
        </div>
      </div>

      <div id="resultSection" class="result-section" style="display: none;">
        <h3>å¯¹æ¯”ç»“æœ</h3>
        <div id="diffOutput"></div>
      </div>
    </div>

    <footer>
      çº¯å‰ç«¯å·¥å…· Â· æ— æœåŠ¡å™¨ Â· 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>

  <script>
    var LS_KEY = 'agreement_compare_v1';

    function getOptions() {
      return {
        ignoreWhitespace: document.getElementById('ignoreWhitespace').checked,
        ignoreCase: document.getElementById('ignoreCase').checked,
        showLineNumbers: document.getElementById('showLineNumbers').checked,
        sideBySide: document.getElementById('sideBySide').checked
      };
    }

    function preprocessText(text, options) {
      if (options.ignoreWhitespace) {
        text = text.replace(/[ \t]+/g, ' ').replace(/^ +| +$/gm, '');
      }
      if (options.ignoreCase) {
        text = text.toLowerCase();
      }
      return text;
    }

    function computeLCS(arr1, arr2) {
      var m = arr1.length;
      var n = arr2.length;
      var dp = [];
      
      for (var i = 0; i <= m; i++) {
        dp[i] = [];
        for (var j = 0; j <= n; j++) {
          if (i === 0 || j === 0) {
            dp[i][j] = 0;
          } else if (arr1[i - 1] === arr2[j - 1]) {
            dp[i][j] = dp[i - 1][j - 1] + 1;
          } else {
            dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
          }
        }
      }
      
      var lcs = [];
      var i = m, j = n;
      while (i > 0 && j > 0) {
        if (arr1[i - 1] === arr2[j - 1]) {
          lcs.unshift({ value: arr1[i - 1], index1: i - 1, index2: j - 1 });
          i--;
          j--;
        } else if (dp[i - 1][j] > dp[i][j - 1]) {
          i--;
        } else {
          j--;
        }
      }
      
      return lcs;
    }

    function computeDiff(original, modified, options) {
      var origLines = original.split('\n');
      var modLines = modified.split('\n');
      
      var processedOrig = preprocessText(original, options).split('\n');
      var processedMod = preprocessText(modified, options).split('\n');
      
      var lcs = computeLCS(processedOrig, processedMod);
      
      var diff = [];
      var origIdx = 0;
      var modIdx = 0;
      var lcsIdx = 0;
      
      while (origIdx < origLines.length || modIdx < modLines.length) {
        if (lcsIdx < lcs.length && origIdx === lcs[lcsIdx].index1 && modIdx === lcs[lcsIdx].index2) {
          diff.push({ type: 'unchanged', value: origLines[origIdx], origLine: origIdx + 1, modLine: modIdx + 1 });
          origIdx++;
          modIdx++;
          lcsIdx++;
        } else if (lcsIdx < lcs.length && origIdx < lcs[lcsIdx].index1) {
          diff.push({ type: 'removed', value: origLines[origIdx], origLine: origIdx + 1 });
          origIdx++;
        } else if (lcsIdx < lcs.length && modIdx < lcs[lcsIdx].index2) {
          diff.push({ type: 'added', value: modLines[modIdx], modLine: modIdx + 1 });
          modIdx++;
        } else if (origIdx < origLines.length) {
          diff.push({ type: 'removed', value: origLines[origIdx], origLine: origIdx + 1 });
          origIdx++;
        } else {
          diff.push({ type: 'added', value: modLines[modIdx], modLine: modIdx + 1 });
          modIdx++;
        }
      }
      
      return diff;
    }

    function createDiffLine(text, className) {
      var div = document.createElement('div');
      div.className = 'diff-line ' + className;
      div.textContent = text;
      return div;
    }

    function renderUnifiedDiff(diff, options, container) {
      var wrapper = document.createElement('div');
      wrapper.className = 'diff-view';
      
      var addedCount = 0;
      var removedCount = 0;
      
      diff.forEach(function(item) {
        var lineNum = '';
        if (options.showLineNumbers) {
          if (item.type === 'unchanged') {
            lineNum = item.origLine + '/' + item.modLine + ': ';
          } else if (item.type === 'removed') {
            lineNum = item.origLine + '/-: ';
          } else {
            lineNum = '-/' + item.modLine + ': ';
          }
        }
        
        var prefix = '';
        if (item.type === 'added') {
          prefix = '+ ';
          addedCount++;
        } else if (item.type === 'removed') {
          prefix = '- ';
          removedCount++;
        } else {
          prefix = '  ';
        }
        
        wrapper.appendChild(createDiffLine(lineNum + prefix + item.value, item.type));
      });
      
      container.textContent = '';
      container.appendChild(wrapper);
      return { added: addedCount, removed: removedCount };
    }

    function renderSideBySideDiff(diff, options, container) {
      var wrapper = document.createElement('div');
      wrapper.className = 'side-by-side';
      
      var leftPanel = document.createElement('div');
      leftPanel.className = 'side-panel';
      var leftTitle = document.createElement('h4');
      leftTitle.textContent = 'åŸå§‹åè®®';
      leftPanel.appendChild(leftTitle);
      
      var rightPanel = document.createElement('div');
      rightPanel.className = 'side-panel';
      var rightTitle = document.createElement('h4');
      rightTitle.textContent = 'ä¿®æ”¹ååè®®';
      rightPanel.appendChild(rightTitle);
      
      var addedCount = 0;
      var removedCount = 0;
      
      diff.forEach(function(item) {
        var lineNum = '';
        
        if (item.type === 'unchanged') {
          if (options.showLineNumbers) {
            lineNum = item.origLine + ': ';
          }
          leftPanel.appendChild(createDiffLine(lineNum + item.value, 'unchanged'));
          if (options.showLineNumbers) {
            lineNum = item.modLine + ': ';
          }
          rightPanel.appendChild(createDiffLine(lineNum + item.value, 'unchanged'));
        } else if (item.type === 'removed') {
          removedCount++;
          if (options.showLineNumbers) {
            lineNum = item.origLine + ': ';
          }
          leftPanel.appendChild(createDiffLine(lineNum + item.value, 'removed'));
          var emptyDiv = document.createElement('div');
          emptyDiv.className = 'diff-line';
          emptyDiv.style.opacity = '0.3';
          emptyDiv.textContent = ' ';
          rightPanel.appendChild(emptyDiv);
        } else {
          addedCount++;
          var emptyDiv = document.createElement('div');
          emptyDiv.className = 'diff-line';
          emptyDiv.style.opacity = '0.3';
          emptyDiv.textContent = ' ';
          leftPanel.appendChild(emptyDiv);
          if (options.showLineNumbers) {
            lineNum = item.modLine + ': ';
          }
          rightPanel.appendChild(createDiffLine(lineNum + item.value, 'added'));
        }
      });
      
      wrapper.appendChild(leftPanel);
      wrapper.appendChild(rightPanel);
      
      container.textContent = '';
      container.appendChild(wrapper);
      return { added: addedCount, removed: removedCount };
    }

    function compareDocuments() {
      var original = document.getElementById('originalText').value;
      var modified = document.getElementById('modifiedText').value;
      
      if (!original.trim()) {
        showStatus('è¯·è¾“å…¥åŸå§‹åè®®å†…å®¹', 'error');
        return;
      }
      
      if (!modified.trim()) {
        showStatus('è¯·è¾“å…¥ä¿®æ”¹åçš„åè®®å†…å®¹', 'error');
        return;
      }
      
      var options = getOptions();
      var diff = computeDiff(original, modified, options);
      var container = document.getElementById('diffOutput');
      
      var result;
      if (options.sideBySide) {
        result = renderSideBySideDiff(diff, options, container);
      } else {
        result = renderUnifiedDiff(diff, options, container);
      }
      
      document.getElementById('addedCount').textContent = '+' + result.added + ' è¡Œæ–°å¢';
      document.getElementById('removedCount').textContent = '-' + result.removed + ' è¡Œåˆ é™¤';
      document.getElementById('changedCount').textContent = '~' + Math.min(result.added, result.removed) + ' è¡Œå¯èƒ½ä¿®æ”¹';
      
      document.getElementById('statsSection').style.display = 'flex';
      document.getElementById('resultSection').style.display = 'block';
      
      saveToStorage();
      showStatus('å¯¹æ¯”å®Œæˆ', 'success');
    }

    function swapDocuments() {
      var original = document.getElementById('originalText');
      var modified = document.getElementById('modifiedText');
      var temp = original.value;
      original.value = modified.value;
      modified.value = temp;
      showStatus('æ–‡æ¡£å·²äº¤æ¢', 'success');
    }

    function copyDiff() {
      var original = document.getElementById('originalText').value;
      var modified = document.getElementById('modifiedText').value;
      
      if (!original.trim() || !modified.trim()) {
        showStatus('è¯·å…ˆè¿›è¡Œå¯¹æ¯”', 'error');
        return;
      }
      
      var options = getOptions();
      var diff = computeDiff(original, modified, options);
      
      var report = 'åè®®å¯¹æ¯”æŠ¥å‘Š\n';
      report += 'ç”Ÿæˆæ—¶é—´: ' + new Date().toLocaleString() + '\n';
      report += '==========================================\n\n';
      
      var added = 0, removed = 0;
      diff.forEach(function(item) {
        if (item.type === 'added') added++;
        if (item.type === 'removed') removed++;
      });
      
      report += 'ç»Ÿè®¡: +' + added + ' è¡Œæ–°å¢, -' + removed + ' è¡Œåˆ é™¤\n\n';
      report += 'è¯¦ç»†å·®å¼‚:\n';
      report += '------------------------------------------\n';
      
      diff.forEach(function(item) {
        var prefix = '';
        if (item.type === 'added') prefix = '+ ';
        else if (item.type === 'removed') prefix = '- ';
        else prefix = '  ';
        report += prefix + item.value + '\n';
      });
      
      navigator.clipboard.writeText(report).then(function() {
        showStatus('å·®å¼‚æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      }).catch(function() {
        showStatus('å¤åˆ¶å¤±è´¥', 'error');
      });
    }

    function pasteOriginal() {
      navigator.clipboard.readText().then(function(text) {
        document.getElementById('originalText').value = text;
        showStatus('å·²ç²˜è´´åˆ°åŸå§‹åè®®', 'success');
      }).catch(function() {
        showStatus('æ— æ³•è®¿é—®å‰ªè´´æ¿', 'error');
      });
    }

    function pasteModified() {
      navigator.clipboard.readText().then(function(text) {
        document.getElementById('modifiedText').value = text;
        showStatus('å·²ç²˜è´´åˆ°ä¿®æ”¹ååè®®', 'success');
      }).catch(function() {
        showStatus('æ— æ³•è®¿é—®å‰ªè´´æ¿', 'error');
      });
    }

    function clearOriginal() {
      document.getElementById('originalText').value = '';
      showStatus('å·²æ¸…ç©ºåŸå§‹åè®®', 'success');
    }

    function clearModified() {
      document.getElementById('modifiedText').value = '';
      showStatus('å·²æ¸…ç©ºä¿®æ”¹ååè®®', 'success');
    }

    function clearAll() {
      document.getElementById('originalText').value = '';
      document.getElementById('modifiedText').value = '';
      document.getElementById('diffOutput').textContent = '';
      document.getElementById('statsSection').style.display = 'none';
      document.getElementById('resultSection').style.display = 'none';
      localStorage.removeItem(LS_KEY);
      showStatus('å·²æ¸…ç©ºå…¨éƒ¨', 'success');
    }

    function showStatus(msg, type) {
      var el = document.getElementById('status');
      el.textContent = msg;
      el.className = 'status ' + (type || '');
    }

    function saveToStorage() {
      try {
        var data = {
          original: document.getElementById('originalText').value,
          modified: document.getElementById('modifiedText').value,
          options: getOptions()
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      } catch (e) {}
    }

    function loadFromStorage() {
      try {
        var saved = localStorage.getItem(LS_KEY);
        if (saved) {
          var data = JSON.parse(saved);
          if (data.original) document.getElementById('originalText').value = data.original;
          if (data.modified) document.getElementById('modifiedText').value = data.modified;
          if (data.options) {
            document.getElementById('ignoreWhitespace').checked = !!data.options.ignoreWhitespace;
            document.getElementById('ignoreCase').checked = !!data.options.ignoreCase;
            document.getElementById('showLineNumbers').checked = data.options.showLineNumbers !== false;
            document.getElementById('sideBySide').checked = !!data.options.sideBySide;
          }
        }
      } catch (e) {}
    }

    // Auto-save on input
    document.querySelectorAll('textarea, input[type="checkbox"]').forEach(function(el) {
      el.addEventListener('change', saveToStorage);
      el.addEventListener('input', saveToStorage);
    });

    // Theme toggle
    function toggleTheme() {
      var html = document.documentElement;
      var btn = document.querySelector('.theme-toggle');
      var next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      btn.textContent = next === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', next);
    }

    // Initialize
    (function() {
      var savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        var btn = document.querySelector('.theme-toggle');
        if (btn) btn.textContent = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
      }
      loadFromStorage();
    })();
  </script>
</body>
</html>

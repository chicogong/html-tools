<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯å¢ƒå˜é‡ç¼–è¾‘å™¨ - WebUtils</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-tertiary: #1a1a25; --text-primary: #fff; --text-secondary: #88a; --accent: #6366f1; --border: #2a2a3a; --success: #22c55e; --danger: #ef4444; }
        [data-theme="light"] { --bg-primary: #f8fafc; --bg-secondary: #fff; --bg-tertiary: #f1f5f9; --text-primary: #1e293b; --text-secondary: #64748b; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(135deg, #10b981, #059669); padding: 2rem; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .nav { display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 1rem; }
        .back-link { color: rgba(255,255,255,0.9); text-decoration: none; }
        .theme-toggle { background: rgba(255,255,255,0.2); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; color: white; cursor: pointer; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 900px) { .editor-grid { grid-template-columns: 1fr; } }
        .editor-box h3 { margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        textarea { width: 100%; min-height: 300px; padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-tertiary); color: var(--text-primary); font-family: Monaco, Menlo, monospace; font-size: 0.9rem; resize: vertical; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-sm { padding: 0.4rem 0.75rem; font-size: 0.85rem; }
        .env-table { width: 100%; border-collapse: collapse; }
        .env-table th, .env-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
        .env-table th { color: var(--text-secondary); font-weight: 600; font-size: 0.85rem; }
        .env-table input { width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 0.25rem; background: var(--bg-tertiary); color: var(--text-primary); font-family: monospace; }
        .env-table .key-col { width: 35%; }
        .env-table .value-col { width: 55%; }
        .env-table .action-col { width: 10%; text-align: center; }
        .add-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .add-row input { flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 0.25rem; background: var(--bg-tertiary); color: var(--text-primary); font-family: monospace; }
        .btn-row { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .format-options { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .format-option { display: flex; align-items: center; gap: 0.5rem; }
        .format-option input[type="radio"] { accent-color: var(--accent); }
        .toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); background: var(--success); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }
        .stats { font-size: 0.85rem; color: var(--text-secondary); font-weight: normal; }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="../../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
        </div>
        <h1>ğŸ“ ç¯å¢ƒå˜é‡ç¼–è¾‘å™¨</h1>
        <p>å¯è§†åŒ–ç¼–è¾‘.envç¯å¢ƒå˜é‡æ–‡ä»¶</p>
    </div>
    <div class="container">
        <div class="editor-grid">
            <div class="card editor-box">
                <h3>
                    .env æ–‡ä»¶å†…å®¹
                    <span class="stats" id="textStats">0 å˜é‡</span>
                </h3>
                <textarea id="envText" placeholder="ç²˜è´´.envæ–‡ä»¶å†…å®¹æˆ–æ‰‹åŠ¨è¾“å…¥...
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=myapp

# APIé…ç½®  
API_KEY=your_api_key_here
API_SECRET=your_secret" oninput="parseEnv()">DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=secret123
DB_NAME=myapp

API_URL=https://api.example.com
API_KEY=sk_test_abc123
API_SECRET=your_secret_key

NODE_ENV=development
DEBUG=true
PORT=3000</textarea>
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="parseEnv()">è§£æ</button>
                    <button class="btn btn-secondary" onclick="sortEnv()">æ’åº</button>
                    <button class="btn btn-secondary" onclick="copyText()">å¤åˆ¶</button>
                </div>
            </div>
            
            <div class="card editor-box">
                <h3>
                    å¯è§†åŒ–ç¼–è¾‘
                    <span class="stats" id="tableStats">0 å˜é‡</span>
                </h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table class="env-table" id="envTable">
                        <thead>
                            <tr>
                                <th class="key-col">å˜é‡å</th>
                                <th class="value-col">å€¼</th>
                                <th class="action-col">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="envTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="add-row">
                    <input type="text" id="newKey" placeholder="å˜é‡å" onkeypress="if(event.key==='Enter')addVar()">
                    <input type="text" id="newValue" placeholder="å€¼" onkeypress="if(event.key==='Enter')addVar()">
                    <button class="btn btn-success btn-sm" onclick="addVar()">+ æ·»åŠ </button>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3 style="margin-bottom: 1rem;">å¯¼å‡ºæ ¼å¼</h3>
            <div class="format-options">
                <label class="format-option">
                    <input type="radio" name="format" value="env" checked>
                    .env æ ¼å¼
                </label>
                <label class="format-option">
                    <input type="radio" name="format" value="json">
                    JSON æ ¼å¼
                </label>
                <label class="format-option">
                    <input type="radio" name="format" value="yaml">
                    YAML æ ¼å¼
                </label>
                <label class="format-option">
                    <input type="radio" name="format" value="shell">
                    Shell export
                </label>
                <label class="format-option">
                    <input type="radio" name="format" value="docker">
                    Docker -e å‚æ•°
                </label>
            </div>
            <textarea id="exportOutput" style="min-height: 150px;" readonly placeholder="é€‰æ‹©æ ¼å¼åç‚¹å‡»å¯¼å‡º"></textarea>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="exportEnv()">å¯¼å‡º</button>
                <button class="btn btn-success" onclick="copyExport()">å¤åˆ¶å¯¼å‡ºå†…å®¹</button>
                <button class="btn btn-secondary" onclick="downloadExport()">ä¸‹è½½æ–‡ä»¶</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
    
    <script>
        let envVars = [];
        
        function parseEnv() {
            const text = document.getElementById('envText').value;
            envVars = [];
            
            const lines = text.split('\n');
            lines.forEach(line => {
                line = line.trim();
                if (!line || line.startsWith('#')) return;
                
                const eqIndex = line.indexOf('=');
                if (eqIndex > 0) {
                    const key = line.substring(0, eqIndex).trim();
                    let value = line.substring(eqIndex + 1).trim();
                    // Remove surrounding quotes
                    if ((value.startsWith('"') && value.endsWith('"')) ||
                        (value.startsWith("'") && value.endsWith("'"))) {
                        value = value.slice(1, -1);
                    }
                    envVars.push({ key, value });
                }
            });
            
            renderTable();
            updateStats();
        }
        
        function renderTable() {
            const tbody = document.getElementById('envTableBody');
            tbody.innerHTML = envVars.map((v, i) => `
                <tr>
                    <td class="key-col">
                        <input type="text" value="${escapeHtml(v.key)}" onchange="updateVar(${i}, 'key', this.value)">
                    </td>
                    <td class="value-col">
                        <input type="text" value="${escapeHtml(v.value)}" onchange="updateVar(${i}, 'value', this.value)">
                    </td>
                    <td class="action-col">
                        <button class="btn btn-danger btn-sm" onclick="removeVar(${i})">Ã—</button>
                    </td>
                </tr>
            `).join('');
        }
        
        window.escapeHtml = function(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        };
        
        window.updateVar = function(index, field, value) {
            envVars[index][field] = value;
            syncToText();
        };
        
        window.removeVar = function(index) {
            envVars.splice(index, 1);
            renderTable();
            syncToText();
        };
        
        window.addVar = function() {
            const key = document.getElementById('newKey').value.trim();
            const value = document.getElementById('newValue').value.trim();
            
            if (!key) {
                alert('è¯·è¾“å…¥å˜é‡å');
                return;
            }
            
            envVars.push({ key, value });
            document.getElementById('newKey').value = '';
            document.getElementById('newValue').value = '';
            renderTable();
            syncToText();
        };
        
        function syncToText() {
            const text = envVars.map(v => {
                const needsQuote = v.value.includes(' ') || v.value.includes('#');
                const value = needsQuote ? `"${v.value}"` : v.value;
                return `${v.key}=${value}`;
            }).join('\n');
            
            document.getElementById('envText').value = text;
            updateStats();
        }
        
        window.sortEnv = function() {
            envVars.sort((a, b) => a.key.localeCompare(b.key));
            renderTable();
            syncToText();
        };
        
        function updateStats() {
            const count = envVars.length;
            document.getElementById('textStats').textContent = `${count} å˜é‡`;
            document.getElementById('tableStats').textContent = `${count} å˜é‡`;
        }
        
        window.exportEnv = function() {
            const format = document.querySelector('input[name="format"]:checked').value;
            let output = '';
            
            switch (format) {
                case 'env':
                    output = envVars.map(v => `${v.key}=${v.value}`).join('\n');
                    break;
                case 'json':
                    const obj = {};
                    envVars.forEach(v => obj[v.key] = v.value);
                    output = JSON.stringify(obj, null, 2);
                    break;
                case 'yaml':
                    output = envVars.map(v => `${v.key}: "${v.value}"`).join('\n');
                    break;
                case 'shell':
                    output = envVars.map(v => `export ${v.key}="${v.value}"`).join('\n');
                    break;
                case 'docker':
                    output = envVars.map(v => `-e ${v.key}="${v.value}"`).join(' \\\n  ');
                    break;
            }
            
            document.getElementById('exportOutput').value = output;
        };
        
        window.copyText = function() {
            navigator.clipboard.writeText(document.getElementById('envText').value);
            showToast();
        };
        
        window.copyExport = function() {
            const output = document.getElementById('exportOutput').value;
            if (!output) {
                alert('è¯·å…ˆç‚¹å‡»å¯¼å‡º');
                return;
            }
            navigator.clipboard.writeText(output);
            showToast();
        };
        
        window.downloadExport = function() {
            const output = document.getElementById('exportOutput').value;
            if (!output) {
                alert('è¯·å…ˆç‚¹å‡»å¯¼å‡º');
                return;
            }
            
            const format = document.querySelector('input[name="format"]:checked').value;
            const extensions = { env: '.env', json: '.json', yaml: '.yaml', shell: '.sh', docker: '.txt' };
            
            const blob = new Blob([output], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'environment' + extensions[format];
            link.click();
        };
        
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // Initialize
        parseEnv();
        
        window.toggleTheme = function() {
            const t = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
        };
        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
    </script>
</body>
</html>

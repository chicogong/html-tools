<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è‰²ç›²æ¨¡æ‹Ÿå™¨ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="è‰²ç›²æ¨¡æ‹Ÿå™¨ï¼Œé¢„è§ˆä¸åŒç±»å‹è‰²ç›²ç”¨æˆ·çœ‹åˆ°çš„é¢œè‰²æ•ˆæœï¼Œæµ‹è¯•è®¾è®¡çš„æ— éšœç¢æ€§" />
  <meta name="keywords" content="è‰²ç›² æ¨¡æ‹Ÿå™¨ colorblind simulator accessibility æ— éšœç¢ a11y" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/color-blindness.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="è‰²ç›²æ¨¡æ‹Ÿå™¨ - WebUtils" />
  <meta property="og:description" content="è‰²ç›²æ¨¡æ‹Ÿå™¨ï¼Œé¢„è§ˆä¸åŒç±»å‹è‰²ç›²ç”¨æˆ·çœ‹åˆ°çš„é¢œè‰²æ•ˆæœï¼Œæµ‹è¯•è®¾è®¡çš„æ— éšœç¢æ€§" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/color-blindness.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="è‰²ç›²æ¨¡æ‹Ÿå™¨ - WebUtils" />
  <meta name="twitter:description" content="è‰²ç›²æ¨¡æ‹Ÿå™¨ï¼Œé¢„è§ˆä¸åŒç±»å‹è‰²ç›²ç”¨æˆ·çœ‹åˆ°çš„é¢œè‰²æ•ˆæœï¼Œæµ‹è¯•è®¾è®¡çš„æ— éšœç¢æ€§" />
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-hover: #252532;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --bg: #0a0a0f;
      --card-bg: #1a1a24;
      --text: #e8e8ed;
      --border: #2a2a3a;
      --primary: #00f5d4;
      --primary-hover: #00dfc4;
      --success: #10b981;
      --error: #ef4444;
      --shadow: 0 2px 8px rgb(0 0 0 / 30%);
      --radius: 8px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --bg: #fafafa;
      --card-bg: #fff;
      --text: #1a1a1a;
      --border: #e5e5e5;
      --primary: #0d9488;
      --primary-hover: #0f766e;
      --success: #198754;
      --shadow: 0 2px 8px rgb(0 0 0 / 8%);
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    h1 {
      font-size: 1.75rem;
      margin: 0 0 8px;
    }

    .desc {
      color: var(--text-muted);
      margin: 0 0 24px;
      font-size: 0.95rem;
    }

    .main-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .input-section {
      margin-bottom: 24px;
    }

    .input-section h3 {
      font-size: 1rem;
      margin: 0 0 12px;
      color: var(--text-secondary);
    }

    .color-input-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .color-picker-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .color-picker-group label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    input[type="color"] {
      width: 50px;
      height: 40px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
      padding: 2px;
    }

    input[type="text"] {
      width: 100px;
      padding: 8px 12px;
      font-size: 0.9rem;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    .upload-area {
      flex: 1;
      min-width: 200px;
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-area:hover {
      border-color: var(--primary);
    }

    .upload-area input {
      display: none;
    }

    .simulation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .sim-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .sim-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sim-header h4 {
      margin: 0;
      font-size: 0.95rem;
    }

    .sim-header .percentage {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .sim-preview {
      height: 120px;
      display: flex;
    }

    .sim-preview .color-half {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .image-preview {
      width: 100%;
      height: 200px;
      object-fit: contain;
      background: var(--bg-deep);
    }

    .color-swatches {
      padding: 16px;
    }

    .swatch-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .swatch {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .info-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .info-section h3 {
      font-size: 1rem;
      margin: 0 0 16px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .info-card {
      background: var(--bg);
      border-radius: var(--radius);
      padding: 16px;
    }

    .info-card h4 {
      margin: 0 0 8px;
      font-size: 0.95rem;
      color: var(--primary);
    }

    .info-card p {
      margin: 0;
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  
        .breadcrumb {     background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span>è‰²ç›²æ¨¡æ‹Ÿå™¨</nav>
  <div class="container">
    <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    <h1>è‰²ç›²æ¨¡æ‹Ÿå™¨</h1>
    <p class="desc">æ¨¡æ‹Ÿä¸åŒç±»å‹è‰²ç›²ç”¨æˆ·çœ‹åˆ°çš„é¢œè‰²æ•ˆæœï¼Œå¸®åŠ©æµ‹è¯•è®¾è®¡çš„æ— éšœç¢æ€§</p>

    <div class="main-card">
      <div class="input-section">
        <h3>é€‰æ‹©é¢œè‰²æˆ–ä¸Šä¼ å›¾ç‰‡</h3>
        <div class="color-input-row">
          <div class="color-picker-group">
            <label>å‰æ™¯è‰²</label>
            <input type="color" id="fgColor" value="#ff0000" />
            <input type="text" id="fgHex" value="#ff0000" />
          </div>
          <div class="color-picker-group">
            <label>èƒŒæ™¯è‰²</label>
            <input type="color" id="bgColor" value="#00ff00" />
            <input type="text" id="bgHex" value="#00ff00" />
          </div>
          <div class="upload-area" id="uploadArea">
            <span>ğŸ“· ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</span>
            <input type="file" id="imageInput" accept="image/*" />
          </div>
        </div>
      </div>

      <div class="simulation-grid" id="simGrid">
        <!-- Simulation cards will be generated here -->
      </div>

      <div class="info-section">
        <h3>è‰²ç›²ç±»å‹è¯´æ˜</h3>
        <div class="info-grid">
          <div class="info-card">
            <h4>çº¢è‰²ç›² (Protanopia)</h4>
            <p>æ— æ³•æ„ŸçŸ¥çº¢è‰²å…‰ï¼Œçº¦å ç”·æ€§ 1%ã€‚çº¢è‰²çœ‹èµ·æ¥åƒæš—é»„è‰²æˆ–æ£•è‰²ã€‚</p>
          </div>
          <div class="info-card">
            <h4>ç»¿è‰²ç›² (Deuteranopia)</h4>
            <p>æ— æ³•æ„ŸçŸ¥ç»¿è‰²å…‰ï¼Œæ˜¯æœ€å¸¸è§çš„è‰²ç›²ç±»å‹ï¼Œçº¦å ç”·æ€§ 6%ã€‚</p>
          </div>
          <div class="info-card">
            <h4>è“è‰²ç›² (Tritanopia)</h4>
            <p>æ— æ³•æ„ŸçŸ¥è“è‰²å…‰ï¼Œéå¸¸ç½•è§ï¼Œçº¦å äººç¾¤ 0.01%ã€‚</p>
          </div>
          <div class="info-card">
            <h4>å…¨è‰²ç›² (Achromatopsia)</h4>
            <p>å®Œå…¨æ— æ³•æ„ŸçŸ¥é¢œè‰²ï¼Œåªèƒ½çœ‹åˆ°ç°åº¦ï¼Œæä¸ºç½•è§ã€‚</p>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <a href="https://github.com/nicepkg/html-tools" target="_blank" rel="noreferrer">View source</a>
      Â· çº¯å‰ç«¯å·¥å…· Â· æ— æœåŠ¡å™¨ Â· 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>

  <script>
    const fgColorInput = document.getElementById('fgColor');
    const bgColorInput = document.getElementById('bgColor');
    const fgHexInput = document.getElementById('fgHex');
    const bgHexInput = document.getElementById('bgHex');
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const simGrid = document.getElementById('simGrid');

    let currentImage = null;

    // Color blindness simulation matrices
    const colorBlindnessTypes = [
      {
        name: 'æ­£å¸¸è§†è§‰',
        type: 'normal',
        percentage: '92%',
        matrix: [
          [1, 0, 0],
          [0, 1, 0],
          [0, 0, 1]
        ]
      },
      {
        name: 'çº¢è‰²ç›² (Protanopia)',
        type: 'protanopia',
        percentage: '~1%',
        matrix: [
          [0.567, 0.433, 0],
          [0.558, 0.442, 0],
          [0, 0.242, 0.758]
        ]
      },
      {
        name: 'ç»¿è‰²ç›² (Deuteranopia)',
        type: 'deuteranopia',
        percentage: '~6%',
        matrix: [
          [0.625, 0.375, 0],
          [0.7, 0.3, 0],
          [0, 0.3, 0.7]
        ]
      },
      {
        name: 'è“è‰²ç›² (Tritanopia)',
        type: 'tritanopia',
        percentage: '~0.01%',
        matrix: [
          [0.95, 0.05, 0],
          [0, 0.433, 0.567],
          [0, 0.475, 0.525]
        ]
      },
      {
        name: 'çº¢è‰²å¼± (Protanomaly)',
        type: 'protanomaly',
        percentage: '~1%',
        matrix: [
          [0.817, 0.183, 0],
          [0.333, 0.667, 0],
          [0, 0.125, 0.875]
        ]
      },
      {
        name: 'ç»¿è‰²å¼± (Deuteranomaly)',
        type: 'deuteranomaly',
        percentage: '~5%',
        matrix: [
          [0.8, 0.2, 0],
          [0.258, 0.742, 0],
          [0, 0.142, 0.858]
        ]
      },
      {
        name: 'å…¨è‰²ç›² (Achromatopsia)',
        type: 'achromatopsia',
        percentage: '~0.003%',
        matrix: [
          [0.299, 0.587, 0.114],
          [0.299, 0.587, 0.114],
          [0.299, 0.587, 0.114]
        ]
      }
    ];

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(function(x) {
        const hex = Math.round(Math.max(0, Math.min(255, x))).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }).join('');
    }

    function applyColorBlindness(rgb, matrix) {
      const r = rgb.r * matrix[0][0] + rgb.g * matrix[0][1] + rgb.b * matrix[0][2];
      const g = rgb.r * matrix[1][0] + rgb.g * matrix[1][1] + rgb.b * matrix[1][2];
      const b = rgb.r * matrix[2][0] + rgb.g * matrix[2][1] + rgb.b * matrix[2][2];
      return { r: r, g: g, b: b };
    }

    function getContrastColor(hex) {
      const rgb = hexToRgb(hex);
      const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
      return luminance > 0.5 ? '#000000' : '#ffffff';
    }

    function renderSimulations() {
      const fgRgb = hexToRgb(fgColorInput.value);
      const bgRgb = hexToRgb(bgColorInput.value);

      let html = '';

      colorBlindnessTypes.forEach(function(type) {
        const simFg = applyColorBlindness(fgRgb, type.matrix);
        const simBg = applyColorBlindness(bgRgb, type.matrix);
        const fgHex = rgbToHex(simFg.r, simFg.g, simFg.b);
        const bgHex = rgbToHex(simBg.r, simBg.g, simBg.b);

        html += '<div class="sim-card">' +
          '<div class="sim-header">' +
            '<h4>' + type.name + '</h4>' +
            '<span class="percentage">äººç¾¤å æ¯”: ' + type.percentage + '</span>' +
          '</div>';

        if (currentImage) {
          html += '<canvas class="image-preview" data-type="' + type.type + '"></canvas>';
        } else {
          html += '<div class="sim-preview">' +
            '<div class="color-half" style="background: ' + fgHex + '; color: ' + getContrastColor(fgHex) + ';">å‰æ™¯<br>' + fgHex + '</div>' +
            '<div class="color-half" style="background: ' + bgHex + '; color: ' + getContrastColor(bgHex) + ';">èƒŒæ™¯<br>' + bgHex + '</div>' +
          '</div>';
        }

        html += '</div>';
      });

      simGrid.innerHTML = html;

      if (currentImage) {
        renderImageSimulations();
      }
    }

    function renderImageSimulations() {
      colorBlindnessTypes.forEach(function(type) {
        const canvas = document.querySelector('canvas[data-type="' + type.type + '"]');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        const maxWidth = canvas.parentElement.clientWidth;
        const scale = Math.min(1, maxWidth / currentImage.width);
        canvas.width = currentImage.width * scale;
        canvas.height = currentImage.height * scale;

        // Draw original image
        ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);

        // Apply color blindness filter
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
          const rgb = { r: data[i], g: data[i + 1], b: data[i + 2] };
          const result = applyColorBlindness(rgb, type.matrix);
          data[i] = Math.round(result.r);
          data[i + 1] = Math.round(result.g);
          data[i + 2] = Math.round(result.b);
        }

        ctx.putImageData(imageData, 0, 0);
      });
    }

    // Event listeners
    fgColorInput.addEventListener('input', function() {
      fgHexInput.value = fgColorInput.value;
      renderSimulations();
    });

    bgColorInput.addEventListener('input', function() {
      bgHexInput.value = bgColorInput.value;
      renderSimulations();
    });

    fgHexInput.addEventListener('input', function() {
      if (/^#[0-9A-Fa-f]{6}$/.test(fgHexInput.value)) {
        fgColorInput.value = fgHexInput.value;
        renderSimulations();
      }
    });

    bgHexInput.addEventListener('input', function() {
      if (/^#[0-9A-Fa-f]{6}$/.test(bgHexInput.value)) {
        bgColorInput.value = bgHexInput.value;
        renderSimulations();
      }
    });

    // Image upload
    uploadArea.addEventListener('click', function() {
      imageInput.click();
    });

    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--primary)';
    });

    uploadArea.addEventListener('dragleave', function() {
      uploadArea.style.borderColor = '';
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.style.borderColor = '';
      const file = e.dataTransfer.files[0];
      if (file) loadImage(file);
    });

    imageInput.addEventListener('change', function() {
      const file = imageInput.files[0];
      if (file) loadImage(file);
    });

    window.loadImage = function(file) {
      if (!file.type.startsWith('image/')) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          currentImage = img;
          uploadArea.innerHTML = '<span>âœ… å·²åŠ è½½å›¾ç‰‡ (ç‚¹å‡»æ›´æ¢)</span><input type="file" id="imageInput" accept="image/*" />';
          document.getElementById('imageInput').addEventListener('change', function() {
            const file = this.files[0];
            if (file) loadImage(file);
          });
          renderSimulations();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    };

    // Theme toggle
    window.toggleTheme = function() {
      const html = document.documentElement;
      const btn = document.querySelector('.theme-toggle');
      const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      btn.textContent = next === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', next);
    };

    (function() {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
        const btn = document.querySelector('.theme-toggle');
        if (btn) btn.textContent = saved === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      }
    })();

    // Initialize
    renderSimulations();
  </script>
</body>
</html>

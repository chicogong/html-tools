<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Markdown é¢„è§ˆ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="å®æ—¶ Markdown é¢„è§ˆï¼Œæ”¯æŒ GFM è¯­æ³•ï¼Œå¯å¯¼å‡º HTML" />
  <meta name="keywords" content="markdown md é¢„è§ˆ æ¸²æŸ“ gfm" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/html-tools/tools/text/markdown-preview.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Markdown é¢„è§ˆ - WebUtils" />
  <meta property="og:description" content="å®æ—¶ Markdown é¢„è§ˆï¼Œæ”¯æŒ GFM è¯­æ³•ï¼Œå¯å¯¼å‡º HTML" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/html-tools/tools/text/markdown-preview.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Markdown é¢„è§ˆ - WebUtils" />
  <meta name="twitter:description" content="å®æ—¶ Markdown é¢„è§ˆï¼Œæ”¯æŒ GFM è¯­æ³•ï¼Œå¯å¯¼å‡º HTML" />
  <!-- OG Image -->
  <meta property="og:image" content="https://tools.realtime-ai.chat/html-tools/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/html-tools/social-preview.png" />

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-hover: #252532;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --bg: #0a0a0f;
      --card-bg: #1a1a24;
      --text: #e8e8ed;
      --border: #2a2a3a;
      --primary: #00f5d4;
      --primary-hover: #00dfc4;
      --success: #10b981;
      --shadow: 0 2px 8px rgb(0,0,0,0.3);
      --radius: 8px;
    }
    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --bg: #fafafa;
      --card-bg: #fff;
      --text: #1a1a1a;
      --border: #e5e5e5;
      --primary: #0d6efd;
      --primary-hover: #0b5ed7;
      --success: #198754;
      --shadow: 0 2px 8px rgb(0,0,0,0.08);
    }
    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
    }
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    h1 {
      font-size: 1.75rem;
      margin: 0 0 8px;
    }

    .desc {
      color: var(--text-muted);
      margin: 0 0 24px;
      font-size: 0.95rem;
    }

    .btn-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    button {
      padding: 10px 16px;
      font-size: 0.95rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      min-height: 500px;
    }

    @media (width <= 900px) {
      .panels {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .panel-header label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .panel-header span {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    textarea {
      flex: 1;
      min-height: 500px;
      padding: 16px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 0.9rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      resize: none;
      line-height: 1.6;
      background: var(--card-bg);
      box-shadow: var(--shadow);
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(13,110,253,0.15);
    }

    .preview {
      flex: 1;
      min-height: 500px;
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      box-shadow: var(--shadow);
      overflow: auto;
      line-height: 1.6;
    }

    .preview h1, .preview h2, .preview h3, .preview h4, .preview h5, .preview h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.25;
    }
    .preview h1 { font-size: 2em; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; }
    .preview h2 { font-size: 1.5em; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; }
    .preview h3 { font-size: 1.25em; }
    .preview p { margin: 0 0 16px; }

    .preview code {
      background: var(--bg);
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 0.85em;
    }

    .preview pre {
      background: var(--bg);
      color: var(--text);
      padding: 16px;
      border-radius: var(--radius);
      overflow-x: auto;
      margin: 0 0 16px;
    }

    .preview pre code {
      background: none;
      padding: 0;
      color: inherit;
    }

    .preview blockquote {
      margin: 0 0 16px;
      padding: 0 16px;
      border-left: 4px solid var(--border);
      color: var(--text-muted);
    }

    .preview ul, .preview ol {
      margin: 0 0 16px;
      padding-left: 2em;
    }
    .preview li { margin: 4px 0; }

    .preview table {
      border-collapse: collapse;
      width: 100%;
      margin: 0 0 16px;
    }

    .preview th, .preview td {
      border: 1px solid var(--border);
      padding: 8px 12px;
      text-align: left;
    }

    .preview th {
      background: var(--bg);
      font-weight: 600;
    }

    .preview a {
      color: var(--primary);
    }

    .preview img {
      max-width: 100%;
    }

    .preview hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 24px 0;
    }

    .status {
      font-size: 0.85rem;
      margin-top: 8px;
      color: var(--success);
    }

    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    <h1>Markdown é¢„è§ˆ</h1>
    <p class="desc">å®æ—¶é¢„è§ˆ Markdown å†…å®¹ï¼Œæ”¯æŒ GFM è¯­æ³•ï¼Œè‡ªåŠ¨ä¿å­˜</p>

    <div class="btn-row">
      <button id="btnClear">æ¸…ç©º</button>
      <button id="btnCopyHtml">å¤åˆ¶ HTML</button>
      <button id="btnDownload">ä¸‹è½½ HTML</button>
    </div>

    <div class="panels">
      <div class="panel">
        <div class="panel-header">
          <label for="input">Markdown</label>
          <span id="wordCount">0 å­—</span>
        </div>
        <textarea id="input" placeholder="åœ¨æ­¤è¾“å…¥ Markdown..."></textarea>
      </div>
      <div class="panel">
        <div class="panel-header">
          <label>é¢„è§ˆ</label>
        </div>
        <div class="preview" id="preview"></div>
      </div>
    </div>

    <div id="status" class="status"></div>

    <footer>
      <a href="https://github.com/chicogong/html-tools/blob/main/tools/markdown-preview.html" target="_blank" rel="noreferrer">View source</a>
      Â· çº¯å‰ç«¯å·¥å…· Â· æ— æœåŠ¡å™¨ Â· 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>

  <!-- marked.js + DOMPurify CDN -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>

  <script>
    const inputEl = document.getElementById('input');
    const previewEl = document.getElementById('preview');
    const wordCountEl = document.getElementById('wordCount');
    const statusEl = document.getElementById('status');

    const LS_KEY = 'markdown_preview_v1';

    // é…ç½® marked
    marked.setOptions({
      breaks: true,
      gfm: true
    });

    function updatePreview() {
      const md = inputEl.value;
      const rawHtml = marked.parse(md);
      // ä½¿ç”¨ DOMPurify æ¸…ç† HTML
      const cleanHtml = DOMPurify.sanitize(rawHtml);
      previewEl.innerHTML = cleanHtml;
      
      // å­—æ•°ç»Ÿè®¡
      const text = md.trim();
      const chars = text.length;
      const words = text ? text.split(/\s+/).length : 0;
      wordCountEl.textContent = chars + ' å­— / ' + words + ' è¯';
    }

    function loadFromStorage() {
      const saved = localStorage.getItem(LS_KEY);
      if (saved) {
        inputEl.value = saved;
        updatePreview();
      }
    }

    function saveToStorage() {
      localStorage.setItem(LS_KEY, inputEl.value);
    }

    function showStatus(msg) {
      statusEl.textContent = msg;
      setTimeout(function() {
        statusEl.textContent = '';
      }, 2000);
    }

    inputEl.addEventListener('input', function() {
      updatePreview();
      saveToStorage();
    });

    document.getElementById('btnClear').onclick = function() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºå†…å®¹å—ï¼Ÿ')) {
        inputEl.value = '';
        updatePreview();
        localStorage.removeItem(LS_KEY);
        showStatus('å·²æ¸…ç©º');
      }
    };

    document.getElementById('btnCopyHtml').onclick = async function() {
      const html = previewEl.innerHTML;
      try {
        await navigator.clipboard.writeText(html);
        showStatus('HTML å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch (e) {
        showStatus('å¤åˆ¶å¤±è´¥');
      }
    };

    document.getElementById('btnDownload').onclick = function() {
      var htmlDoc = '<!DOCTYPE html>\n<html>\n<head>\n<meta charset="utf-8">\n<title>Markdown Export</title>\n<style>\nbody { font-family: system-ui, sans-serif; max-width: 800px; margin: 40px auto; padding: 0 20px; line-height: 1.6; }\npre { background: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto; }\ncode { background: #f6f8fa; padding: 0.2em 0.4em; border-radius: 3px; }\nblockquote { border-left: 4px solid #ddd; margin: 0; padding-left: 16px; color: #666; }\ntable { border-collapse: collapse; width: 100%; }\nth, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\nth { background: #f6f8fa; }\n</style>\n</head>\n<body>\n' + previewEl.innerHTML + '\n</body>\n</html>';
      
      var blob = new Blob([htmlDoc], { type: 'text/html' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'markdown-export.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showStatus('å·²ä¸‹è½½');
    };

    // åˆå§‹åŒ–
    loadFromStorage();
    
    // å¦‚æœä¸ºç©ºï¼Œæ˜¾ç¤ºç¤ºä¾‹
    if (!inputEl.value) {
      inputEl.value = '# Markdown é¢„è§ˆ\n\nè¿™æ˜¯ä¸€ä¸ª **å®æ—¶é¢„è§ˆ** çš„ Markdown ç¼–è¾‘å™¨ã€‚\n\n## åŠŸèƒ½\n\n- æ”¯æŒ GFM è¯­æ³•\n- è‡ªåŠ¨ä¿å­˜åˆ° localStorage\n- å¯¼å‡º HTML\n\n## ä»£ç ç¤ºä¾‹\n\n```javascript\nconst hello = "world";\nconsole.log(hello);\n```\n\n## è¡¨æ ¼\n\n| åç§° | æè¿° |\n|------|------|\n| A | ç¬¬ä¸€é¡¹ |\n| B | ç¬¬äºŒé¡¹ |\n\n> å¼•ç”¨æ–‡æœ¬\n\n---\n\n[é“¾æ¥ç¤ºä¾‹](https://example.com)';
      updatePreview();
    }

    function toggleTheme() {
      const html = document.documentElement;
      const btn = document.querySelector('.theme-toggle');
      const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      btn.textContent = next === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', next);
    }
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
        const btn = document.querySelector('.theme-toggle');
        if (btn) btn.textContent = saved === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      }
    })();
  </script>
</body>
</html>

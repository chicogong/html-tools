<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>周餐计划器 - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #ec4899; --accent2: #f472b6; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .week-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .week-nav button { padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); cursor: pointer; }
        .week-nav button:hover { border-color: var(--accent); }
        .week-nav h2 { font-size: 1.2rem; }
        .planner-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
        .day-column { background: var(--bg); border-radius: 12px; padding: 12px; min-height: 300px; }
        .day-header { text-align: center; padding: 8px; border-bottom: 1px solid var(--border); margin-bottom: 12px; }
        .day-header .day-name { font-weight: 600; font-size: 0.9rem; }
        .day-header .day-date { font-size: 0.8rem; color: var(--text2); }
        .day-header.today { color: var(--accent); }
        .meal-slot { margin-bottom: 12px; }
        .meal-label { font-size: 0.75rem; color: var(--text2); margin-bottom: 4px; text-transform: uppercase; }
        .meal-content { padding: 8px; background: var(--card); border-radius: 6px; min-height: 40px; cursor: pointer; font-size: 0.85rem; border: 1px solid transparent; }
        .meal-content:hover { border-color: var(--accent); }
        .meal-content.empty { color: var(--text2); font-style: italic; }
        .meal-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .meal-modal.show { display: flex; }
        .modal-content { background: var(--card); border-radius: 12px; padding: 24px; width: 90%; max-width: 400px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h3 { font-size: 1.1rem; }
        .modal-close { width: 32px; height: 32px; border: none; background: transparent; color: var(--text); cursor: pointer; font-size: 1.5rem; }
        .modal-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; margin-bottom: 16px; }
        .modal-input:focus { outline: none; border-color: var(--accent); }
        .modal-suggestions { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .suggestion-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 16px; background: var(--bg); color: var(--text); cursor: pointer; font-size: 0.8rem; }
        .suggestion-btn:hover { border-color: var(--accent); }
        .modal-actions { display: flex; gap: 12px; }
        .modal-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; }
        .modal-btn.primary { background: var(--accent); color: white; }
        .modal-btn.secondary { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
        .summary-card { background: linear-gradient(135deg, var(--accent), var(--accent2)); border-radius: 12px; padding: 20px; color: white; }
        .summary-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: 700; }
        .stat-label { font-size: 0.85rem; opacity: 0.9; }
        .action-btns { display: flex; gap: 12px; margin-top: 20px; }
        .action-btn { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); cursor: pointer; }
        .action-btn:hover { border-color: var(--accent); }
        @media (max-width: 800px) { .planner-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { .planner-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>周餐计划器</h1>
        <p class="subtitle">规划一周的健康饮食</p>
        
        <div class="card">
            <div class="week-nav">
                <button onclick="changeWeek(-1)">上一周</button>
                <h2 id="weekTitle">本周</h2>
                <button onclick="changeWeek(1)">下一周</button>
            </div>
            
            <div class="planner-grid" id="plannerGrid"></div>
        </div>
        
        <div class="summary-card">
            <div class="summary-stats">
                <div>
                    <div class="stat-value" id="plannedMeals">0</div>
                    <div class="stat-label">已规划餐食</div>
                </div>
                <div>
                    <div class="stat-value" id="uniqueMeals">0</div>
                    <div class="stat-label">不同菜品</div>
                </div>
                <div>
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-label">完成率</div>
                </div>
            </div>
        </div>
        
        <div class="action-btns">
            <button class="action-btn" onclick="exportPlan()">导出计划</button>
            <button class="action-btn" onclick="generateShopping()">生成购物清单</button>
            <button class="action-btn" onclick="clearWeek()">清空本周</button>
        </div>
    </div>
    
    <div class="meal-modal" id="mealModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">编辑餐食</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <input type="text" class="modal-input" id="mealInput" placeholder="输入菜品名称...">
            <div class="modal-suggestions" id="suggestions"></div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="deleteMeal()">删除</button>
                <button class="modal-btn primary" onclick="saveMeal()">保存</button>
            </div>
        </div>
    </div>
    
    <script>
        const days = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
        const meals = ['breakfast', 'lunch', 'dinner'];
        const mealLabels = { breakfast: '早餐', lunch: '午餐', dinner: '晚餐' };
        
        const suggestions = {
            breakfast: ['牛奶麦片', '鸡蛋吐司', '豆浆油条', '小米粥', '三明治', '水果沙拉'],
            lunch: ['红烧肉', '番茄炒蛋', '宫保鸡丁', '麻婆豆腐', '清炒时蔬', '牛肉面'],
            dinner: ['清蒸鱼', '蔬菜沙拉', '煎牛排', '火锅', '饺子', '炒饭']
        };
        
        let weekOffset = 0;
        let currentEdit = null;
        let planData = JSON.parse(localStorage.getItem('mealPlan') || '{}');
        
        function getWeekDates(offset) {
            const today = new Date();
            const monday = new Date(today);
            monday.setDate(today.getDate() - today.getDay() + 1 + offset * 7);
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                dates.push(date);
            }
            return dates;
        }
        
        function formatDate(date) {
            return (date.getMonth() + 1) + '/' + date.getDate();
        }
        
        function getDateKey(date) {
            return date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0') + '-' + String(date.getDate()).padStart(2, '0');
        }
        
        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }
        
        function changeWeek(delta) {
            weekOffset += delta;
            renderPlanner();
        }
        
        function renderPlanner() {
            const dates = getWeekDates(weekOffset);
            const grid = document.getElementById('plannerGrid');
            while (grid.firstChild) grid.removeChild(grid.firstChild);
            
            const startDate = formatDate(dates[0]);
            const endDate = formatDate(dates[6]);
            document.getElementById('weekTitle').textContent = startDate + ' - ' + endDate;
            
            let plannedCount = 0;
            const uniqueSet = new Set();
            
            dates.forEach(function(date, dayIndex) {
                const column = document.createElement('div');
                column.className = 'day-column';
                
                const header = document.createElement('div');
                header.className = 'day-header' + (isToday(date) ? ' today' : '');
                const dayName = document.createElement('div');
                dayName.className = 'day-name';
                dayName.textContent = days[dayIndex];
                const dayDate = document.createElement('div');
                dayDate.className = 'day-date';
                dayDate.textContent = formatDate(date);
                header.appendChild(dayName);
                header.appendChild(dayDate);
                column.appendChild(header);
                
                const dateKey = getDateKey(date);
                
                meals.forEach(function(meal) {
                    const slot = document.createElement('div');
                    slot.className = 'meal-slot';
                    
                    const label = document.createElement('div');
                    label.className = 'meal-label';
                    label.textContent = mealLabels[meal];
                    
                    const content = document.createElement('div');
                    content.className = 'meal-content';
                    
                    const mealKey = dateKey + '-' + meal;
                    const mealValue = planData[mealKey] || '';
                    
                    if (mealValue) {
                        content.textContent = mealValue;
                        plannedCount++;
                        uniqueSet.add(mealValue);
                    } else {
                        content.className += ' empty';
                        content.textContent = '点击添加';
                    }
                    
                    content.addEventListener('click', function() {
                        openModal(dateKey, meal, days[dayIndex], mealLabels[meal]);
                    });
                    
                    slot.appendChild(label);
                    slot.appendChild(content);
                    column.appendChild(slot);
                });
                
                grid.appendChild(column);
            });
            
            document.getElementById('plannedMeals').textContent = plannedCount;
            document.getElementById('uniqueMeals').textContent = uniqueSet.size;
            document.getElementById('completionRate').textContent = Math.round(plannedCount / 21 * 100) + '%';
        }
        
        function openModal(dateKey, meal, dayName, mealLabel) {
            currentEdit = { dateKey: dateKey, meal: meal };
            document.getElementById('modalTitle').textContent = dayName + ' ' + mealLabel;
            document.getElementById('mealInput').value = planData[dateKey + '-' + meal] || '';
            
            const suggestionsEl = document.getElementById('suggestions');
            while (suggestionsEl.firstChild) suggestionsEl.removeChild(suggestionsEl.firstChild);
            
            suggestions[meal].forEach(function(sug) {
                const btn = document.createElement('button');
                btn.className = 'suggestion-btn';
                btn.textContent = sug;
                btn.addEventListener('click', function() {
                    document.getElementById('mealInput').value = sug;
                });
                suggestionsEl.appendChild(btn);
            });
            
            document.getElementById('mealModal').classList.add('show');
            document.getElementById('mealInput').focus();
        }
        
        function closeModal() {
            document.getElementById('mealModal').classList.remove('show');
            currentEdit = null;
        }
        
        function saveMeal() {
            if (!currentEdit) return;
            const value = document.getElementById('mealInput').value.trim();
            const key = currentEdit.dateKey + '-' + currentEdit.meal;
            
            if (value) {
                planData[key] = value;
            } else {
                delete planData[key];
            }
            
            localStorage.setItem('mealPlan', JSON.stringify(planData));
            closeModal();
            renderPlanner();
        }
        
        function deleteMeal() {
            if (!currentEdit) return;
            const key = currentEdit.dateKey + '-' + currentEdit.meal;
            delete planData[key];
            localStorage.setItem('mealPlan', JSON.stringify(planData));
            closeModal();
            renderPlanner();
        }
        
        function exportPlan() {
            const dates = getWeekDates(weekOffset);
            let text = '周餐计划 (' + formatDate(dates[0]) + ' - ' + formatDate(dates[6]) + ')\n';
            text += '='.repeat(30) + '\n\n';
            
            dates.forEach(function(date, dayIndex) {
                text += days[dayIndex] + ' (' + formatDate(date) + ')\n';
                const dateKey = getDateKey(date);
                meals.forEach(function(meal) {
                    const value = planData[dateKey + '-' + meal] || '未规划';
                    text += '  ' + mealLabels[meal] + ': ' + value + '\n';
                });
                text += '\n';
            });
            
            navigator.clipboard.writeText(text).then(function() { alert('已复制到剪贴板'); });
        }
        
        function generateShopping() {
            const dates = getWeekDates(weekOffset);
            const mealsList = [];
            
            dates.forEach(function(date) {
                const dateKey = getDateKey(date);
                meals.forEach(function(meal) {
                    const value = planData[dateKey + '-' + meal];
                    if (value) mealsList.push(value);
                });
            });
            
            let text = '本周菜单\n' + '='.repeat(20) + '\n\n';
            const unique = Array.from(new Set(mealsList));
            unique.forEach(function(m) { text += '- ' + m + '\n'; });
            
            navigator.clipboard.writeText(text).then(function() { alert('菜单已复制，可用于生成购物清单'); });
        }
        
        function clearWeek() {
            if (!confirm('确定清空本周所有餐食规划吗？')) return;
            const dates = getWeekDates(weekOffset);
            dates.forEach(function(date) {
                const dateKey = getDateKey(date);
                meals.forEach(function(meal) {
                    delete planData[dateKey + '-' + meal];
                });
            });
            localStorage.setItem('mealPlan', JSON.stringify(planData));
            renderPlanner();
        }
        
        document.getElementById('mealModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        document.getElementById('mealInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveMeal();
        });
        
        renderPlanner();
    </script>
</body>
</html>

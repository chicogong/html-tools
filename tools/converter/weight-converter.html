<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重量单位转换器</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .converter-panel {
            background: var(--pico-card-background-color);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .input-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        @media (max-width: 600px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }
        .input-section input[type="number"] {
            font-size: 1.5rem;
            text-align: right;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .result-card {
            background: var(--pico-background-color);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .result-card:hover {
            border-color: var(--pico-primary);
        }
        .result-card.active {
            border-color: var(--pico-primary);
            background: var(--pico-secondary-background);
        }
        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--pico-primary);
            word-break: break-all;
        }
        .result-unit {
            font-size: 0.9rem;
            color: var(--pico-muted-color);
            margin-top: 0.25rem;
        }
        .result-name {
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        .category-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .category-tab {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            background: var(--pico-background-color);
            border: 1px solid var(--pico-muted-border-color);
            transition: all 0.2s;
        }
        .category-tab:hover {
            background: var(--pico-secondary-background);
        }
        .category-tab.active {
            background: var(--pico-primary);
            color: white;
            border-color: var(--pico-primary);
        }
        .common-conversions {
            margin-top: 2rem;
        }
        .common-conversions h3 {
            margin-bottom: 1rem;
        }
        .conversion-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem;
        }
        .conversion-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--pico-background-color);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .conversion-formula {
            color: var(--pico-muted-color);
        }
        .quick-values {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .quick-value {
            padding: 0.25rem 0.75rem;
            background: var(--pico-secondary-background);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .quick-value:hover {
            background: var(--pico-primary);
            color: white;
        }
        .copy-hint {
            font-size: 0.8rem;
            color: var(--pico-muted-color);
            text-align: center;
            margin-top: 1rem;
        }
        .precision-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .precision-control label {
            font-size: 0.9rem;
            margin: 0;
        }
        .precision-control select {
            width: auto;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">← 返回首页</a>
        <header>
            <h1>重量单位转换器</h1>
            <button id="themeToggle" class="outline">切换主题</button>
        </header>

        <div class="converter-panel">
            <div class="input-section">
                <label>
                    输入数值
                    <input type="number" id="inputValue" value="1" step="any">
                </label>
                <label>
                    选择单位
                    <select id="inputUnit"></select>
                </label>
            </div>

            <div class="quick-values">
                <span style="font-size: 0.85rem; color: var(--pico-muted-color);">快速输入:</span>
                <span class="quick-value" data-value="1">1</span>
                <span class="quick-value" data-value="10">10</span>
                <span class="quick-value" data-value="50">50</span>
                <span class="quick-value" data-value="100">100</span>
                <span class="quick-value" data-value="500">500</span>
                <span class="quick-value" data-value="1000">1000</span>
            </div>

            <div class="category-tabs" id="categoryTabs"></div>

            <div class="results-grid" id="resultsGrid"></div>

            <div class="precision-control">
                <label>小数精度:</label>
                <select id="precision">
                    <option value="2">2位</option>
                    <option value="4" selected>4位</option>
                    <option value="6">6位</option>
                    <option value="8">8位</option>
                </select>
            </div>

            <p class="copy-hint">点击结果卡片可复制数值</p>
        </div>

        <div class="common-conversions">
            <h3>常用转换公式</h3>
            <div class="conversion-list">
                <div class="conversion-item">
                    <span>1 千克 (kg)</span>
                    <span class="conversion-formula">= 2.2046 磅 (lb)</span>
                </div>
                <div class="conversion-item">
                    <span>1 磅 (lb)</span>
                    <span class="conversion-formula">= 0.4536 千克 (kg)</span>
                </div>
                <div class="conversion-item">
                    <span>1 千克 (kg)</span>
                    <span class="conversion-formula">= 2 斤</span>
                </div>
                <div class="conversion-item">
                    <span>1 斤</span>
                    <span class="conversion-formula">= 500 克 (g)</span>
                </div>
                <div class="conversion-item">
                    <span>1 盎司 (oz)</span>
                    <span class="conversion-formula">= 28.3495 克 (g)</span>
                </div>
                <div class="conversion-item">
                    <span>1 吨 (t)</span>
                    <span class="conversion-formula">= 1000 千克 (kg)</span>
                </div>
                <div class="conversion-item">
                    <span>1 英石 (st)</span>
                    <span class="conversion-formula">= 6.3503 千克 (kg)</span>
                </div>
                <div class="conversion-item">
                    <span>1 金衡盎司</span>
                    <span class="conversion-formula">= 31.1035 克 (g)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 重量单位定义（以克为基准）
        const units = {
            metric: {
                name: '公制',
                units: [
                    { id: 'mg', name: '毫克', symbol: 'mg', toGram: 0.001 },
                    { id: 'g', name: '克', symbol: 'g', toGram: 1 },
                    { id: 'kg', name: '千克', symbol: 'kg', toGram: 1000 },
                    { id: 't', name: '吨', symbol: 't', toGram: 1000000 },
                    { id: 'ct', name: '克拉', symbol: 'ct', toGram: 0.2 }
                ]
            },
            imperial: {
                name: '英制',
                units: [
                    { id: 'gr', name: '格令', symbol: 'gr', toGram: 0.06479891 },
                    { id: 'dr', name: '打兰', symbol: 'dr', toGram: 1.7718451953125 },
                    { id: 'oz', name: '盎司', symbol: 'oz', toGram: 28.349523125 },
                    { id: 'lb', name: '磅', symbol: 'lb', toGram: 453.59237 },
                    { id: 'st', name: '英石', symbol: 'st', toGram: 6350.29318 },
                    { id: 'ton_uk', name: '英吨', symbol: 'ton(UK)', toGram: 1016046.9088 },
                    { id: 'ton_us', name: '美吨', symbol: 'ton(US)', toGram: 907184.74 }
                ]
            },
            chinese: {
                name: '中国市制',
                units: [
                    { id: 'li', name: '厘', symbol: '厘', toGram: 0.05 },
                    { id: 'fen', name: '分', symbol: '分', toGram: 0.5 },
                    { id: 'qian', name: '钱', symbol: '钱', toGram: 5 },
                    { id: 'liang', name: '两', symbol: '两', toGram: 50 },
                    { id: 'jin', name: '斤', symbol: '斤', toGram: 500 },
                    { id: 'dan', name: '担', symbol: '担', toGram: 50000 }
                ]
            },
            troy: {
                name: '金衡制',
                units: [
                    { id: 'gr_troy', name: '金衡格令', symbol: 'gr(troy)', toGram: 0.06479891 },
                    { id: 'dwt', name: '本尼威特', symbol: 'dwt', toGram: 1.55517384 },
                    { id: 'oz_troy', name: '金衡盎司', symbol: 'oz(troy)', toGram: 31.1034768 },
                    { id: 'lb_troy', name: '金衡磅', symbol: 'lb(troy)', toGram: 373.2417216 }
                ]
            }
        };

        // 状态
        let currentCategory = 'all';
        let precision = 4;

        // 获取所有单位
        function getAllUnits() {
            const all = [];
            Object.values(units).forEach(function(category) {
                category.units.forEach(function(unit) {
                    all.push(unit);
                });
            });
            return all;
        }

        // 初始化单位选择器
        function initUnitSelect() {
            const select = document.getElementById('inputUnit');
            
            Object.entries(units).forEach(function(entry) {
                const categoryKey = entry[0];
                const category = entry[1];
                
                const optgroup = document.createElement('optgroup');
                optgroup.label = category.name;
                
                category.units.forEach(function(unit) {
                    const option = document.createElement('option');
                    option.value = unit.id;
                    option.textContent = unit.name + ' (' + unit.symbol + ')';
                    if (unit.id === 'kg') option.selected = true;
                    optgroup.appendChild(option);
                });
                
                select.appendChild(optgroup);
            });
        }

        // 初始化类别标签
        function initCategoryTabs() {
            const container = document.getElementById('categoryTabs');
            
            const allTab = document.createElement('span');
            allTab.className = 'category-tab active';
            allTab.textContent = '全部';
            allTab.dataset.category = 'all';
            container.appendChild(allTab);
            
            Object.entries(units).forEach(function(entry) {
                const key = entry[0];
                const category = entry[1];
                
                const tab = document.createElement('span');
                tab.className = 'category-tab';
                tab.textContent = category.name;
                tab.dataset.category = key;
                container.appendChild(tab);
            });
            
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('category-tab')) {
                    container.querySelectorAll('.category-tab').forEach(function(t) {
                        t.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.category;
                    convert();
                }
            });
        }

        // 转换
        function convert() {
            const inputValue = parseFloat(document.getElementById('inputValue').value) || 0;
            const inputUnitId = document.getElementById('inputUnit').value;
            
            // 找到输入单位
            let inputUnit = null;
            Object.values(units).forEach(function(category) {
                category.units.forEach(function(unit) {
                    if (unit.id === inputUnitId) {
                        inputUnit = unit;
                    }
                });
            });
            
            if (!inputUnit) return;
            
            // 转换为克
            const grams = inputValue * inputUnit.toGram;
            
            // 显示结果
            const container = document.getElementById('resultsGrid');
            container.replaceChildren();
            
            const unitsToShow = currentCategory === 'all' 
                ? getAllUnits() 
                : units[currentCategory]?.units || [];
            
            unitsToShow.forEach(function(unit) {
                const value = grams / unit.toGram;
                
                const card = document.createElement('div');
                card.className = 'result-card';
                if (unit.id === inputUnitId) {
                    card.classList.add('active');
                }
                
                const valueDiv = document.createElement('div');
                valueDiv.className = 'result-value';
                valueDiv.textContent = formatNumber(value);
                
                const unitDiv = document.createElement('div');
                unitDiv.className = 'result-unit';
                unitDiv.textContent = unit.symbol;
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'result-name';
                nameDiv.textContent = unit.name;
                
                card.appendChild(valueDiv);
                card.appendChild(unitDiv);
                card.appendChild(nameDiv);
                
                card.addEventListener('click', function() {
                    navigator.clipboard.writeText(formatNumber(value)).then(function() {
                        // 显示复制反馈
                        const originalText = valueDiv.textContent;
                        valueDiv.textContent = '已复制!';
                        setTimeout(function() {
                            valueDiv.textContent = originalText;
                        }, 1000);
                    });
                });
                
                container.appendChild(card);
            });
        }

        // 格式化数字
        function formatNumber(num) {
            if (num === 0) return '0';
            
            // 非常大或非常小的数用科学计数法
            if (Math.abs(num) >= 1e10 || (Math.abs(num) < 1e-6 && num !== 0)) {
                return num.toExponential(precision);
            }
            
            // 移除末尾的0
            const fixed = num.toFixed(precision);
            return parseFloat(fixed).toString();
        }

        // 主题切换
        document.getElementById('themeToggle').addEventListener('click', function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // 事件绑定
        document.getElementById('inputValue').addEventListener('input', convert);
        document.getElementById('inputUnit').addEventListener('change', convert);
        
        document.getElementById('precision').addEventListener('change', function() {
            precision = parseInt(this.value);
            convert();
        });

        // 快速输入
        document.querySelectorAll('.quick-value').forEach(function(btn) {
            btn.addEventListener('click', function() {
                document.getElementById('inputValue').value = this.dataset.value;
                convert();
            });
        });

        // 初始化
        initUnitSelect();
        initCategoryTabs();
        convert();
    </script>
</body>
</html>

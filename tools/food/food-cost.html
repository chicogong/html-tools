<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>菜品成本计算器 - WebUtils</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #059669; --accent2: #10b981; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 12px; margin-bottom: 12px; align-items: end; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: var(--text2); }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 0.95rem; }
        input:focus, select:focus { outline: none; border-color: var(--accent); }
        .remove-btn { width: 36px; height: 36px; border-radius: 8px; border: 1px solid #ef4444; background: transparent; color: #ef4444; cursor: pointer; font-size: 1.2rem; margin-bottom: 2px; }
        .remove-btn:hover { background: #ef4444; color: white; }
        .add-btn { width: 100%; padding: 12px; border: 1px dashed var(--border); border-radius: 8px; background: transparent; color: var(--text2); cursor: pointer; margin-top: 12px; }
        .add-btn:hover { border-color: var(--accent); color: var(--accent); }
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px; }
        .summary-item { text-align: center; padding: 20px; background: var(--bg); border-radius: 12px; }
        .summary-item.highlight { background: linear-gradient(135deg, var(--accent), var(--accent2)); }
        .summary-item .value { font-size: 1.8rem; font-weight: 700; color: var(--accent); }
        .summary-item.highlight .value { color: white; }
        .summary-item .label { font-size: 0.85rem; color: var(--text2); margin-top: 4px; }
        .summary-item.highlight .label { color: rgba(255,255,255,0.9); }
        .pricing-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .pricing-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .pricing-row label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: var(--text2); }
        .result-row { display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
        .result-row .label { color: var(--text2); }
        .result-row .value { font-weight: 600; }
        .result-row.profit { background: rgba(5, 150, 105, 0.1); }
        .result-row.profit .value { color: var(--accent); }
        .cost-breakdown { margin-top: 16px; }
        .breakdown-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .breakdown-item:last-child { border-bottom: none; }
        @media (max-width: 700px) { .form-row { grid-template-columns: 1fr; } .summary-grid { grid-template-columns: 1fr; } .pricing-row { grid-template-columns: 1fr; } }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    
        .breadcrumb { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
    <nav class="breadcrumb"><a href="../../index.html">首页</a><span>›</span><a href="../../index.html#food">餐饮食品</a><span>›</span>菜品成本计算器</nav>
    <div class="container">
        <a href="../../index.html" class="back-link">← 返回</a>
        <h1>菜品成本计算器</h1>
        <p class="subtitle">精确计算食材成本和利润率</p>
        
        <div class="card">
            <h3 style="margin-bottom: 16px;">食材清单</h3>
            <div id="ingredientList"></div>
            <button class="add-btn" onclick="addIngredient()">+ 添加食材</button>
        </div>
        
        <div class="card">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="value" id="totalCost">¥0.00</div>
                    <div class="label">食材成本</div>
                </div>
                <div class="summary-item">
                    <div class="value" id="costPerServing">¥0.00</div>
                    <div class="label">每份成本</div>
                </div>
                <div class="summary-item highlight">
                    <div class="value" id="profitMargin">0%</div>
                    <div class="label">利润率</div>
                </div>
            </div>
            
            <div class="pricing-section">
                <h3 style="margin-bottom: 16px;">定价计算</h3>
                <div class="pricing-row">
                    <div>
                        <label>份数</label>
                        <input type="number" id="servings" value="4" min="1" oninput="calculate()">
                    </div>
                    <div>
                        <label>目标成本率 (%)</label>
                        <input type="number" id="targetCostRate" value="30" min="1" max="100" oninput="calculate()">
                    </div>
                    <div>
                        <label>售价 (¥)</label>
                        <input type="number" id="sellingPrice" value="0" min="0" oninput="calculate()">
                    </div>
                </div>
                
                <div class="result-row">
                    <span class="label">建议售价 (基于目标成本率)</span>
                    <span class="value" id="suggestedPrice">¥0.00</span>
                </div>
                <div class="result-row">
                    <span class="label">实际成本率</span>
                    <span class="value" id="actualCostRate">0%</span>
                </div>
                <div class="result-row profit">
                    <span class="label">每份利润</span>
                    <span class="value" id="profitPerServing">¥0.00</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3 style="margin-bottom: 16px;">成本明细</h3>
            <div class="cost-breakdown" id="costBreakdown"></div>
        </div>
    </div>
    
    <script>
        function createIngredientRow(name, quantity, unit, unitPrice) {
            const row = document.createElement('div');
            row.className = 'form-row ingredient-row';
            
            const nameGroup = document.createElement('div');
            nameGroup.className = 'form-group';
            const nameLabel = document.createElement('label');
            nameLabel.textContent = '食材名称';
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.className = 'ingredient-name';
            nameInput.placeholder = '如：鸡胸肉';
            nameInput.value = name || '';
            nameInput.addEventListener('input', calculate);
            nameGroup.appendChild(nameLabel);
            nameGroup.appendChild(nameInput);
            
            const qtyGroup = document.createElement('div');
            qtyGroup.className = 'form-group';
            const qtyLabel = document.createElement('label');
            qtyLabel.textContent = '用量';
            const qtyInput = document.createElement('input');
            qtyInput.type = 'number';
            qtyInput.className = 'ingredient-qty';
            qtyInput.placeholder = '100';
            qtyInput.value = quantity || '';
            qtyInput.addEventListener('input', calculate);
            qtyGroup.appendChild(qtyLabel);
            qtyGroup.appendChild(qtyInput);
            
            const unitGroup = document.createElement('div');
            unitGroup.className = 'form-group';
            const unitLabel = document.createElement('label');
            unitLabel.textContent = '单位';
            const unitInput = document.createElement('input');
            unitInput.type = 'text';
            unitInput.className = 'ingredient-unit';
            unitInput.placeholder = '克';
            unitInput.value = unit || '';
            unitInput.addEventListener('input', calculate);
            unitGroup.appendChild(unitLabel);
            unitGroup.appendChild(unitInput);
            
            const priceGroup = document.createElement('div');
            priceGroup.className = 'form-group';
            const priceLabel = document.createElement('label');
            priceLabel.textContent = '单价(¥)';
            const priceInput = document.createElement('input');
            priceInput.type = 'number';
            priceInput.className = 'ingredient-price';
            priceInput.placeholder = '0.05';
            priceInput.step = '0.01';
            priceInput.value = unitPrice || '';
            priceInput.addEventListener('input', calculate);
            priceGroup.appendChild(priceLabel);
            priceGroup.appendChild(priceInput);
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = '×';
            removeBtn.addEventListener('click', function() {
                row.remove();
                calculate();
            });
            
            row.appendChild(nameGroup);
            row.appendChild(qtyGroup);
            row.appendChild(unitGroup);
            row.appendChild(priceGroup);
            row.appendChild(removeBtn);
            
            return row;
        }
        
        function initIngredients() {
            const list = document.getElementById('ingredientList');
            list.appendChild(createIngredientRow('鸡胸肉', 200, '克', 0.025));
            list.appendChild(createIngredientRow('西兰花', 150, '克', 0.012));
            list.appendChild(createIngredientRow('橄榄油', 15, '毫升', 0.08));
            calculate();
        }
        
        function addIngredient() {
            const list = document.getElementById('ingredientList');
            list.appendChild(createIngredientRow('', '', '', ''));
        }
        
        function calculate() {
            const rows = document.querySelectorAll('.ingredient-row');
            let totalCost = 0;
            const breakdown = [];
            
            rows.forEach(function(row) {
                const name = row.querySelector('.ingredient-name').value;
                const qty = parseFloat(row.querySelector('.ingredient-qty').value) || 0;
                const unit = row.querySelector('.ingredient-unit').value;
                const price = parseFloat(row.querySelector('.ingredient-price').value) || 0;
                const cost = qty * price;
                totalCost += cost;
                
                if (name && cost > 0) {
                    breakdown.push({ name: name, qty: qty, unit: unit, cost: cost });
                }
            });
            
            const servings = parseInt(document.getElementById('servings').value) || 1;
            const targetCostRate = parseFloat(document.getElementById('targetCostRate').value) || 30;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            
            const costPerServing = totalCost / servings;
            const suggestedPrice = costPerServing / (targetCostRate / 100);
            
            let actualCostRate = 0;
            let profitPerServing = 0;
            let profitMargin = 0;
            
            if (sellingPrice > 0) {
                actualCostRate = (costPerServing / sellingPrice) * 100;
                profitPerServing = sellingPrice - costPerServing;
                profitMargin = (profitPerServing / sellingPrice) * 100;
            }
            
            document.getElementById('totalCost').textContent = '¥' + totalCost.toFixed(2);
            document.getElementById('costPerServing').textContent = '¥' + costPerServing.toFixed(2);
            document.getElementById('suggestedPrice').textContent = '¥' + suggestedPrice.toFixed(2);
            document.getElementById('actualCostRate').textContent = actualCostRate.toFixed(1) + '%';
            document.getElementById('profitPerServing').textContent = '¥' + profitPerServing.toFixed(2);
            document.getElementById('profitMargin').textContent = profitMargin.toFixed(1) + '%';
            
            const breakdownEl = document.getElementById('costBreakdown');
            while (breakdownEl.firstChild) breakdownEl.removeChild(breakdownEl.firstChild);
            
            breakdown.sort(function(a, b) { return b.cost - a.cost; });
            
            breakdown.forEach(function(item) {
                const div = document.createElement('div');
                div.className = 'breakdown-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name + ' (' + item.qty + item.unit + ')';
                
                const costSpan = document.createElement('span');
                costSpan.style.fontWeight = '600';
                const percent = totalCost > 0 ? (item.cost / totalCost * 100).toFixed(1) : 0;
                costSpan.textContent = '¥' + item.cost.toFixed(2) + ' (' + percent + '%)';
                
                div.appendChild(nameSpan);
                div.appendChild(costSpan);
                breakdownEl.appendChild(div);
            });
        }
        
        initIngredients();
    </script>
</body>
</html>

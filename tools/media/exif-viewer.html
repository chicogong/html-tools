<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EXIF ä¿¡æ¯æŸ¥çœ‹ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="æŸ¥çœ‹å›¾ç‰‡çš„ EXIF å…ƒæ•°æ®å’Œæ‹æ‘„ä¿¡æ¯" />
    <meta name="keywords" content="exif å›¾ç‰‡ ä¿¡æ¯ å…ƒæ•°æ® ç›¸æœº gps" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/media/exif-viewer.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="EXIF ä¿¡æ¯æŸ¥çœ‹ - WebUtils" />
    <meta property="og:description" content="æŸ¥çœ‹å›¾ç‰‡çš„ EXIF å…ƒæ•°æ®å’Œæ‹æ‘„ä¿¡æ¯" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/media/exif-viewer.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="EXIF ä¿¡æ¯æŸ¥çœ‹ - WebUtils" />
    <meta name="twitter:description" content="æŸ¥çœ‹å›¾ç‰‡çš„ EXIF å…ƒæ•°æ®å’Œæ‹æ‘„ä¿¡æ¯" />
    <!-- OG Image -->
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --border-default: #2a2a3a;
        --border-focus: #3a3a4a;
        --color-text-primary: #e0e0e0;
        --color-text-secondary: #888;
        --color-accent-cyan: #00d4ff;
        --accent-magenta: #f0f;
        --accent-green: #0f8;
        --accent-yellow: #fd0;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "SF Mono", Consolas, Monaco, monospace;
        font-size: 16px;
        line-height: 1.6;
        background: var(--color-bg-deep);
        color: var(--color-text-primary);
        min-height: 100vh;
        padding: 20px;
      }
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--color-accent-cyan);
        text-decoration: none;
        font-size: 14px;
        margin-bottom: 20px;
        padding: 8px 16px;
        border: 1px solid var(--border-default);
        border-radius: 6px;
        transition: all 0.2s;
      }
      .back-link:hover {
        background: var(--color-bg-card);
        border-color: var(--color-accent-cyan);
      }
      h1 {
        font-size: 28px;
        margin-bottom: 8px;
        background: linear-gradient(135deg, var(--color-accent-cyan), var(--accent-magenta));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .subtitle {
        color: var(--color-text-secondary);
        margin-bottom: 30px;
        font-size: 14px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .layout {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: 20px;
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
      .card {
        background: var(--color-bg-card);
        border: 1px solid var(--border-default);
        border-radius: 12px;
        padding: 24px;
      }
      .upload-area {
        border: 2px dashed var(--border-default);
        border-radius: 8px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
      }
      .upload-area:hover,
      .upload-area.dragover {
        border-color: var(--color-accent-cyan);
        background: rgba(0, 212, 255, 0.05);
      }
      .upload-area input {
        display: none;
      }
      .upload-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      .image-preview {
        display: none;
        margin-top: 20px;
      }
      .image-preview.visible {
        display: block;
      }
      .image-preview img {
        width: 100%;
        border-radius: 8px;
        border: 1px solid var(--border-default);
      }
      .image-info {
        margin-top: 16px;
        padding: 12px;
        background: var(--color-bg-surface);
        border-radius: 6px;
        font-size: 12px;
      }
      .image-info p {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
      }
      .image-info span:last-child {
        color: var(--color-accent-cyan);
      }
      .exif-section {
        display: none;
      }
      .exif-section.visible {
        display: block;
      }
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: var(--color-bg-surface);
        border-radius: 8px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .section-header:hover {
        background: var(--border-default);
      }
      .section-header h3 {
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .section-header .toggle {
        color: var(--color-text-secondary);
        transition: transform 0.2s;
      }
      .section-header.collapsed .toggle {
        transform: rotate(-90deg);
      }
      .section-content {
        overflow: hidden;
        transition: max-height 0.3s;
      }
      .section-header.collapsed + .section-content {
        max-height: 0 !important;
      }
      .exif-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      .exif-table th,
      .exif-table td {
        padding: 10px 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-default);
        font-size: 13px;
      }
      .exif-table th {
        color: var(--color-text-secondary);
        font-weight: normal;
        width: 40%;
      }
      .exif-table td {
        color: var(--color-text-primary);
        word-break: break-all;
      }
      .exif-table tr:last-child th,
      .exif-table tr:last-child td {
        border-bottom: none;
      }
      .no-exif {
        text-align: center;
        padding: 40px 20px;
        color: var(--color-text-secondary);
      }
      .no-exif .icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      .map-container {
        height: 200px;
        background: var(--color-bg-surface);
        border-radius: 8px;
        margin-top: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .map-container iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 8px;
      }
      .btn {
        padding: 10px 20px;
        border: 1px solid var(--border-default);
        border-radius: 6px;
        font-family: inherit;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        background: var(--color-bg-surface);
        color: var(--color-text-primary);
      }
      .btn:hover {
        border-color: var(--color-accent-cyan);
      }
      .btn-row {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }
      .highlight {
        color: var(--color-accent-cyan);
      }
      .warning {
        color: var(--accent-yellow);
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      EXIF ä¿¡æ¯æŸ¥çœ‹
    </nav>
    <div class="container">
      <h1>EXIF ä¿¡æ¯æŸ¥çœ‹</h1>
      <p class="subtitle">æŸ¥çœ‹å›¾ç‰‡çš„ EXIF å…ƒæ•°æ®ä¿¡æ¯</p>

      <div class="layout">
        <div class="sidebar">
          <div class="card">
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">ğŸ“·</div>
              <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
              <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px">
                æ”¯æŒ JPGã€JPEG æ ¼å¼
              </p>
              <input type="file" id="fileInput" accept="image/jpeg,image/jpg" />
            </div>

            <div class="image-preview" id="imagePreview">
              <img id="previewImg" alt="Preview" />
              <div class="image-info" id="basicInfo"></div>
            </div>

            <div class="btn-row" id="btnRow" style="display: none">
              <button class="btn" id="exportBtn">å¯¼å‡º JSON</button>
              <button class="btn" id="copyBtn">å¤åˆ¶ä¿¡æ¯</button>
            </div>
          </div>
        </div>

        <div class="main-area">
          <div class="card exif-section" id="exifSection">
            <div id="exifContent"></div>
          </div>

          <div class="card" id="noExifCard">
            <div class="no-exif" id="noExifContent">
              <div class="icon">ğŸ“‹</div>
              <p>ä¸Šä¼  JPEG å›¾ç‰‡ä»¥æŸ¥çœ‹ EXIF ä¿¡æ¯</p>
              <p style="font-size: 12px; margin-top: 8px">ä»… JPEG æ ¼å¼æ”¯æŒ EXIF æ•°æ®</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const imagePreview = document.getElementById("imagePreview");
      const previewImg = document.getElementById("previewImg");
      const basicInfo = document.getElementById("basicInfo");
      const exifSection = document.getElementById("exifSection");
      const exifContent = document.getElementById("exifContent");
      const noExifCard = document.getElementById("noExifCard");
      const noExifContent = document.getElementById("noExifContent");
      const btnRow = document.getElementById("btnRow");

      let currentExif = null;

      // Upload handlers
      uploadArea.addEventListener("click", () => fileInput.click());
      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });
      uploadArea.addEventListener("dragleave", () => uploadArea.classList.remove("dragover"));
      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        if (e.dataTransfer.files[0]) loadImage(e.dataTransfer.files[0]);
      });
      fileInput.addEventListener("change", (e) => {
        if (e.target.files[0]) loadImage(e.target.files[0]);
      });

      window.loadImage = function (file) {
        if (!file.type.match(/image\/jpe?g/)) {
          alert("è¯·ä¸Šä¼  JPEG æ ¼å¼çš„å›¾ç‰‡");
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          previewImg.src = e.target.result;
          imagePreview.classList.add("visible");

          const img = new Image();
          img.onload = () => {
            renderBasicInfo(file.name, img.width, img.height, file.size, file.type);
          };
          img.src = e.target.result;

          readExif(e.target.result);
        };
        reader.readAsDataURL(file);
      };

      function renderBasicInfo(name, width, height, size, type) {
        while (basicInfo.firstChild) {
          basicInfo.removeChild(basicInfo.firstChild);
        }

        const items = [
          { label: "æ–‡ä»¶å", value: name },
          { label: "å°ºå¯¸", value: width + " Ã— " + height },
          { label: "æ–‡ä»¶å¤§å°", value: formatFileSize(size) },
          { label: "ç±»å‹", value: type }
        ];

        items.forEach((item) => {
          const p = document.createElement("p");
          const labelSpan = document.createElement("span");
          labelSpan.textContent = item.label;
          const valueSpan = document.createElement("span");
          valueSpan.textContent = item.value;
          p.appendChild(labelSpan);
          p.appendChild(valueSpan);
          basicInfo.appendChild(p);
        });
      }

      function readExif(dataUrl) {
        // Convert base64 to ArrayBuffer
        const base64 = dataUrl.split(",")[1];
        const binary = atob(base64);
        const len = binary.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
          bytes[i] = binary.charCodeAt(i);
        }

        const exif = parseExif(bytes.buffer);
        currentExif = exif;

        if (exif && Object.keys(exif).length > 0) {
          displayExif(exif);
          exifSection.classList.add("visible");
          noExifCard.style.display = "none";
          btnRow.style.display = "flex";
        } else {
          exifSection.classList.remove("visible");
          noExifCard.style.display = "block";
          showNoExifMessage();
          btnRow.style.display = "none";
        }
      }

      function showNoExifMessage() {
        while (noExifContent.firstChild) {
          noExifContent.removeChild(noExifContent.firstChild);
        }

        const icon = document.createElement("div");
        icon.className = "icon";
        icon.textContent = "âš ï¸";

        const msg = document.createElement("p");
        msg.textContent = "æ­¤å›¾ç‰‡ä¸åŒ…å« EXIF ä¿¡æ¯";

        const sub = document.createElement("p");
        sub.style.fontSize = "12px";
        sub.style.marginTop = "8px";
        sub.textContent = "å¯èƒ½å·²è¢«å‰¥ç¦»æˆ–ä»æœªåŒ…å«";

        noExifContent.appendChild(icon);
        noExifContent.appendChild(msg);
        noExifContent.appendChild(sub);
      }

      function parseExif(buffer) {
        const view = new DataView(buffer);

        // Check JPEG magic number
        if (view.getUint16(0) !== 0xffd8) return null;

        let offset = 2;
        const exifData = {};

        while (offset < view.byteLength) {
          if (view.getUint8(offset) !== 0xff) break;

          const marker = view.getUint8(offset + 1);

          // APP1 marker (EXIF)
          if (marker === 0xe1) {
            const exifHeader = getString(view, offset + 4, 4);

            if (exifHeader === "Exif") {
              const tiffOffset = offset + 10;
              const littleEndian = view.getUint16(tiffOffset) === 0x4949;

              const ifdOffset = view.getUint32(tiffOffset + 4, littleEndian);

              // Parse IFD0
              parseIFD(view, tiffOffset, tiffOffset + ifdOffset, littleEndian, exifData, "IFD0");

              // Look for EXIF IFD
              if (exifData.ExifIFDPointer) {
                parseIFD(
                  view,
                  tiffOffset,
                  tiffOffset + exifData.ExifIFDPointer,
                  littleEndian,
                  exifData,
                  "EXIF"
                );
              }

              // Look for GPS IFD
              if (exifData.GPSInfoIFDPointer) {
                parseIFD(
                  view,
                  tiffOffset,
                  tiffOffset + exifData.GPSInfoIFDPointer,
                  littleEndian,
                  exifData,
                  "GPS"
                );
              }
            }
            break;
          }

          offset += 2 + view.getUint16(offset + 2);
        }

        return exifData;
      }

      const EXIF_TAGS = {
        0x010f: "Make",
        0x0110: "Model",
        0x0112: "Orientation",
        0x011a: "XResolution",
        0x011b: "YResolution",
        0x0128: "ResolutionUnit",
        0x0131: "Software",
        0x0132: "DateTime",
        0x013b: "Artist",
        0x8298: "Copyright",
        0x8769: "ExifIFDPointer",
        0x8825: "GPSInfoIFDPointer",
        0x829a: "ExposureTime",
        0x829d: "FNumber",
        0x8822: "ExposureProgram",
        0x8827: "ISOSpeedRatings",
        0x9000: "ExifVersion",
        0x9003: "DateTimeOriginal",
        0x9004: "DateTimeDigitized",
        0x9201: "ShutterSpeedValue",
        0x9202: "ApertureValue",
        0x9203: "BrightnessValue",
        0x9204: "ExposureBiasValue",
        0x9205: "MaxApertureValue",
        0x9206: "SubjectDistance",
        0x9207: "MeteringMode",
        0x9208: "LightSource",
        0x9209: "Flash",
        0x920a: "FocalLength",
        0xa001: "ColorSpace",
        0xa002: "PixelXDimension",
        0xa003: "PixelYDimension",
        0xa402: "ExposureMode",
        0xa403: "WhiteBalance",
        0xa404: "DigitalZoomRatio",
        0xa405: "FocalLengthIn35mmFilm",
        0xa406: "SceneCaptureType",
        0xa420: "ImageUniqueID",
        0xa433: "LensMake",
        0xa434: "LensModel"
      };

      const GPS_TAGS = {
        0x0000: "GPSVersionID",
        0x0001: "GPSLatitudeRef",
        0x0002: "GPSLatitude",
        0x0003: "GPSLongitudeRef",
        0x0004: "GPSLongitude",
        0x0005: "GPSAltitudeRef",
        0x0006: "GPSAltitude",
        0x0007: "GPSTimeStamp",
        0x001d: "GPSDateStamp"
      };

      function parseIFD(view, tiffOffset, ifdOffset, littleEndian, exifData, ifdName) {
        try {
          const numEntries = view.getUint16(ifdOffset, littleEndian);

          for (let i = 0; i < numEntries; i++) {
            const entryOffset = ifdOffset + 2 + i * 12;
            const tag = view.getUint16(entryOffset, littleEndian);
            const type = view.getUint16(entryOffset + 2, littleEndian);
            const count = view.getUint32(entryOffset + 4, littleEndian);
            const valueOffset = entryOffset + 8;

            const tagName =
              (ifdName === "GPS" ? GPS_TAGS[tag] : EXIF_TAGS[tag]) || "Unknown_" + tag.toString(16);
            const value = readTagValue(view, tiffOffset, valueOffset, type, count, littleEndian);

            if (value !== null) {
              exifData[tagName] = value;
            }
          }
        } catch (e) {
          console.log("Error parsing IFD:", e);
        }
      }

      function readTagValue(view, tiffOffset, valueOffset, type, count, littleEndian) {
        const typeSize = [0, 1, 1, 2, 4, 8, 1, 1, 2, 4, 8, 4, 8];
        const totalSize = typeSize[type] * count;

        let dataOffset = valueOffset;
        if (totalSize > 4) {
          dataOffset = tiffOffset + view.getUint32(valueOffset, littleEndian);
        }

        try {
          switch (type) {
            case 1: // BYTE
            case 7: // UNDEFINED
              if (count === 1) return view.getUint8(dataOffset);
              const bytes = [];
              for (let i = 0; i < count; i++) bytes.push(view.getUint8(dataOffset + i));
              return bytes;
            case 2: // ASCII
              return getString(view, dataOffset, count - 1);
            case 3: // SHORT
              if (count === 1) return view.getUint16(dataOffset, littleEndian);
              const shorts = [];
              for (let i = 0; i < count; i++)
                shorts.push(view.getUint16(dataOffset + i * 2, littleEndian));
              return shorts;
            case 4: // LONG
              if (count === 1) return view.getUint32(dataOffset, littleEndian);
              const longs = [];
              for (let i = 0; i < count; i++)
                longs.push(view.getUint32(dataOffset + i * 4, littleEndian));
              return longs;
            case 5: // RATIONAL
            case 10: // SRATIONAL
              const rationals = [];
              for (let i = 0; i < count; i++) {
                const num =
                  type === 5
                    ? view.getUint32(dataOffset + i * 8, littleEndian)
                    : view.getInt32(dataOffset + i * 8, littleEndian);
                const den =
                  type === 5
                    ? view.getUint32(dataOffset + i * 8 + 4, littleEndian)
                    : view.getInt32(dataOffset + i * 8 + 4, littleEndian);
                rationals.push(den === 0 ? 0 : num / den);
              }
              return count === 1 ? rationals[0] : rationals;
            default:
              return null;
          }
        } catch (e) {
          return null;
        }
      }

      function getString(view, offset, length) {
        let str = "";
        for (let i = 0; i < length; i++) {
          const c = view.getUint8(offset + i);
          if (c === 0) break;
          str += String.fromCharCode(c);
        }
        return str;
      }

      function displayExif(exif) {
        const sections = [
          {
            title: "ğŸ“· ç›¸æœºä¿¡æ¯",
            keys: ["Make", "Model", "Software", "LensMake", "LensModel"],
            collapsed: false
          },
          {
            title: "âš™ï¸ æ‹æ‘„å‚æ•°",
            keys: [
              "ExposureTime",
              "FNumber",
              "ISOSpeedRatings",
              "FocalLength",
              "FocalLengthIn35mmFilm",
              "ExposureBiasValue",
              "MaxApertureValue",
              "MeteringMode",
              "Flash",
              "WhiteBalance",
              "ExposureMode",
              "ExposureProgram"
            ],
            collapsed: false
          },
          {
            title: "ğŸ“… æ—¥æœŸæ—¶é—´",
            keys: ["DateTime", "DateTimeOriginal", "DateTimeDigitized"],
            collapsed: true
          },
          {
            title: "ğŸ“ å›¾åƒä¿¡æ¯",
            keys: [
              "PixelXDimension",
              "PixelYDimension",
              "Orientation",
              "ColorSpace",
              "XResolution",
              "YResolution",
              "ResolutionUnit"
            ],
            collapsed: true
          },
          {
            title: "ğŸ“ GPS ä¿¡æ¯",
            keys: [
              "GPSLatitude",
              "GPSLatitudeRef",
              "GPSLongitude",
              "GPSLongitudeRef",
              "GPSAltitude",
              "GPSAltitudeRef",
              "GPSDateStamp",
              "GPSTimeStamp"
            ],
            collapsed: true
          },
          {
            title: "ğŸ“ å…¶ä»–ä¿¡æ¯",
            keys: ["Artist", "Copyright", "ImageUniqueID", "SceneCaptureType"],
            collapsed: true
          }
        ];

        while (exifContent.firstChild) {
          exifContent.removeChild(exifContent.firstChild);
        }

        sections.forEach((section) => {
          const sectionData = section.keys.filter((key) => exif[key] !== undefined);
          if (sectionData.length === 0) return;

          // Create header
          const header = document.createElement("div");
          header.className = "section-header" + (section.collapsed ? " collapsed" : "");
          header.onclick = function () {
            this.classList.toggle("collapsed");
          };

          const h3 = document.createElement("h3");
          h3.textContent = section.title;
          header.appendChild(h3);

          const toggle = document.createElement("span");
          toggle.className = "toggle";
          toggle.textContent = "â–¼";
          header.appendChild(toggle);

          exifContent.appendChild(header);

          // Create content
          const content = document.createElement("div");
          content.className = "section-content";
          content.style.maxHeight = section.collapsed ? "0" : "1000px";

          const table = document.createElement("table");
          table.className = "exif-table";

          sectionData.forEach((key) => {
            const tr = document.createElement("tr");
            const th = document.createElement("th");
            th.textContent = formatTagName(key);
            const td = document.createElement("td");
            td.textContent = formatExifValue(key, exif[key]);
            tr.appendChild(th);
            tr.appendChild(td);
            table.appendChild(tr);
          });

          content.appendChild(table);
          exifContent.appendChild(content);

          // Show GPS coordinates as text (no external map to protect privacy)
          if (section.title.includes("GPS") && exif.GPSLatitude && exif.GPSLongitude) {
            const lat = convertGPSToDecimal(exif.GPSLatitude, exif.GPSLatitudeRef);
            const lng = convertGPSToDecimal(exif.GPSLongitude, exif.GPSLongitudeRef);

            const coordsContainer = document.createElement("div");
            coordsContainer.className = "map-container";
            coordsContainer.style.flexDirection = "column";
            coordsContainer.style.gap = "8px";
            coordsContainer.style.padding = "16px";

            const coordsText = document.createElement("div");
            coordsText.style.fontFamily = "'JetBrains Mono', monospace";
            coordsText.style.fontSize = "14px";
            coordsText.style.color = "var(--color-accent-cyan)";
            coordsText.textContent = lat.toFixed(6) + ", " + lng.toFixed(6);

            const copyBtn = document.createElement("button");
            copyBtn.className = "btn";
            copyBtn.style.marginTop = "8px";
            copyBtn.textContent = "å¤åˆ¶åæ ‡";
            copyBtn.onclick = function () {
              navigator.clipboard
                .writeText(lat.toFixed(6) + ", " + lng.toFixed(6))
                .then(function () {
                  copyBtn.textContent = "å·²å¤åˆ¶!";
                  setTimeout(function () {
                    copyBtn.textContent = "å¤åˆ¶åæ ‡";
                  }, 2000);
                });
            };

            coordsContainer.appendChild(coordsText);
            coordsContainer.appendChild(copyBtn);
            exifContent.appendChild(coordsContainer);
          }
        });
      }

      function formatTagName(tag) {
        return tag.replace(/([A-Z])/g, " $1").trim();
      }

      function formatExifValue(tag, value) {
        if (value === undefined || value === null) return "-";

        switch (tag) {
          case "ExposureTime":
            return value < 1 ? "1/" + Math.round(1 / value) + "s" : value + "s";
          case "FNumber":
            return "f/" + value.toFixed(1);
          case "FocalLength":
          case "FocalLengthIn35mmFilm":
            return value + "mm";
          case "ExposureBiasValue":
            return (value > 0 ? "+" : "") + value.toFixed(1) + " EV";
          case "GPSLatitude":
          case "GPSLongitude":
            if (Array.isArray(value)) {
              return value[0] + "Â° " + value[1] + "' " + value[2].toFixed(2) + '"';
            }
            return String(value);
          case "GPSAltitude":
            return value.toFixed(1) + "m";
          case "Flash":
            return value & 1 ? "é—ªå…‰ç¯å·²è§¦å‘" : "é—ªå…‰ç¯æœªè§¦å‘";
          case "MeteringMode":
            const meters = ["æœªçŸ¥", "å¹³å‡", "ä¸­å¤®é‡ç‚¹", "ç‚¹æµ‹å…‰", "å¤šç‚¹", "çŸ©é˜µ", "å±€éƒ¨"];
            return meters[value] || String(value);
          case "WhiteBalance":
            return value === 0 ? "è‡ªåŠ¨" : "æ‰‹åŠ¨";
          case "ExposureMode":
            return ["è‡ªåŠ¨", "æ‰‹åŠ¨", "åŒ…å›´æ›å…‰"][value] || String(value);
          case "Orientation":
            const orientations = [
              "",
              "æ­£å¸¸",
              "æ°´å¹³ç¿»è½¬",
              "æ—‹è½¬180Â°",
              "å‚ç›´ç¿»è½¬",
              "é¡ºæ—¶é’ˆ90Â°+æ°´å¹³ç¿»è½¬",
              "é¡ºæ—¶é’ˆ90Â°",
              "é€†æ—¶é’ˆ90Â°+æ°´å¹³ç¿»è½¬",
              "é€†æ—¶é’ˆ90Â°"
            ];
            return orientations[value] || String(value);
          case "ColorSpace":
            return value === 1 ? "sRGB" : "Adobe RGB";
          case "ResolutionUnit":
            return value === 2 ? "dpi" : value === 3 ? "dpcm" : String(value);
          default:
            if (Array.isArray(value)) return value.join(", ");
            return String(value);
        }
      }

      function convertGPSToDecimal(coords, ref) {
        if (!Array.isArray(coords) || coords.length < 3) return 0;
        let decimal = coords[0] + coords[1] / 60 + coords[2] / 3600;
        if (ref === "S" || ref === "W") decimal = -decimal;
        return decimal;
      }

      window.formatFileSize = function (bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
        return (bytes / (1024 * 1024)).toFixed(2) + " MB";
      };

      // Export
      document.getElementById("exportBtn").addEventListener("click", () => {
        if (!currentExif) return;
        const blob = new Blob([JSON.stringify(currentExif, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "exif_data.json";
        a.click();
        URL.revokeObjectURL(url);
      });

      // Copy
      document.getElementById("copyBtn").addEventListener("click", () => {
        if (!currentExif) return;
        const text = Object.entries(currentExif)
          .map(([k, v]) => formatTagName(k) + ": " + formatExifValue(k, v))
          .join("\n");
        navigator.clipboard.writeText(text).then(() => {
          const btn = document.getElementById("copyBtn");
          btn.textContent = "å·²å¤åˆ¶!";
          setTimeout(() => (btn.textContent = "å¤åˆ¶ä¿¡æ¯"), 2000);
        });
      });

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", newTheme);
      }

      // Load saved theme
      const savedTheme = localStorage.getItem("theme") || "dark";
      if (savedTheme === "light") {
        document.documentElement.setAttribute("data-theme", "light");
        document.getElementById("theme-icon").textContent = "â˜€ï¸";
      }
    </script>
  </body>
</html>

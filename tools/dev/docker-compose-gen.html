<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Docker Compose ç”Ÿæˆå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="keywords" content="docker-compose-gen,dev,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/docker-compose-gen.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/dev/docker-compose-gen.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:description" content="Docker Compose ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --spacing-compact: 0.5rem;
      }
      body {
        padding: 1rem;
      }
      .container {
        max-width: 1400px;
      }
      .grid-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      @media (max-width: 992px) {
        .grid-layout {
          grid-template-columns: 1fr;
        }
      }
      .service-card {
        background: var(--pico-card-background-color);
        border: 1px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        padding: 1rem;
        margin-bottom: 1rem;
      }
      .service-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .service-header h4 {
        margin: 0;
      }
      .port-row,
      .env-row,
      .volume-row {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        align-items: center;
      }
      .port-row input,
      .env-row input,
      .volume-row input {
        margin-bottom: 0;
      }
      .output-section {
        position: sticky;
        top: 1rem;
      }
      pre {
        background: var(--pico-code-background-color);
        padding: 1rem;
        border-radius: var(--pico-border-radius);
        overflow-x: auto;
        max-height: 70vh;
        font-size: 0.85rem;
      }
      .btn-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .template-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
      }
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
      }
      details {
        margin-bottom: 0.5rem;
      }
      .small-input {
        width: 100px;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      Docker Compose ç”Ÿæˆå™¨
    </nav>
    <button class="theme-toggle outline" onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>

    <main class="container">
      <a
        href="../../index.html"
        style="
          display: inline-block;
          margin-bottom: 1rem;
          color: var(--pico-primary);
          text-decoration: none;
        "
      >
        â† è¿”å›é¦–é¡µ
      </a>
      <h1>ğŸ³ Docker Compose ç”Ÿæˆå™¨</h1>
      <p>å¯è§†åŒ–åˆ›å»º docker-compose.yml é…ç½®æ–‡ä»¶</p>

      <div class="grid-layout">
        <section>
          <article>
            <header>
              <h3>åŸºç¡€é…ç½®</h3>
            </header>
            <label>
              Compose ç‰ˆæœ¬
              <select id="composeVersion">
                <option value="3.9">3.9</option>
                <option value="3.8">3.8</option>
                <option value="3.7">3.7</option>
                <option value="3">3</option>
                <option value="2.4">2.4</option>
              </select>
            </label>

            <h4>å¿«é€Ÿæ·»åŠ æ¨¡æ¿</h4>
            <div class="btn-group">
              <button class="template-btn outline" onclick="addTemplate('nginx')">Nginx</button>
              <button class="template-btn outline" onclick="addTemplate('mysql')">MySQL</button>
              <button class="template-btn outline" onclick="addTemplate('postgres')">
                PostgreSQL
              </button>
              <button class="template-btn outline" onclick="addTemplate('redis')">Redis</button>
              <button class="template-btn outline" onclick="addTemplate('mongo')">MongoDB</button>
              <button class="template-btn outline" onclick="addTemplate('node')">Node.js</button>
              <button class="template-btn outline" onclick="addTemplate('python')">Python</button>
              <button class="template-btn outline" onclick="addTemplate('php')">PHP</button>
            </div>
          </article>

          <article>
            <header>
              <div style="display: flex; justify-content: space-between; align-items: center">
                <h3>æœåŠ¡é…ç½®</h3>
                <button class="outline" onclick="addService()">+ æ·»åŠ æœåŠ¡</button>
              </div>
            </header>
            <div id="servicesContainer"></div>
          </article>

          <article>
            <header>
              <div style="display: flex; justify-content: space-between; align-items: center">
                <h3>ç½‘ç»œé…ç½®</h3>
                <button class="outline" onclick="addNetwork()">+ æ·»åŠ ç½‘ç»œ</button>
              </div>
            </header>
            <div id="networksContainer"></div>
          </article>

          <article>
            <header>
              <div style="display: flex; justify-content: space-between; align-items: center">
                <h3>æ•°æ®å·é…ç½®</h3>
                <button class="outline" onclick="addVolume()">+ æ·»åŠ æ•°æ®å·</button>
              </div>
            </header>
            <div id="volumesContainer"></div>
          </article>
        </section>

        <section class="output-section">
          <article>
            <header>
              <div style="display: flex; justify-content: space-between; align-items: center">
                <h3>ç”Ÿæˆç»“æœ</h3>
                <div class="btn-group">
                  <button class="outline" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶</button>
                  <button class="outline" onclick="downloadFile()">ğŸ’¾ ä¸‹è½½</button>
                </div>
              </div>
            </header>
            <pre><code id="output">version: "3.9"

services:
  # ç‚¹å‡»å·¦ä¾§æ·»åŠ æœåŠ¡å¼€å§‹é…ç½®</code></pre>
          </article>
        </section>
      </div>
    </main>

    <script>
      let services = [];
      let networks = [];
      let volumes = [];
      let serviceId = 0;
      let networkId = 0;
      let volumeId = 0;

      // ä¸»é¢˜åˆ‡æ¢
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      };

      // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
      (function () {
        const savedTheme = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", savedTheme);
      })();

      // æœåŠ¡æ¨¡æ¿
      const templates = {
        nginx: {
          name: "nginx",
          image: "nginx:alpine",
          ports: [{ host: "80", container: "80" }],
          volumes: [{ host: "./nginx.conf", container: "/etc/nginx/nginx.conf", readonly: true }]
        },
        mysql: {
          name: "mysql",
          image: "mysql:8.0",
          ports: [{ host: "3306", container: "3306" }],
          environment: [
            { key: "MYSQL_ROOT_PASSWORD", value: "rootpassword" },
            { key: "MYSQL_DATABASE", value: "mydb" }
          ],
          volumes: [{ host: "mysql_data", container: "/var/lib/mysql", readonly: false }]
        },
        postgres: {
          name: "postgres",
          image: "postgres:15-alpine",
          ports: [{ host: "5432", container: "5432" }],
          environment: [
            { key: "POSTGRES_PASSWORD", value: "postgres" },
            { key: "POSTGRES_DB", value: "mydb" }
          ],
          volumes: [
            { host: "postgres_data", container: "/var/lib/postgresql/data", readonly: false }
          ]
        },
        redis: {
          name: "redis",
          image: "redis:alpine",
          ports: [{ host: "6379", container: "6379" }],
          volumes: [{ host: "redis_data", container: "/data", readonly: false }]
        },
        mongo: {
          name: "mongo",
          image: "mongo:6",
          ports: [{ host: "27017", container: "27017" }],
          environment: [
            { key: "MONGO_INITDB_ROOT_USERNAME", value: "root" },
            { key: "MONGO_INITDB_ROOT_PASSWORD", value: "rootpassword" }
          ],
          volumes: [{ host: "mongo_data", container: "/data/db", readonly: false }]
        },
        node: {
          name: "app",
          image: "node:18-alpine",
          ports: [{ host: "3000", container: "3000" }],
          volumes: [{ host: ".", container: "/app", readonly: false }],
          workingDir: "/app",
          command: "npm start"
        },
        python: {
          name: "app",
          image: "python:3.11-slim",
          ports: [{ host: "8000", container: "8000" }],
          volumes: [{ host: ".", container: "/app", readonly: false }],
          workingDir: "/app",
          command: "python app.py"
        },
        php: {
          name: "php",
          image: "php:8.2-fpm",
          volumes: [{ host: "./src", container: "/var/www/html", readonly: false }]
        }
      };

      window.addTemplate = function (type) {
        const template = templates[type];
        if (template) {
          addService(template);
        }
      };

      function addService(template = null) {
        const id = serviceId++;
        const service = {
          id,
          name: template?.name || "service_" + id,
          image: template?.image || "",
          ports: template?.ports ? JSON.parse(JSON.stringify(template.ports)) : [],
          environment: template?.environment
            ? JSON.parse(JSON.stringify(template.environment))
            : [],
          volumes: template?.volumes ? JSON.parse(JSON.stringify(template.volumes)) : [],
          dependsOn: [],
          restart: "unless-stopped",
          workingDir: template?.workingDir || "",
          command: template?.command || "",
          networks: []
        };
        services.push(service);
        renderServices();
        generateOutput();
      }

      window.removeService = function (id) {
        services = services.filter((s) => s.id !== id);
        renderServices();
        generateOutput();
      };

      function renderServices() {
        const container = document.getElementById("servicesContainer");
        container.replaceChildren();

        services.forEach((service) => {
          const card = document.createElement("div");
          card.className = "service-card";

          // Header
          const header = document.createElement("div");
          header.className = "service-header";
          const title = document.createElement("h4");
          title.textContent = "ğŸ”§ " + service.name;
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "outline secondary";
          deleteBtn.textContent = "åˆ é™¤";
          deleteBtn.onclick = () => removeService(service.id);
          header.appendChild(title);
          header.appendChild(deleteBtn);
          card.appendChild(header);

          // Name and Image inputs
          const gridDiv = document.createElement("div");
          gridDiv.className = "grid";

          const nameLabel = document.createElement("label");
          nameLabel.textContent = "æœåŠ¡åç§°";
          const nameInput = document.createElement("input");
          nameInput.type = "text";
          nameInput.value = service.name;
          nameInput.onchange = (e) => updateService(service.id, "name", e.target.value);
          nameLabel.appendChild(nameInput);

          const imageLabel = document.createElement("label");
          imageLabel.textContent = "é•œåƒ";
          const imageInput = document.createElement("input");
          imageInput.type = "text";
          imageInput.value = service.image;
          imageInput.placeholder = "nginx:alpine";
          imageInput.onchange = (e) => updateService(service.id, "image", e.target.value);
          imageLabel.appendChild(imageInput);

          gridDiv.appendChild(nameLabel);
          gridDiv.appendChild(imageLabel);
          card.appendChild(gridDiv);

          // Ports details
          const portsDetails = document.createElement("details");
          const portsSummary = document.createElement("summary");
          portsSummary.textContent = "ç«¯å£æ˜ å°„ (" + service.ports.length + ")";
          portsDetails.appendChild(portsSummary);

          const portsDiv = document.createElement("div");
          service.ports.forEach((p, i) => {
            const row = createPortRow(service.id, p, i);
            portsDiv.appendChild(row);
          });
          portsDetails.appendChild(portsDiv);

          const addPortBtn = document.createElement("button");
          addPortBtn.className = "outline";
          addPortBtn.textContent = "+ æ·»åŠ ç«¯å£";
          addPortBtn.onclick = () => addServicePort(service.id);
          portsDetails.appendChild(addPortBtn);
          card.appendChild(portsDetails);

          // Environment details
          const envDetails = document.createElement("details");
          const envSummary = document.createElement("summary");
          envSummary.textContent = "ç¯å¢ƒå˜é‡ (" + service.environment.length + ")";
          envDetails.appendChild(envSummary);

          const envDiv = document.createElement("div");
          service.environment.forEach((e, i) => {
            const row = createEnvRow(service.id, e, i);
            envDiv.appendChild(row);
          });
          envDetails.appendChild(envDiv);

          const addEnvBtn = document.createElement("button");
          addEnvBtn.className = "outline";
          addEnvBtn.textContent = "+ æ·»åŠ å˜é‡";
          addEnvBtn.onclick = () => addServiceEnv(service.id);
          envDetails.appendChild(addEnvBtn);
          card.appendChild(envDetails);

          // Volumes details
          const volDetails = document.createElement("details");
          const volSummary = document.createElement("summary");
          volSummary.textContent = "æ•°æ®å· (" + service.volumes.length + ")";
          volDetails.appendChild(volSummary);

          const volDiv = document.createElement("div");
          service.volumes.forEach((v, i) => {
            const row = createVolumeRow(service.id, v, i);
            volDiv.appendChild(row);
          });
          volDetails.appendChild(volDiv);

          const addVolBtn = document.createElement("button");
          addVolBtn.className = "outline";
          addVolBtn.textContent = "+ æ·»åŠ æ•°æ®å·";
          addVolBtn.onclick = () => addServiceVol(service.id);
          volDetails.appendChild(addVolBtn);
          card.appendChild(volDetails);

          // Advanced options
          const advDetails = document.createElement("details");
          const advSummary = document.createElement("summary");
          advSummary.textContent = "é«˜çº§é€‰é¡¹";
          advDetails.appendChild(advSummary);

          // Restart policy
          const restartLabel = document.createElement("label");
          restartLabel.textContent = "é‡å¯ç­–ç•¥";
          const restartSelect = document.createElement("select");
          ["no", "always", "on-failure", "unless-stopped"].forEach((opt) => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            option.selected = service.restart === opt;
            restartSelect.appendChild(option);
          });
          restartSelect.onchange = (e) => updateService(service.id, "restart", e.target.value);
          restartLabel.appendChild(restartSelect);
          advDetails.appendChild(restartLabel);

          // Working directory
          const wdLabel = document.createElement("label");
          wdLabel.textContent = "å·¥ä½œç›®å½•";
          const wdInput = document.createElement("input");
          wdInput.type = "text";
          wdInput.value = service.workingDir;
          wdInput.placeholder = "/app";
          wdInput.onchange = (e) => updateService(service.id, "workingDir", e.target.value);
          wdLabel.appendChild(wdInput);
          advDetails.appendChild(wdLabel);

          // Command
          const cmdLabel = document.createElement("label");
          cmdLabel.textContent = "å¯åŠ¨å‘½ä»¤";
          const cmdInput = document.createElement("input");
          cmdInput.type = "text";
          cmdInput.value = service.command;
          cmdInput.placeholder = "npm start";
          cmdInput.onchange = (e) => updateService(service.id, "command", e.target.value);
          cmdLabel.appendChild(cmdInput);
          advDetails.appendChild(cmdLabel);

          // Depends on
          const depLabel = document.createElement("label");
          depLabel.textContent = "ä¾èµ–æœåŠ¡";
          const depSelect = document.createElement("select");
          depSelect.multiple = true;
          services
            .filter((s) => s.id !== service.id)
            .forEach((s) => {
              const option = document.createElement("option");
              option.value = s.name;
              option.textContent = s.name;
              option.selected = service.dependsOn.includes(s.name);
              depSelect.appendChild(option);
            });
          depSelect.onchange = (e) => {
            const selected = Array.from(e.target.selectedOptions).map((o) => o.value);
            service.dependsOn = selected;
            generateOutput();
          };
          depLabel.appendChild(depSelect);
          advDetails.appendChild(depLabel);

          card.appendChild(advDetails);
          container.appendChild(card);
        });
      }

      function createPortRow(serviceId, port, index) {
        const row = document.createElement("div");
        row.className = "port-row";

        const hostInput = document.createElement("input");
        hostInput.type = "text";
        hostInput.value = port.host;
        hostInput.placeholder = "ä¸»æœºç«¯å£";
        hostInput.className = "small-input";
        hostInput.onchange = (e) => updateServicePort(serviceId, index, "host", e.target.value);

        const sep = document.createElement("span");
        sep.textContent = ":";

        const containerInput = document.createElement("input");
        containerInput.type = "text";
        containerInput.value = port.container;
        containerInput.placeholder = "å®¹å™¨ç«¯å£";
        containerInput.className = "small-input";
        containerInput.onchange = (e) =>
          updateServicePort(serviceId, index, "container", e.target.value);

        const delBtn = document.createElement("button");
        delBtn.className = "outline secondary";
        delBtn.textContent = "Ã—";
        delBtn.onclick = () => removeServicePort(serviceId, index);

        row.appendChild(hostInput);
        row.appendChild(sep);
        row.appendChild(containerInput);
        row.appendChild(delBtn);
        return row;
      }

      function createEnvRow(serviceId, env, index) {
        const row = document.createElement("div");
        row.className = "env-row";

        const keyInput = document.createElement("input");
        keyInput.type = "text";
        keyInput.value = env.key;
        keyInput.placeholder = "å˜é‡å";
        keyInput.onchange = (e) => updateServiceEnv(serviceId, index, "key", e.target.value);

        const sep = document.createElement("span");
        sep.textContent = "=";

        const valInput = document.createElement("input");
        valInput.type = "text";
        valInput.value = env.value;
        valInput.placeholder = "å€¼";
        valInput.onchange = (e) => updateServiceEnv(serviceId, index, "value", e.target.value);

        const delBtn = document.createElement("button");
        delBtn.className = "outline secondary";
        delBtn.textContent = "Ã—";
        delBtn.onclick = () => removeServiceEnv(serviceId, index);

        row.appendChild(keyInput);
        row.appendChild(sep);
        row.appendChild(valInput);
        row.appendChild(delBtn);
        return row;
      }

      function createVolumeRow(serviceId, vol, index) {
        const row = document.createElement("div");
        row.className = "volume-row";

        const hostInput = document.createElement("input");
        hostInput.type = "text";
        hostInput.value = vol.host;
        hostInput.placeholder = "ä¸»æœºè·¯å¾„";
        hostInput.onchange = (e) => updateServiceVol(serviceId, index, "host", e.target.value);

        const sep = document.createElement("span");
        sep.textContent = ":";

        const containerInput = document.createElement("input");
        containerInput.type = "text";
        containerInput.value = vol.container;
        containerInput.placeholder = "å®¹å™¨è·¯å¾„";
        containerInput.onchange = (e) =>
          updateServiceVol(serviceId, index, "container", e.target.value);

        const roLabel = document.createElement("label");
        roLabel.style.cssText = "margin:0;display:flex;align-items:center;gap:0.25rem;";
        const roCheck = document.createElement("input");
        roCheck.type = "checkbox";
        roCheck.checked = vol.readonly;
        roCheck.onchange = (e) => updateServiceVol(serviceId, index, "readonly", e.target.checked);
        roLabel.appendChild(roCheck);
        roLabel.appendChild(document.createTextNode("åªè¯»"));

        const delBtn = document.createElement("button");
        delBtn.className = "outline secondary";
        delBtn.textContent = "Ã—";
        delBtn.onclick = () => removeServiceVol(serviceId, index);

        row.appendChild(hostInput);
        row.appendChild(sep);
        row.appendChild(containerInput);
        row.appendChild(roLabel);
        row.appendChild(delBtn);
        return row;
      }

      function updateService(id, field, value) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service[field] = value;
          if (field === "name") renderServices();
          generateOutput();
        }
      }

      // ç«¯å£æ“ä½œ
      function addServicePort(id) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.ports.push({ host: "", container: "" });
          renderServices();
          generateOutput();
        }
      }

      function updateServicePort(id, index, field, value) {
        const service = services.find((s) => s.id === id);
        if (service && service.ports[index]) {
          service.ports[index][field] = value;
          generateOutput();
        }
      }

      function removeServicePort(id, index) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.ports.splice(index, 1);
          renderServices();
          generateOutput();
        }
      }

      // ç¯å¢ƒå˜é‡æ“ä½œ
      function addServiceEnv(id) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.environment.push({ key: "", value: "" });
          renderServices();
          generateOutput();
        }
      }

      function updateServiceEnv(id, index, field, value) {
        const service = services.find((s) => s.id === id);
        if (service && service.environment[index]) {
          service.environment[index][field] = value;
          generateOutput();
        }
      }

      function removeServiceEnv(id, index) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.environment.splice(index, 1);
          renderServices();
          generateOutput();
        }
      }

      // æ•°æ®å·æ“ä½œ
      function addServiceVol(id) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.volumes.push({ host: "", container: "", readonly: false });
          renderServices();
          generateOutput();
        }
      }

      function updateServiceVol(id, index, field, value) {
        const service = services.find((s) => s.id === id);
        if (service && service.volumes[index]) {
          service.volumes[index][field] = value;
          generateOutput();
        }
      }

      function removeServiceVol(id, index) {
        const service = services.find((s) => s.id === id);
        if (service) {
          service.volumes.splice(index, 1);
          renderServices();
          generateOutput();
        }
      }

      // ç½‘ç»œé…ç½®
      window.addNetwork = function () {
        const id = networkId++;
        networks.push({
          id,
          name: "network_" + id,
          driver: "bridge"
        });
        renderNetworks();
        generateOutput();
      };

      function removeNetwork(id) {
        networks = networks.filter((n) => n.id !== id);
        renderNetworks();
        generateOutput();
      }

      function renderNetworks() {
        const container = document.getElementById("networksContainer");
        container.replaceChildren();

        networks.forEach((network) => {
          const card = document.createElement("div");
          card.className = "service-card";

          const grid = document.createElement("div");
          grid.className = "grid";

          const nameLabel = document.createElement("label");
          nameLabel.textContent = "ç½‘ç»œåç§°";
          const nameInput = document.createElement("input");
          nameInput.type = "text";
          nameInput.value = network.name;
          nameInput.onchange = (e) => updateNetwork(network.id, "name", e.target.value);
          nameLabel.appendChild(nameInput);

          const driverLabel = document.createElement("label");
          driverLabel.textContent = "é©±åŠ¨";
          const driverSelect = document.createElement("select");
          ["bridge", "host", "overlay", "none"].forEach((d) => {
            const opt = document.createElement("option");
            opt.value = d;
            opt.textContent = d;
            opt.selected = network.driver === d;
            driverSelect.appendChild(opt);
          });
          driverSelect.onchange = (e) => updateNetwork(network.id, "driver", e.target.value);
          driverLabel.appendChild(driverSelect);

          grid.appendChild(nameLabel);
          grid.appendChild(driverLabel);
          card.appendChild(grid);

          const delBtn = document.createElement("button");
          delBtn.className = "outline secondary";
          delBtn.textContent = "åˆ é™¤ç½‘ç»œ";
          delBtn.onclick = () => removeNetwork(network.id);
          card.appendChild(delBtn);

          container.appendChild(card);
        });
      }

      function updateNetwork(id, field, value) {
        const network = networks.find((n) => n.id === id);
        if (network) {
          network[field] = value;
          generateOutput();
        }
      }

      // æ•°æ®å·é…ç½®
      window.addVolume = function () {
        const id = volumeId++;
        volumes.push({
          id,
          name: "volume_" + id,
          driver: "local"
        });
        renderVolumes();
        generateOutput();
      };

      function removeVolume(id) {
        volumes = volumes.filter((v) => v.id !== id);
        renderVolumes();
        generateOutput();
      }

      function renderVolumes() {
        const container = document.getElementById("volumesContainer");
        container.replaceChildren();

        volumes.forEach((volume) => {
          const card = document.createElement("div");
          card.className = "service-card";

          const grid = document.createElement("div");
          grid.className = "grid";

          const nameLabel = document.createElement("label");
          nameLabel.textContent = "æ•°æ®å·åç§°";
          const nameInput = document.createElement("input");
          nameInput.type = "text";
          nameInput.value = volume.name;
          nameInput.onchange = (e) => updateVolume(volume.id, "name", e.target.value);
          nameLabel.appendChild(nameInput);

          const driverLabel = document.createElement("label");
          driverLabel.textContent = "é©±åŠ¨";
          const driverSelect = document.createElement("select");
          const opt = document.createElement("option");
          opt.value = "local";
          opt.textContent = "local";
          opt.selected = volume.driver === "local";
          driverSelect.appendChild(opt);
          driverSelect.onchange = (e) => updateVolume(volume.id, "driver", e.target.value);
          driverLabel.appendChild(driverSelect);

          grid.appendChild(nameLabel);
          grid.appendChild(driverLabel);
          card.appendChild(grid);

          const delBtn = document.createElement("button");
          delBtn.className = "outline secondary";
          delBtn.textContent = "åˆ é™¤æ•°æ®å·";
          delBtn.onclick = () => removeVolume(volume.id);
          card.appendChild(delBtn);

          container.appendChild(card);
        });
      }

      function updateVolume(id, field, value) {
        const volume = volumes.find((v) => v.id === id);
        if (volume) {
          volume[field] = value;
          generateOutput();
        }
      }

      // ç”Ÿæˆè¾“å‡º
      function generateOutput() {
        const version = document.getElementById("composeVersion").value;
        let yaml = 'version: "' + version + '"\n\n';

        if (services.length > 0) {
          yaml += "services:\n";
          services.forEach((service) => {
            yaml += "  " + service.name + ":\n";
            if (service.image) yaml += "    image: " + service.image + "\n";
            if (service.command) yaml += "    command: " + service.command + "\n";
            if (service.workingDir) yaml += "    working_dir: " + service.workingDir + "\n";
            if (service.restart) yaml += "    restart: " + service.restart + "\n";

            if (service.ports.length > 0) {
              const validPorts = service.ports.filter((p) => p.host && p.container);
              if (validPorts.length > 0) {
                yaml += "    ports:\n";
                validPorts.forEach((p) => {
                  yaml += '      - "' + p.host + ":" + p.container + '"\n';
                });
              }
            }

            if (service.environment.length > 0) {
              const validEnv = service.environment.filter((e) => e.key);
              if (validEnv.length > 0) {
                yaml += "    environment:\n";
                validEnv.forEach((e) => {
                  yaml += "      " + e.key + ": " + e.value + "\n";
                });
              }
            }

            if (service.volumes.length > 0) {
              const validVols = service.volumes.filter((v) => v.host && v.container);
              if (validVols.length > 0) {
                yaml += "    volumes:\n";
                validVols.forEach((v) => {
                  const ro = v.readonly ? ":ro" : "";
                  yaml += "      - " + v.host + ":" + v.container + ro + "\n";
                });
              }
            }

            if (service.dependsOn.length > 0) {
              yaml += "    depends_on:\n";
              service.dependsOn.forEach((d) => {
                yaml += "      - " + d + "\n";
              });
            }

            yaml += "\n";
          });
        }

        if (networks.length > 0) {
          yaml += "networks:\n";
          networks.forEach((network) => {
            yaml += "  " + network.name + ":\n";
            yaml += "    driver: " + network.driver + "\n";
          });
          yaml += "\n";
        }

        if (volumes.length > 0) {
          yaml += "volumes:\n";
          volumes.forEach((volume) => {
            yaml += "  " + volume.name + ":\n";
            yaml += "    driver: " + volume.driver + "\n";
          });
        }

        document.getElementById("output").textContent = yaml;
      }

      window.copyOutput = function () {
        const output = document.getElementById("output").textContent;
        navigator.clipboard.writeText(output).then(() => {
          alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
        });
      };

      window.downloadFile = function () {
        const output = document.getElementById("output").textContent;
        const blob = new Blob([output], { type: "text/yaml" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "docker-compose.yml";
        a.click();
        URL.revokeObjectURL(url);
      };

      // ç›‘å¬ç‰ˆæœ¬å˜åŒ–
      document.getElementById("composeVersion").addEventListener("change", generateOutput);

      // åˆå§‹åŒ–
      generateOutput();
    </script>
  </body>
</html>

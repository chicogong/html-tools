<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËΩ¨ÁõòÊäΩÂ•ñ - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a24;
            --text-primary: #fff;
            --text-secondary: #a0a0a0;
            --accent: #ff6b6b;
            --accent-hover: #ff8585;
            --border: #2a2a3a;
            --success: #4ade80;
            --warning: #fbbf24;
        }
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #fff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #ef4444;
            --accent-hover: #dc2626;
            --border: #e2e8f0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 24px; margin-bottom: 5px; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .header p { font-size: 14px; opacity: 0.95; color: #fff; }
        .back-link {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        .back-link:hover { opacity: 1; }
        .theme-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            backdrop-filter: blur(10px);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
        }
        .wheel-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px 0;
        }
        @media (max-width: 500px) {
            .wheel-container { width: 300px; height: 300px; }
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            box-shadow: 0 0 30px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,0,0,0.2);
        }
        .wheel.spinning {
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 10;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
            line-height: 1.2;
        }
        .wheel-center:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        .wheel-center:active {
            transform: translate(-50%, -50%) scale(0.95);
        }
        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid var(--accent);
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
            z-index: 20;
        }
        .control-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        .panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .options-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }
        .option-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            flex-shrink: 0;
        }
        .option-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
        }
        .option-delete {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }
        .option-delete:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        .add-option-btn {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 2px dashed var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin-bottom: 20px;
        }
        .add-option-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .settings-section {
            border-top: 1px solid var(--border);
            padding-top: 15px;
            margin-top: 15px;
        }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .setting-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--bg-tertiary);
            border-radius: 24px;
            transition: 0.3s;
            border: 1px solid var(--border);
        }
        .toggle-slider::before {
            content: "";
            position: absolute;
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: 0.3s;
        }
        .toggle-switch input:checked + .toggle-slider {
            background: var(--accent);
            border-color: var(--accent);
        }
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: #fff;
        }
        .result-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .result-modal.show {
            display: flex;
            animation: fade-in 0.3s ease;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .result-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: scale-in 0.3s ease;
            border: 1px solid var(--border);
        }
        @keyframes scale-in {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .result-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .result-title {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .result-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            overflow-wrap: break-word;
        }
        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--accent);
            color: #fff;
        }
        .btn-primary:hover {
            background: var(--accent-hover);
        }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover {
            background: var(--border);
        }
        .history-section {
            margin-top: 20px;
            border-top: 1px solid var(--border);
            padding-top: 15px;
        }
        .history-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-clear {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
        }
        .history-clear:hover {
            color: var(--accent);
        }
        .history-list {
            max-height: 150px;
            overflow-y: auto;
        }
        .history-item {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item .time {
            color: var(--text-secondary);
            font-size: 11px;
        }
        .stats-bar {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .stat-item {
            flex: 1;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ÂΩ©Â∏¶Âä®Áîª */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="../../index.html" class="back-link">‚Üê ËøîÂõû</a>
        <h1>üé° ËΩ¨ÁõòÊäΩÂ•ñ</h1>
        <p>ÂÖ¨Âπ≥ÈöèÊú∫ÊäΩÂ•ñ ¬∑ ÊîØÊåÅËá™ÂÆö‰πâÈÄâÈ°π</p>
        <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    </div>

    <div class="container">
        <div class="wheel-section">
            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheelCanvas" class="wheel"></canvas>
                <div class="wheel-center" onclick="spin()">ÁÇπÂáª<br>ÊäΩÂ•ñ</div>
            </div>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalSpins">0</div>
                    <div class="stat-label">ÊÄªÊäΩÂ•ñÊ¨°Êï∞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="optionCount">6</div>
                    <div class="stat-label">ÂΩìÂâçÈÄâÈ°πÊï∞</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-title">‚öôÔ∏è ÈÄâÈ°πËÆæÁΩÆ</div>
            <div class="options-list" id="optionsList"></div>
            <button class="add-option-btn" onclick="addOption()">+ Ê∑ªÂä†ÈÄâÈ°π</button>

            <div class="settings-section">
                <div class="setting-row">
                    <span class="setting-label">ÊäΩ‰∏≠ÂêéÁßªÈô§</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="removeWinner">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Èü≥Êïà</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span class="setting-label">ÂΩ©Â∏¶ÊïàÊûú</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="confettiEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="history-section">
                <div class="history-title">
                    <span>üìú ÊäΩÂ•ñÂéÜÂè≤</span>
                    <button class="history-clear" onclick="clearHistory()">Ê∏ÖÁ©∫</button>
                </div>
                <div class="history-list" id="historyList">
                    <div style="text-align:center;color:var(--text-secondary);padding:20px;font-size:13px;">
                        ÊöÇÊó†ÊäΩÂ•ñËÆ∞ÂΩï
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="result-modal" id="resultModal" onclick="closeModal(event)">
        <div class="result-content" onclick="event.stopPropagation()">
            <div class="result-icon">üéâ</div>
            <div class="result-title">ÊÅ≠ÂñúËé∑Âæó</div>
            <div class="result-value" id="resultValue"></div>
            <div class="result-actions">
                <button class="btn btn-secondary" onclick="closeModal()">ÂÖ≥Èó≠</button>
                <button class="btn btn-primary" onclick="closeModal(); spin();">ÂÜçÊù•‰∏ÄÊ¨°</button>
            </div>
        </div>
    </div>

    <script>
        // ÈªòËÆ§ÈÄâÈ°π
        const defaultOptions = [
            { text: '‰∏ÄÁ≠âÂ•ñ', color: '#ff6b6b' },
            { text: '‰∫åÁ≠âÂ•ñ', color: '#feca57' },
            { text: '‰∏âÁ≠âÂ•ñ', color: '#48dbfb' },
            { text: 'ÂèÇ‰∏éÂ•ñ', color: '#1dd1a1' },
            { text: 'ÂÜçÊù•‰∏ÄÊ¨°', color: '#5f27cd' },
            { text: 'Ë∞¢Ë∞¢ÂèÇ‰∏é', color: '#ff9ff3' }
        ];

        // È¢ÑËÆæÈ¢úËâ≤
        const presetColors = [
            '#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1', '#5f27cd', '#ff9ff3',
            '#00d2d3', '#54a0ff', '#5f27cd', '#ee5a24', '#009432', '#0652DD'
        ];

        let options = JSON.parse(localStorage.getItem('wheelOptions')) || [...defaultOptions];
        let isSpinning = false;
        let currentRotation = 0;
        let totalSpins = parseInt(localStorage.getItem('wheelTotalSpins') || '0');
        let history = JSON.parse(localStorage.getItem('wheelHistory') || '[]');

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');

        // HTML ËΩ¨‰πâÂáΩÊï∞ (Èò≤Ê≠¢ XSS)
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Èü≥È¢ë‰∏ä‰∏ãÊñá
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playTickSound() {
            if (!document.getElementById('soundEnabled').checked) return;
            initAudio();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
        }

        function playWinSound() {
            if (!document.getElementById('soundEnabled').checked) return;
            initAudio();
            
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                }, i * 100);
            });
        }

        // ‰ΩøÁî®Âä†ÂØÜÂÆâÂÖ®ÁöÑÈöèÊú∫Êï∞
        function secureRandom() {
            const array = new Uint32Array(1);
            crypto.getRandomValues(array);
            return array[0] / (0xFFFFFFFF + 1);
        }

        function drawWheel() {
            const size = Math.min(canvas.parentElement.clientWidth, 400);
            canvas.width = size;
            canvas.height = size;
            
            const centerX = size / 2;
            const centerY = size / 2;
            const radius = size / 2 - 5;
            
            if (options.length === 0) {
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.fill();
                return;
            }
            
            const arc = (Math.PI * 2) / options.length;
            
            options.forEach((option, i) => {
                const angle = i * arc;
                
                // ÁªòÂà∂ÊâáÂΩ¢
                ctx.beginPath();
                ctx.fillStyle = option.color;
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + arc);
                ctx.closePath();
                ctx.fill();
                
                // ÁªòÂà∂ËæπÊ°Ü
                ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ÁªòÂà∂ÊñáÂ≠ó
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#fff';
                ctx.font = `bold ${Math.max(12, size / 25)}px sans-serif`;
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 3;
                
                const text = option.text.length > 8 ? option.text.slice(0, 7) + '‚Ä¶' : option.text;
                ctx.fillText(text, radius - 20, 5);
                ctx.restore();
            });
            
            // Â§ñÂúàË£ÖÈ•∞
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 10;
            ctx.stroke();
        }

        function spin() {
            if (isSpinning || options.length < 2) return;
            
            isSpinning = true;
            initAudio();
            
            // ‰ΩøÁî®Âä†ÂØÜÈöèÊú∫Êï∞
            const randomValue = secureRandom();
            const winnerIndex = Math.floor(randomValue * options.length);
            
            // ËÆ°ÁÆóÊóãËΩ¨ËßíÂ∫¶
            const arc = 360 / options.length;
            const targetAngle = 360 - (winnerIndex * arc + arc / 2);
            const spins = 5 + Math.floor(secureRandom() * 3); // 5-7Âúà
            const totalRotation = spins * 360 + targetAngle;
            
            currentRotation += totalRotation;
            canvas.style.transform = `rotate(${currentRotation}deg)`;
            canvas.classList.add('spinning');
            
            // Êí≠ÊîæÊª¥Á≠îÂ£∞
            let tickCount = 0;
            const tickInterval = setInterval(() => {
                playTickSound();
                tickCount++;
                if (tickCount > 30) clearInterval(tickInterval);
            }, 100);
            
            setTimeout(() => {
                clearInterval(tickInterval);
                canvas.classList.remove('spinning');
                isSpinning = false;
                
                // ÊòæÁ§∫ÁªìÊûú
                const winner = options[winnerIndex];
                showResult(winner);
                
                // Êõ¥Êñ∞ÁªüËÆ°
                totalSpins++;
                localStorage.setItem('wheelTotalSpins', totalSpins);
                document.getElementById('totalSpins').textContent = totalSpins;
                
                // Ê∑ªÂä†ÂéÜÂè≤ËÆ∞ÂΩï
                addHistory(winner.text);
                
                // Â¶ÇÊûúÂºÄÂêØ‰∫ÜÁßªÈô§Ëé∑ËÉúËÄÖ
                if (document.getElementById('removeWinner').checked) {
                    options.splice(winnerIndex, 1);
                    saveOptions();
                    renderOptions();
                    drawWheel();
                }
            }, 5000);
        }

        function showResult(winner) {
            document.getElementById('resultValue').textContent = winner.text;
            document.getElementById('resultValue').style.color = winner.color;
            document.getElementById('resultModal').classList.add('show');
            
            playWinSound();
            
            if (document.getElementById('confettiEnabled').checked) {
                createConfetti();
            }
        }

        function closeModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('resultModal').classList.remove('show');
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1', '#5f27cd', '#ff9ff3'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                        { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: 2000 + Math.random() * 1000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    animation.onfinish = () => confetti.remove();
                }, i * 30);
            }
        }

        function renderOptions() {
            const list = document.getElementById('optionsList');
            list.innerHTML = options.map((opt, i) => `
                <div class="option-item">
                    <input type="color" class="option-color" value="${escapeHtml(opt.color)}" 
                           onchange="updateOptionColor(${i}, this.value)">
                    <input type="text" class="option-input" value="${escapeHtml(opt.text)}" 
                           onchange="updateOptionText(${i}, this.value)" 
                           placeholder="ËæìÂÖ•ÈÄâÈ°πÂÜÖÂÆπ">
                    <button class="option-delete" onclick="deleteOption(${i})">‚úï</button>
                </div>
            `).join('');
            
            document.getElementById('optionCount').textContent = options.length;
        }

        function addOption() {
            const colorIndex = options.length % presetColors.length;
            options.push({
                text: `ÈÄâÈ°π ${options.length + 1}`,
                color: presetColors[colorIndex]
            });
            saveOptions();
            renderOptions();
            drawWheel();
        }

        function deleteOption(index) {
            if (options.length <= 2) {
                alert('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô2‰∏™ÈÄâÈ°π');
                return;
            }
            options.splice(index, 1);
            saveOptions();
            renderOptions();
            drawWheel();
        }

        function updateOptionText(index, text) {
            options[index].text = text || `ÈÄâÈ°π ${index + 1}`;
            saveOptions();
            drawWheel();
        }

        function updateOptionColor(index, color) {
            options[index].color = color;
            saveOptions();
            drawWheel();
        }

        function saveOptions() {
            localStorage.setItem('wheelOptions', JSON.stringify(options));
        }

        function addHistory(result) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            history.unshift({ result, time: timeStr });
            if (history.length > 20) history.pop();
            localStorage.setItem('wheelHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:var(--text-secondary);padding:20px;font-size:13px;">ÊöÇÊó†ÊäΩÂ•ñËÆ∞ÂΩï</div>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <span>${escapeHtml(h.result)}</span>
                    <span class="time">${escapeHtml(h.time)}</span>
                </div>
            `).join('');
        }

        function clearHistory() {
            history = [];
            localStorage.setItem('wheelHistory', '[]');
            renderHistory();
        }

        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }

        // ÂàùÂßãÂåñ
        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
        document.getElementById('totalSpins').textContent = totalSpins;
        renderOptions();
        renderHistory();
        drawWheel();

        // ÂìçÂ∫îÂºèÈáçÁªò
        window.addEventListener('resize', drawWheel);
    </script>
</body>
</html>

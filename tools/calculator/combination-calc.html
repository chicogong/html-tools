<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’åˆ—ç»„åˆè®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { min-height: 100vh; padding: 2rem 1rem; }
        .container { max-width: 800px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .calc-box { background: var(--pico-muted-border-color); border-radius: var(--pico-border-radius); padding: 1.5rem; margin-bottom: 1.5rem; }
        .result-highlight { font-size: 2rem; font-weight: bold; color: var(--pico-primary); text-align: center; margin: 1rem 0; word-break: break-all; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .result-card { background: var(--pico-background-color); border-radius: var(--pico-border-radius); padding: 1rem; text-align: center; }
        .result-card h5 { margin: 0 0 0.5rem 0; font-size: 0.85rem; color: var(--pico-muted-color); }
        .result-card .value { font-size: 1.1rem; font-weight: bold; font-family: monospace; word-break: break-all; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .formula { background: var(--pico-background-color); padding: 1rem; border-radius: var(--pico-border-radius); margin-top: 1rem; font-family: monospace; text-align: center; }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 2rem; }
        .tabs button { flex: 1; }
        .tabs button.active { background: var(--pico-primary); color: var(--pico-primary-inverse); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <main class="container">
        <header>
            <h1>æ’åˆ—ç»„åˆè®¡ç®—å™¨</h1>
            <button id="themeToggle" class="outline" onclick="toggleTheme()">ğŸŒ™</button>
        </header>

        <div class="tabs">
            <button class="active" onclick="showTab('permutation')">æ’åˆ— (P)</button>
            <button onclick="showTab('combination')">ç»„åˆ (C)</button>
            <button onclick="showTab('factorial')">é˜¶ä¹˜ (n!)</button>
            <button onclick="showTab('multiset')">å¤šé‡æ’åˆ—</button>
        </div>

        <div id="permutation" class="tab-content active">
            <div class="calc-box">
                <h3>æ’åˆ— (Permutation)</h3>
                <p style="color: var(--pico-muted-color);">ä»nä¸ªä¸åŒå…ƒç´ ä¸­å–å‡ºrä¸ªå…ƒç´ çš„æ’åˆ—æ•°ï¼ˆé¡ºåºæœ‰å…³ï¼‰</p>
                <div class="input-row">
                    <div>
                        <label>æ€»å…ƒç´ æ•° (n)</label>
                        <input type="number" id="permN" value="10" min="0" max="170">
                    </div>
                    <div>
                        <label>é€‰å–æ•° (r)</label>
                        <input type="number" id="permR" value="3" min="0">
                    </div>
                </div>
                <button onclick="calcPermutation()" style="margin-top: 1rem;">è®¡ç®—æ’åˆ—</button>

                <div class="result-highlight" id="permResult">P(10,3) = 720</div>

                <div class="result-grid">
                    <div class="result-card"><h5>æ’åˆ—æ•° P(n,r)</h5><div class="value" id="permValue">720</div></div>
                    <div class="result-card"><h5>ç§‘å­¦è®¡æ•°æ³•</h5><div class="value" id="permScientific">7.2Ã—10Â²</div></div>
                    <div class="result-card"><h5>n!</h5><div class="value" id="permNFact">3628800</div></div>
                    <div class="result-card"><h5>(n-r)!</h5><div class="value" id="permNRFact">5040</div></div>
                </div>

                <div class="formula">P(n,r) = n! / (n-r)! = n Ã— (n-1) Ã— ... Ã— (n-r+1)</div>
            </div>
        </div>

        <div id="combination" class="tab-content">
            <div class="calc-box">
                <h3>ç»„åˆ (Combination)</h3>
                <p style="color: var(--pico-muted-color);">ä»nä¸ªä¸åŒå…ƒç´ ä¸­å–å‡ºrä¸ªå…ƒç´ çš„ç»„åˆæ•°ï¼ˆé¡ºåºæ— å…³ï¼‰</p>
                <div class="input-row">
                    <div>
                        <label>æ€»å…ƒç´ æ•° (n)</label>
                        <input type="number" id="combN" value="10" min="0" max="170">
                    </div>
                    <div>
                        <label>é€‰å–æ•° (r)</label>
                        <input type="number" id="combR" value="3" min="0">
                    </div>
                </div>
                <button onclick="calcCombination()" style="margin-top: 1rem;">è®¡ç®—ç»„åˆ</button>

                <div class="result-highlight" id="combResult">C(10,3) = 120</div>

                <div class="result-grid">
                    <div class="result-card"><h5>ç»„åˆæ•° C(n,r)</h5><div class="value" id="combValue">120</div></div>
                    <div class="result-card"><h5>ç§‘å­¦è®¡æ•°æ³•</h5><div class="value" id="combScientific">1.2Ã—10Â²</div></div>
                    <div class="result-card"><h5>å¯¹åº”æ’åˆ—æ•°</h5><div class="value" id="combPerm">720</div></div>
                    <div class="result-card"><h5>C(n,n-r)</h5><div class="value" id="combSymmetric">120</div></div>
                </div>

                <div class="formula">C(n,r) = n! / (r! Ã— (n-r)!) = P(n,r) / r!</div>

                <h4 style="margin-top: 1.5rem;">æ¨è¾‰ä¸‰è§’ (å‰10è¡Œ)</h4>
                <div id="pascalTriangle" style="font-family: monospace; text-align: center; line-height: 1.8;"></div>
            </div>
        </div>

        <div id="factorial" class="tab-content">
            <div class="calc-box">
                <h3>é˜¶ä¹˜ (Factorial)</h3>
                <div class="input-row">
                    <div>
                        <label>æ•°å€¼ (n)</label>
                        <input type="number" id="factN" value="10" min="0" max="170">
                    </div>
                </div>
                <button onclick="calcFactorial()" style="margin-top: 1rem;">è®¡ç®—é˜¶ä¹˜</button>

                <div class="result-highlight" id="factResult">10! = 3,628,800</div>

                <div class="result-grid">
                    <div class="result-card"><h5>é˜¶ä¹˜å€¼</h5><div class="value" id="factValue">3628800</div></div>
                    <div class="result-card"><h5>ç§‘å­¦è®¡æ•°æ³•</h5><div class="value" id="factScientific">3.6288Ã—10â¶</div></div>
                    <div class="result-card"><h5>ä½æ•°</h5><div class="value" id="factDigits">7</div></div>
                    <div class="result-card"><h5>ln(n!)</h5><div class="value" id="factLn">15.1</div></div>
                </div>

                <div class="formula">n! = n Ã— (n-1) Ã— (n-2) Ã— ... Ã— 2 Ã— 1</div>

                <h4 style="margin-top: 1.5rem;">å¸¸ç”¨é˜¶ä¹˜å€¼</h4>
                <table>
                    <thead><tr><th>n</th><th>n!</th><th>n</th><th>n!</th></tr></thead>
                    <tbody>
                        <tr><td>0</td><td>1</td><td>6</td><td>720</td></tr>
                        <tr><td>1</td><td>1</td><td>7</td><td>5,040</td></tr>
                        <tr><td>2</td><td>2</td><td>8</td><td>40,320</td></tr>
                        <tr><td>3</td><td>6</td><td>9</td><td>362,880</td></tr>
                        <tr><td>4</td><td>24</td><td>10</td><td>3,628,800</td></tr>
                        <tr><td>5</td><td>120</td><td>20</td><td>â‰ˆ2.43Ã—10Â¹â¸</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="multiset" class="tab-content">
            <div class="calc-box">
                <h3>å¤šé‡æ’åˆ—</h3>
                <p style="color: var(--pico-muted-color);">nä¸ªå…ƒç´ ä¸­æœ‰é‡å¤å…ƒç´ æ—¶çš„æ’åˆ—æ•°</p>
                <label>æ€»å…ƒç´ æ•° (n)</label>
                <input type="number" id="multiN" value="10" min="0" max="170">
                
                <label>å„ç±»å…ƒç´ æ•°é‡ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                <input type="text" id="multiGroups" value="3,3,4" placeholder="å¦‚: 3,3,4 è¡¨ç¤º3ä¸ªA,3ä¸ªB,4ä¸ªC">
                
                <button onclick="calcMultiset()" style="margin-top: 1rem;">è®¡ç®—</button>

                <div class="result-highlight" id="multiResult">4200</div>

                <div class="result-grid">
                    <div class="result-card"><h5>å¤šé‡æ’åˆ—æ•°</h5><div class="value" id="multiValue">4200</div></div>
                    <div class="result-card"><h5>ç§‘å­¦è®¡æ•°æ³•</h5><div class="value" id="multiScientific">4.2Ã—10Â³</div></div>
                </div>

                <div class="formula">n! / (nâ‚! Ã— nâ‚‚! Ã— ... Ã— nâ‚–!)</div>
            </div>

            <div class="calc-box">
                <h3>é‡å¤ç»„åˆ</h3>
                <p style="color: var(--pico-muted-color);">ä»nç§å…ƒç´ ä¸­å¯é‡å¤å–rä¸ªçš„ç»„åˆæ•°</p>
                <div class="input-row">
                    <div>
                        <label>å…ƒç´ ç§ç±» (n)</label>
                        <input type="number" id="repCombN" value="5" min="1">
                    </div>
                    <div>
                        <label>é€‰å–æ•° (r)</label>
                        <input type="number" id="repCombR" value="3" min="0">
                    </div>
                </div>
                <button onclick="calcRepComb()" style="margin-top: 1rem;">è®¡ç®—é‡å¤ç»„åˆ</button>

                <div class="result-highlight" id="repCombResult">H(5,3) = 35</div>

                <div class="formula">H(n,r) = C(n+r-1,r) = (n+r-1)! / (r! Ã— (n-1)!)</div>
            </div>
        </div>

        <article style="margin-top: 2rem;">
            <h4>æ’åˆ—ç»„åˆå¯¹æ¯”</h4>
            <table>
                <thead><tr><th>ç±»å‹</th><th>å…¬å¼</th><th>é¡ºåº</th><th>é‡å¤</th></tr></thead>
                <tbody>
                    <tr><td>æ’åˆ— P(n,r)</td><td>n!/(n-r)!</td><td>æœ‰å…³</td><td>ä¸å¯</td></tr>
                    <tr><td>ç»„åˆ C(n,r)</td><td>n!/[r!(n-r)!]</td><td>æ— å…³</td><td>ä¸å¯</td></tr>
                    <tr><td>é‡å¤æ’åˆ—</td><td>n^r</td><td>æœ‰å…³</td><td>å¯ä»¥</td></tr>
                    <tr><td>é‡å¤ç»„åˆ H(n,r)</td><td>C(n+r-1,r)</td><td>æ— å…³</td><td>å¯ä»¥</td></tr>
                </tbody>
            </table>
        </article>
    </main>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function factorial(n) {
            if (n > 170) return Infinity;
            if (n <= 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) result *= i;
            return result;
        }

        function permutation(n, r) {
            if (r > n) return 0;
            let result = 1;
            for (let i = n; i > n - r; i--) result *= i;
            return result;
        }

        function combination(n, r) {
            if (r > n) return 0;
            if (r > n - r) r = n - r;
            let result = 1;
            for (let i = 0; i < r; i++) {
                result *= (n - i);
                result /= (i + 1);
            }
            return Math.round(result);
        }

        function toScientific(num) {
            if (!Number.isFinite(num)) return 'æ— ç©·å¤§';
            if (num === 0) return '0';
            const exp = Math.floor(Math.log10(Math.abs(num)));
            const mantissa = num / Math.pow(10, exp);
            if (exp === 0) return mantissa.toFixed(4);
            return mantissa.toFixed(4) + 'Ã—10' + (exp < 0 ? 'â»' : '') + Math.abs(exp).toString().split('').map(d => 'â°Â¹Â²Â³â´âµâ¶â·â¸â¹'[d]).join('');
        }

        function formatNumber(num) {
            if (!Number.isFinite(num)) return 'æ— ç©·å¤§';
            if (num > 1e15) return toScientific(num);
            return num.toLocaleString();
        }

        function calcPermutation() {
            const n = parseInt(document.getElementById('permN').value) || 0;
            const r = parseInt(document.getElementById('permR').value) || 0;

            const p = permutation(n, r);
            const nFact = factorial(n);
            const nrFact = factorial(n - r);

            document.getElementById('permResult').textContent = 'P(' + n + ',' + r + ') = ' + formatNumber(p);
            document.getElementById('permValue').textContent = formatNumber(p);
            document.getElementById('permScientific').textContent = toScientific(p);
            document.getElementById('permNFact').textContent = formatNumber(nFact);
            document.getElementById('permNRFact').textContent = formatNumber(nrFact);
        }

        function calcCombination() {
            const n = parseInt(document.getElementById('combN').value) || 0;
            const r = parseInt(document.getElementById('combR').value) || 0;

            const c = combination(n, r);
            const p = permutation(n, r);

            document.getElementById('combResult').textContent = 'C(' + n + ',' + r + ') = ' + formatNumber(c);
            document.getElementById('combValue').textContent = formatNumber(c);
            document.getElementById('combScientific').textContent = toScientific(c);
            document.getElementById('combPerm').textContent = formatNumber(p);
            document.getElementById('combSymmetric').textContent = formatNumber(combination(n, n - r));

            renderPascal();
        }

        function calcFactorial() {
            const n = parseInt(document.getElementById('factN').value) || 0;
            const f = factorial(n);
            const digits = Number.isFinite(f) ? Math.floor(Math.log10(f)) + 1 : 'å¾ˆå¤š';

            document.getElementById('factResult').textContent = n + '! = ' + formatNumber(f);
            document.getElementById('factValue').textContent = formatNumber(f);
            document.getElementById('factScientific').textContent = toScientific(f);
            document.getElementById('factDigits').textContent = digits;
            document.getElementById('factLn').textContent = Number.isFinite(f) ? Math.log(f).toFixed(4) : 'âˆ';
        }

        function calcMultiset() {
            const n = parseInt(document.getElementById('multiN').value) || 0;
            const groups = document.getElementById('multiGroups').value.split(',').map(s => parseInt(s.trim()) || 0);
            
            const sum = groups.reduce((a, b) => a + b, 0);
            if (sum !== n) {
                alert('å„ç»„æ•°é‡ä¹‹å’Œ(' + sum + ')å¿…é¡»ç­‰äºæ€»æ•°(' + n + ')');
                return;
            }

            let result = factorial(n);
            groups.forEach(g => result /= factorial(g));

            document.getElementById('multiResult').textContent = formatNumber(result);
            document.getElementById('multiValue').textContent = formatNumber(result);
            document.getElementById('multiScientific').textContent = toScientific(result);
        }

        function calcRepComb() {
            const n = parseInt(document.getElementById('repCombN').value) || 1;
            const r = parseInt(document.getElementById('repCombR').value) || 0;
            const h = combination(n + r - 1, r);

            document.getElementById('repCombResult').textContent = 'H(' + n + ',' + r + ') = ' + formatNumber(h);
        }

        function renderPascal() {
            const container = document.getElementById('pascalTriangle');
            container.textContent = '';
            const rows = 10;
            for (let i = 0; i < rows; i++) {
                let row = '';
                for (let j = 0; j <= i; j++) {
                    row += combination(i, j) + ' ';
                }
                container.appendChild(document.createTextNode(row));
                container.appendChild(document.createElement('br'));
            }
        }

        loadTheme();
        calcPermutation();
        calcCombination();
        calcFactorial();
    </script>
</body>
</html>

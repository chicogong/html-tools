<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gravatar 头像查询 - WebUtils</title>
  <meta name="description" content="通过邮箱查询 Gravatar 全球通用头像" />
  <meta name="keywords" content="Gravatar,头像,邮箱,avatar,查询" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-elevated: #1a1a24;
      --border-subtle: #2a2a3a;
      --text-primary: #e8e8ed;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
      --accent-cyan: #00f5d4;
      --accent-purple: #bf5af2;
      --accent-green: #30d158;
      --accent-orange: #ff9f0a;
      --accent-red: #ff453a;
      --accent-blue: #1e88e5;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Space Grotesk', -apple-system, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 20px;
      transition: color 0.2s;
    }

    .back-link:hover { color: var(--accent-cyan); }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-secondary);
      margin-bottom: 24px;
      font-size: 15px;
    }

    .search-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
    }

    .search-form {
      display: flex;
      gap: 12px;
    }

    .search-input {
      flex: 1;
      padding: 14px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 15px;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent-blue);
      color: #fff;
    }

    .btn-primary:hover {
      background: #1976d2;
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(30, 136, 229, 0.3);
    }

    .result-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 32px;
      text-align: center;
      display: none;
    }

    .result-card.show {
      display: block;
    }

    .avatar-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 24px;
    }

    .avatar {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 4px solid var(--border-subtle);
      object-fit: cover;
      background: var(--bg-elevated);
    }

    .avatar-badge {
      position: absolute;
      bottom: 8px;
      right: 8px;
      padding: 6px 12px;
      background: var(--accent-green);
      color: #fff;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .avatar-badge.not-found {
      background: var(--accent-orange);
    }

    .email-display {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .hash-display {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--text-muted);
      word-break: break-all;
      margin-bottom: 24px;
    }

    .size-options {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .size-btn {
      padding: 10px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-family: inherit;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .size-btn:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .size-btn.active {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
      color: #000;
    }

    .download-section {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn-download {
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
    }

    .btn-download:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .info-section {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-top: 24px;
    }

    .info-section h3 {
      font-size: 16px;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .info-section p {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .info-section a {
      color: var(--accent-cyan);
      text-decoration: none;
    }

    .info-section a:hover {
      text-decoration: underline;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-subtle);
      border-top-color: var(--accent-cyan);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 500px) {
      .search-form {
        flex-direction: column;
      }

      .avatar-container {
        width: 150px;
        height: 150px;
      }

      .avatar {
        width: 150px;
        height: 150px;
      }

      .size-options {
        flex-direction: column;
        align-items: center;
      }

      .download-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      返回工具列表
    </a>

    <h1>Gravatar 头像查询</h1>
    <p class="subtitle">输入邮箱地址，获取关联的 Gravatar 全球通用头像</p>

    <div class="search-card">
      <form class="search-form" onsubmit="searchGravatar(event)">
        <input type="email" class="search-input" id="emailInput" placeholder="输入邮箱地址..." required>
        <button type="submit" class="btn btn-primary">查询</button>
      </form>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>正在查询...</p>
    </div>

    <div class="result-card" id="resultCard">
      <div class="avatar-container">
        <img class="avatar" id="avatarImg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Gravatar">
        <span class="avatar-badge" id="avatarBadge">已找到</span>
      </div>
      <div class="email-display" id="emailDisplay"></div>
      <div class="hash-display" id="hashDisplay"></div>
      
      <div class="size-options" id="sizeOptions">
        <button class="size-btn" onclick="changeSize(80)">80px</button>
        <button class="size-btn" onclick="changeSize(100)">100px</button>
        <button class="size-btn active" onclick="changeSize(200)">200px</button>
        <button class="size-btn" onclick="changeSize(400)">400px</button>
        <button class="size-btn" onclick="changeSize(500)">500px</button>
      </div>

      <div class="download-section">
        <button class="btn btn-download" onclick="copyUrl()">复制链接</button>
        <button class="btn btn-download" onclick="downloadAvatar()">下载头像</button>
      </div>
    </div>

    <div class="info-section">
      <h3>关于 Gravatar</h3>
      <p>Gravatar (Globally Recognized Avatar) 是一个全球通用头像服务。用户只需在 Gravatar 网站注册并上传头像，之后在支持 Gravatar 的网站上使用同一邮箱，就会自动显示对应头像。</p>
      <p>WordPress、GitHub、Stack Overflow 等众多网站都支持 Gravatar。</p>
      <p>官网: <a href="https://gravatar.com" target="_blank" rel="noopener">gravatar.com</a></p>
    </div>
  </div>

  <script>
    ;(function() {
      'use strict';

      let currentHash = '';
      let currentSize = 200;
      let hasCustomAvatar = false;

      async function md5(string) {
        const msgBuffer = new TextEncoder().encode(string);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        // Gravatar actually uses MD5, but we'll use a simple implementation
        // For production, use a proper MD5 library
        return md5Simple(string);
      }

      // Simple MD5 implementation
      function md5Simple(string) {
        function rotateLeft(value, shift) {
          return (value << shift) | (value >>> (32 - shift));
        }

        function addUnsigned(x, y) {
          const lsw = (x & 0xFFFF) + (y & 0xFFFF);
          const msw = (x >> 16) + (y >> 16) + (lsw >> 16);
          return (msw << 16) | (lsw & 0xFFFF);
        }

        function F(x, y, z) { return (x & y) | ((~x) & z); }
        function G(x, y, z) { return (x & z) | (y & (~z)); }
        function H(x, y, z) { return x ^ y ^ z; }
        function I(x, y, z) { return y ^ (x | (~z)); }

        function FF(a, b, c, d, x, s, ac) {
          a = addUnsigned(a, addUnsigned(addUnsigned(F(b, c, d), x), ac));
          return addUnsigned(rotateLeft(a, s), b);
        }

        function GG(a, b, c, d, x, s, ac) {
          a = addUnsigned(a, addUnsigned(addUnsigned(G(b, c, d), x), ac));
          return addUnsigned(rotateLeft(a, s), b);
        }

        function HH(a, b, c, d, x, s, ac) {
          a = addUnsigned(a, addUnsigned(addUnsigned(H(b, c, d), x), ac));
          return addUnsigned(rotateLeft(a, s), b);
        }

        function II(a, b, c, d, x, s, ac) {
          a = addUnsigned(a, addUnsigned(addUnsigned(I(b, c, d), x), ac));
          return addUnsigned(rotateLeft(a, s), b);
        }

        function convertToWordArray(string) {
          let lWordCount;
          const lMessageLength = string.length;
          const lNumberOfWordsTemp1 = lMessageLength + 8;
          const lNumberOfWordsTemp2 = (lNumberOfWordsTemp1 - (lNumberOfWordsTemp1 % 64)) / 64;
          const lNumberOfWords = (lNumberOfWordsTemp2 + 1) * 16;
          const lWordArray = Array(lNumberOfWords - 1);
          let lBytePosition = 0;
          let lByteCount = 0;

          while (lByteCount < lMessageLength) {
            lWordCount = (lByteCount - (lByteCount % 4)) / 4;
            lBytePosition = (lByteCount % 4) * 8;
            lWordArray[lWordCount] = (lWordArray[lWordCount] || 0) | (string.charCodeAt(lByteCount) << lBytePosition);
            lByteCount++;
          }

          lWordCount = (lByteCount - (lByteCount % 4)) / 4;
          lBytePosition = (lByteCount % 4) * 8;
          lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
          lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
          lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;

          return lWordArray;
        }

        function wordToHex(lValue) {
          let wordToHexValue = '', wordToHexValueTemp = '', lByte, lCount;
          for (lCount = 0; lCount <= 3; lCount++) {
            lByte = (lValue >>> (lCount * 8)) & 255;
            wordToHexValueTemp = '0' + lByte.toString(16);
            wordToHexValue += wordToHexValueTemp.substr(wordToHexValueTemp.length - 2, 2);
          }
          return wordToHexValue;
        }

        const x = convertToWordArray(string);
        let a = 0x67452301, b = 0xEFCDAB89, c = 0x98BADCFE, d = 0x10325476;
        const S11 = 7, S12 = 12, S13 = 17, S14 = 22;
        const S21 = 5, S22 = 9, S23 = 14, S24 = 20;
        const S31 = 4, S32 = 11, S33 = 16, S34 = 23;
        const S41 = 6, S42 = 10, S43 = 15, S44 = 21;

        for (let k = 0; k < x.length; k += 16) {
          const AA = a, BB = b, CC = c, DD = d;

          a = FF(a, b, c, d, x[k], S11, 0xD76AA478);
          d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
          c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
          b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
          a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
          d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
          c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
          b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
          a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
          d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
          c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
          b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
          a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
          d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
          c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
          b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);

          a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
          d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
          c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
          b = GG(b, c, d, a, x[k], S24, 0xE9B6C7AA);
          a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
          d = GG(d, a, b, c, x[k + 10], S22, 0x2441453);
          c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
          b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
          a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
          d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
          c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
          b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
          a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
          d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
          c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
          b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);

          a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
          d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
          c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
          b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
          a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
          d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
          c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
          b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
          a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
          d = HH(d, a, b, c, x[k], S32, 0xEAA127FA);
          c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
          b = HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
          a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
          d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
          c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
          b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);

          a = II(a, b, c, d, x[k], S41, 0xF4292244);
          d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
          c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
          b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
          a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
          d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
          c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
          b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
          a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
          d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
          c = II(c, d, a, b, x[k + 6], S43, 0xA3014314);
          b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
          a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
          d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
          c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
          b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);

          a = addUnsigned(a, AA);
          b = addUnsigned(b, BB);
          c = addUnsigned(c, CC);
          d = addUnsigned(d, DD);
        }

        return (wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d)).toLowerCase();
      }

      function getGravatarUrl(hash, size) {
        return `https://www.gravatar.com/avatar/${hash}?s=${size}&d=404`;
      }

      function getGravatarUrlWithDefault(hash, size) {
        return `https://www.gravatar.com/avatar/${hash}?s=${size}&d=mp`;
      }

      async function searchGravatar(e) {
        e.preventDefault();
        
        const email = document.getElementById('emailInput').value.trim().toLowerCase();
        if (!email) return;

        const loading = document.getElementById('loading');
        const resultCard = document.getElementById('resultCard');

        loading.classList.add('show');
        resultCard.classList.remove('show');

        currentHash = md5Simple(email);
        currentSize = 200;

        // 检查是否有自定义头像
        const testUrl = getGravatarUrl(currentHash, 80);
        
        try {
          const response = await fetch(testUrl, { method: 'HEAD' });
          hasCustomAvatar = response.ok;
        } catch (e) {
          hasCustomAvatar = false;
        }

        // 显示结果
        const avatarImg = document.getElementById('avatarImg');
        const avatarBadge = document.getElementById('avatarBadge');
        const emailDisplay = document.getElementById('emailDisplay');
        const hashDisplay = document.getElementById('hashDisplay');

        avatarImg.src = getGravatarUrlWithDefault(currentHash, currentSize);
        emailDisplay.textContent = email;
        hashDisplay.textContent = `MD5: ${currentHash}`;

        if (hasCustomAvatar) {
          avatarBadge.textContent = '已找到';
          avatarBadge.classList.remove('not-found');
        } else {
          avatarBadge.textContent = '默认头像';
          avatarBadge.classList.add('not-found');
        }

        // 更新尺寸按钮状态
        updateSizeButtons();

        loading.classList.remove('show');
        resultCard.classList.add('show');
      }

      function changeSize(size) {
        currentSize = size;
        const avatarImg = document.getElementById('avatarImg');
        avatarImg.src = getGravatarUrlWithDefault(currentHash, size);
        updateSizeButtons();
      }

      function updateSizeButtons() {
        document.querySelectorAll('.size-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent === `${currentSize}px`) {
            btn.classList.add('active');
          }
        });
      }

      function copyUrl() {
        const url = getGravatarUrlWithDefault(currentHash, currentSize);
        navigator.clipboard.writeText(url).then(() => {
          alert('链接已复制到剪贴板');
        });
      }

      function downloadAvatar() {
        const url = getGravatarUrlWithDefault(currentHash, currentSize);
        const a = document.createElement('a');
        a.href = url;
        a.download = `gravatar_${currentHash}_${currentSize}.png`;
        a.target = '_blank';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      // 暴露全局函数
      window.searchGravatar = searchGravatar;
      window.changeSize = changeSize;
      window.copyUrl = copyUrl;
      window.downloadAvatar = downloadAvatar;
    })();
  </script>
</body>
</html>

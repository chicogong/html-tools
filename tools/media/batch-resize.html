<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils" />
    <meta name="keywords" content="batch-resize,media,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/media/batch-resize.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils" />
    <meta property="og:description" content="å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/media/batch-resize.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils" />
    <meta name="twitter:description" content="å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-magenta: #f72585;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-blue: #4cc9f0;
        --accent-purple: #7b2cbf;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --font-sans: "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
        --accent-cyan: #00d4b8;
        --accent-magenta: #e63975;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      :root {
        --success-color: #2ecc71;
        --warning-color: #f39c12;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
      }
      .drop-zone {
        border: 2px dashed var(--muted-color);
        border-radius: 8px;
        padding: 3rem;
        text-align: center;
        transition:
          border-color 0.3s,
          background 0.3s;
        margin-bottom: 2rem;
      }
      .drop-zone.dragover {
        border-color: var(--accent-cyan);
        background: var(--primary-focus);
      }
      .settings-panel {
        background: var(--card-background-color);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
      }
      .setting-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
      }
      .size-inputs {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      .size-inputs input {
        width: 100px;
        margin: 0;
      }
      .preset-sizes {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
      }
      .preset-sizes button {
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
      }
      .image-list {
        margin-bottom: 2rem;
      }
      .image-item {
        display: grid;
        grid-template-columns: 80px 1fr auto auto;
        gap: 1rem;
        align-items: center;
        padding: 1rem;
        background: var(--card-background-color);
        border-radius: 8px;
        margin-bottom: 0.5rem;
      }
      .image-item img {
        width: 80px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
      }
      .image-info {
        min-width: 0;
      }
      .image-info .filename {
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .image-info .dimensions {
        font-size: 0.85rem;
        color: var(--muted-color);
      }
      .new-dimensions {
        font-family: var(--font-mono);
        background: var(--primary-focus);
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        white-space: nowrap;
      }
      .image-actions button {
        padding: 0.3rem 0.6rem;
        margin: 0;
      }
      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--muted-border-color);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 1rem;
        display: none;
      }
      .progress-bar-fill {
        height: 100%;
        background: var(--accent-cyan);
        transition: width 0.3s;
      }
      .action-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .stats {
        display: flex;
        gap: 2rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }
      .stat-item {
        text-align: center;
      }
      .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent-cyan);
      }
      .stat-label {
        font-size: 0.85rem;
        color: var(--muted-color);
      }
      .format-select {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .format-select label {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        cursor: pointer;
      }
      .quality-slider {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .quality-slider input {
        flex: 1;
        margin: 0;
      }
      .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--muted-color);
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸
    </nav>
    <main class="container">
      <header>
        <h1>ğŸ“ å›¾ç‰‡æ‰¹é‡è°ƒæ•´å°ºå¯¸</h1>
        <button id="themeToggle" class="outline">ğŸŒ™ æš—è‰²æ¨¡å¼</button>
      </header>

      <div class="drop-zone" id="dropZone">
        <p>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
        <p style="color: var(--muted-color); font-size: 0.9rem">
          æ”¯æŒ JPGã€PNGã€WebPã€GIF æ ¼å¼ï¼Œå¯å¤šé€‰
        </p>
        <input type="file" id="fileInput" accept="image/*" multiple style="display: none" />
        <button onclick="document.getElementById('fileInput').click()">é€‰æ‹©å›¾ç‰‡</button>
      </div>

      <div class="settings-panel">
        <h3>âš™ï¸ è°ƒæ•´è®¾ç½®</h3>
        <div class="settings-grid">
          <div class="setting-group">
            <label>è°ƒæ•´æ¨¡å¼</label>
            <select id="resizeMode">
              <option value="width">æŒ‰å®½åº¦</option>
              <option value="height">æŒ‰é«˜åº¦</option>
              <option value="both">å›ºå®šå°ºå¯¸</option>
              <option value="percent">æŒ‰æ¯”ä¾‹</option>
              <option value="longest">æŒ‰æœ€é•¿è¾¹</option>
              <option value="shortest">æŒ‰æœ€çŸ­è¾¹</option>
            </select>
          </div>

          <div class="setting-group">
            <label>ç›®æ ‡å°ºå¯¸</label>
            <div class="size-inputs">
              <input
                type="number"
                id="targetWidth"
                value="800"
                min="1"
                max="10000"
                placeholder="å®½åº¦"
              />
              <span>Ã—</span>
              <input
                type="number"
                id="targetHeight"
                value="600"
                min="1"
                max="10000"
                placeholder="é«˜åº¦"
              />
            </div>
            <div class="preset-sizes">
              <button class="outline secondary" onclick="setPresetSize(640, 480)">640Ã—480</button>
              <button class="outline secondary" onclick="setPresetSize(800, 600)">800Ã—600</button>
              <button class="outline secondary" onclick="setPresetSize(1024, 768)">1024Ã—768</button>
              <button class="outline secondary" onclick="setPresetSize(1280, 720)">720p</button>
              <button class="outline secondary" onclick="setPresetSize(1920, 1080)">1080p</button>
              <button class="outline secondary" onclick="setPresetSize(2560, 1440)">2K</button>
              <button class="outline secondary" onclick="setPresetSize(3840, 2160)">4K</button>
            </div>
          </div>

          <div class="setting-group">
            <label>è¾“å‡ºæ ¼å¼</label>
            <div class="format-select">
              <label>
                <input type="radio" name="format" value="original" checked />
                ä¿æŒåŸæ ¼å¼
              </label>
              <label>
                <input type="radio" name="format" value="jpeg" />
                JPEG
              </label>
              <label>
                <input type="radio" name="format" value="png" />
                PNG
              </label>
              <label>
                <input type="radio" name="format" value="webp" />
                WebP
              </label>
            </div>
          </div>

          <div class="setting-group">
            <label>è´¨é‡ (JPEG/WebP)</label>
            <div class="quality-slider">
              <input type="range" id="quality" min="1" max="100" value="85" />
              <span id="qualityValue">85%</span>
            </div>
          </div>
        </div>

        <div style="margin-top: 1rem">
          <label>
            <input type="checkbox" id="keepAspectRatio" checked />
            ä¿æŒå®½é«˜æ¯”
          </label>
          <label style="margin-left: 1rem">
            <input type="checkbox" id="allowUpscale" />
            å…è®¸æ”¾å¤§ï¼ˆå¯èƒ½é™ä½è´¨é‡ï¼‰
          </label>
        </div>
      </div>

      <div class="stats" id="stats" style="display: none">
        <div class="stat-item">
          <div class="stat-value" id="totalCount">0</div>
          <div class="stat-label">å›¾ç‰‡æ•°é‡</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalOriginalSize">0 MB</div>
          <div class="stat-label">åŸå§‹å¤§å°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="processedCount">0</div>
          <div class="stat-label">å·²å¤„ç†</div>
        </div>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-bar-fill" id="progressFill"></div>
      </div>

      <div class="image-list" id="imageList">
        <div class="empty-state">æš‚æ— å›¾ç‰‡ï¼Œè¯·ä¸Šä¼ å›¾ç‰‡å¼€å§‹å¤„ç†</div>
      </div>

      <div class="action-buttons">
        <button onclick="processAll()" id="processBtn" disabled>ğŸš€ æ‰¹é‡å¤„ç†</button>
        <button onclick="downloadAll()" id="downloadBtn" class="contrast" disabled>
          ğŸ“¦ æ‰“åŒ…ä¸‹è½½
        </button>
        <button onclick="clearAll()" class="secondary outline">ğŸ—‘ï¸ æ¸…ç©ºåˆ—è¡¨</button>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script>
      // Theme toggle
      const themeToggle = document.getElementById("themeToggle");
      const html = document.documentElement;

      function setTheme(dark) {
        html.setAttribute("data-theme", dark ? "dark" : "light");
        themeToggle.textContent = dark ? "â˜€ï¸ äº®è‰²æ¨¡å¼" : "ğŸŒ™ æš—è‰²æ¨¡å¼";
        localStorage.setItem("theme", dark ? "dark" : "light");
      }

      themeToggle.addEventListener("click", () => {
        setTheme(html.getAttribute("data-theme") !== "dark");
      });

      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        setTheme(savedTheme === "dark");
      } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        setTheme(true);
      }

      // Image data storage
      let images = [];
      let processedImages = [];

      // Elements
      const fileInput = document.getElementById("fileInput");
      const dropZone = document.getElementById("dropZone");
      const imageList = document.getElementById("imageList");
      const qualitySlider = document.getElementById("quality");
      const qualityValue = document.getElementById("qualityValue");
      const resizeMode = document.getElementById("resizeMode");
      const targetWidth = document.getElementById("targetWidth");
      const targetHeight = document.getElementById("targetHeight");

      // Quality slider
      qualitySlider.addEventListener("input", () => {
        qualityValue.textContent = qualitySlider.value + "%";
      });

      // Resize mode change
      resizeMode.addEventListener("change", () => {
        const mode = resizeMode.value;
        targetHeight.disabled = mode === "width" || mode === "longest" || mode === "shortest";
        targetWidth.disabled = mode === "height";

        if (mode === "percent") {
          targetWidth.placeholder = "ç™¾åˆ†æ¯”";
          targetWidth.value = "50";
          targetHeight.disabled = true;
        } else {
          targetWidth.placeholder = "å®½åº¦";
        }

        updateAllPreview();
      });

      // Size input change
      targetWidth.addEventListener("input", updateAllPreview);
      targetHeight.addEventListener("input", updateAllPreview);

      // File handling
      fileInput.addEventListener("change", (e) => {
        addImages(e.target.files);
      });

      dropZone.addEventListener("click", () => fileInput.click());
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });
      dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        addImages(e.dataTransfer.files);
      });

      function addImages(files) {
        Array.from(files).forEach((file) => {
          if (!file.type.startsWith("image/")) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const imageData = {
                id: Date.now() + Math.random(),
                file: file,
                dataUrl: e.target.result,
                width: img.width,
                height: img.height,
                processed: false,
                processedDataUrl: null
              };
              images.push(imageData);
              renderImageList();
              updateStats();
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        });
      }

      window.setPresetSize = function (width, height) {
        targetWidth.value = width;
        targetHeight.value = height;
        updateAllPreview();
      };

      function calculateNewDimensions(origWidth, origHeight) {
        const mode = resizeMode.value;
        const tw = parseInt(targetWidth.value) || 800;
        const th = parseInt(targetHeight.value) || 600;
        const keepRatio = document.getElementById("keepAspectRatio").checked;
        const allowUpscale = document.getElementById("allowUpscale").checked;

        let newWidth, newHeight;

        switch (mode) {
          case "width":
            newWidth = tw;
            newHeight = keepRatio ? Math.round(origHeight * (tw / origWidth)) : origHeight;
            break;
          case "height":
            newHeight = th;
            newWidth = keepRatio ? Math.round(origWidth * (th / origHeight)) : origWidth;
            break;
          case "both":
            if (keepRatio) {
              const ratio = Math.min(tw / origWidth, th / origHeight);
              newWidth = Math.round(origWidth * ratio);
              newHeight = Math.round(origHeight * ratio);
            } else {
              newWidth = tw;
              newHeight = th;
            }
            break;
          case "percent":
            const percent = tw / 100;
            newWidth = Math.round(origWidth * percent);
            newHeight = Math.round(origHeight * percent);
            break;
          case "longest":
            if (origWidth >= origHeight) {
              newWidth = tw;
              newHeight = Math.round(origHeight * (tw / origWidth));
            } else {
              newHeight = tw;
              newWidth = Math.round(origWidth * (tw / origHeight));
            }
            break;
          case "shortest":
            if (origWidth <= origHeight) {
              newWidth = tw;
              newHeight = Math.round(origHeight * (tw / origWidth));
            } else {
              newHeight = tw;
              newWidth = Math.round(origWidth * (tw / origHeight));
            }
            break;
        }

        // Prevent upscaling unless allowed
        if (!allowUpscale) {
          if (newWidth > origWidth) newWidth = origWidth;
          if (newHeight > origHeight) newHeight = origHeight;

          // Recalculate to maintain aspect ratio if needed
          if (keepRatio && (newWidth !== origWidth || newHeight !== origHeight)) {
            const ratio = Math.min(newWidth / origWidth, newHeight / origHeight);
            newWidth = Math.round(origWidth * ratio);
            newHeight = Math.round(origHeight * ratio);
          }
        }

        return { width: Math.max(1, newWidth), height: Math.max(1, newHeight) };
      }

      function renderImageList() {
        if (images.length === 0) {
          imageList.replaceChildren();
          const emptyDiv = document.createElement("div");
          emptyDiv.className = "empty-state";
          emptyDiv.textContent = "æš‚æ— å›¾ç‰‡ï¼Œè¯·ä¸Šä¼ å›¾ç‰‡å¼€å§‹å¤„ç†";
          imageList.appendChild(emptyDiv);
          document.getElementById("processBtn").disabled = true;
          document.getElementById("downloadBtn").disabled = true;
          document.getElementById("stats").style.display = "none";
          return;
        }

        imageList.replaceChildren();
        document.getElementById("stats").style.display = "flex";
        document.getElementById("processBtn").disabled = false;

        images.forEach((image, index) => {
          const newDims = calculateNewDimensions(image.width, image.height);

          const item = document.createElement("div");
          item.className = "image-item";

          const img = document.createElement("img");
          img.src = image.dataUrl;
          img.alt = image.file.name;

          const info = document.createElement("div");
          info.className = "image-info";

          const filename = document.createElement("div");
          filename.className = "filename";
          filename.textContent = image.file.name;

          const dimensions = document.createElement("div");
          dimensions.className = "dimensions";
          dimensions.textContent =
            image.width + " Ã— " + image.height + " | " + formatFileSize(image.file.size);

          info.appendChild(filename);
          info.appendChild(dimensions);

          const newDimsSpan = document.createElement("span");
          newDimsSpan.className = "new-dimensions";
          newDimsSpan.textContent = "â†’ " + newDims.width + " Ã— " + newDims.height;

          const actions = document.createElement("div");
          actions.className = "image-actions";

          const removeBtn = document.createElement("button");
          removeBtn.className = "secondary outline";
          removeBtn.textContent = "âœ•";
          removeBtn.addEventListener("click", () => removeImage(index));

          actions.appendChild(removeBtn);

          item.appendChild(img);
          item.appendChild(info);
          item.appendChild(newDimsSpan);
          item.appendChild(actions);

          imageList.appendChild(item);
        });
      }

      function updateAllPreview() {
        renderImageList();
      }

      window.removeImage = function (index) {
        images.splice(index, 1);
        renderImageList();
        updateStats();
      };

      window.clearAll = function () {
        images = [];
        processedImages = [];
        renderImageList();
        updateStats();
      };

      function updateStats() {
        document.getElementById("totalCount").textContent = images.length;
        const totalSize = images.reduce((sum, img) => sum + img.file.size, 0);
        document.getElementById("totalOriginalSize").textContent = formatFileSize(totalSize);
        const processed = images.filter((img) => img.processed).length;
        document.getElementById("processedCount").textContent = processed;

        document.getElementById("downloadBtn").disabled = processed === 0;
      }

      window.formatFileSize = function (bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
        return (bytes / (1024 * 1024)).toFixed(2) + " MB";
      };

      window.processAll = async function () {
        const progressBar = document.getElementById("progressBar");
        const progressFill = document.getElementById("progressFill");
        progressBar.style.display = "block";

        processedImages = [];

        for (let i = 0; i < images.length; i++) {
          const progress = ((i + 1) / images.length) * 100;
          progressFill.style.width = progress + "%";

          await processImage(images[i]);
          updateStats();
        }

        setTimeout(() => {
          progressBar.style.display = "none";
        }, 500);
      };

      function processImage(imageData) {
        return new Promise((resolve) => {
          const img = new Image();
          img.onload = () => {
            const newDims = calculateNewDimensions(imageData.width, imageData.height);

            const canvas = document.createElement("canvas");
            canvas.width = newDims.width;
            canvas.height = newDims.height;

            const ctx = canvas.getContext("2d");
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = "high";
            ctx.drawImage(img, 0, 0, newDims.width, newDims.height);

            const format = document.querySelector('input[name="format"]:checked').value;
            const quality = parseInt(qualitySlider.value) / 100;

            let mimeType, extension;
            if (format === "original") {
              mimeType = imageData.file.type;
              extension = imageData.file.name.split(".").pop();
            } else {
              mimeType = "image/" + format;
              extension = format === "jpeg" ? "jpg" : format;
            }

            const dataUrl = canvas.toDataURL(mimeType, quality);

            imageData.processed = true;
            imageData.processedDataUrl = dataUrl;
            imageData.processedWidth = newDims.width;
            imageData.processedHeight = newDims.height;
            imageData.processedExtension = extension;

            processedImages.push(imageData);
            resolve();
          };
          img.src = imageData.dataUrl;
        });
      }

      window.downloadAll = async function () {
        const processed = images.filter((img) => img.processed);
        if (processed.length === 0) return;

        if (processed.length === 1) {
          // Single file download
          const img = processed[0];
          const link = document.createElement("a");
          const baseName = img.file.name.replace(/\.[^.]+$/, "");
          link.download = baseName + "_resized." + img.processedExtension;
          link.href = img.processedDataUrl;
          link.click();
        } else {
          // Multiple files - create zip
          const zip = new JSZip();

          processed.forEach((img, index) => {
            const baseName = img.file.name.replace(/\.[^.]+$/, "");
            const filename = baseName + "_resized." + img.processedExtension;
            const base64Data = img.processedDataUrl.split(",")[1];
            zip.file(filename, base64Data, { base64: true });
          });

          const blob = await zip.generateAsync({ type: "blob" });
          const link = document.createElement("a");
          link.download = "resized_images.zip";
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(link.href);
        }
      };

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", newTheme);
      }
    </script>
  </body>
</html>

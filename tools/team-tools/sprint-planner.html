<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ•æ·å†²åˆºè§„åˆ’å™¨ - WebUtils</title>
    <style>
      :root {
        --bg-color: #1a1a2e;
        --card-bg: #16213e;
        --text-color: #e0e0e0;
        --primary-color: #0f3460;
        --accent-color: #00d9ff;
        --border-color: #0f3460;
        --input-bg: #1a1a2e;
        --success-color: #4ade80;
        --warning-color: #fbbf24;
        --danger-color: #f87171;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --bg-color: #f0f4f8;
        --card-bg: #fff;
        --text-color: #1a1a2e;
        --primary-color: #e0e7ff;
        --accent-color: #0891b2;
        --border-color: #c7d2fe;
        --input-bg: #f8fafc;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        font-size: 16px;
        line-height: 1.6;
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        position: relative;
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--accent-color), #a855f7);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .theme-toggle {
        position: absolute;
        right: 0;
        top: 0;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        background: var(--primary-color);
      }

      .back-link {
        position: absolute;
        left: 0;
        top: 0;
        color: var(--accent-color);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
      }

      .back-link:hover {
        text-decoration: underline;
      }

      .panel {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        border: 1px solid var(--border-color);
        margin-bottom: 20px;
      }

      .panel-title {
        font-size: 1rem;
        margin-bottom: 15px;
        color: var(--accent-color);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .sprint-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .form-group label {
        font-size: 13px;
        color: var(--text-color);
        opacity: 0.8;
      }

      .form-group input,
      .form-group select {
        padding: 10px 12px;
        background: var(--input-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-color);
        font-size: 14px;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--accent-color);
      }

      .capacity-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .team-member {
        display: grid;
        grid-template-columns: 1fr 80px 80px 40px;
        gap: 10px;
        padding: 12px;
        background: var(--input-bg);
        border-radius: 8px;
        margin-bottom: 10px;
        align-items: center;
      }

      .team-member input {
        padding: 8px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-color);
        font-size: 13px;
      }

      .backlog-item {
        display: grid;
        grid-template-columns: 1fr 80px 100px 40px;
        gap: 10px;
        padding: 12px;
        background: var(--input-bg);
        border-radius: 8px;
        margin-bottom: 10px;
        align-items: center;
      }

      .backlog-item input,
      .backlog-item select {
        padding: 8px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-color);
        font-size: 13px;
      }

      .backlog-item.in-sprint {
        border-left: 3px solid var(--success-color);
      }

      .backlog-item.over-capacity {
        border-left: 3px solid var(--danger-color);
      }

      .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background: var(--accent-color);
        color: #000;
      }

      .btn-primary:hover {
        opacity: 0.9;
      }

      .btn-secondary {
        background: var(--primary-color);
        color: var(--text-color);
      }

      .btn-secondary:hover {
        background: var(--border-color);
      }

      .btn-danger {
        background: transparent;
        color: var(--danger-color);
        padding: 8px;
      }

      .btn-danger:hover {
        background: rgba(248, 113, 113, 0.1);
      }

      .btn-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .stat-card {
        background: var(--input-bg);
        padding: 15px;
        border-radius: 12px;
        text-align: center;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--accent-color);
      }

      .stat-label {
        font-size: 12px;
        opacity: 0.7;
        margin-top: 5px;
      }

      .progress-bar {
        height: 20px;
        background: var(--input-bg);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-fill {
        height: 100%;
        background: var(--accent-color);
        border-radius: 10px;
        transition: width 0.3s ease;
      }

      .progress-fill.warning {
        background: var(--warning-color);
      }

      .progress-fill.danger {
        background: var(--danger-color);
      }

      .velocity-chart {
        display: flex;
        align-items: flex-end;
        gap: 10px;
        height: 150px;
        padding: 20px 0;
      }

      .velocity-bar {
        flex: 1;
        background: var(--accent-color);
        border-radius: 4px 4px 0 0;
        position: relative;
        min-height: 20px;
      }

      .velocity-bar span {
        position: absolute;
        bottom: -20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 11px;
        opacity: 0.7;
      }

      .checkbox-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .checkbox-wrapper input[type="checkbox"] {
        width: 18px;
        height: 18px;
      }

      @media (max-width: 768px) {
        .team-member,
        .backlog-item {
          grid-template-columns: 1fr;
        }
      }
      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <div class="container">
      <div class="header">
        <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
        <h1>æ•æ·å†²åˆºè§„åˆ’å™¨</h1>
        <p>è§„åˆ’å’Œè¿½è¸ªæ•æ·å†²åˆº</p>
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ¢ä¸»é¢˜</button>
      </div>

      <div class="panel">
        <div class="panel-title">ğŸƒ å†²åˆºä¿¡æ¯</div>
        <div class="sprint-info">
          <div class="form-group">
            <label>å†²åˆºåç§°</label>
            <input type="text" id="sprintName" placeholder="ä¾‹å¦‚ï¼šSprint 23" />
          </div>
          <div class="form-group">
            <label>å¼€å§‹æ—¥æœŸ</label>
            <input type="date" id="startDate" />
          </div>
          <div class="form-group">
            <label>ç»“æŸæ—¥æœŸ</label>
            <input type="date" id="endDate" />
          </div>
          <div class="form-group">
            <label>å†²åˆºç›®æ ‡</label>
            <input type="text" id="sprintGoal" placeholder="æœ¬å†²åˆºçš„ä¸»è¦ç›®æ ‡" />
          </div>
        </div>
      </div>

      <div class="capacity-section">
        <div class="panel">
          <div class="panel-title">ğŸ‘¥ å›¢é˜Ÿå®¹é‡</div>
          <div id="teamMembers"></div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="addTeamMember()">+ æ·»åŠ æˆå‘˜</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">ğŸ“Š å†å²é€Ÿç‡</div>
          <div id="velocityInputs"></div>
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="addVelocityRecord()">+ æ·»åŠ è®°å½•</button>
          </div>
          <div class="velocity-chart" id="velocityChart"></div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">ğŸ“‹ äº§å“å¾…åŠåˆ—è¡¨</div>
        <div id="backlogItems"></div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="addBacklogItem()">+ æ·»åŠ ç”¨æˆ·æ•…äº‹</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">ğŸ“ˆ å†²åˆºæ¦‚è§ˆ</div>
        <div class="progress-bar">
          <div class="progress-fill" id="capacityProgress" style="width: 0%"></div>
        </div>
        <p style="text-align: center; margin-top: 10px; font-size: 13px">
          å®¹é‡ä½¿ç”¨ç‡:
          <span id="capacityPercent">0</span>
          %
        </p>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalCapacity">0</div>
            <div class="stat-label">æ€»å®¹é‡ (ç‚¹æ•°)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="plannedPoints">0</div>
            <div class="stat-label">è®¡åˆ’ç‚¹æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avgVelocity">0</div>
            <div class="stat-label">å¹³å‡é€Ÿç‡</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="sprintDays">0</div>
            <div class="stat-label">å†²åˆºå¤©æ•°</div>
          </div>
        </div>
        <div class="btn-group" style="justify-content: center; margin-top: 20px">
          <button class="btn btn-primary" onclick="exportPlan()">ğŸ“‹ å¯¼å‡ºè®¡åˆ’</button>
          <button class="btn btn-secondary" onclick="sharePlan()">ğŸ”— åˆ†äº«</button>
          <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
      </div>
    </div>

    <script>
      const LS_KEY = "sprint-planner-data";

      let teamMembers = [];
      let backlogItems = [];
      let velocityRecords = [];

      function init() {
        const savedTheme = localStorage.getItem("theme") || "dark";
        if (savedTheme === "light") {
          document.body.setAttribute("data-theme", "light");
        }

        const today = new Date();
        document.getElementById("startDate").value = today.toISOString().split("T")[0];
        const endDate = new Date(today);
        endDate.setDate(endDate.getDate() + 14);
        document.getElementById("endDate").value = endDate.toISOString().split("T")[0];

        loadFromStorage();
        loadFromUrl();

        if (teamMembers.length === 0) {
          addTeamMember("æˆå‘˜1", 10, 80);
        }
        if (backlogItems.length === 0) {
          addBacklogItem();
        }
        if (velocityRecords.length === 0) {
          addVelocityRecord();
        }

        document.querySelectorAll("input").forEach((el) => {
          el.addEventListener("input", () => {
            updateStats();
            saveToStorage();
          });
        });
      }

      function addTeamMember(name = "", capacity = 10, availability = 100) {
        teamMembers.push({
          id: Date.now(),
          name: name,
          capacity: capacity,
          availability: availability
        });
        renderTeamMembers();
        updateStats();
        saveToStorage();
      }

      function removeTeamMember(id) {
        teamMembers = teamMembers.filter((m) => m.id !== id);
        renderTeamMembers();
        updateStats();
        saveToStorage();
      }

      function renderTeamMembers() {
        const container = document.getElementById("teamMembers");
        container.textContent = "";

        teamMembers.forEach((member) => {
          const div = document.createElement("div");
          div.className = "team-member";

          const nameInput = document.createElement("input");
          nameInput.type = "text";
          nameInput.placeholder = "æˆå‘˜å§“å";
          nameInput.value = member.name;
          nameInput.addEventListener("input", (e) => {
            member.name = e.target.value;
            saveToStorage();
          });

          const capacityInput = document.createElement("input");
          capacityInput.type = "number";
          capacityInput.min = "0";
          capacityInput.placeholder = "ç‚¹æ•°";
          capacityInput.value = member.capacity;
          capacityInput.addEventListener("input", (e) => {
            member.capacity = parseInt(e.target.value) || 0;
            updateStats();
            saveToStorage();
          });

          const availInput = document.createElement("input");
          availInput.type = "number";
          availInput.min = "0";
          availInput.max = "100";
          availInput.placeholder = "%";
          availInput.value = member.availability;
          availInput.addEventListener("input", (e) => {
            member.availability = parseInt(e.target.value) || 0;
            updateStats();
            saveToStorage();
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-danger";
          deleteBtn.textContent = "Ã—";
          deleteBtn.addEventListener("click", () => removeTeamMember(member.id));

          div.appendChild(nameInput);
          div.appendChild(capacityInput);
          div.appendChild(availInput);
          div.appendChild(deleteBtn);

          container.appendChild(div);
        });
      }

      function addVelocityRecord(value = 0) {
        velocityRecords.push({
          id: Date.now(),
          value: value
        });
        renderVelocityRecords();
        updateStats();
        saveToStorage();
      }

      function removeVelocityRecord(id) {
        velocityRecords = velocityRecords.filter((r) => r.id !== id);
        renderVelocityRecords();
        updateStats();
        saveToStorage();
      }

      function renderVelocityRecords() {
        const container = document.getElementById("velocityInputs");
        container.textContent = "";

        velocityRecords.forEach((record, index) => {
          const div = document.createElement("div");
          div.style.cssText = "display:flex;gap:10px;margin-bottom:8px;align-items:center;";

          const label = document.createElement("span");
          label.style.cssText = "font-size:12px;opacity:0.7;width:70px;";
          label.textContent = "Sprint " + (index + 1);

          const input = document.createElement("input");
          input.type = "number";
          input.min = "0";
          input.style.cssText =
            "flex:1;padding:8px;background:var(--input-bg);border:1px solid var(--border-color);border-radius:6px;color:var(--text-color);";
          input.value = record.value;
          input.addEventListener("input", (e) => {
            record.value = parseInt(e.target.value) || 0;
            updateStats();
            renderVelocityChart();
            saveToStorage();
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-danger";
          deleteBtn.textContent = "Ã—";
          deleteBtn.addEventListener("click", () => removeVelocityRecord(record.id));

          div.appendChild(label);
          div.appendChild(input);
          div.appendChild(deleteBtn);

          container.appendChild(div);
        });

        renderVelocityChart();
      }

      function renderVelocityChart() {
        const container = document.getElementById("velocityChart");
        container.textContent = "";

        if (velocityRecords.length === 0) return;

        const maxValue = Math.max(...velocityRecords.map((r) => r.value), 1);

        velocityRecords.forEach((record, index) => {
          const bar = document.createElement("div");
          bar.className = "velocity-bar";
          const height = (record.value / maxValue) * 100;
          bar.style.height = height + "%";

          const label = document.createElement("span");
          label.textContent = "S" + (index + 1);
          bar.appendChild(label);

          container.appendChild(bar);
        });
      }

      function addBacklogItem(title = "", points = 0, priority = "medium") {
        backlogItems.push({
          id: Date.now(),
          title: title,
          points: points,
          priority: priority,
          inSprint: false
        });
        renderBacklogItems();
        updateStats();
        saveToStorage();
      }

      function removeBacklogItem(id) {
        backlogItems = backlogItems.filter((item) => item.id !== id);
        renderBacklogItems();
        updateStats();
        saveToStorage();
      }

      function renderBacklogItems() {
        const container = document.getElementById("backlogItems");
        container.textContent = "";

        backlogItems.forEach((item) => {
          const div = document.createElement("div");
          div.className = "backlog-item";
          if (item.inSprint) div.classList.add("in-sprint");

          const checkWrapper = document.createElement("div");
          checkWrapper.className = "checkbox-wrapper";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = item.inSprint;
          checkbox.addEventListener("change", (e) => {
            item.inSprint = e.target.checked;
            renderBacklogItems();
            updateStats();
            saveToStorage();
          });

          const titleInput = document.createElement("input");
          titleInput.type = "text";
          titleInput.placeholder = "ç”¨æˆ·æ•…äº‹æ ‡é¢˜";
          titleInput.value = item.title;
          titleInput.style.flex = "1";
          titleInput.addEventListener("input", (e) => {
            item.title = e.target.value;
            saveToStorage();
          });

          checkWrapper.appendChild(checkbox);
          checkWrapper.appendChild(titleInput);

          const pointsInput = document.createElement("input");
          pointsInput.type = "number";
          pointsInput.min = "0";
          pointsInput.placeholder = "ç‚¹æ•°";
          pointsInput.value = item.points;
          pointsInput.addEventListener("input", (e) => {
            item.points = parseInt(e.target.value) || 0;
            updateStats();
            saveToStorage();
          });

          const prioritySelect = document.createElement("select");
          ["high", "medium", "low"].forEach((p) => {
            const option = document.createElement("option");
            option.value = p;
            option.textContent = p === "high" ? "é«˜" : p === "medium" ? "ä¸­" : "ä½";
            if (p === item.priority) option.selected = true;
            prioritySelect.appendChild(option);
          });
          prioritySelect.addEventListener("change", (e) => {
            item.priority = e.target.value;
            saveToStorage();
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-danger";
          deleteBtn.textContent = "Ã—";
          deleteBtn.addEventListener("click", () => removeBacklogItem(item.id));

          div.appendChild(checkWrapper);
          div.appendChild(pointsInput);
          div.appendChild(prioritySelect);
          div.appendChild(deleteBtn);

          container.appendChild(div);
        });
      }

      function updateStats() {
        const totalCapacity = teamMembers.reduce((sum, m) => {
          return sum + (m.capacity * m.availability) / 100;
        }, 0);

        const plannedPoints = backlogItems
          .filter((item) => item.inSprint)
          .reduce((sum, item) => sum + item.points, 0);

        const avgVelocity =
          velocityRecords.length > 0
            ? velocityRecords.reduce((sum, r) => sum + r.value, 0) / velocityRecords.length
            : 0;

        const startDate = new Date(document.getElementById("startDate").value);
        const endDate = new Date(document.getElementById("endDate").value);
        const sprintDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

        document.getElementById("totalCapacity").textContent = Math.round(totalCapacity);
        document.getElementById("plannedPoints").textContent = plannedPoints;
        document.getElementById("avgVelocity").textContent = Math.round(avgVelocity);
        document.getElementById("sprintDays").textContent = sprintDays > 0 ? sprintDays : 0;

        const capacityPercent = totalCapacity > 0 ? (plannedPoints / totalCapacity) * 100 : 0;
        document.getElementById("capacityPercent").textContent = Math.round(capacityPercent);

        const progressBar = document.getElementById("capacityProgress");
        progressBar.style.width = Math.min(capacityPercent, 100) + "%";
        progressBar.classList.remove("warning", "danger");
        if (capacityPercent > 100) {
          progressBar.classList.add("danger");
        } else if (capacityPercent > 80) {
          progressBar.classList.add("warning");
        }
      }

      function exportPlan() {
        const sprintName = document.getElementById("sprintName").value || "Sprint";
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;
        const sprintGoal = document.getElementById("sprintGoal").value;

        let text = "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
        text += "        " + sprintName + " è§„åˆ’\n";
        text += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

        text += "ğŸ“… å‘¨æœŸï¼š" + startDate + " ~ " + endDate + "\n";
        if (sprintGoal) text += "ğŸ¯ ç›®æ ‡ï¼š" + sprintGoal + "\n";
        text += "\n";

        text += "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
        text += "             å›¢é˜Ÿå®¹é‡\n";
        text += "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
        teamMembers.forEach((m) => {
          const effectiveCapacity = Math.round((m.capacity * m.availability) / 100);
          text +=
            "â€¢ " +
            (m.name || "æˆå‘˜") +
            ": " +
            effectiveCapacity +
            " ç‚¹ (" +
            m.availability +
            "% å¯ç”¨)\n";
        });
        text += "\n";

        text += "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
        text += "             å†²åˆºå†…å®¹\n";
        text += "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
        const sprintItems = backlogItems.filter((item) => item.inSprint);
        if (sprintItems.length > 0) {
          sprintItems.forEach((item, i) => {
            const priorityLabel =
              item.priority === "high" ? "[é«˜]" : item.priority === "medium" ? "[ä¸­]" : "[ä½]";
            text +=
              i +
              1 +
              ". " +
              (item.title || "ç”¨æˆ·æ•…äº‹") +
              " - " +
              item.points +
              "ç‚¹ " +
              priorityLabel +
              "\n";
          });
        } else {
          text += "(æ— è®¡åˆ’é¡¹ç›®)\n";
        }
        text += "\n";

        const totalCapacity = teamMembers.reduce(
          (sum, m) => sum + (m.capacity * m.availability) / 100,
          0
        );
        const plannedPoints = sprintItems.reduce((sum, item) => sum + item.points, 0);

        text += "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
        text += "æ€»å®¹é‡: " + Math.round(totalCapacity) + " ç‚¹\n";
        text += "è®¡åˆ’ç‚¹æ•°: " + plannedPoints + " ç‚¹\n";
        text +=
          "ä½¿ç”¨ç‡: " +
          Math.round(totalCapacity > 0 ? (plannedPoints / totalCapacity) * 100 : 0) +
          "%\n";
        text += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";

        navigator.clipboard.writeText(text).then(() => {
          showToast("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        });
      }

      function sharePlan() {
        const data = {
          sprintName: document.getElementById("sprintName").value,
          startDate: document.getElementById("startDate").value,
          endDate: document.getElementById("endDate").value,
          sprintGoal: document.getElementById("sprintGoal").value,
          teamMembers: teamMembers,
          backlogItems: backlogItems,
          velocityRecords: velocityRecords
        };
        const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
        const url = window.location.href.split("#")[0] + "#" + encoded;
        navigator.clipboard.writeText(url).then(() => {
          showToast("åˆ†äº«é“¾æ¥å·²å¤åˆ¶");
        });
      }

      function loadFromUrl() {
        const hash = window.location.hash.slice(1);
        if (hash) {
          try {
            const data = JSON.parse(decodeURIComponent(atob(hash)));
            document.getElementById("sprintName").value = data.sprintName || "";
            document.getElementById("startDate").value = data.startDate || "";
            document.getElementById("endDate").value = data.endDate || "";
            document.getElementById("sprintGoal").value = data.sprintGoal || "";
            if (data.teamMembers) teamMembers = data.teamMembers;
            if (data.backlogItems) backlogItems = data.backlogItems;
            if (data.velocityRecords) velocityRecords = data.velocityRecords;
            renderTeamMembers();
            renderBacklogItems();
            renderVelocityRecords();
            updateStats();
          } catch (e) {
            console.error("Failed to load from URL:", e);
          }
        }
      }

      function saveToStorage() {
        const data = {
          sprintName: document.getElementById("sprintName").value,
          startDate: document.getElementById("startDate").value,
          endDate: document.getElementById("endDate").value,
          sprintGoal: document.getElementById("sprintGoal").value,
          teamMembers: teamMembers,
          backlogItems: backlogItems,
          velocityRecords: velocityRecords
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      }

      function loadFromStorage() {
        const saved = localStorage.getItem(LS_KEY);
        if (saved) {
          try {
            const data = JSON.parse(saved);
            document.getElementById("sprintName").value = data.sprintName || "";
            if (data.startDate) document.getElementById("startDate").value = data.startDate;
            if (data.endDate) document.getElementById("endDate").value = data.endDate;
            document.getElementById("sprintGoal").value = data.sprintGoal || "";
            if (data.teamMembers) teamMembers = data.teamMembers;
            if (data.backlogItems) backlogItems = data.backlogItems;
            if (data.velocityRecords) velocityRecords = data.velocityRecords;
            renderTeamMembers();
            renderBacklogItems();
            renderVelocityRecords();
            updateStats();
          } catch (e) {
            console.error("Failed to load from storage:", e);
          }
        }
      }

      function clearAll() {
        if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ")) {
          document.getElementById("sprintName").value = "";
          document.getElementById("sprintGoal").value = "";
          teamMembers = [];
          backlogItems = [];
          velocityRecords = [];
          addTeamMember("æˆå‘˜1", 10, 80);
          addBacklogItem();
          addVelocityRecord();
          localStorage.removeItem(LS_KEY);
          window.location.hash = "";
        }
      }

      function showToast(message) {
        const toast = document.createElement("div");
        toast.style.cssText =
          "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent-color);color:#000;padding:12px 24px;border-radius:8px;z-index:1000;font-size:14px;";
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
      }

      window.toggleTheme = function () {
        const body = document.body;
        const currentTheme = body.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        body.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      };

      init();
    </script>
  </body>
</html>

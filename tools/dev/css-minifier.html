<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS ä»£ç å‹ç¼©å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --editor-height: 400px;
        }
        .container {
            max-width: 1400px;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
        }
        .editor-panel {
            display: flex;
            flex-direction: column;
        }
        .editor-panel label {
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        textarea {
            height: var(--editor-height);
            font-family: Consolas, Monaco, monospace;
            font-size: 13px;
            resize: vertical;
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        .button-group button {
            margin: 0;
        }
        .options-panel {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
        }
        .options-panel label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
            cursor: pointer;
        }
        .options-panel input[type="checkbox"] {
            margin: 0;
        }
        .stats {
            font-size: 0.875rem;
            color: var(--pico-muted-color);
            margin-top: 0.5rem;
        }
        .stats-highlight {
            background: var(--pico-primary-background);
            color: var(--pico-primary-inverse);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin-left: 0.5rem;
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .compression-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
        }
        .info-item {
            text-align: center;
        }
        .info-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--pico-primary);
        }
        .info-item .label {
            font-size: 0.875rem;
            color: var(--pico-muted-color);
        }
        .savings-positive {
            color: var(--pico-ins-color);
        }
        .savings-negative {
            color: var(--pico-del-color);
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>CSS ä»£ç å‹ç¼©å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        </header>

        <div class="options-panel">
            <label>
                <input type="checkbox" id="opt-remove-comments" checked>
                ç§»é™¤æ³¨é‡Š
            </label>
            <label>
                <input type="checkbox" id="opt-remove-whitespace" checked>
                ç§»é™¤ç©ºç™½
            </label>
            <label>
                <input type="checkbox" id="opt-remove-semicolon" checked>
                ç§»é™¤æœ«å°¾åˆ†å·
            </label>
            <label>
                <input type="checkbox" id="opt-shorten-colors" checked>
                ç®€åŒ–é¢œè‰²å€¼
            </label>
            <label>
                <input type="checkbox" id="opt-shorten-zero" checked>
                ç®€åŒ–é›¶å€¼
            </label>
            <label>
                <input type="checkbox" id="opt-merge-selectors">
                åˆå¹¶ç›¸åŒé€‰æ‹©å™¨
            </label>
        </div>

        <div class="compression-info">
            <div class="info-item">
                <div class="value" id="original-size">0</div>
                <div class="label">åŸå§‹å¤§å° (bytes)</div>
            </div>
            <div class="info-item">
                <div class="value" id="minified-size">0</div>
                <div class="label">å‹ç¼©å (bytes)</div>
            </div>
            <div class="info-item">
                <div class="value savings-positive" id="savings">0%</div>
                <div class="label">èŠ‚çœç©ºé—´</div>
            </div>
            <div class="info-item">
                <div class="value" id="gzip-estimate">0</div>
                <div class="label">Gzip ä¼°ç®— (bytes)</div>
            </div>
        </div>

        <div class="editor-container">
            <div class="editor-panel">
                <label for="css-input">CSS è¾“å…¥</label>
                <textarea id="css-input" placeholder="åœ¨æ­¤è¾“å…¥ CSS ä»£ç ...">/* ä¸»å®¹å™¨æ ·å¼ */
.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
    background-color: #ffffff;
    border-bottom: 1px solid #eeeeee;
    padding: 15px 0;
}

.header .logo {
    font-size: 24px;
    font-weight: bold;
    color: #333333;
}

/* å¯¼èˆªæ ·å¼ */
.nav {
    display: flex;
    gap: 20px;
}

.nav-link {
    color: #666666;
    text-decoration: none;
    padding: 10px 15px;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.nav-link:hover {
    background-color: #f5f5f5;
    color: #000000;
}

.nav-link.active {
    background-color: #007bff;
    color: #ffffff;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
    display: inline-block;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
}

.btn-primary {
    background-color: #007bff;
    color: #ffffff;
}

.btn-primary:hover {
    background-color: #0056b3;
}

/* å“åº”å¼ */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .nav {
        flex-direction: column;
        gap: 10px;
    }
}</textarea>
                <div class="stats" id="input-stats">è¡Œæ•°: 0 | é€‰æ‹©å™¨: 0 | å±æ€§: 0</div>
            </div>

            <div class="editor-panel">
                <label for="css-output">å‹ç¼©åçš„ CSS</label>
                <textarea id="css-output" readonly placeholder="å‹ç¼©åçš„ CSS å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                <div class="stats" id="output-stats">è¡Œæ•°: 0</div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="minifyCSS()">å‹ç¼©</button>
            <button class="secondary" onclick="beautifyCSS()">ç¾åŒ–</button>
            <button class="secondary" onclick="copyCSS()">å¤åˆ¶ç»“æœ</button>
            <button class="secondary" onclick="downloadCSS()">ä¸‹è½½æ–‡ä»¶</button>
            <button class="secondary" onclick="clearAll()">æ¸…ç©º</button>
            <button class="secondary" onclick="loadSample()">åŠ è½½ç¤ºä¾‹</button>
        </div>

        <details>
            <summary>å‹ç¼©é€‰é¡¹è¯´æ˜</summary>
            <ul>
                <li><strong>ç§»é™¤æ³¨é‡Š</strong> - åˆ é™¤æ‰€æœ‰ CSS æ³¨é‡Š (/* ... */)</li>
                <li><strong>ç§»é™¤ç©ºç™½</strong> - åˆ é™¤ä¸å¿…è¦çš„ç©ºæ ¼ã€æ¢è¡Œå’Œåˆ¶è¡¨ç¬¦</li>
                <li><strong>ç§»é™¤æœ«å°¾åˆ†å·</strong> - åˆ é™¤è§„åˆ™å—æœ€åä¸€ä¸ªå£°æ˜çš„åˆ†å·</li>
                <li><strong>ç®€åŒ–é¢œè‰²å€¼</strong> - å°† #ffffff è½¬æ¢ä¸º #fffï¼Œrgb() è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li>
                <li><strong>ç®€åŒ–é›¶å€¼</strong> - å°† 0px, 0em ç­‰è½¬æ¢ä¸º 0</li>
                <li><strong>åˆå¹¶ç›¸åŒé€‰æ‹©å™¨</strong> - åˆå¹¶å…·æœ‰ç›¸åŒé€‰æ‹©å™¨çš„è§„åˆ™å—</li>
            </ul>
        </details>
    </main>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        window.toggleTheme = function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        };

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // CSS å‹ç¼©
        function minifyCSS() {
            let css = document.getElementById('css-input').value;
            const originalSize = new Blob([css]).size;
            
            const removeComments = document.getElementById('opt-remove-comments').checked;
            const removeWhitespace = document.getElementById('opt-remove-whitespace').checked;
            const removeSemicolon = document.getElementById('opt-remove-semicolon').checked;
            const shortenColors = document.getElementById('opt-shorten-colors').checked;
            const shortenZero = document.getElementById('opt-shorten-zero').checked;
            const mergeSelectors = document.getElementById('opt-merge-selectors').checked;
            
            // ç§»é™¤æ³¨é‡Š
            if (removeComments) {
                css = css.replace(/\/\*[\s\S]*?\*\//g, '');
            }
            
            // ç®€åŒ–é¢œè‰²å€¼
            if (shortenColors) {
                // #ffffff -> #fff
                css = css.replace(/#([0-9a-fA-F])\1([0-9a-fA-F])\2([0-9a-fA-F])\3/gi, '#$1$2$3');
                
                // rgb(255, 255, 255) -> #fff
                css = css.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi, (match, r, g, b) => {
                    const hex = '#' + [r, g, b].map(x => {
                        const h = parseInt(x).toString(16);
                        return h.length === 1 ? '0' + h : h;
                    }).join('');
                    // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç®€åŒ–
                    if (hex[1] === hex[2] && hex[3] === hex[4] && hex[5] === hex[6]) {
                        return '#' + hex[1] + hex[3] + hex[5];
                    }
                    return hex;
                });
            }
            
            // ç®€åŒ–é›¶å€¼
            if (shortenZero) {
                css = css.replace(/\b0(px|em|rem|%|pt|pc|in|cm|mm|ex|ch|vw|vh|vmin|vmax)\b/gi, '0');
                css = css.replace(/\b0\.(\d)/g, '.$1');
            }
            
            // ç§»é™¤ç©ºç™½
            if (removeWhitespace) {
                css = css.replace(/\s+/g, ' ');
                css = css.replace(/\s*{\s*/g, '{');
                css = css.replace(/\s*}\s*/g, '}');
                css = css.replace(/\s*;\s*/g, ';');
                css = css.replace(/\s*:\s*/g, ':');
                css = css.replace(/\s*,\s*/g, ',');
                css = css.replace(/\s*>\s*/g, '>');
                css = css.replace(/\s*~\s*/g, '~');
                css = css.replace(/\s*\+\s*/g, '+');
                css = css.trim();
            }
            
            // ç§»é™¤æœ«å°¾åˆ†å·
            if (removeSemicolon) {
                css = css.replace(/;}/g, '}');
            }
            
            // åˆå¹¶ç›¸åŒé€‰æ‹©å™¨
            if (mergeSelectors) {
                const rules = {};
                const ruleRegex = /([^{}]+){([^{}]*)}/g;
                let match;
                const orderedSelectors = [];
                
                while ((match = ruleRegex.exec(css)) !== null) {
                    const selector = match[1].trim();
                    const declarations = match[2].trim();
                    
                    // è·³è¿‡ @è§„åˆ™
                    if (selector.startsWith('@')) {
                        orderedSelectors.push({ selector, declarations, isAtRule: true });
                    } else {
                        if (!rules[selector]) {
                            rules[selector] = [];
                            orderedSelectors.push({ selector, isAtRule: false });
                        }
                        rules[selector].push(declarations);
                    }
                }
                
                css = orderedSelectors.map(item => {
                    if (item.isAtRule) {
                        return `${item.selector}{${item.declarations}}`;
                    }
                    const merged = rules[item.selector].join(';');
                    delete rules[item.selector]; // é˜²æ­¢é‡å¤
                    return merged ? `${item.selector}{${merged}}` : '';
                }).filter(Boolean).join('');
            }
            
            document.getElementById('css-output').value = css;
            
            // æ›´æ–°ç»Ÿè®¡
            const minifiedSize = new Blob([css]).size;
            const savings = originalSize > 0 ? ((1 - minifiedSize / originalSize) * 100).toFixed(1) : 0;
            const gzipEstimate = Math.round(minifiedSize * 0.3); // ç²—ç•¥ä¼°ç®—
            
            document.getElementById('original-size').textContent = originalSize.toLocaleString();
            document.getElementById('minified-size').textContent = minifiedSize.toLocaleString();
            document.getElementById('savings').textContent = savings + '%';
            document.getElementById('savings').className = 'value ' + (savings >= 0 ? 'savings-positive' : 'savings-negative');
            document.getElementById('gzip-estimate').textContent = gzipEstimate.toLocaleString();
            
            updateStats();
        }

        // CSS ç¾åŒ–
        window.beautifyCSS = function() {
            let css = document.getElementById('css-input').value;
            
            // ç§»é™¤å¤šä½™ç©ºç™½
            css = css.replace(/\s+/g, ' ');
            
            // åœ¨ { åæ·»åŠ æ¢è¡Œ
            css = css.replace(/\s*{\s*/g, ' {\n  ');
            
            // åœ¨ } åæ·»åŠ æ¢è¡Œ
            css = css.replace(/\s*}\s*/g, '\n}\n\n');
            
            // åœ¨ ; åæ·»åŠ æ¢è¡Œ
            css = css.replace(/;\s*/g, ';\n  ');
            
            // ä¿®å¤ç¼©è¿›
            css = css.replace(/\n {2}}/g, '\n}');
            
            // ç§»é™¤å¤šä½™æ¢è¡Œ
            css = css.replace(/\n{3,}/g, '\n\n');
            
            css = css.trim();
            
            document.getElementById('css-output').value = css;
            updateStats();
            
            // é‡ç½®å‹ç¼©ç»Ÿè®¡
            const size = new Blob([css]).size;
            document.getElementById('original-size').textContent = new Blob([document.getElementById('css-input').value]).size.toLocaleString();
            document.getElementById('minified-size').textContent = size.toLocaleString();
            document.getElementById('savings').textContent = '0%';
            document.getElementById('gzip-estimate').textContent = Math.round(size * 0.3).toLocaleString();
        };

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const input = document.getElementById('css-input').value;
            const output = document.getElementById('css-output').value;
            
            // ç»Ÿè®¡é€‰æ‹©å™¨æ•°é‡
            const selectorCount = (input.match(/[^{}]+(?={)/g) || []).length;
            
            // ç»Ÿè®¡å±æ€§æ•°é‡
            const propertyCount = (input.match(/[^{}:;]+:/g) || []).length;
            
            document.getElementById('input-stats').textContent = 
                `è¡Œæ•°: ${input.split('\n').length} | é€‰æ‹©å™¨: ${selectorCount} | å±æ€§: ${propertyCount}`;
            document.getElementById('output-stats').textContent = 
                `è¡Œæ•°: ${output.split('\n').length}`;
        }

        // å¤åˆ¶
        window.copyCSS = function() {
            const css = document.getElementById('css-output').value;
            navigator.clipboard.writeText(css).then(() => {
                alert('CSS ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                const textarea = document.getElementById('css-output');
                textarea.select();
                document.execCommand('copy');
                alert('CSS ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        };

        // ä¸‹è½½
        window.downloadCSS = function() {
            const css = document.getElementById('css-output').value;
            const blob = new Blob([css], { type: 'text/css;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'styles.min.css';
            a.click();
            URL.revokeObjectURL(url);
        };

        // æ¸…ç©º
        window.clearAll = function() {
            document.getElementById('css-input').value = '';
            document.getElementById('css-output').value = '';
            document.getElementById('original-size').textContent = '0';
            document.getElementById('minified-size').textContent = '0';
            document.getElementById('savings').textContent = '0%';
            document.getElementById('gzip-estimate').textContent = '0';
            updateStats();
        };

        // åŠ è½½ç¤ºä¾‹
        window.loadSample = function() {
            const sample = `/* ==========================================================================
   åŸºç¡€æ ·å¼
   ========================================================================== */

/* é‡ç½®æ ·å¼ */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* æ ¹å…ƒç´  */
:root {
    --primary-color: #007bff;
    --secondary-color: #6c757d;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --warning-color: #ffc107;
    --info-color: #17a2b8;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --font-size-base: 16px;
    --line-height-base: 1.5;
}

/* é¡µé¢ä¸»ä½“ */
body {
    font-family: var(--font-family);
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    color: #333333;
    background-color: #ffffff;
}

/* ==========================================================================
   å¸ƒå±€ç»„ä»¶
   ========================================================================== */

/* å®¹å™¨ */
.container {
    width: 100%;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    padding-left: 15px;
    padding-right: 15px;
}

/* ç½‘æ ¼ç³»ç»Ÿ */
.row {
    display: flex;
    flex-wrap: wrap;
    margin-left: -15px;
    margin-right: -15px;
}

.col {
    flex: 1;
    padding-left: 15px;
    padding-right: 15px;
}

/* ==========================================================================
   æŒ‰é’®ç»„ä»¶
   ========================================================================== */

.btn {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    text-align: center;
    text-decoration: none;
    vertical-align: middle;
    cursor: pointer;
    border: 1px solid transparent;
    border-radius: 0.25rem;
    transition: color 0.15s ease-in-out, 
                background-color 0.15s ease-in-out, 
                border-color 0.15s ease-in-out, 
                box-shadow 0.15s ease-in-out;
}

.btn-primary {
    color: #ffffff;
    background-color: #007bff;
    border-color: #007bff;
}

.btn-primary:hover {
    color: #ffffff;
    background-color: #0069d9;
    border-color: #0062cc;
}

.btn-secondary {
    color: #ffffff;
    background-color: #6c757d;
    border-color: #6c757d;
}

/* ==========================================================================
   å“åº”å¼è®¾è®¡
   ========================================================================== */

@media (max-width: 992px) {
    .container {
        max-width: 960px;
    }
}

@media (max-width: 768px) {
    .container {
        max-width: 720px;
    }
    
    .row {
        flex-direction: column;
    }
    
    .col {
        flex: none;
        width: 100%;
    }
}

@media (max-width: 576px) {
    .container {
        max-width: 540px;
    }
    
    .btn {
        display: block;
        width: 100%;
    }
}`;
            document.getElementById('css-input').value = sample;
            minifyCSS();
        };

        // å®æ—¶æ›´æ–°ç»Ÿè®¡
        document.getElementById('css-input').addEventListener('input', updateStats);

        // åˆå§‹åŒ–
        loadTheme();
        minifyCSS();
    </script>
</body>
</html>

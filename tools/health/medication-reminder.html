<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>服药提醒器 - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #6366f1; --accent2: #8b5cf6; --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text2); }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); }
        textarea { resize: vertical; min-height: 60px; }
        button { padding: 12px 24px; border: none; border-radius: 8px; background: var(--accent); color: white; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        button.secondary { background: var(--border); color: var(--text); }
        button.danger { background: var(--danger); }
        .time-slots { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
        .time-slot { display: flex; align-items: center; gap: 4px; padding: 6px 12px; background: var(--bg); border-radius: 6px; }
        .time-slot input { width: 80px; padding: 6px; }
        .time-slot .remove { background: none; border: none; color: var(--danger); cursor: pointer; padding: 4px; }
        .add-time { padding: 6px 12px; font-size: 0.9rem; }
        .med-list { margin-top: 16px; }
        .med-item { padding: 16px; background: var(--bg); border-radius: 12px; margin-bottom: 12px; border-left: 4px solid var(--accent); }
        .med-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .med-name { font-weight: 600; font-size: 1.1rem; }
        .med-actions { display: flex; gap: 8px; }
        .med-actions button { padding: 6px 12px; font-size: 0.8rem; }
        .med-details { font-size: 0.9rem; color: var(--text2); }
        .med-times { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        .med-time { padding: 4px 10px; background: var(--card); border-radius: 4px; font-size: 0.85rem; }
        .today-section { margin-top: 20px; }
        .reminder-item { display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--bg); border-radius: 12px; margin-bottom: 12px; }
        .reminder-item.done { opacity: 0.5; }
        .reminder-time { font-size: 1.3rem; font-weight: 700; color: var(--accent); min-width: 60px; }
        .reminder-info { flex: 1; }
        .reminder-name { font-weight: 600; }
        .reminder-dose { font-size: 0.85rem; color: var(--text2); }
        .reminder-check { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .reminder-check.checked { background: var(--success); border-color: var(--success); color: white; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat { padding: 16px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; text-align: center; }
        .stat .value { font-size: 1.8rem; font-weight: 700; color: var(--accent); }
        .stat .label { font-size: 0.8rem; color: var(--text2); margin-top: 4px; }
        .empty-state { text-align: center; padding: 40px; color: var(--text2); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: var(--card); border-radius: 16px; padding: 24px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 16px; }
        .note { margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px; font-size: 0.85rem; color: var(--text2); }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← 返回</a>
        <h1>服药提醒器</h1>
        <p class="subtitle">管理药物服用计划，按时服药</p>
        
        <div class="stats">
            <div class="stat">
                <div class="value" id="totalMeds">0</div>
                <div class="label">药物总数</div>
            </div>
            <div class="stat">
                <div class="value" id="todayDone">0</div>
                <div class="label">今日已服</div>
            </div>
            <div class="stat">
                <div class="value" id="todayRemaining">0</div>
                <div class="label">今日待服</div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">
                    <span>今日服药计划</span>
                    <span style="font-size: 0.85rem; color: var(--text2);" id="todayDate"></span>
                </div>
                <div id="todayReminders"></div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <span>我的药物</span>
                    <button onclick="showAddModal()" style="padding: 8px 16px; font-size: 0.9rem;">+ 添加</button>
                </div>
                <div class="med-list" id="medList"></div>
            </div>
        </div>
        
        <div class="note">
            本工具仅作为服药提醒辅助，不构成医疗建议。请严格按照医嘱服药，如有疑问请咨询医生或药师。
        </div>
    </div>
    
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">添加药物</div>
            <div class="form-group">
                <label>药物名称</label>
                <input type="text" id="medName" placeholder="如：阿司匹林">
            </div>
            <div class="form-group">
                <label>剂量</label>
                <input type="text" id="medDose" placeholder="如：100mg / 1片">
            </div>
            <div class="form-group">
                <label>服用频率</label>
                <select id="medFrequency" onchange="updateTimeSlots()">
                    <option value="1">每日1次</option>
                    <option value="2">每日2次</option>
                    <option value="3">每日3次</option>
                    <option value="4">每日4次</option>
                    <option value="custom">自定义</option>
                </select>
            </div>
            <div class="form-group">
                <label>服药时间</label>
                <div class="time-slots" id="timeSlots"></div>
                <button class="secondary add-time" onclick="addTimeSlot()" style="margin-top: 8px;">+ 添加时间</button>
            </div>
            <div class="form-group">
                <label>备注（可选）</label>
                <textarea id="medNotes" placeholder="如：饭后服用、不能与XX同服"></textarea>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 20px;">
                <button onclick="saveMed()" style="flex: 1;">保存</button>
                <button class="secondary" onclick="hideAddModal()" style="flex: 1;">取消</button>
            </div>
        </div>
    </div>
    
    <script>
        const LS_KEY = 'medications';
        const LOG_KEY = 'med_logs';
        let medications = [];
        let logs = {};
        let editIndex = -1;
        let timeSlots = ['08:00'];
        
        function loadData() {
            const savedMeds = localStorage.getItem(LS_KEY);
            if (savedMeds) medications = JSON.parse(savedMeds);
            
            const savedLogs = localStorage.getItem(LOG_KEY);
            if (savedLogs) logs = JSON.parse(savedLogs);
            
            // 清理过期日志（保留7天）
            const cutoff = new Date();
            cutoff.setDate(cutoff.getDate() - 7);
            const cutoffStr = cutoff.toISOString().split('T')[0];
            Object.keys(logs).forEach(date => {
                if (date < cutoffStr) delete logs[date];
            });
            saveData();
            
            render();
        }
        
        function saveData() {
            localStorage.setItem(LS_KEY, JSON.stringify(medications));
            localStorage.setItem(LOG_KEY, JSON.stringify(logs));
        }
        
        function showAddModal(index = -1) {
            editIndex = index;
            document.getElementById('modalTitle').textContent = index >= 0 ? '编辑药物' : '添加药物';
            
            if (index >= 0) {
                const med = medications[index];
                document.getElementById('medName').value = med.name;
                document.getElementById('medDose').value = med.dose;
                document.getElementById('medFrequency').value = med.times.length <= 4 ? med.times.length : 'custom';
                document.getElementById('medNotes').value = med.notes || '';
                timeSlots = [...med.times];
            } else {
                document.getElementById('medName').value = '';
                document.getElementById('medDose').value = '';
                document.getElementById('medFrequency').value = '1';
                document.getElementById('medNotes').value = '';
                timeSlots = ['08:00'];
            }
            
            renderTimeSlots();
            document.getElementById('addModal').classList.add('show');
        }
        
        function hideAddModal() {
            document.getElementById('addModal').classList.remove('show');
            editIndex = -1;
        }
        
        function updateTimeSlots() {
            const freq = document.getElementById('medFrequency').value;
            if (freq !== 'custom') {
                const count = parseInt(freq);
                const defaultTimes = {
                    1: ['08:00'],
                    2: ['08:00', '20:00'],
                    3: ['08:00', '14:00', '20:00'],
                    4: ['08:00', '12:00', '18:00', '22:00']
                };
                timeSlots = defaultTimes[count] || ['08:00'];
                renderTimeSlots();
            }
        }
        
        function renderTimeSlots() {
            const container = document.getElementById('timeSlots');
            container.textContent = '';
            
            timeSlots.forEach((time, index) => {
                const div = document.createElement('div');
                div.className = 'time-slot';
                
                const input = document.createElement('input');
                input.type = 'time';
                input.value = time;
                input.onchange = (e) => { timeSlots[index] = e.target.value; };
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove';
                removeBtn.textContent = '×';
                removeBtn.onclick = () => {
                    if (timeSlots.length > 1) {
                        timeSlots.splice(index, 1);
                        renderTimeSlots();
                    }
                };
                
                div.appendChild(input);
                div.appendChild(removeBtn);
                container.appendChild(div);
            });
        }
        
        function addTimeSlot() {
            timeSlots.push('12:00');
            document.getElementById('medFrequency').value = 'custom';
            renderTimeSlots();
        }
        
        function saveMed() {
            const name = document.getElementById('medName').value.trim();
            const dose = document.getElementById('medDose').value.trim();
            const notes = document.getElementById('medNotes').value.trim();
            
            if (!name) {
                alert('请输入药物名称');
                return;
            }
            
            const med = {
                name,
                dose,
                times: timeSlots.sort(),
                notes,
                id: editIndex >= 0 ? medications[editIndex].id : Date.now()
            };
            
            if (editIndex >= 0) {
                medications[editIndex] = med;
            } else {
                medications.push(med);
            }
            
            saveData();
            hideAddModal();
            render();
        }
        
        function deleteMed(index) {
            if (confirm('确定要删除这个药物吗？')) {
                medications.splice(index, 1);
                saveData();
                render();
            }
        }
        
        function toggleReminder(medId, time) {
            const today = new Date().toISOString().split('T')[0];
            if (!logs[today]) logs[today] = {};
            
            const key = medId + '_' + time;
            logs[today][key] = !logs[today][key];
            
            saveData();
            render();
        }
        
        function render() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('todayDate').textContent = today;
            
            // 渲染药物列表
            const medList = document.getElementById('medList');
            medList.textContent = '';
            
            if (medications.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.textContent = '还没有添加药物，点击"添加"开始';
                medList.appendChild(empty);
            } else {
                medications.forEach((med, index) => {
                    const div = document.createElement('div');
                    div.className = 'med-item';
                    
                    const header = document.createElement('div');
                    header.className = 'med-header';
                    
                    const name = document.createElement('div');
                    name.className = 'med-name';
                    name.textContent = med.name;
                    
                    const actions = document.createElement('div');
                    actions.className = 'med-actions';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'secondary';
                    editBtn.textContent = '编辑';
                    editBtn.onclick = () => showAddModal(index);
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'danger';
                    deleteBtn.textContent = '删除';
                    deleteBtn.onclick = () => deleteMed(index);
                    
                    actions.appendChild(editBtn);
                    actions.appendChild(deleteBtn);
                    header.appendChild(name);
                    header.appendChild(actions);
                    
                    const details = document.createElement('div');
                    details.className = 'med-details';
                    details.textContent = med.dose + (med.notes ? ' · ' + med.notes : '');
                    
                    const times = document.createElement('div');
                    times.className = 'med-times';
                    med.times.forEach(time => {
                        const span = document.createElement('span');
                        span.className = 'med-time';
                        span.textContent = time;
                        times.appendChild(span);
                    });
                    
                    div.appendChild(header);
                    div.appendChild(details);
                    div.appendChild(times);
                    medList.appendChild(div);
                });
            }
            
            // 渲染今日提醒
            const todayReminders = document.getElementById('todayReminders');
            todayReminders.textContent = '';
            
            const reminders = [];
            medications.forEach(med => {
                med.times.forEach(time => {
                    reminders.push({
                        medId: med.id,
                        name: med.name,
                        dose: med.dose,
                        time: time,
                        done: logs[today] && logs[today][med.id + '_' + time]
                    });
                });
            });
            
            reminders.sort((a, b) => a.time.localeCompare(b.time));
            
            if (reminders.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.textContent = '今日没有服药计划';
                todayReminders.appendChild(empty);
            } else {
                reminders.forEach(reminder => {
                    const div = document.createElement('div');
                    div.className = 'reminder-item' + (reminder.done ? ' done' : '');
                    
                    const time = document.createElement('div');
                    time.className = 'reminder-time';
                    time.textContent = reminder.time;
                    
                    const info = document.createElement('div');
                    info.className = 'reminder-info';
                    
                    const name = document.createElement('div');
                    name.className = 'reminder-name';
                    name.textContent = reminder.name;
                    
                    const dose = document.createElement('div');
                    dose.className = 'reminder-dose';
                    dose.textContent = reminder.dose;
                    
                    info.appendChild(name);
                    info.appendChild(dose);
                    
                    const check = document.createElement('div');
                    check.className = 'reminder-check' + (reminder.done ? ' checked' : '');
                    check.textContent = reminder.done ? '✓' : '';
                    check.onclick = () => toggleReminder(reminder.medId, reminder.time);
                    
                    div.appendChild(time);
                    div.appendChild(info);
                    div.appendChild(check);
                    todayReminders.appendChild(div);
                });
            }
            
            // 更新统计
            document.getElementById('totalMeds').textContent = medications.length;
            document.getElementById('todayDone').textContent = reminders.filter(r => r.done).length;
            document.getElementById('todayRemaining').textContent = reminders.filter(r => !r.done).length;
        }
        
        loadData();
    </script>
</body>
</html>

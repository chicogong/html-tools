<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åé¦ˆè¡¨å•ç”Ÿæˆå™¨ - WebUtils</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #e0e0e0;
            --primary-color: #0f3460;
            --accent-color: #00d9ff;
            --border-color: #0f3460;
            --input-bg: #1a1a2e;
            --success-color: #4ade80;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
        }

        [data-theme="light"] {
            --bg-color: #f0f4f8;
            --card-bg: #fff;
            --text-color: #1a1a2e;
            --primary-color: #e0e7ff;
            --accent-color: #0891b2;
            --border-color: #c7d2fe;
            --input-bg: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-color), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            position: absolute;
            right: 0;
            top: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
        }

        .back-link {
            position: absolute;
            left: 0;
            top: 0;
            color: var(--accent-color);
            text-decoration: none;
            font-size: 14px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--accent-color);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--primary-color);
            color: var(--text-color);
        }

        .btn-danger {
            background: transparent;
            color: var(--danger-color);
            padding: 6px 10px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .template-btn {
            padding: 15px;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-btn:hover {
            border-color: var(--accent-color);
        }

        .template-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .template-name {
            font-size: 13px;
            font-weight: 500;
        }

        .question-item {
            padding: 15px;
            background: var(--input-bg);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-color);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }

        .question-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent-color);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            flex-shrink: 0;
        }

        .question-content {
            flex: 1;
        }

        .question-input {
            width: 100%;
            padding: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .question-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .question-settings {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .question-settings select {
            padding: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 13px;
        }

        .question-settings label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .options-list {
            margin-top: 10px;
        }

        .option-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 6px;
        }

        .option-row input {
            flex: 1;
            padding: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 13px;
        }

        .preview-container {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 30px;
            min-height: 400px;
        }

        .preview-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .preview-title {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 10px;
        }

        .preview-description {
            text-align: center;
            opacity: 0.7;
            margin-bottom: 30px;
        }

        .preview-question {
            margin-bottom: 25px;
        }

        .preview-question-label {
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            gap: 5px;
        }

        .required-mark {
            color: var(--danger-color);
        }

        .preview-input {
            width: 100%;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
        }

        .preview-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
            resize: vertical;
        }

        .preview-radio,
        .preview-checkbox {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .preview-radio label,
        .preview-checkbox label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .preview-rating {
            display: flex;
            gap: 10px;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .rating-btn:hover,
        .rating-btn.selected {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: #000;
        }

        .preview-nps {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .nps-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .nps-btn:hover,
        .nps-btn.selected {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: #000;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
        }

        .tab.active {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }

        .code-preview {
            background: var(--input-bg);
            border-radius: 8px;
            padding: 20px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
            <h1>åé¦ˆè¡¨å•ç”Ÿæˆå™¨</h1>
            <p>å¿«é€Ÿåˆ›å»ºå›¢é˜Ÿåé¦ˆå’Œè°ƒæŸ¥è¡¨å•</p>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ¢ä¸»é¢˜</button>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ¯ å¿«é€Ÿæ¨¡æ¿</div>
            <div class="template-grid">
                <button class="template-btn" onclick="loadTemplate('performance')">
                    <div class="template-icon">ğŸ“Š</div>
                    <div class="template-name">ç»©æ•ˆåé¦ˆ</div>
                </button>
                <button class="template-btn" onclick="loadTemplate('360')">
                    <div class="template-icon">ğŸ”„</div>
                    <div class="template-name">360åº¦è¯„ä¼°</div>
                </button>
                <button class="template-btn" onclick="loadTemplate('meeting')">
                    <div class="template-icon">ğŸ“‹</div>
                    <div class="template-name">ä¼šè®®åé¦ˆ</div>
                </button>
                <button class="template-btn" onclick="loadTemplate('project')">
                    <div class="template-icon">ğŸš€</div>
                    <div class="template-name">é¡¹ç›®å¤ç›˜</div>
                </button>
                <button class="template-btn" onclick="loadTemplate('onboarding')">
                    <div class="template-icon">ğŸ‘‹</div>
                    <div class="template-name">å…¥èŒä½“éªŒ</div>
                </button>
                <button class="template-btn" onclick="loadTemplate('nps')">
                    <div class="template-icon">â­</div>
                    <div class="template-name">NPSè°ƒæŸ¥</div>
                </button>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ“ è¡¨å•ä¿¡æ¯</div>
            <div class="form-group">
                <label>è¡¨å•æ ‡é¢˜</label>
                <input type="text" id="formTitle" placeholder="ä¾‹å¦‚ï¼šå›¢é˜Ÿæ»¡æ„åº¦è°ƒæŸ¥" onchange="updatePreview(); saveToStorage();" />
            </div>
            <div class="form-group">
                <label>è¡¨å•æè¿°</label>
                <textarea id="formDescription" rows="2" placeholder="ç®€è¦è¯´æ˜è¿™ä¸ªè¡¨å•çš„ç›®çš„..." onchange="updatePreview(); saveToStorage();"></textarea>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">â“ é—®é¢˜åˆ—è¡¨</div>
            <div id="questionsList"></div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="addQuestion()">+ æ·»åŠ é—®é¢˜</button>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ‘ï¸ é¢„è§ˆä¸å¯¼å‡º</div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('preview', this)">é¢„è§ˆ</button>
                <button class="tab" onclick="switchTab('html', this)">HTML</button>
                <button class="tab" onclick="switchTab('markdown', this)">Markdown</button>
                <button class="tab" onclick="switchTab('json', this)">JSON</button>
            </div>
            <div id="previewContent"></div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶</button>
                <button class="btn btn-secondary" onclick="downloadOutput()">ğŸ’¾ ä¸‹è½½</button>
                <button class="btn btn-secondary" onclick="shareLink()">ğŸ”— åˆ†äº«</button>
            </div>
        </div>
    </div>

    <script>
        var LS_KEY = 'feedback-form-data';
        var questions = [];
        var currentTab = 'preview';

        var questionTypes = [
            { value: 'text', label: 'å•è¡Œæ–‡æœ¬' },
            { value: 'textarea', label: 'å¤šè¡Œæ–‡æœ¬' },
            { value: 'radio', label: 'å•é€‰' },
            { value: 'checkbox', label: 'å¤šé€‰' },
            { value: 'rating', label: 'è¯„åˆ† (1-5)' },
            { value: 'nps', label: 'NPS (0-10)' }
        ];

        function init() {
            var savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.setAttribute('data-theme', 'light');
            }

            loadFromUrl() || loadFromStorage();
            
            if (questions.length === 0) {
                addQuestion();
            }

            renderQuestions();
            updatePreview();
        }

        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function addQuestion(text, type, required, options) {
            questions.push({
                id: generateId(),
                text: text || '',
                type: type || 'text',
                required: required !== undefined ? required : true,
                options: options || ['é€‰é¡¹1', 'é€‰é¡¹2', 'é€‰é¡¹3']
            });
            renderQuestions();
            updatePreview();
            saveToStorage();
        }

        function removeQuestion(id) {
            questions = questions.filter(function(q) { return q.id !== id; });
            renderQuestions();
            updatePreview();
            saveToStorage();
        }

        function createTypeSelect(question) {
            var select = document.createElement('select');
            questionTypes.forEach(function(t) {
                var option = document.createElement('option');
                option.value = t.value;
                option.textContent = t.label;
                if (t.value === question.type) option.selected = true;
                select.appendChild(option);
            });
            select.onchange = function() {
                question.type = select.value;
                renderQuestions();
                updatePreview();
                saveToStorage();
            };
            return select;
        }

        function renderQuestions() {
            var container = document.getElementById('questionsList');
            container.textContent = '';

            questions.forEach(function(question, index) {
                var div = document.createElement('div');
                div.className = 'question-item';

                var header = document.createElement('div');
                header.className = 'question-header';

                var number = document.createElement('div');
                number.className = 'question-number';
                number.textContent = index + 1;

                var content = document.createElement('div');
                content.className = 'question-content';

                var textInput = document.createElement('input');
                textInput.type = 'text';
                textInput.className = 'question-input';
                textInput.placeholder = 'è¾“å…¥é—®é¢˜';
                textInput.value = question.text;
                textInput.onchange = function() {
                    question.text = textInput.value;
                    updatePreview();
                    saveToStorage();
                };

                var settings = document.createElement('div');
                settings.className = 'question-settings';

                var typeSelect = createTypeSelect(question);
                
                var requiredLabel = document.createElement('label');
                var requiredCheckbox = document.createElement('input');
                requiredCheckbox.type = 'checkbox';
                requiredCheckbox.checked = question.required;
                requiredCheckbox.onchange = function() {
                    question.required = requiredCheckbox.checked;
                    updatePreview();
                    saveToStorage();
                };
                requiredLabel.appendChild(requiredCheckbox);
                requiredLabel.appendChild(document.createTextNode(' å¿…å¡«'));

                settings.appendChild(typeSelect);
                settings.appendChild(requiredLabel);

                content.appendChild(textInput);
                content.appendChild(settings);

                if (question.type === 'radio' || question.type === 'checkbox') {
                    var optionsList = document.createElement('div');
                    optionsList.className = 'options-list';

                    question.options.forEach(function(opt, optIndex) {
                        var row = document.createElement('div');
                        row.className = 'option-row';

                        var optInput = document.createElement('input');
                        optInput.type = 'text';
                        optInput.value = opt;
                        optInput.placeholder = 'é€‰é¡¹ ' + (optIndex + 1);
                        optInput.onchange = function() {
                            question.options[optIndex] = optInput.value;
                            updatePreview();
                            saveToStorage();
                        };

                        var removeOptBtn = document.createElement('button');
                        removeOptBtn.className = 'btn btn-danger';
                        removeOptBtn.textContent = 'Ã—';
                        removeOptBtn.onclick = function() {
                            if (question.options.length > 2) {
                                question.options.splice(optIndex, 1);
                                renderQuestions();
                                updatePreview();
                                saveToStorage();
                            }
                        };

                        row.appendChild(optInput);
                        row.appendChild(removeOptBtn);
                        optionsList.appendChild(row);
                    });

                    var addOptBtn = document.createElement('button');
                    addOptBtn.className = 'btn btn-secondary';
                    addOptBtn.style.marginTop = '5px';
                    addOptBtn.style.padding = '6px 12px';
                    addOptBtn.style.fontSize = '12px';
                    addOptBtn.textContent = '+ æ·»åŠ é€‰é¡¹';
                    addOptBtn.onclick = function() {
                        question.options.push('é€‰é¡¹ ' + (question.options.length + 1));
                        renderQuestions();
                        updatePreview();
                        saveToStorage();
                    };
                    optionsList.appendChild(addOptBtn);

                    content.appendChild(optionsList);
                }

                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = 'åˆ é™¤';
                deleteBtn.onclick = function() { removeQuestion(question.id); };

                header.appendChild(number);
                header.appendChild(content);
                header.appendChild(deleteBtn);

                div.appendChild(header);
                container.appendChild(div);
            });
        }

        function loadTemplate(type) {
            var templates = {
                performance: {
                    title: 'ç»©æ•ˆåé¦ˆè¡¨',
                    description: 'è¯·å¯¹å›¢é˜Ÿæˆå‘˜çš„å·¥ä½œè¡¨ç°è¿›è¡Œè¯„ä»·',
                    questions: [
                        { text: 'è¢«è¯„ä»·äººå§“å', type: 'text', required: true },
                        { text: 'å·¥ä½œè´¨é‡è¯„åˆ†', type: 'rating', required: true },
                        { text: 'å·¥ä½œæ•ˆç‡è¯„åˆ†', type: 'rating', required: true },
                        { text: 'å›¢é˜Ÿåä½œè¯„åˆ†', type: 'rating', required: true },
                        { text: 'ä¸»è¦ä¼˜ç‚¹', type: 'textarea', required: true },
                        { text: 'æ”¹è¿›å»ºè®®', type: 'textarea', required: false }
                    ]
                },
                '360': {
                    title: '360åº¦åé¦ˆè¯„ä¼°',
                    description: 'å¤šç»´åº¦è¯„ä¼°å›¢é˜Ÿæˆå‘˜è¡¨ç°',
                    questions: [
                        { text: 'ä¸“ä¸šèƒ½åŠ›è¯„åˆ†', type: 'rating', required: true },
                        { text: 'æ²Ÿé€šèƒ½åŠ›è¯„åˆ†', type: 'rating', required: true },
                        { text: 'é¢†å¯¼èƒ½åŠ›è¯„åˆ†', type: 'rating', required: true },
                        { text: 'åˆ›æ–°èƒ½åŠ›è¯„åˆ†', type: 'rating', required: true },
                        { text: 'è¯¥åŒäº‹çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ', type: 'textarea', required: true },
                        { text: 'è¯¥åŒäº‹å¯ä»¥åœ¨å“ªäº›æ–¹é¢æå‡ï¼Ÿ', type: 'textarea', required: true }
                    ]
                },
                meeting: {
                    title: 'ä¼šè®®åé¦ˆè¡¨',
                    description: 'å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ä¼šè®®è´¨é‡',
                    questions: [
                        { text: 'ä¼šè®®ä¸»é¢˜æ˜¯å¦æ¸…æ™°ï¼Ÿ', type: 'radio', required: true, options: ['éå¸¸æ¸…æ™°', 'æ¯”è¾ƒæ¸…æ™°', 'ä¸€èˆ¬', 'ä¸å¤ªæ¸…æ™°'] },
                        { text: 'ä¼šè®®æ—¶é•¿æ˜¯å¦åˆé€‚ï¼Ÿ', type: 'radio', required: true, options: ['å¤ªçŸ­', 'åˆšå¥½', 'ç¨é•¿', 'å¤ªé•¿'] },
                        { text: 'ä¼šè®®æ•ˆç‡è¯„åˆ†', type: 'rating', required: true },
                        { text: 'æ‚¨çš„æ”¶è·å’Œå»ºè®®', type: 'textarea', required: false }
                    ]
                },
                project: {
                    title: 'é¡¹ç›®å¤ç›˜åé¦ˆ',
                    description: 'æ€»ç»“é¡¹ç›®ç»éªŒï¼ŒæŒç»­æ”¹è¿›',
                    questions: [
                        { text: 'é¡¹ç›®æ•´ä½“æ»¡æ„åº¦', type: 'rating', required: true },
                        { text: 'é¡¹ç›®ä¸­åšå¾—å¥½çš„åœ°æ–¹', type: 'checkbox', required: true, options: ['æ²Ÿé€šåä½œ', 'è¿›åº¦ç®¡ç†', 'è´¨é‡æ§åˆ¶', 'é£é™©åº”å¯¹', 'èµ„æºè°ƒé…'] },
                        { text: 'é¡¹ç›®ä¸­å¯ä»¥æ”¹è¿›çš„åœ°æ–¹', type: 'textarea', required: true },
                        { text: 'å­¦åˆ°çš„ç»éªŒæ•™è®­', type: 'textarea', required: true }
                    ]
                },
                onboarding: {
                    title: 'å…¥èŒä½“éªŒè°ƒæŸ¥',
                    description: 'å¸®åŠ©æˆ‘ä»¬æ”¹è¿›æ–°äººå…¥èŒä½“éªŒ',
                    questions: [
                        { text: 'å…¥èŒæµç¨‹æ¸…æ™°åº¦', type: 'rating', required: true },
                        { text: 'å›¢é˜Ÿæ°›å›´è¯„åˆ†', type: 'rating', required: true },
                        { text: 'åŸ¹è®­å†…å®¹å®ç”¨æ€§', type: 'rating', required: true },
                        { text: 'å…¥èŒè¿‡ç¨‹ä¸­é‡åˆ°çš„å›°éš¾', type: 'textarea', required: false },
                        { text: 'æ”¹è¿›å»ºè®®', type: 'textarea', required: false }
                    ]
                },
                nps: {
                    title: 'NPS æ»¡æ„åº¦è°ƒæŸ¥',
                    description: 'æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬éå¸¸é‡è¦',
                    questions: [
                        { text: 'æ‚¨æœ‰å¤šå¤§å¯èƒ½å‘æœ‹å‹æ¨èæˆ‘ä»¬ï¼Ÿ', type: 'nps', required: true },
                        { text: 'æ‚¨æœ€æ»¡æ„çš„æ–¹é¢', type: 'checkbox', required: false, options: ['äº§å“è´¨é‡', 'å®¢æˆ·æœåŠ¡', 'ä»·æ ¼', 'äº¤ä»˜é€Ÿåº¦', 'æŠ€æœ¯æ”¯æŒ'] },
                        { text: 'è¯·å‘Šè¯‰æˆ‘ä»¬åŸå› ', type: 'textarea', required: false }
                    ]
                }
            };

            var template = templates[type];
            if (template) {
                document.getElementById('formTitle').value = template.title;
                document.getElementById('formDescription').value = template.description;
                questions = template.questions.map(function(q) {
                    return {
                        id: generateId(),
                        text: q.text,
                        type: q.type,
                        required: q.required,
                        options: q.options || ['é€‰é¡¹1', 'é€‰é¡¹2', 'é€‰é¡¹3']
                    };
                });
                renderQuestions();
                updatePreview();
                saveToStorage();
                showToast('å·²åŠ è½½æ¨¡æ¿');
            }
        }

        function switchTab(tab, btn) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            btn.classList.add('active');
            updatePreview();
        }

        function updatePreview() {
            var container = document.getElementById('previewContent');
            container.textContent = '';
            
            if (currentTab === 'preview') {
                var previewDiv = document.createElement('div');
                previewDiv.className = 'preview-container';
                previewDiv.id = 'previewContainer';
                container.appendChild(previewDiv);
                renderFormPreview();
            } else {
                var codeDiv = document.createElement('div');
                codeDiv.className = 'code-preview';
                codeDiv.id = 'codePreview';
                
                if (currentTab === 'html') {
                    codeDiv.textContent = generateHTML();
                } else if (currentTab === 'markdown') {
                    codeDiv.textContent = generateMarkdown();
                } else if (currentTab === 'json') {
                    codeDiv.textContent = generateJSON();
                }
                container.appendChild(codeDiv);
            }
        }

        function renderFormPreview() {
            var container = document.getElementById('previewContainer');
            if (!container) return;
            container.textContent = '';

            var form = document.createElement('div');
            form.className = 'preview-form';

            var title = document.createElement('div');
            title.className = 'preview-title';
            title.textContent = document.getElementById('formTitle').value || 'è¡¨å•æ ‡é¢˜';
            form.appendChild(title);

            var desc = document.getElementById('formDescription').value;
            if (desc) {
                var description = document.createElement('div');
                description.className = 'preview-description';
                description.textContent = desc;
                form.appendChild(description);
            }

            questions.forEach(function(question, index) {
                var qDiv = document.createElement('div');
                qDiv.className = 'preview-question';

                var label = document.createElement('div');
                label.className = 'preview-question-label';
                label.textContent = (index + 1) + '. ' + (question.text || 'é—®é¢˜');
                if (question.required) {
                    var mark = document.createElement('span');
                    mark.className = 'required-mark';
                    mark.textContent = ' *';
                    label.appendChild(mark);
                }
                qDiv.appendChild(label);

                if (question.type === 'text') {
                    var input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'preview-input';
                    input.placeholder = 'è¯·è¾“å…¥å›ç­”';
                    qDiv.appendChild(input);
                } else if (question.type === 'textarea') {
                    var textarea = document.createElement('textarea');
                    textarea.className = 'preview-textarea';
                    textarea.placeholder = 'è¯·è¾“å…¥å›ç­”';
                    qDiv.appendChild(textarea);
                } else if (question.type === 'radio') {
                    var radioGroup = document.createElement('div');
                    radioGroup.className = 'preview-radio';
                    question.options.forEach(function(opt) {
                        var radioLabel = document.createElement('label');
                        var radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = 'q_' + question.id;
                        radioLabel.appendChild(radio);
                        radioLabel.appendChild(document.createTextNode(' ' + opt));
                        radioGroup.appendChild(radioLabel);
                    });
                    qDiv.appendChild(radioGroup);
                } else if (question.type === 'checkbox') {
                    var checkGroup = document.createElement('div');
                    checkGroup.className = 'preview-checkbox';
                    question.options.forEach(function(opt) {
                        var checkLabel = document.createElement('label');
                        var checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkLabel.appendChild(checkbox);
                        checkLabel.appendChild(document.createTextNode(' ' + opt));
                        checkGroup.appendChild(checkLabel);
                    });
                    qDiv.appendChild(checkGroup);
                } else if (question.type === 'rating') {
                    var ratingDiv = document.createElement('div');
                    ratingDiv.className = 'preview-rating';
                    for (var i = 1; i <= 5; i++) {
                        var ratingBtn = document.createElement('button');
                        ratingBtn.className = 'rating-btn';
                        ratingBtn.textContent = i;
                        ratingDiv.appendChild(ratingBtn);
                    }
                    qDiv.appendChild(ratingDiv);
                } else if (question.type === 'nps') {
                    var npsDiv = document.createElement('div');
                    npsDiv.className = 'preview-nps';
                    for (var j = 0; j <= 10; j++) {
                        var npsBtn = document.createElement('button');
                        npsBtn.className = 'nps-btn';
                        npsBtn.textContent = j;
                        npsDiv.appendChild(npsBtn);
                    }
                    qDiv.appendChild(npsDiv);
                }

                form.appendChild(qDiv);
            });

            var submitBtn = document.createElement('button');
            submitBtn.className = 'btn btn-primary';
            submitBtn.style.width = '100%';
            submitBtn.style.marginTop = '20px';
            submitBtn.textContent = 'æäº¤åé¦ˆ';
            form.appendChild(submitBtn);

            container.appendChild(form);
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generateHTML() {
            var title = document.getElementById('formTitle').value || 'åé¦ˆè¡¨å•';
            var desc = document.getElementById('formDescription').value;
            
            var lines = [];
            lines.push('<!DOCTYPE html>');
            lines.push('<html lang="zh">');
            lines.push('<head>');
            lines.push('  <meta charset="UTF-8">');
            lines.push('  <meta name="viewport" content="width=device-width, initial-scale=1.0">');
            lines.push('  <title>' + escapeHtml(title) + '</title>');
            lines.push('  <style>');
            lines.push('    body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }');
            lines.push('    h1 { text-align: center; }');
            lines.push('    .question { margin-bottom: 20px; }');
            lines.push('    label { display: block; margin-bottom: 8px; font-weight: 500; }');
            lines.push('    input[type="text"], textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }');
            lines.push('    .required { color: red; }');
            lines.push('    button { width: 100%; padding: 12px; background: #0891b2; color: white; border: none; border-radius: 6px; cursor: pointer; }');
            lines.push('  </style>');
            lines.push('</head>');
            lines.push('<body>');
            lines.push('  <h1>' + escapeHtml(title) + '</h1>');
            if (desc) {
                lines.push('  <p style="text-align:center;color:#666;">' + escapeHtml(desc) + '</p>');
            }
            lines.push('  <form>');
            
            questions.forEach(function(q, i) {
                lines.push('    <div class="question">');
                lines.push('      <label>' + (i + 1) + '. ' + escapeHtml(q.text) + (q.required ? '<span class="required">*</span>' : '') + '</label>');
                
                if (q.type === 'text') {
                    lines.push('      <input type="text" name="q' + (i + 1) + '"' + (q.required ? ' required' : '') + '>');
                } else if (q.type === 'textarea') {
                    lines.push('      <textarea name="q' + (i + 1) + '" rows="3"' + (q.required ? ' required' : '') + '></textarea>');
                } else if (q.type === 'radio') {
                    q.options.forEach(function(opt) {
                        lines.push('      <label><input type="radio" name="q' + (i + 1) + '" value="' + escapeHtml(opt) + '"' + (q.required ? ' required' : '') + '> ' + escapeHtml(opt) + '</label>');
                    });
                } else if (q.type === 'checkbox') {
                    q.options.forEach(function(opt) {
                        lines.push('      <label><input type="checkbox" name="q' + (i + 1) + '" value="' + escapeHtml(opt) + '"> ' + escapeHtml(opt) + '</label>');
                    });
                } else if (q.type === 'rating') {
                    var ratingOptions = ['1-å¾ˆå·®', '2-è¾ƒå·®', '3-ä¸€èˆ¬', '4-è¾ƒå¥½', '5-å¾ˆå¥½'];
                    ratingOptions.forEach(function(opt) {
                        lines.push('      <label><input type="radio" name="q' + (i + 1) + '" value="' + opt.split('-')[0] + '"' + (q.required ? ' required' : '') + '> ' + opt + '</label>');
                    });
                } else if (q.type === 'nps') {
                    lines.push('      <div style="display:flex;gap:5px;">');
                    for (var n = 0; n <= 10; n++) {
                        lines.push('        <label><input type="radio" name="q' + (i + 1) + '" value="' + n + '"' + (q.required ? ' required' : '') + '> ' + n + '</label>');
                    }
                    lines.push('      </div>');
                }
                
                lines.push('    </div>');
            });
            
            lines.push('    <button type="submit">æäº¤åé¦ˆ</button>');
            lines.push('  </form>');
            lines.push('</body>');
            lines.push('</html>');
            
            return lines.join('\n');
        }

        function generateMarkdown() {
            var title = document.getElementById('formTitle').value || 'åé¦ˆè¡¨å•';
            var desc = document.getElementById('formDescription').value;
            
            var lines = [];
            lines.push('# ' + title);
            if (desc) lines.push('\n' + desc + '\n');
            lines.push('---\n');
            
            questions.forEach(function(q, i) {
                lines.push('### ' + (i + 1) + '. ' + q.text + (q.required ? ' *' : ''));
                
                if (q.type === 'text' || q.type === 'textarea') {
                    lines.push('\n_________________________________\n');
                } else if (q.type === 'radio' || q.type === 'checkbox') {
                    q.options.forEach(function(opt) {
                        lines.push('- [ ] ' + opt);
                    });
                    lines.push('');
                } else if (q.type === 'rating') {
                    lines.push('- [ ] 1-å¾ˆå·®  [ ] 2-è¾ƒå·®  [ ] 3-ä¸€èˆ¬  [ ] 4-è¾ƒå¥½  [ ] 5-å¾ˆå¥½\n');
                } else if (q.type === 'nps') {
                    lines.push('0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10\n');
                }
            });
            
            lines.push('---\n*è¡¨å•ç”Ÿæˆäº ' + new Date().toLocaleString() + '*');
            
            return lines.join('\n');
        }

        function generateJSON() {
            var data = {
                title: document.getElementById('formTitle').value || 'åé¦ˆè¡¨å•',
                description: document.getElementById('formDescription').value,
                questions: questions.map(function(q) {
                    var qData = {
                        text: q.text,
                        type: q.type,
                        required: q.required
                    };
                    if (q.type === 'radio' || q.type === 'checkbox') {
                        qData.options = q.options;
                    }
                    return qData;
                }),
                createdAt: new Date().toISOString()
            };
            return JSON.stringify(data, null, 2);
        }

        function copyOutput() {
            var content = '';
            if (currentTab === 'preview') {
                content = generateMarkdown();
            } else {
                var codePreview = document.getElementById('codePreview');
                if (codePreview) content = codePreview.textContent;
            }
            
            navigator.clipboard.writeText(content).then(function() {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        function downloadOutput() {
            var title = document.getElementById('formTitle').value || 'åé¦ˆè¡¨å•';
            var content = '';
            var ext = '';
            
            if (currentTab === 'html') {
                content = generateHTML();
                ext = 'html';
            } else if (currentTab === 'json') {
                content = generateJSON();
                ext = 'json';
            } else {
                content = generateMarkdown();
                ext = 'md';
            }
            
            var blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = title + '.' + ext;
            a.click();
            URL.revokeObjectURL(url);
        }

        function shareLink() {
            var data = {
                title: document.getElementById('formTitle').value,
                description: document.getElementById('formDescription').value,
                questions: questions
            };
            
            try {
                var encoded = btoa(encodeURIComponent(JSON.stringify(data)));
                var url = location.origin + location.pathname + '#' + encoded;
                navigator.clipboard.writeText(url);
                showToast('åˆ†äº«é“¾æ¥å·²å¤åˆ¶');
            } catch (e) {
                showToast('ç”Ÿæˆé“¾æ¥å¤±è´¥');
            }
        }

        function loadFromUrl() {
            var hash = location.hash.slice(1);
            if (!hash) return false;
            try {
                var data = JSON.parse(decodeURIComponent(atob(hash)));
                document.getElementById('formTitle').value = data.title || '';
                document.getElementById('formDescription').value = data.description || '';
                if (data.questions) questions = data.questions;
                return true;
            } catch (e) {
                return false;
            }
        }

        function saveToStorage() {
            var data = {
                title: document.getElementById('formTitle').value,
                description: document.getElementById('formDescription').value,
                questions: questions
            };
            localStorage.setItem(LS_KEY, JSON.stringify(data));
        }

        function loadFromStorage() {
            var saved = localStorage.getItem(LS_KEY);
            if (saved) {
                try {
                    var data = JSON.parse(saved);
                    document.getElementById('formTitle').value = data.title || '';
                    document.getElementById('formDescription').value = data.description || '';
                    if (data.questions) questions = data.questions;
                } catch (e) {
                    console.error('Failed to load from storage');
                }
            }
        }

        function showToast(message) {
            var toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent-color);color:#000;padding:12px 24px;border-radius:8px;z-index:1000;font-size:14px;';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(function() { toast.remove(); }, 2000);
        }

        window.toggleTheme = function() {
            var body = document.body;
            var currentTheme = body.getAttribute('data-theme');
            var newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        };

        init();
    </script>
</body>
</html>

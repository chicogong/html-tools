<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>密码生成器 - WebUtils</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --card-bg: #fff;
      --text: #212529;
      --text-muted: #6c757d;
      --border: #dee2e6;
      --primary: #0d6efd;
      --primary-hover: #0b5ed7;
      --success: #198754;
      --warning: #ffc107;
      --danger: #dc3545;
      --shadow: 0 2px 8px rgba(0,0,0,0.08);
      --radius: 8px;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    h1 {
      font-size: 1.75rem;
      margin: 0 0 8px;
    }
    .desc {
      color: var(--text-muted);
      margin: 0 0 24px;
      font-size: 0.95rem;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    .password-display {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 1.25rem;
      word-break: break-all;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .strength-bar {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .strength-fill {
      height: 100%;
      transition: width 0.3s, background 0.3s;
    }
    .strength-text {
      font-size: 0.85rem;
      margin-bottom: 16px;
    }
    .btn-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 16px;
      font-size: 0.95rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    button.primary {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }
    button.primary:hover {
      background: var(--primary-hover);
      border-color: var(--primary-hover);
      color: #fff;
    }
    .option-group {
      margin-bottom: 16px;
    }
    .option-group label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    .option-group input[type="range"] {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: var(--border);
      border-radius: 4px;
      outline: none;
    }
    .option-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
    }
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    @media (max-width: 500px) {
      .checkbox-group {
        grid-template-columns: 1fr;
      }
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: var(--bg);
      border-radius: var(--radius);
      cursor: pointer;
    }
    .checkbox-item:hover {
      background: #e9ecef;
    }
    .checkbox-item input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .checkbox-item span {
      font-size: 0.9rem;
    }
    .history {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }
    .history h3 {
      font-size: 1rem;
      margin: 0 0 12px;
    }
    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: var(--bg);
      border-radius: var(--radius);
      margin-bottom: 8px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 0.85rem;
    }
    .history-item button {
      padding: 4px 8px;
      font-size: 0.8rem;
    }
    .status {
      font-size: 0.85rem;
      margin-top: 12px;
      min-height: 20px;
    }
    .status.success {
      color: var(--success);
    }
    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    footer a {
      color: var(--primary);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">← 返回工具列表</a>
    <h1>密码生成器</h1>
    <p class="desc">生成安全的随机密码，支持自定义长度和字符类型</p>

    <div class="card">
      <div class="password-display" id="password">点击生成密码</div>
      
      <div class="strength-bar">
        <div class="strength-fill" id="strengthFill"></div>
      </div>
      <div class="strength-text"><span>密码强度: </span><span id="strengthLabel">-</span></div>

      <div class="btn-row">
        <button id="btnGenerate" class="primary">生成密码</button>
        <button id="btnCopy">复制</button>
      </div>

      <div class="option-group">
        <label>
          <span>密码长度</span>
          <span id="lengthValue">16</span>
        </label>
        <input type="range" id="length" min="4" max="64" value="16" />
      </div>

      <div class="checkbox-group">
        <label class="checkbox-item">
          <input type="checkbox" id="uppercase" checked />
          <span>大写字母 (A-Z)</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="lowercase" checked />
          <span>小写字母 (a-z)</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="numbers" checked />
          <span>数字 (0-9)</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="symbols" checked />
          <span>特殊符号 (!@#$...)</span>
        </label>
      </div>

      <div id="status" class="status"></div>

      <div class="history">
        <h3>历史记录</h3>
        <div class="history-list" id="historyList">
          <div style="color: var(--text-muted); font-size: 0.9rem;">暂无历史记录</div>
        </div>
      </div>
    </div>

    <footer>
      <a href="https://github.com/chicogong/html-tools" target="_blank" rel="noreferrer">View source</a>
      · 纯前端工具 · 无服务器 · 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>

  <script>
    const passwordEl = document.getElementById('password');
    const lengthSlider = document.getElementById('length');
    const lengthValue = document.getElementById('lengthValue');
    const uppercaseEl = document.getElementById('uppercase');
    const lowercaseEl = document.getElementById('lowercase');
    const numbersEl = document.getElementById('numbers');
    const symbolsEl = document.getElementById('symbols');
    const strengthFill = document.getElementById('strengthFill');
    const strengthLabel = document.getElementById('strengthLabel');
    const historyList = document.getElementById('historyList');
    const statusEl = document.getElementById('status');

    const CHARS = {
      uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      lowercase: 'abcdefghijklmnopqrstuvwxyz',
      numbers: '0123456789',
      symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
    };

    let history = [];

    function getCharset() {
      let charset = '';
      if (uppercaseEl.checked) charset += CHARS.uppercase;
      if (lowercaseEl.checked) charset += CHARS.lowercase;
      if (numbersEl.checked) charset += CHARS.numbers;
      if (symbolsEl.checked) charset += CHARS.symbols;
      return charset;
    }

    function generatePassword() {
      const charset = getCharset();
      if (!charset) {
        showStatus('请至少选择一种字符类型', 'error');
        return;
      }

      const length = parseInt(lengthSlider.value);
      let password = '';

      // 使用 crypto API 生成安全随机数
      const array = new Uint32Array(length);
      crypto.getRandomValues(array);

      for (let i = 0; i < length; i++) {
        password += charset[array[i] % charset.length];
      }

      // 确保包含所有选中的字符类型
      let requiredChars = [];
      if (uppercaseEl.checked) requiredChars.push(CHARS.uppercase[Math.floor(Math.random() * CHARS.uppercase.length)]);
      if (lowercaseEl.checked) requiredChars.push(CHARS.lowercase[Math.floor(Math.random() * CHARS.lowercase.length)]);
      if (numbersEl.checked) requiredChars.push(CHARS.numbers[Math.floor(Math.random() * CHARS.numbers.length)]);
      if (symbolsEl.checked) requiredChars.push(CHARS.symbols[Math.floor(Math.random() * CHARS.symbols.length)]);

      // 替换密码中的随机位置
      for (let i = 0; i < requiredChars.length && i < length; i++) {
        const pos = Math.floor(Math.random() * length);
        password = password.substring(0, pos) + requiredChars[i] + password.substring(pos + 1);
      }

      passwordEl.textContent = password;
      updateStrength(password);
      addToHistory(password);
      showStatus('密码已生成', 'success');
    }

    function calculateStrength(password) {
      let score = 0;
      
      // 长度评分
      if (password.length >= 8) score += 1;
      if (password.length >= 12) score += 1;
      if (password.length >= 16) score += 1;
      if (password.length >= 24) score += 1;

      // 字符类型评分
      if (/[a-z]/.test(password)) score += 1;
      if (/[A-Z]/.test(password)) score += 1;
      if (/[0-9]/.test(password)) score += 1;
      if (/[^a-zA-Z0-9]/.test(password)) score += 1;

      return Math.min(score, 8);
    }

    function updateStrength(password) {
      const score = calculateStrength(password);
      const percentage = (score / 8) * 100;

      let color, text;
      if (score <= 2) {
        color = '#dc3545';
        text = '弱';
      } else if (score <= 4) {
        color = '#fd7e14';
        text = '一般';
      } else if (score <= 6) {
        color = '#ffc107';
        text = '中等';
      } else {
        color = '#198754';
        text = '强';
      }

      strengthFill.style.width = percentage + '%';
      strengthFill.style.background = color;
      strengthLabel.textContent = text + ' (' + score + '/8)';
      strengthLabel.style.color = color;
    }

    function addToHistory(password) {
      history.unshift(password);
      if (history.length > 10) history.pop();
      renderHistory();
    }

    function renderHistory() {
      historyList.textContent = '';
      
      if (history.length === 0) {
        const emptyDiv = document.createElement('div');
        emptyDiv.style.color = 'var(--text-muted)';
        emptyDiv.style.fontSize = '0.9rem';
        emptyDiv.textContent = '暂无历史记录';
        historyList.appendChild(emptyDiv);
        return;
      }

      history.forEach((pwd, i) => {
        const item = document.createElement('div');
        item.className = 'history-item';
        
        const span = document.createElement('span');
        span.textContent = pwd;
        
        const btn = document.createElement('button');
        btn.textContent = '复制';
        btn.onclick = () => copyHistoryItem(i);
        
        item.appendChild(span);
        item.appendChild(btn);
        historyList.appendChild(item);
      });
    }

    async function copyHistoryItem(index) {
      try {
        await navigator.clipboard.writeText(history[index]);
        showStatus('已复制', 'success');
      } catch (e) {
        showStatus('复制失败', 'error');
      }
    }

    function showStatus(msg, type) {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + (type || '');
    }

    // 事件绑定
    document.getElementById('btnGenerate').onclick = generatePassword;

    document.getElementById('btnCopy').onclick = async () => {
      const password = passwordEl.textContent;
      if (password === '点击生成密码') {
        showStatus('请先生成密码', 'error');
        return;
      }
      try {
        await navigator.clipboard.writeText(password);
        showStatus('已复制到剪贴板', 'success');
      } catch (e) {
        showStatus('复制失败', 'error');
      }
    };

    lengthSlider.addEventListener('input', () => {
      lengthValue.textContent = lengthSlider.value;
    });

    // 自动生成一个密码
    generatePassword();
  </script>
</body>
</html>

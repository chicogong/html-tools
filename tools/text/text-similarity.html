<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body {
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        header h1 {
            margin: 0;
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .text-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .text-inputs {
                grid-template-columns: 1fr;
            }
        }
        .text-inputs textarea {
            min-height: 200px;
            font-family: monospace;
        }
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin: 1.5rem 0;
        }
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .result-section {
            margin-top: 2rem;
        }
        .result-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .result-card {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1.5rem;
            text-align: center;
        }
        .result-card h4 {
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
            color: var(--pico-muted-color);
        }
        .result-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--pico-primary);
        }
        .result-card .percent {
            font-size: 1.2rem;
            color: var(--pico-muted-color);
        }
        .similarity-bar {
            height: 8px;
            background: var(--pico-muted-border-color);
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        .similarity-bar .fill {
            height: 100%;
            background: var(--pico-primary);
            transition: width 0.3s ease;
        }
        .detail-section {
            margin-top: 2rem;
        }
        .detail-box {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1.5rem;
        }
        .diff-view {
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.6;
        }
        .diff-add {
            background: rgba(0, 200, 0, 0.2);
            color: #0a0;
        }
        .diff-del {
            background: rgba(255, 0, 0, 0.2);
            color: #c00;
            text-decoration: line-through;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: var(--pico-secondary-background);
            border-radius: var(--pico-border-radius);
        }
        .algorithm-info {
            margin-top: 2rem;
        }
        .algorithm-info details {
            margin-bottom: 1rem;
        }
        [data-theme="dark"] .diff-add {
            color: #4f4;
        }
        [data-theme="dark"] .diff-del {
            color: #f77;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ğŸ“Š æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—</h1>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
        </header>

        <section class="text-inputs">
            <label>
                æ–‡æœ¬ A
                <textarea id="textA" placeholder="è¾“å…¥ç¬¬ä¸€æ®µæ–‡æœ¬..."></textarea>
            </label>
            <label>
                æ–‡æœ¬ B
                <textarea id="textB" placeholder="è¾“å…¥ç¬¬äºŒæ®µæ–‡æœ¬..."></textarea>
            </label>
        </section>

        <section class="controls">
            <div class="btn-group">
                <button onclick="calculate()">ğŸ“ è®¡ç®—ç›¸ä¼¼åº¦</button>
                <button class="secondary" onclick="swapTexts()">ğŸ”„ äº¤æ¢æ–‡æœ¬</button>
                <button class="secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="outline" onclick="loadExample()">ğŸ“ åŠ è½½ç¤ºä¾‹</button>
            </div>
        </section>

        <section class="result-section">
            <h3>è®¡ç®—ç»“æœ</h3>
            <div class="result-cards">
                <div class="result-card">
                    <h4>ä½™å¼¦ç›¸ä¼¼åº¦</h4>
                    <div class="value" id="cosineSim">-</div>
                    <div class="similarity-bar"><div class="fill" id="cosineBar" style="width: 0"></div></div>
                </div>
                <div class="result-card">
                    <h4>Jaccard ç›¸ä¼¼åº¦</h4>
                    <div class="value" id="jaccardSim">-</div>
                    <div class="similarity-bar"><div class="fill" id="jaccardBar" style="width: 0"></div></div>
                </div>
                <div class="result-card">
                    <h4>ç¼–è¾‘è·ç¦»</h4>
                    <div class="value" id="editDist">-</div>
                    <div class="percent" id="editDistPercent"></div>
                </div>
                <div class="result-card">
                    <h4>æœ€é•¿å…¬å…±å­åºåˆ—</h4>
                    <div class="value" id="lcsSim">-</div>
                    <div class="similarity-bar"><div class="fill" id="lcsBar" style="width: 0"></div></div>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid">
                <!-- åŠ¨æ€ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯ -->
            </div>
        </section>

        <section class="detail-section">
            <details>
                <summary>å·®å¼‚å¯¹æ¯”</summary>
                <div class="detail-box">
                    <div class="diff-view" id="diffView">è®¡ç®—åæ˜¾ç¤ºå·®å¼‚</div>
                </div>
            </details>
        </section>

        <section class="algorithm-info">
            <details>
                <summary>ç®—æ³•è¯´æ˜</summary>
                <article>
                    <h4>ä½™å¼¦ç›¸ä¼¼åº¦ (Cosine Similarity)</h4>
                    <p>å°†æ–‡æœ¬è½¬æ¢ä¸ºè¯é¢‘å‘é‡ï¼Œè®¡ç®—å‘é‡å¤¹è§’çš„ä½™å¼¦å€¼ã€‚å€¼åŸŸ [0, 1]ï¼Œ1 è¡¨ç¤ºå®Œå…¨ç›¸åŒã€‚</p>
                    
                    <h4>Jaccard ç›¸ä¼¼åº¦</h4>
                    <p>è®¡ç®—ä¸¤ä¸ªé›†åˆçš„äº¤é›†ä¸å¹¶é›†çš„æ¯”å€¼ã€‚å€¼åŸŸ [0, 1]ï¼Œé€‚åˆæ¯”è¾ƒè¯é›†é‡åˆåº¦ã€‚</p>
                    
                    <h4>ç¼–è¾‘è·ç¦» (Levenshtein Distance)</h4>
                    <p>å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ‰€éœ€çš„æœ€å°‘æ“ä½œæ•°ï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ï¼‰ã€‚æ•°å€¼è¶Šå°è¶Šç›¸ä¼¼ã€‚</p>
                    
                    <h4>æœ€é•¿å…¬å…±å­åºåˆ— (LCS)</h4>
                    <p>æ‰¾å‡ºä¸¤ä¸ªåºåˆ—ä¸­æœ€é•¿çš„å…¬å…±å­åºåˆ—é•¿åº¦ï¼Œåæ˜ ç»“æ„ç›¸ä¼¼æ€§ã€‚</p>
                </article>
            </details>
        </section>
    </main>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // åˆ†è¯ï¼ˆç®€å•æŒ‰å­—ç¬¦å’Œç©ºæ ¼åˆ†è¯ï¼‰
        function tokenize(text) {
            return text.toLowerCase()
                .split(/[\s\n\r\t]+/)
                .filter(w => w.length > 0);
        }

        // å­—ç¬¦çº§åˆ†è¯
        function charTokenize(text) {
            return text.split('');
        }

        // è¯é¢‘ç»Ÿè®¡
        function getTermFrequency(tokens) {
            const tf = {};
            tokens.forEach(token => {
                tf[token] = (tf[token] || 0) + 1;
            });
            return tf;
        }

        // ä½™å¼¦ç›¸ä¼¼åº¦
        function cosineSimilarity(textA, textB) {
            const tokensA = tokenize(textA);
            const tokensB = tokenize(textB);
            
            if (tokensA.length === 0 && tokensB.length === 0) return 1;
            if (tokensA.length === 0 || tokensB.length === 0) return 0;

            const tfA = getTermFrequency(tokensA);
            const tfB = getTermFrequency(tokensB);
            
            const allTerms = new Set([...Object.keys(tfA), ...Object.keys(tfB)]);
            
            let dotProduct = 0;
            let normA = 0;
            let normB = 0;
            
            allTerms.forEach(term => {
                const a = tfA[term] || 0;
                const b = tfB[term] || 0;
                dotProduct += a * b;
                normA += a * a;
                normB += b * b;
            });
            
            if (normA === 0 || normB === 0) return 0;
            return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
        }

        // Jaccard ç›¸ä¼¼åº¦
        function jaccardSimilarity(textA, textB) {
            const tokensA = new Set(tokenize(textA));
            const tokensB = new Set(tokenize(textB));
            
            if (tokensA.size === 0 && tokensB.size === 0) return 1;
            if (tokensA.size === 0 || tokensB.size === 0) return 0;

            const intersection = new Set([...tokensA].filter(x => tokensB.has(x)));
            const union = new Set([...tokensA, ...tokensB]);
            
            return intersection.size / union.size;
        }

        // ç¼–è¾‘è·ç¦»ï¼ˆLevenshteinï¼‰
        function levenshteinDistance(strA, strB) {
            const m = strA.length;
            const n = strB.length;
            
            if (m === 0) return n;
            if (n === 0) return m;

            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
            
            for (let i = 0; i <= m; i++) dp[i][0] = i;
            for (let j = 0; j <= n; j++) dp[0][j] = j;
            
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    const cost = strA[i - 1] === strB[j - 1] ? 0 : 1;
                    dp[i][j] = Math.min(
                        dp[i - 1][j] + 1,      // åˆ é™¤
                        dp[i][j - 1] + 1,      // æ’å…¥
                        dp[i - 1][j - 1] + cost // æ›¿æ¢
                    );
                }
            }
            
            return dp[m][n];
        }

        // æœ€é•¿å…¬å…±å­åºåˆ—
        function lcsLength(strA, strB) {
            const m = strA.length;
            const n = strB.length;
            
            if (m === 0 || n === 0) return 0;

            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
            
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (strA[i - 1] === strB[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }
            
            return dp[m][n];
        }

        // ç®€å•å·®å¼‚å¯¹æ¯”
        function simpleDiff(textA, textB) {
            const wordsA = textA.split(/(\s+)/);
            const wordsB = textB.split(/(\s+)/);
            
            const result = [];
            let i = 0, j = 0;
            
            while (i < wordsA.length || j < wordsB.length) {
                if (i >= wordsA.length) {
                    result.push({ type: 'add', text: wordsB[j] });
                    j++;
                } else if (j >= wordsB.length) {
                    result.push({ type: 'del', text: wordsA[i] });
                    i++;
                } else if (wordsA[i] === wordsB[j]) {
                    result.push({ type: 'same', text: wordsA[i] });
                    i++;
                    j++;
                } else {
                    // ç®€å•å¤„ç†ï¼šå…ˆåˆ ååŠ 
                    result.push({ type: 'del', text: wordsA[i] });
                    result.push({ type: 'add', text: wordsB[j] });
                    i++;
                    j++;
                }
            }
            
            return result;
        }

        // è®¡ç®—æ‰€æœ‰ç›¸ä¼¼åº¦
        function calculate() {
            const textA = document.getElementById('textA').value;
            const textB = document.getElementById('textB').value;

            if (!textA.trim() && !textB.trim()) {
                alert('è¯·è¾“å…¥æ–‡æœ¬');
                return;
            }

            // ä½™å¼¦ç›¸ä¼¼åº¦
            const cosine = cosineSimilarity(textA, textB);
            document.getElementById('cosineSim').textContent = (cosine * 100).toFixed(1) + '%';
            document.getElementById('cosineBar').style.width = (cosine * 100) + '%';

            // Jaccard ç›¸ä¼¼åº¦
            const jaccard = jaccardSimilarity(textA, textB);
            document.getElementById('jaccardSim').textContent = (jaccard * 100).toFixed(1) + '%';
            document.getElementById('jaccardBar').style.width = (jaccard * 100) + '%';

            // ç¼–è¾‘è·ç¦»
            const editDist = levenshteinDistance(textA, textB);
            const maxLen = Math.max(textA.length, textB.length);
            const editSim = maxLen > 0 ? (1 - editDist / maxLen) : 1;
            document.getElementById('editDist').textContent = editDist;
            document.getElementById('editDistPercent').textContent = 'ç›¸ä¼¼åº¦: ' + (editSim * 100).toFixed(1) + '%';

            // LCS
            const lcs = lcsLength(textA, textB);
            const lcsSim = maxLen > 0 ? (lcs / maxLen) : 1;
            document.getElementById('lcsSim').textContent = (lcsSim * 100).toFixed(1) + '%';
            document.getElementById('lcsBar').style.width = (lcsSim * 100) + '%';

            // ç»Ÿè®¡ä¿¡æ¯
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.textContent = '';
            
            const stats = [
                ['æ–‡æœ¬Aå­—ç¬¦æ•°', textA.length],
                ['æ–‡æœ¬Bå­—ç¬¦æ•°', textB.length],
                ['æ–‡æœ¬Aè¯æ•°', tokenize(textA).length],
                ['æ–‡æœ¬Bè¯æ•°', tokenize(textB).length],
                ['LCSé•¿åº¦', lcs],
                ['ç¼–è¾‘æ“ä½œæ•°', editDist]
            ];
            
            stats.forEach(([label, value]) => {
                const div = document.createElement('div');
                div.className = 'stat-item';
                
                const labelSpan = document.createElement('span');
                labelSpan.textContent = label;
                
                const valueStrong = document.createElement('strong');
                valueStrong.textContent = value;
                
                div.appendChild(labelSpan);
                div.appendChild(valueStrong);
                statsGrid.appendChild(div);
            });

            // å·®å¼‚å¯¹æ¯”
            const diffView = document.getElementById('diffView');
            diffView.textContent = '';
            
            const diff = simpleDiff(textA, textB);
            diff.forEach(item => {
                const span = document.createElement('span');
                if (item.type === 'add') {
                    span.className = 'diff-add';
                } else if (item.type === 'del') {
                    span.className = 'diff-del';
                }
                span.textContent = item.text;
                diffView.appendChild(span);
            });
        }

        // äº¤æ¢æ–‡æœ¬
        function swapTexts() {
            const textA = document.getElementById('textA');
            const textB = document.getElementById('textB');
            const temp = textA.value;
            textA.value = textB.value;
            textB.value = temp;
        }

        // æ¸…ç©º
        function clearAll() {
            document.getElementById('textA').value = '';
            document.getElementById('textB').value = '';
            document.getElementById('cosineSim').textContent = '-';
            document.getElementById('jaccardSim').textContent = '-';
            document.getElementById('editDist').textContent = '-';
            document.getElementById('editDistPercent').textContent = '';
            document.getElementById('lcsSim').textContent = '-';
            document.getElementById('cosineBar').style.width = '0';
            document.getElementById('jaccardBar').style.width = '0';
            document.getElementById('lcsBar').style.width = '0';
            document.getElementById('statsGrid').textContent = '';
            document.getElementById('diffView').textContent = 'è®¡ç®—åæ˜¾ç¤ºå·®å¼‚';
        }

        // åŠ è½½ç¤ºä¾‹
        function loadExample() {
            document.getElementById('textA').value = 'ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå‡ºå»æ•£æ­¥ã€‚é˜³å…‰æ˜åªšï¼Œå¾®é£ä¹ ä¹ ã€‚';
            document.getElementById('textB').value = 'ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆå¤–å‡ºæ•£æ­¥ã€‚é˜³å…‰ç¿çƒ‚ï¼Œå¾®é£è½»æ‹‚ã€‚';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initTheme);
    </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils" />
    <meta name="keywords" content="meeting-scheduler,time,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/time/meeting-scheduler.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils" />
    <meta property="og:description" content="è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/time/meeting-scheduler.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils" />
    <meta name="twitter:description" content="è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, blinkmacsystemfont, 'Segoe UI', roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      :root {
        --good-time: #dcfce7;
        --ok-time: #fef3c7;
        --bad-time: #fee2e2;
        --night-time: #e0e7ff;
      }
      [data-theme="dark"] {
        --good-time: #14532d;
        --ok-time: #78350f;
        --bad-time: #7f1d1d;
        --night-time: #312e81;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }
      .setup-section {
        background: var(--pico-card-background-color);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
      }
      .setup-section h2 {
        margin-top: 0;
      }
      .participants-list {
        margin: 1rem 0;
      }
      .participant-item {
        display: flex;
        gap: 1rem;
        align-items: center;
        padding: 0.75rem;
        background: var(--pico-background-color);
        border-radius: 4px;
        margin-bottom: 0.5rem;
      }
      .participant-name {
        flex: 1;
        font-weight: bold;
      }
      .participant-timezone {
        color: var(--pico-muted-color);
        font-size: 0.9rem;
      }
      .participant-local {
        font-size: 0.85rem;
      }
      .add-participant {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 0.5rem;
        margin-top: 1rem;
      }
      @media (max-width: 768px) {
        .add-participant {
          grid-template-columns: 1fr;
        }
      }
      .time-grid {
        background: var(--pico-card-background-color);
        padding: 1.5rem;
        border-radius: 8px;
        overflow-x: auto;
      }
      .time-grid h2 {
        margin-top: 0;
      }
      .grid-container {
        display: grid;
        gap: 2px;
        min-width: 800px;
      }
      .grid-header {
        display: contents;
      }
      .grid-row {
        display: contents;
      }
      .grid-cell {
        padding: 0.5rem;
        text-align: center;
        font-size: 0.85rem;
        border-radius: 2px;
      }
      .header-cell {
        font-weight: bold;
        background: var(--pico-secondary-background);
        padding: 0.75rem 0.5rem;
      }
      .name-cell {
        text-align: left;
        font-weight: bold;
        padding: 0.5rem 1rem;
        background: var(--pico-secondary-background);
      }
      .time-cell {
        cursor: pointer;
        transition: opacity 0.2s;
      }
      .time-cell:hover {
        opacity: 0.8;
      }
      .time-cell.good {
        background: var(--good-time);
      }
      .time-cell.ok {
        background: var(--ok-time);
      }
      .time-cell.bad {
        background: var(--bad-time);
      }
      .time-cell.night {
        background: var(--night-time);
      }
      .time-cell.selected {
        outline: 3px solid var(--pico-primary);
        outline-offset: -3px;
      }
      .legend {
        display: flex;
        gap: 1.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
      }
      .result-section {
        background: var(--pico-card-background-color);
        padding: 1.5rem;
        border-radius: 8px;
        margin-top: 2rem;
      }
      .result-section h2 {
        margin-top: 0;
      }
      .selected-time {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--pico-primary);
        margin-bottom: 1rem;
      }
      .time-breakdown {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
      }
      .breakdown-item {
        padding: 1rem;
        background: var(--pico-background-color);
        border-radius: 8px;
      }
      .breakdown-name {
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .breakdown-time {
        font-size: 1.2rem;
        color: var(--pico-primary);
      }
      .breakdown-date {
        font-size: 0.85rem;
        color: var(--pico-muted-color);
      }
      .action-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .quick-timezones {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }
      .quick-tz {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
        cursor: pointer;
        background: var(--pico-secondary-background);
        border-radius: 4px;
      }
      .quick-tz:hover {
        background: var(--pico-primary);
        color: white;
      }
      .working-hours {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--pico-background-color);
        border-radius: 8px;
      }
      .working-hours-row {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨
    </nav>
    <div class="container">
      <header>
        <h1>è·¨æ—¶åŒºä¼šè®®æ—¶é—´åè°ƒå™¨</h1>
        <button id="themeToggle" class="outline">åˆ‡æ¢ä¸»é¢˜</button>
      </header>

      <div class="setup-section">
        <h2>å‚ä¸è€…è®¾ç½®</h2>
        <div class="participants-list" id="participantsList"></div>

        <div class="add-participant">
          <input type="text" id="participantName" placeholder="å‚ä¸è€…åç§°" />
          <select id="participantTimezone"></select>
          <button id="addParticipantBtn">æ·»åŠ </button>
        </div>

        <div class="quick-timezones">
          <span style="font-size: 0.85rem; color: var(--pico-muted-color)">å¿«é€Ÿæ·»åŠ :</span>
          <span class="quick-tz" data-tz="Asia/Shanghai" data-name="åŒ—äº¬">åŒ—äº¬</span>
          <span class="quick-tz" data-tz="Asia/Tokyo" data-name="ä¸œäº¬">ä¸œäº¬</span>
          <span class="quick-tz" data-tz="America/New_York" data-name="çº½çº¦">çº½çº¦</span>
          <span class="quick-tz" data-tz="America/Los_Angeles" data-name="æ´›æ‰çŸ¶">æ´›æ‰çŸ¶</span>
          <span class="quick-tz" data-tz="Europe/London" data-name="ä¼¦æ•¦">ä¼¦æ•¦</span>
          <span class="quick-tz" data-tz="Europe/Paris" data-name="å·´é»">å·´é»</span>
          <span class="quick-tz" data-tz="Australia/Sydney" data-name="æ‚‰å°¼">æ‚‰å°¼</span>
          <span class="quick-tz" data-tz="Asia/Singapore" data-name="æ–°åŠ å¡">æ–°åŠ å¡</span>
        </div>

        <div class="working-hours">
          <strong>å·¥ä½œæ—¶é—´è®¾ç½®</strong>
          <div class="working-hours-row" style="margin-top: 0.5rem">
            <label>
              å¼€å§‹:
              <input type="time" id="workStart" value="09:00" style="width: 120px" />
            </label>
            <label>
              ç»“æŸ:
              <input type="time" id="workEnd" value="18:00" style="width: 120px" />
            </label>
            <button id="updateGridBtn" class="secondary">æ›´æ–°æ—¶é—´ç½‘æ ¼</button>
          </div>
        </div>
      </div>

      <div class="time-grid">
        <h2>
          æ—¶é—´ç½‘æ ¼
          <small style="font-weight: normal; color: var(--pico-muted-color)">
            (ç‚¹å‡»é€‰æ‹©ä¼šè®®æ—¶é—´)
          </small>
        </h2>
        <div class="grid-container" id="timeGrid"></div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color" style="background: var(--good-time)"></div>
            <span>å·¥ä½œæ—¶é—´ (9:00-18:00)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: var(--ok-time)"></div>
            <span>å¯æ¥å—æ—¶é—´ (7:00-9:00, 18:00-21:00)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: var(--bad-time)"></div>
            <span>ä¸æ¨èæ—¶é—´ (21:00-23:00, 6:00-7:00)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: var(--night-time)"></div>
            <span>å¤œé—´æ—¶é—´ (23:00-6:00)</span>
          </div>
        </div>
      </div>

      <div class="result-section" id="resultSection" style="display: none">
        <h2>é€‰å®šçš„ä¼šè®®æ—¶é—´</h2>
        <div class="selected-time" id="selectedTime"></div>
        <div class="time-breakdown" id="timeBreakdown"></div>
        <div class="action-buttons">
          <button id="copyResultBtn">å¤åˆ¶æ—¶é—´ä¿¡æ¯</button>
          <button id="addToCalendarBtn" class="secondary">æ·»åŠ åˆ°æ—¥å†</button>
        </div>
      </div>
    </div>

    <script>
      // å¸¸ç”¨æ—¶åŒºåˆ—è¡¨
      const timezones = [
        { value: "Asia/Shanghai", label: "ä¸­å›½ - åŒ—äº¬/ä¸Šæµ· (UTC+8)" },
        { value: "Asia/Hong_Kong", label: "ä¸­å›½ - é¦™æ¸¯ (UTC+8)" },
        { value: "Asia/Taipei", label: "ä¸­å›½ - å°åŒ— (UTC+8)" },
        { value: "Asia/Tokyo", label: "æ—¥æœ¬ - ä¸œäº¬ (UTC+9)" },
        { value: "Asia/Seoul", label: "éŸ©å›½ - é¦–å°” (UTC+9)" },
        { value: "Asia/Singapore", label: "æ–°åŠ å¡ (UTC+8)" },
        { value: "Asia/Bangkok", label: "æ³°å›½ - æ›¼è°· (UTC+7)" },
        { value: "Asia/Dubai", label: "é˜¿è”é…‹ - è¿ªæ‹œ (UTC+4)" },
        { value: "Asia/Kolkata", label: "å°åº¦ - å­Ÿä¹° (UTC+5:30)" },
        { value: "Europe/London", label: "è‹±å›½ - ä¼¦æ•¦ (UTC+0/+1)" },
        { value: "Europe/Paris", label: "æ³•å›½ - å·´é» (UTC+1/+2)" },
        { value: "Europe/Berlin", label: "å¾·å›½ - æŸæ— (UTC+1/+2)" },
        { value: "Europe/Moscow", label: "ä¿„ç½—æ–¯ - è«æ–¯ç§‘ (UTC+3)" },
        { value: "America/New_York", label: "ç¾å›½ - çº½çº¦ (UTC-5/-4)" },
        { value: "America/Chicago", label: "ç¾å›½ - èŠåŠ å“¥ (UTC-6/-5)" },
        { value: "America/Denver", label: "ç¾å›½ - ä¸¹ä½› (UTC-7/-6)" },
        { value: "America/Los_Angeles", label: "ç¾å›½ - æ´›æ‰çŸ¶ (UTC-8/-7)" },
        { value: "America/Sao_Paulo", label: "å·´è¥¿ - åœ£ä¿ç½— (UTC-3)" },
        { value: "Australia/Sydney", label: "æ¾³å¤§åˆ©äºš - æ‚‰å°¼ (UTC+10/+11)" },
        { value: "Australia/Melbourne", label: "æ¾³å¤§åˆ©äºš - å¢¨å°”æœ¬ (UTC+10/+11)" },
        { value: "Pacific/Auckland", label: "æ–°è¥¿å…° - å¥¥å…‹å…° (UTC+12/+13)" }
      ];

      // çŠ¶æ€
      let participants = [];
      let selectedHour = null;
      let baseDate = new Date();
      baseDate.setHours(0, 0, 0, 0);

      // åˆå§‹åŒ–æ—¶åŒºé€‰æ‹©å™¨
      function initTimezoneSelect() {
        const select = document.getElementById("participantTimezone");
        timezones.forEach((tz) => {
          const option = document.createElement("option");
          option.value = tz.value;
          option.textContent = tz.label;
          select.appendChild(option);
        });

        // é»˜è®¤é€‰æ‹©ç”¨æˆ·å½“å‰æ—¶åŒº
        try {
          const userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
          if (timezones.find((t) => t.value === userTz)) {
            select.value = userTz;
          }
        } catch (e) {}
      }

      // æ·»åŠ å‚ä¸è€…
      function addParticipant(name, timezone) {
        if (!name) {
          alert("è¯·è¾“å…¥å‚ä¸è€…åç§°");
          return;
        }

        participants.push({ name, timezone });
        renderParticipants();
        renderTimeGrid();

        document.getElementById("participantName").value = "";
      }

      // æ¸²æŸ“å‚ä¸è€…åˆ—è¡¨
      function renderParticipants() {
        const container = document.getElementById("participantsList");
        container.replaceChildren();

        if (participants.length === 0) {
          const p = document.createElement("p");
          p.style.color = "var(--pico-muted-color)";
          p.textContent = "è¯·æ·»åŠ ä¼šè®®å‚ä¸è€…";
          container.appendChild(p);
          return;
        }

        participants.forEach((p, index) => {
          const item = document.createElement("div");
          item.className = "participant-item";

          const nameSpan = document.createElement("span");
          nameSpan.className = "participant-name";
          nameSpan.textContent = p.name;

          const tzSpan = document.createElement("span");
          tzSpan.className = "participant-timezone";
          tzSpan.textContent = p.timezone;

          const localSpan = document.createElement("span");
          localSpan.className = "participant-local";
          const now = new Date();
          localSpan.textContent = "å½“å‰: " + formatTimeInZone(now, p.timezone);

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "outline";
          deleteBtn.style.padding = "0.25rem 0.5rem";
          deleteBtn.textContent = "åˆ é™¤";
          deleteBtn.addEventListener("click", function () {
            participants.splice(index, 1);
            renderParticipants();
            renderTimeGrid();
          });

          item.appendChild(nameSpan);
          item.appendChild(tzSpan);
          item.appendChild(localSpan);
          item.appendChild(deleteBtn);
          container.appendChild(item);
        });
      }

      // æ ¼å¼åŒ–æ—¶åŒºæ—¶é—´
      function formatTimeInZone(date, timezone) {
        return date.toLocaleTimeString("zh-CN", {
          timeZone: timezone,
          hour: "2-digit",
          minute: "2-digit",
          hour12: false
        });
      }

      // è·å–æ—¶åŒºçš„å°æ—¶
      function getHourInZone(date, timezone) {
        const str = date.toLocaleTimeString("en-US", {
          timeZone: timezone,
          hour: "numeric",
          hour12: false
        });
        return parseInt(str);
      }

      // è·å–æ—¶é—´åˆ†ç±»
      function getTimeCategory(hour) {
        if (hour >= 9 && hour < 18) return "good";
        if ((hour >= 7 && hour < 9) || (hour >= 18 && hour < 21)) return "ok";
        if ((hour >= 21 && hour < 23) || (hour >= 6 && hour < 7)) return "bad";
        return "night";
      }

      // è·å–æ‰€æœ‰å‚ä¸è€…ä¸­æœ€å·®çš„æ—¶é—´åˆ†ç±»
      function getWorstCategory(categories) {
        const priority = { night: 0, bad: 1, ok: 2, good: 3 };
        let worst = "good";
        categories.forEach((cat) => {
          if (priority[cat] < priority[worst]) {
            worst = cat;
          }
        });
        return worst;
      }

      // æ¸²æŸ“æ—¶é—´ç½‘æ ¼
      function renderTimeGrid() {
        const container = document.getElementById("timeGrid");
        container.replaceChildren();

        if (participants.length === 0) {
          const p = document.createElement("p");
          p.style.color = "var(--pico-muted-color)";
          p.style.textAlign = "center";
          p.style.padding = "2rem";
          p.textContent = "æ·»åŠ å‚ä¸è€…åå°†æ˜¾ç¤ºæ—¶é—´ç½‘æ ¼";
          container.appendChild(p);
          return;
        }

        // è®¾ç½®ç½‘æ ¼åˆ—æ•°
        container.style.gridTemplateColumns = "150px repeat(24, 1fr)";

        // è¡¨å¤´
        const headerRow = document.createElement("div");
        headerRow.className = "grid-header";

        const cornerCell = document.createElement("div");
        cornerCell.className = "grid-cell header-cell";
        cornerCell.textContent = "å‚ä¸è€…";
        container.appendChild(cornerCell);

        for (let h = 0; h < 24; h++) {
          const cell = document.createElement("div");
          cell.className = "grid-cell header-cell";
          cell.textContent = h.toString().padStart(2, "0") + ":00";
          container.appendChild(cell);
        }

        // æ¯ä¸ªå‚ä¸è€…çš„è¡Œ
        participants.forEach((p, pIndex) => {
          const nameCell = document.createElement("div");
          nameCell.className = "grid-cell name-cell";
          nameCell.textContent = p.name;
          container.appendChild(nameCell);

          for (let h = 0; h < 24; h++) {
            // åŸºå‡†æ—¶é—´ï¼ˆç¬¬ä¸€ä¸ªå‚ä¸è€…çš„æ—¶åŒºï¼‰
            const baseTime = new Date(baseDate);
            baseTime.setHours(h);

            // è½¬æ¢åˆ°å½“å‰å‚ä¸è€…çš„æ—¶åŒº
            const localHour = getHourInZone(baseTime, p.timezone);
            const category = getTimeCategory(localHour);

            const cell = document.createElement("div");
            cell.className = "grid-cell time-cell " + category;
            cell.textContent = localHour.toString().padStart(2, "0");
            cell.dataset.hour = h;
            cell.dataset.participant = pIndex;

            if (h === selectedHour) {
              cell.classList.add("selected");
            }

            cell.addEventListener("click", function () {
              selectTime(h);
            });

            container.appendChild(cell);
          }
        });

        // ç»¼åˆè¯„åˆ†è¡Œ
        const summaryCell = document.createElement("div");
        summaryCell.className = "grid-cell name-cell";
        summaryCell.textContent = "ç»¼åˆè¯„ä»·";
        summaryCell.style.fontStyle = "italic";
        container.appendChild(summaryCell);

        for (let h = 0; h < 24; h++) {
          const baseTime = new Date(baseDate);
          baseTime.setHours(h);

          const categories = participants.map((p) => {
            const localHour = getHourInZone(baseTime, p.timezone);
            return getTimeCategory(localHour);
          });

          const worst = getWorstCategory(categories);

          const cell = document.createElement("div");
          cell.className = "grid-cell time-cell " + worst;
          cell.style.fontWeight = "bold";

          const symbols = { good: "â˜…", ok: "â—", bad: "â—‹", night: "â—" };
          cell.textContent = symbols[worst];

          cell.dataset.hour = h;
          cell.addEventListener("click", function () {
            selectTime(h);
          });

          if (h === selectedHour) {
            cell.classList.add("selected");
          }

          container.appendChild(cell);
        }
      }

      // é€‰æ‹©æ—¶é—´
      function selectTime(hour) {
        selectedHour = hour;

        // æ›´æ–°é€‰ä¸­çŠ¶æ€
        document.querySelectorAll(".time-cell").forEach((cell) => {
          if (parseInt(cell.dataset.hour) === hour) {
            cell.classList.add("selected");
          } else {
            cell.classList.remove("selected");
          }
        });

        // æ˜¾ç¤ºç»“æœ
        showResult(hour);
      }

      // æ˜¾ç¤ºç»“æœ
      function showResult(hour) {
        const section = document.getElementById("resultSection");
        section.style.display = "block";

        const baseTime = new Date(baseDate);
        baseTime.setHours(hour);

        // ç¬¬ä¸€ä¸ªå‚ä¸è€…çš„æ—¶åŒºä½œä¸ºåŸºå‡†
        const baseTz = participants[0]?.timezone || "Asia/Shanghai";

        document.getElementById("selectedTime").textContent =
          hour.toString().padStart(2, "0") + ":00 (" + baseTz + ")";

        const breakdown = document.getElementById("timeBreakdown");
        breakdown.replaceChildren();

        participants.forEach((p) => {
          const item = document.createElement("div");
          item.className = "breakdown-item";

          const localTime = new Date(baseTime);
          const localHour = getHourInZone(localTime, p.timezone);
          const category = getTimeCategory(localHour);

          const nameDiv = document.createElement("div");
          nameDiv.className = "breakdown-name";
          nameDiv.textContent = p.name;

          const timeDiv = document.createElement("div");
          timeDiv.className = "breakdown-time";
          timeDiv.textContent = localHour.toString().padStart(2, "0") + ":00";

          const dateDiv = document.createElement("div");
          dateDiv.className = "breakdown-date";
          dateDiv.textContent = localTime.toLocaleDateString("zh-CN", {
            timeZone: p.timezone,
            weekday: "long"
          });

          const statusDiv = document.createElement("div");
          statusDiv.style.marginTop = "0.5rem";
          statusDiv.style.fontSize = "0.85rem";

          const statusMap = {
            good: "âœ“ å·¥ä½œæ—¶é—´",
            ok: "â—‹ å¯æ¥å—",
            bad: "â–³ ä¸æ¨è",
            night: "âœ— å¤œé—´"
          };
          statusDiv.textContent = statusMap[category];

          item.appendChild(nameDiv);
          item.appendChild(timeDiv);
          item.appendChild(dateDiv);
          item.appendChild(statusDiv);
          breakdown.appendChild(item);
        });
      }

      // å¤åˆ¶ç»“æœ
      window.copyResult = function () {
        if (selectedHour === null) {
          alert("è¯·å…ˆé€‰æ‹©ä¼šè®®æ—¶é—´");
          return;
        }

        const baseTime = new Date(baseDate);
        baseTime.setHours(selectedHour);

        let text = "ä¼šè®®æ—¶é—´å®‰æ’:\n\n";

        participants.forEach((p) => {
          const localHour = getHourInZone(baseTime, p.timezone);
          text +=
            p.name + ": " + localHour.toString().padStart(2, "0") + ":00 (" + p.timezone + ")\n";
        });

        navigator.clipboard.writeText(text).then(function () {
          alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        });
      };

      // æ·»åŠ åˆ°æ—¥å†
      function addToCalendar() {
        if (selectedHour === null) {
          alert("è¯·å…ˆé€‰æ‹©ä¼šè®®æ—¶é—´");
          return;
        }

        const startTime = new Date(baseDate);
        startTime.setHours(selectedHour);

        const endTime = new Date(startTime);
        endTime.setHours(startTime.getHours() + 1);

        const formatDate = (d) => d.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";

        const title = encodeURIComponent("è·¨æ—¶åŒºä¼šè®®");
        const details = encodeURIComponent("å‚ä¸è€…: " + participants.map((p) => p.name).join(", "));

        const url =
          "https://calendar.google.com/calendar/render?action=TEMPLATE" +
          "&text=" +
          title +
          "&dates=" +
          formatDate(startTime) +
          "/" +
          formatDate(endTime) +
          "&details=" +
          details;

        window.open(url, "_blank");
      }

      // ä¸»é¢˜åˆ‡æ¢
      document.getElementById("themeToggle").addEventListener("click", function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      });

      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        document.documentElement.setAttribute("data-theme", savedTheme);
      }

      // äº‹ä»¶ç»‘å®š
      document.getElementById("addParticipantBtn").addEventListener("click", function () {
        const name = document.getElementById("participantName").value.trim();
        const timezone = document.getElementById("participantTimezone").value;
        addParticipant(name, timezone);
      });

      document.getElementById("participantName").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          const name = this.value.trim();
          const timezone = document.getElementById("participantTimezone").value;
          addParticipant(name, timezone);
        }
      });

      document.querySelectorAll(".quick-tz").forEach(function (btn) {
        btn.addEventListener("click", function () {
          const tz = this.dataset.tz;
          const name = this.dataset.name;
          addParticipant(name, tz);
        });
      });

      document.getElementById("updateGridBtn").addEventListener("click", renderTimeGrid);
      document.getElementById("copyResultBtn").addEventListener("click", copyResult);
      document.getElementById("addToCalendarBtn").addEventListener("click", addToCalendar);

      // åˆå§‹åŒ–
      initTimezoneSelect();
      renderParticipants();
      renderTimeGrid();

      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.getElementById("theme-icon").textContent = newTheme === "light" ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", newTheme);
      }
    </script>
  </body>
</html>

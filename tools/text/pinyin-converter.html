<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‰å­—è½¬æ‹¼éŸ³</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --primary-color: #9b59b6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        h1 {
            margin-bottom: 0;
            color: var(--primary-color);
        }
        
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: 2px solid var(--pico-muted-border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .options-bar {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .options-bar label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .text-area-wrapper {
            margin-bottom: 1rem;
        }
        
        .text-area-wrapper label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-size: 1rem;
        }
        
        .output-area {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            min-height: 100px;
            line-height: 2;
            word-break: break-all;
        }
        
        .pinyin-char {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0.25rem;
            text-align: center;
        }
        
        .pinyin-char .pinyin {
            font-size: 0.8rem;
            color: var(--primary-color);
        }
        
        .pinyin-char .hanzi {
            font-size: 1.1rem;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        
        .char-count {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--pico-muted-color);
            margin-top: 0.25rem;
        }
        
        .result-text {
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--pico-muted-border-color);
            color: var(--pico-muted-color);
        }
        
        .tone-select {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>æ±‰å­—è½¬æ‹¼éŸ³</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                <span id="theme-icon">ğŸŒ™</span>
            </button>
        </header>
        
        <article>
            <div class="options-bar">
                <label>
                    <input type="checkbox" id="showTone" checked>
                    æ˜¾ç¤ºå£°è°ƒ
                </label>
                <label>
                    <input type="checkbox" id="showHanzi" checked>
                    æ˜¾ç¤ºæ±‰å­—
                </label>
                <label>
                    <input type="checkbox" id="polyphone">
                    å¤šéŸ³å­—æç¤º
                </label>
                <div class="tone-select">
                    <span>å£°è°ƒæ ¼å¼:</span>
                    <select id="toneFormat">
                        <option value="mark">ç¬¦å· (pÄ«n yÄ«n)</option>
                        <option value="number">æ•°å­— (pin1 yin1)</option>
                        <option value="none">æ— å£°è°ƒ (pin yin)</option>
                    </select>
                </div>
            </div>
            
            <div class="text-area-wrapper">
                <label for="input-text">è¾“å…¥æ±‰å­—</label>
                <textarea id="input-text" placeholder="è¯·è¾“å…¥è¦è½¬æ¢çš„æ±‰å­—æ–‡æœ¬..."></textarea>
                <div class="char-count">
                    <span>å­—ç¬¦æ•°: <span id="input-count">0</span></span>
                    <button class="outline secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="clearInput()">æ¸…ç©º</button>
                </div>
            </div>
            
            <div class="btn-group">
                <button onclick="convert()">è½¬æ¢ä¸ºæ‹¼éŸ³</button>
                <button onclick="copyResult()" class="secondary">å¤åˆ¶ç»“æœ</button>
            </div>
            
            <div class="text-area-wrapper">
                <label>è½¬æ¢ç»“æœ</label>
                <div id="output-area" class="output-area">
                    <span class="result-text" id="result-text">è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</span>
                </div>
            </div>
        </article>
        
        <footer>
            <p>æ±‰å­—è½¬æ‹¼éŸ³å·¥å…· - çº¯å®¢æˆ·ç«¯è¿è¡Œï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ </p>
        </footer>
    </main>
    
    <script>
        // ç®€åŒ–çš„æ‹¼éŸ³å­—å…¸ï¼ˆå¸¸ç”¨å­—ï¼‰
        const pinyinDict = {
            'çš„':'de','ä¸€':'yÄ«','æ˜¯':'shÃ¬','äº†':'le','æˆ‘':'wÇ’','ä¸':'bÃ¹','äºº':'rÃ©n','åœ¨':'zÃ i','ä»–':'tÄ','æœ‰':'yÇ’u',
            'è¿™':'zhÃ¨','ä¸ª':'gÃ¨','ä¸Š':'shÃ ng','ä»¬':'men','æ¥':'lÃ¡i','åˆ°':'dÃ o','æ—¶':'shÃ­','å¤§':'dÃ ','åœ°':'dÃ¬','ä¸º':'wÃ¨i',
            'å­':'zÇ','ä¸­':'zhÅng','ä½ ':'nÇ','è¯´':'shuÅ','ç”Ÿ':'shÄ“ng','å›½':'guÃ³','å¹´':'niÃ¡n','ç€':'zhe','å°±':'jiÃ¹','é‚£':'nÃ ',
            'å’Œ':'hÃ©','è¦':'yÃ o','å¥¹':'tÄ','å‡º':'chÅ«','ä¹Ÿ':'yÄ›','å¾—':'de','é‡Œ':'lÇ','å':'hÃ²u','è‡ª':'zÃ¬','ä»¥':'yÇ',
            'ä¼š':'huÃ¬','å®¶':'jiÄ','å¯':'kÄ›','ä¸‹':'xiÃ ','è€Œ':'Ã©r','è¿‡':'guÃ²','å¤©':'tiÄn','å»':'qÃ¹','èƒ½':'nÃ©ng','å¯¹':'duÃ¬',
            'å°':'xiÇo','å¤š':'duÅ','ç„¶':'rÃ¡n','äº':'yÃº','å¿ƒ':'xÄ«n','å­¦':'xuÃ©','ä¹ˆ':'me','ä¹‹':'zhÄ«','éƒ½':'dÅu','å¥½':'hÇo',
            'çœ‹':'kÃ n','èµ·':'qÇ','å‘':'fÄ','å½“':'dÄng','æ²¡':'mÃ©i','æˆ':'chÃ©ng','åª':'zhÇ','å¦‚':'rÃº','äº‹':'shÃ¬','æŠŠ':'bÇ',
            'è¿˜':'hÃ¡i','ç”¨':'yÃ²ng','ç¬¬':'dÃ¬','æ ·':'yÃ ng','é“':'dÃ o','æƒ³':'xiÇng','ä½œ':'zuÃ²','ç§':'zhÇ’ng','å¼€':'kÄi','ç¾':'mÄ›i',
            'æ€»':'zÇ’ng','ä»':'cÃ³ng','æ— ':'wÃº','æƒ…':'qÃ­ng','å·±':'jÇ','é¢':'miÃ n','æœ€':'zuÃ¬','å¥³':'nÇš','ä½†':'dÃ n','ç°':'xiÃ n',
            'å‰':'qiÃ¡n','äº›':'xiÄ“','æ‰€':'suÇ’','åŒ':'tÃ³ng','æ—¥':'rÃ¬','æ‰‹':'shÇ’u','åˆ':'yÃ²u','è¡Œ':'xÃ­ng','æ„':'yÃ¬','åŠ¨':'dÃ²ng',
            'æ–¹':'fÄng','æœŸ':'qÄ«','å®ƒ':'tÄ','å¤´':'tÃ³u','ç»':'jÄ«ng','é•¿':'chÃ¡ng','å„¿':'Ã©r','å›':'huÃ­','ä½':'wÃ¨i','åˆ†':'fÄ“n',
            'çˆ±':'Ã i','è€':'lÇo','å› ':'yÄ«n','å¾ˆ':'hÄ›n','ç»™':'gÄ›i','å':'mÃ­ng','æ³•':'fÇ','é—´':'jiÄn','æ–¯':'sÄ«','çŸ¥':'zhÄ«',
            'ä¸–':'shÃ¬','ä»€':'shÃ©n','ä¸¤':'liÇng','æ¬¡':'cÃ¬','ä½¿':'shÇ','èº«':'shÄ“n','è€…':'zhÄ›','è¢«':'bÃ¨i','é«˜':'gÄo','å·²':'yÇ',
            'äº²':'qÄ«n','å…¶':'qÃ­','è¿›':'jÃ¬n','æ­¤':'cÇ','è¯':'huÃ ','å¸¸':'chÃ¡ng','ä¸':'yÇ”','æ´»':'huÃ³','æ­£':'zhÃ¨ng','æ„Ÿ':'gÇn',
            'è§':'jiÃ n','æ˜':'mÃ­ng','é—®':'wÃ¨n','åŠ›':'lÃ¬','ç†':'lÇ','å°”':'Ä›r','ç‚¹':'diÇn','æ–‡':'wÃ©n','å‡ ':'jÇ','å®š':'dÃ¬ng',
            'æœ¬':'bÄ›n','å…¬':'gÅng','ç‰¹':'tÃ¨','åš':'zuÃ²','å¤–':'wÃ i','å­©':'hÃ¡i','ç›¸':'xiÄng','è¥¿':'xÄ«','æœ':'guÇ’','èµ°':'zÇ’u',
            'å°†':'jiÄng','æœˆ':'yuÃ¨','å':'shÃ­','å®':'shÃ­','å‘':'xiÃ ng','å£°':'shÄ“ng','è½¦':'chÄ“','å…¨':'quÃ¡n','ä¿¡':'xÃ¬n','é‡':'zhÃ²ng',
            'ä¸‰':'sÄn','æœº':'jÄ«','å·¥':'gÅng','ç‰©':'wÃ¹','æ°”':'qÃ¬','æ¯':'mÄ›i','å¹¶':'bÃ¬ng','åˆ«':'biÃ©','çœŸ':'zhÄ“n','æ‰“':'dÇ',
            'å¤ª':'tÃ i','æ–°':'xÄ«n','æ¯”':'bÇ','æ‰':'cÃ¡i','ä¾¿':'biÃ n','å¤«':'fÅ«','å†':'zÃ i','ä¹¦':'shÅ«','éƒ¨':'bÃ¹','æ°´':'shuÇ',
            'åƒ':'xiÃ ng','çœ¼':'yÇn','å°‘':'shÇo','ç•Œ':'jiÃ¨','å¦ˆ':'mÄ','å¬':'tÄ«ng','è¿œ':'yuÇn','å¸ˆ':'shÄ«','ç”µ':'diÃ n','ç¤¾':'shÃ¨',
            'ç¨‹':'chÃ©ng','å˜':'biÃ n','æµ·':'hÇi','ä¸‡':'wÃ n','ç²¾':'jÄ«ng','åŒ–':'huÃ ','å±±':'shÄn','ç¥':'shÃ©n','å‚':'cÄn','ç™¾':'bÇi',
            'è¡¨':'biÇo','è®©':'rÃ ng','å«':'jiÃ o','ç³»':'xÃ¬','äº”':'wÇ”','æ•°':'shÃ¹','å²':'shÇ','æ€§':'xÃ¬ng','é€š':'tÅng','åŠ':'bÃ n',
            'å´':'quÃ¨','çˆ¶':'fÃ¹','ä¸œ':'dÅng','æ”¿':'zhÃ¨ng','æ­»':'sÇ','æ°‘':'mÃ­n','å››':'sÃ¬','åˆ':'hÃ©','å¸‚':'shÃ¬','å®Œ':'wÃ¡n',
            'å…¥':'rÃ¹','è®¤':'rÃ¨n','å§‹':'shÇ','è®°':'jÃ¬','ç›´':'zhÃ­','é¢˜':'tÃ­','å…š':'dÇng','ä¸»':'zhÇ”','é¢˜':'tÃ­','ç¨‹':'chÃ©ng',
            'æ˜':'mÃ­ng','è·¯':'lÃ¹','æ¥':'jiÄ“','æ›´':'gÃ¨ng','å·':'hÃ o','å†›':'jÅ«n','ç­‰':'dÄ›ng','å¹³':'pÃ­ng','èŠ±':'huÄ','å…³':'guÄn',
            'ç®¡':'guÇn','é':'fÄ“i','è¿':'liÃ¡n','è¨€':'yÃ¡n','è§†':'shÃ¬','ç™½':'bÃ¡i','å…ˆ':'xiÄn','æˆ˜':'zhÃ n','ä¸š':'yÃ¨','é£':'fÄ“ng',
            'å°':'tÃ¡i','åŒ—':'bÄ›i','å‘˜':'yuÃ¡n','æœ':'fÃº','å†™':'xiÄ›','è¾¹':'biÄn','æ±‚':'qiÃº','å“':'pÇn','è±¡':'xiÃ ng','çº¢':'hÃ³ng',
            'æ—©':'zÇo','æ™š':'wÇn','éš¾':'nÃ¡n','åˆ':'wÇ”','é¦™':'xiÄng','å':'zuÃ²','ä½':'zhÃ¹','å¤œ':'yÃ¨','é»‘':'hÄ“i','è¯»':'dÃº',
            'ç«™':'zhÃ n','å®¤':'shÃ¬','å‹':'yÇ’u','é£':'fÄ“i','å¤„':'chÃ¹','é’±':'qiÃ¡n','ç—…':'bÃ¬ng','å¿™':'mÃ¡ng','æ‰¾':'zhÇo','è“':'lÃ¡n',
            'å†·':'lÄ›ng','é”™':'cuÃ²','é€':'sÃ²ng','ç»¿':'lÇœ','ç´§':'jÇn','å–':'hÄ“','åƒ':'chÄ«','ç¡':'shuÃ¬','ä¹°':'mÇi','å–':'mÃ i',
            'ç©':'wÃ¡n','ç©¿':'chuÄn','ç¬‘':'xiÃ o','å“­':'kÅ«','è·‘':'pÇo','å¿«':'kuÃ i','æ…¢':'mÃ n','ç´¯':'lÃ¨i','é¥¿':'Ã¨','æ¸´':'kÄ›',
            'çƒ­':'rÃ¨','æ€•':'pÃ ','å¿˜':'wÃ ng','æ‡‚':'dÇ’ng','å¸®':'bÄng','æ¢':'huÃ n','æ‹¿':'nÃ¡','æ”¾':'fÃ ng','å¸¦':'dÃ i','çŒ«':'mÄo',
            'ç‹—':'gÇ’u','é¸Ÿ':'niÇo','é±¼':'yÃº','ç‰›':'niÃº','ç¾Š':'yÃ¡ng','é©¬':'mÇ','é¸¡':'jÄ«','é¸­':'yÄ','çŒª':'zhÅ«','è™':'hÇ”',
            'é¾™':'lÃ³ng','å…”':'tÃ¹','è›‡':'shÃ©','ç±³':'mÇ','é¥­':'fÃ n','èœ':'cÃ i','è‚‰':'rÃ²u','è›‹':'dÃ n','é¢':'miÃ n','èŒ¶':'chÃ¡',
            'é…’':'jiÇ”','ç³–':'tÃ¡ng','ç›':'yÃ¡n','æ²¹':'yÃ³u','æœ':'guÇ’','ç“œ':'guÄ','æ¡ƒ':'tÃ¡o','æ¢¨':'lÃ­','è‹¹':'pÃ­ng','è‰':'cÇo',
            'æ ‘':'shÃ¹','ç«¹':'zhÃº','æ—':'lÃ­n','æ²³':'hÃ©','æ¹–':'hÃº','æ±Ÿ':'jiÄng','é›¨':'yÇ”','é›ª':'xuÄ›','äº‘':'yÃºn','æ˜Ÿ':'xÄ«ng',
            'æ˜¥':'chÅ«n','å¤':'xiÃ ','ç§‹':'qiÅ«','å†¬':'dÅng','ä¸œ':'dÅng','å—':'nÃ¡n','åŒ—':'bÄ›i','å³':'yÃ²u','å·¦':'zuÇ’','é‡Œ':'lÇ',
            'é—¨':'mÃ©n','çª—':'chuÄng','æ¡Œ':'zhuÅ','æ¤…':'yÇ','åºŠ':'chuÃ¡ng','æˆ¿':'fÃ¡ng','æ¥¼':'lÃ³u','åŸ':'chÃ©ng','åº—':'diÃ n','æ ¡':'xiÃ o',
            'åŒ»':'yÄ«','é™¢':'yuÃ n','å…':'tÄ«ng','å¨':'chÃº','å«':'wÃ¨i','æµ´':'yÃ¹','å›­':'yuÃ¡n','åœº':'chÇng','è¡—':'jiÄ“','ç«™':'zhÃ n',
            'æ¡¥':'qiÃ¡o','å¡”':'tÇ','å¢™':'qiÃ¡ng','è·¯':'lÃ¹','é—¨':'mÃ©n','ç¥¨':'piÃ o','é’Ÿ':'zhÅng','è¡¨':'biÇo','ä¼':'sÇn','åŒ…':'bÄo',
            'ç®±':'xiÄng','è¢‹':'dÃ i','ç“¶':'pÃ­ng','ç¢—':'wÇn','æ¯':'bÄ“i','ç›˜':'pÃ¡n','ç­·':'kuÃ i','åˆ€':'dÄo','å‰':'chÄ','å‹º':'shÃ¡o',
            'ç¯':'dÄ“ng','ç«':'huÇ’','ç”µ':'diÃ n','è„‘':'nÇo','è¯':'huÃ ','è§†':'shÃ¬','ç½‘':'wÇng','ç´':'qÃ­n','ç”»':'huÃ ','æ­Œ':'gÄ“',
            'èˆ':'wÇ”','æ£‹':'qÃ­','çƒ':'qiÃº','æ³³':'yÇ’ng','è·³':'tiÃ o','å”±':'chÃ ng','ç©':'wÃ¡n','æ¸¸':'yÃ³u','æˆ':'xÃ¬','å½±':'yÇng',
            'éŸ³':'yÄ«n','ä¹':'yuÃ¨','çˆ¸':'bÃ ','å¦ˆ':'mÄ','å“¥':'gÄ“','å§':'jiÄ›','å¼Ÿ':'dÃ¬','å¦¹':'mÃ¨i','å”':'shÅ«','å§‘':'gÅ«',
            'èˆ…':'jiÃ¹','å¥¶':'nÇi','çˆ·':'yÃ©','å­™':'sÅ«n','ä¾„':'zhÃ­','ç”¥':'shÄ“ng','å©†':'pÃ³','åª³':'xÃ­','å¤«':'fÅ«','å¦»':'qÄ«',
            'ç”·':'nÃ¡n','å¥³':'nÇš','å…ˆ':'xiÄn','å':'hÃ²u','æœ‹':'pÃ©ng','å‹':'yÇ’u','åŒ':'tÃ³ng','ä¼´':'bÃ n','å®¢':'kÃ¨','å®¾':'bÄ«n',
            'é›¶':'lÃ­ng','äºŒ':'Ã¨r','å…­':'liÃ¹','ä¸ƒ':'qÄ«','å…«':'bÄ','ä¹':'jiÇ”','åƒ':'qiÄn','äº¿':'yÃ¬','å…ƒ':'yuÃ¡n','è§’':'jiÇo',
            'å—':'kuÃ i','æ¯›':'mÃ¡o','å…‹':'kÃ¨','æ–¤':'jÄ«n','å¨':'dÅ«n','ç±³':'mÇ','å˜':'lÃ­','å¯¸':'cÃ¹n','å°º':'chÇ','ä¸ˆ':'zhÃ ng',
            'äº©':'mÇ”','é¡·':'qÇng','ç§’':'miÇo','é’Ÿ':'zhÅng','åˆ»':'kÃ¨','å²':'suÃ¬','å‘¨':'zhÅu','å­£':'jÃ¬','ç”²':'jiÇ','ä¹™':'yÇ',
            'ä¸™':'bÇng','ä¸':'dÄ«ng','æˆŠ':'wÃ¹','å·±':'jÇ','åºš':'gÄ“ng','è¾›':'xÄ«n','å£¬':'rÃ©n','ç™¸':'guÇ','é¼ ':'shÇ”','ç‰›':'niÃº',
            'è°¢':'xiÃ¨','è¯·':'qÇng','æ‚¨':'nÃ­n','å—¨':'hÄi','å“¦':'Ã³','å‘¢':'ne','å—':'ma','å•Š':'Ä','å“‡':'wÄ','å˜¿':'hÄ“i',
            'å‘€':'ya','å–‚':'wÃ¨i','å—¯':'Ç¹g','å”‰':'Äi','å“ˆ':'hÄ','å˜»':'xÄ«','å‘µ':'hÄ“','å™¢':'Å','å“':'Äi','å“Ÿ':'yÅ',
            'å­—':'zÃ¬','è¯':'cÃ­','å¥':'jÃ¹','æ®µ':'duÃ n','ç¯‡':'piÄn','ç« ':'zhÄng','å†Œ':'cÃ¨','å·':'juÃ n','é¡µ':'yÃ¨','ç¬”':'bÇ',
            'çº¸':'zhÇ','å¢¨':'mÃ²','ç š':'yÃ n','å°':'yÃ¬n','ç‰ˆ':'bÇn','æŠ¥':'bÃ o','åˆŠ':'kÄn','å¿—':'zhÃ¬','ç›®':'mÃ¹','å½•':'lÃ¹'
        };
        
        // å£°è°ƒè½¬æ¢æ˜ å°„
        const toneMarks = {
            'a': ['Ä', 'Ã¡', 'Ç', 'Ã ', 'a'],
            'e': ['Ä“', 'Ã©', 'Ä›', 'Ã¨', 'e'],
            'i': ['Ä«', 'Ã­', 'Ç', 'Ã¬', 'i'],
            'o': ['Å', 'Ã³', 'Ç’', 'Ã²', 'o'],
            'u': ['Å«', 'Ãº', 'Ç”', 'Ã¹', 'u'],
            'Ã¼': ['Ç–', 'Ç–', 'Çš', 'Çœ', 'Ã¼'],
            'v': ['Ç–', 'Ç˜', 'Çš', 'Çœ', 'Ã¼']
        };
        
        // å£°è°ƒç¬¦å·åˆ°æ•°å­—çš„æ˜ å°„
        const toneToNumber = {
            'Ä': 'a1', 'Ã¡': 'a2', 'Ç': 'a3', 'Ã ': 'a4',
            'Ä“': 'e1', 'Ã©': 'e2', 'Ä›': 'e3', 'Ã¨': 'e4',
            'Ä«': 'i1', 'Ã­': 'i2', 'Ç': 'i3', 'Ã¬': 'i4',
            'Å': 'o1', 'Ã³': 'o2', 'Ç’': 'o3', 'Ã²': 'o4',
            'Å«': 'u1', 'Ãº': 'u2', 'Ç”': 'u3', 'Ã¹': 'u4',
            'Ç–': 'v1', 'Ç˜': 'v2', 'Çš': 'v3', 'Çœ': 'v4'
        };
        
        // å°†å¸¦å£°è°ƒçš„æ‹¼éŸ³è½¬æ¢ä¸ºæ•°å­—å½¢å¼
        function convertToNumberTone(pinyin) {
            let result = pinyin;
            let tone = '';
            for (const [mark, replacement] of Object.entries(toneToNumber)) {
                if (pinyin.includes(mark)) {
                    result = pinyin.replace(mark, replacement[0]);
                    tone = replacement[1];
                    break;
                }
            }
            return tone ? result + tone : result;
        }
        
        // å»é™¤å£°è°ƒ
        function removeTone(pinyin) {
            let result = pinyin;
            for (const [mark, replacement] of Object.entries(toneToNumber)) {
                result = result.replace(mark, replacement[0]);
            }
            return result.replace(/[1-4]/g, '');
        }
        
        // è¾“å…¥æ¡†äº‹ä»¶ç›‘å¬
        document.getElementById('input-text').addEventListener('input', function() {
            document.getElementById('input-count').textContent = this.value.length;
        });
        
        // å®‰å…¨åœ°åˆ›å»ºå…ƒç´ 
        function createPinyinElement(pinyin, hanzi) {
            const span = document.createElement('span');
            span.className = 'pinyin-char';
            
            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'pinyin';
            pinyinSpan.textContent = pinyin;
            
            const hanziSpan = document.createElement('span');
            hanziSpan.className = 'hanzi';
            hanziSpan.textContent = hanzi;
            
            span.appendChild(pinyinSpan);
            span.appendChild(hanziSpan);
            return span;
        }
        
        // è½¬æ¢å‡½æ•°
        function convert() {
            const input = document.getElementById('input-text').value;
            const showHanzi = document.getElementById('showHanzi').checked;
            const toneFormat = document.getElementById('toneFormat').value;
            const outputArea = document.getElementById('output-area');
            
            // æ¸…ç©ºè¾“å‡ºåŒºåŸŸ
            outputArea.textContent = '';
            
            if (!input.trim()) {
                outputArea.textContent = 'è¯·è¾“å…¥è¦è½¬æ¢çš„æ±‰å­—...';
                return;
            }
            
            let pinyinOnly = [];
            const fragment = document.createDocumentFragment();
            
            for (const char of input) {
                let pinyin = pinyinDict[char];
                
                if (pinyin) {
                    // æ ¹æ®æ ¼å¼è°ƒæ•´æ‹¼éŸ³
                    if (toneFormat === 'number') {
                        pinyin = convertToNumberTone(pinyin);
                    } else if (toneFormat === 'none') {
                        pinyin = removeTone(pinyin);
                    }
                    
                    if (showHanzi) {
                        fragment.appendChild(createPinyinElement(pinyin, char));
                    } else {
                        pinyinOnly.push(pinyin);
                    }
                } else if (/[\u4e00-\u9fff]/.test(char)) {
                    // æœªæ”¶å½•çš„æ±‰å­—
                    if (showHanzi) {
                        fragment.appendChild(createPinyinElement('?', char));
                    } else {
                        pinyinOnly.push('?');
                    }
                } else if (char === '\n') {
                    if (showHanzi) {
                        fragment.appendChild(document.createElement('br'));
                    } else {
                        pinyinOnly.push('\n');
                    }
                } else {
                    // éæ±‰å­—å­—ç¬¦ä¿æŒåŸæ ·
                    if (showHanzi) {
                        fragment.appendChild(createPinyinElement('\u00A0', char));
                    } else {
                        pinyinOnly.push(char);
                    }
                }
            }
            
            if (showHanzi) {
                outputArea.appendChild(fragment);
            } else {
                outputArea.textContent = pinyinOnly.join(' ').replace(/ +/g, ' ').trim();
            }
        }
        
        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('input-text').value = '';
            document.getElementById('input-count').textContent = '0';
            document.getElementById('output-area').textContent = 'è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
        }
        
        // å¤åˆ¶ç»“æœ
        function copyResult() {
            const resultEl = document.getElementById('output-area');
            const text = resultEl.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 1500);
            });
        }
        
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }
        
        // åˆå§‹åŒ–ä¸»é¢˜
        (function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        })();
        
        // é€‰é¡¹å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è½¬æ¢
        document.querySelectorAll('#showTone, #showHanzi, #toneFormat').forEach(el => {
            el.addEventListener('change', () => {
                if (document.getElementById('input-text').value.trim()) {
                    convert();
                }
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤åˆ©è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body {
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        .card {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            border: 1px solid var(--pico-muted-border-color);
        }
        .card h3 {
            margin: 0 0 1rem 0;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        .form-group small {
            color: var(--pico-muted-color);
        }
        .input-with-unit {
            display: flex;
            align-items: center;
        }
        .input-with-unit input {
            flex: 1;
            margin: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-with-unit .unit {
            background: var(--pico-muted-border-color);
            padding: 0.5rem 1rem;
            border-top-right-radius: var(--pico-border-radius);
            border-bottom-right-radius: var(--pico-border-radius);
            font-size: 0.9rem;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }
        .result-card {
            padding: 1rem;
            background: var(--pico-code-background-color);
            border-radius: var(--pico-border-radius);
            text-align: center;
        }
        .result-card.highlight {
            background: var(--pico-primary);
            color: var(--pico-primary-inverse);
        }
        .result-card .label {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        .result-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
        }
        .chart-container {
            margin-top: 1rem;
            height: 300px;
            position: relative;
        }
        .chart-svg {
            width: 100%;
            height: 100%;
        }
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        .schedule-table {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .schedule-table table {
            font-size: 0.85rem;
        }
        .schedule-table th, .schedule-table td {
            padding: 0.5rem;
            text-align: right;
        }
        .schedule-table th:first-child, .schedule-table td:first-child {
            text-align: left;
        }
        .formula {
            background: var(--pico-code-background-color);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h2>å¤åˆ©è®¡ç®—å™¨</h2>
            <button class="outline" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ æ·±è‰²</button>
        </header>

        <div class="main-grid">
            <div class="card">
                <h3>è¾“å…¥å‚æ•°</h3>
                
                <div class="form-group">
                    <label>æœ¬é‡‘ (P)</label>
                    <div class="input-with-unit">
                        <input type="number" id="principal" value="10000" min="0" step="100" oninput="calculate()">
                        <span class="unit">å…ƒ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>å¹´åˆ©ç‡ (r)</label>
                    <div class="input-with-unit">
                        <input type="number" id="rate" value="5" min="0" max="100" step="0.1" oninput="calculate()">
                        <span class="unit">%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>æŠ•èµ„æœŸé™ (t)</label>
                    <div class="input-with-unit">
                        <input type="number" id="years" value="10" min="1" max="50" step="1" oninput="calculate()">
                        <span class="unit">å¹´</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>å¤åˆ©é¢‘ç‡ (n)</label>
                    <select id="frequency" onchange="calculate()">
                        <option value="1">æ¯å¹´ (å¹´å¤åˆ©)</option>
                        <option value="2">æ¯åŠå¹´</option>
                        <option value="4">æ¯å­£åº¦</option>
                        <option value="12" selected>æ¯æœˆ (æœˆå¤åˆ©)</option>
                        <option value="365">æ¯æ—¥</option>
                        <option value="continuous">è¿ç»­å¤åˆ©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>æ¯æœŸè¿½åŠ æŠ•å…¥ <small>(å¯é€‰)</small></label>
                    <div class="input-with-unit">
                        <input type="number" id="contribution" value="0" min="0" step="100" oninput="calculate()">
                        <span class="unit">å…ƒ</span>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card highlight">
                        <div class="label">æœ€ç»ˆé‡‘é¢</div>
                        <div class="value" id="finalAmount">-</div>
                    </div>
                    <div class="result-card">
                        <div class="label">æ€»åˆ©æ¯æ”¶ç›Š</div>
                        <div class="value" id="totalInterest">-</div>
                    </div>
                    <div class="result-card">
                        <div class="label">æœ¬é‡‘æ€»æŠ•å…¥</div>
                        <div class="value" id="totalPrincipal">-</div>
                    </div>
                    <div class="result-card">
                        <div class="label">æ”¶ç›Šç‡</div>
                        <div class="value" id="returnRate">-</div>
                    </div>
                </div>
                
                <div class="formula">
                    <strong>å¤åˆ©å…¬å¼:</strong><br>
                    A = P(1 + r/n)^(nt)<br><br>
                    P = æœ¬é‡‘<br>
                    r = å¹´åˆ©ç‡<br>
                    n = å¤åˆ©é¢‘ç‡<br>
                    t = å¹´æ•°<br>
                    A = æœ€ç»ˆé‡‘é¢
                </div>
            </div>
            
            <div class="card">
                <h3>å¢é•¿å›¾è¡¨</h3>
                <div class="chart-container">
                    <svg class="chart-svg" id="chart" viewBox="0 0 400 280"></svg>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--pico-primary);"></div>
                        <span>æ€»é‡‘é¢</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>æœ¬é‡‘</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2ecc71;"></div>
                        <span>åˆ©æ¯</span>
                    </div>
                </div>
                
                <details>
                    <summary>å¹´åº¦æ˜ç»†è¡¨</summary>
                    <div class="schedule-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>å¹´ä»½</th>
                                    <th>æœ¬é‡‘</th>
                                    <th>åˆ©æ¯</th>
                                    <th>æ€»é‡‘é¢</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody"></tbody>
                        </table>
                    </div>
                </details>
            </div>
        </div>
    </main>

    <script>
        function calculate() {
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const rate = parseFloat(document.getElementById('rate').value) / 100 || 0;
            const years = parseInt(document.getElementById('years').value) || 0;
            const frequencyVal = document.getElementById('frequency').value;
            const contribution = parseFloat(document.getElementById('contribution').value) || 0;
            
            const isContinuous = frequencyVal === 'continuous';
            const frequency = isContinuous ? 12 : parseInt(frequencyVal);
            
            let finalAmount, totalPrincipal, schedule = [];
            
            if (isContinuous && contribution === 0) {
                // Continuous compound interest: A = P * e^(rt)
                finalAmount = principal * Math.exp(rate * years);
                totalPrincipal = principal;
            } else {
                // Calculate year by year for the chart
                let currentAmount = principal;
                let totalContributions = principal;
                
                for (let year = 1; year <= years; year++) {
                    // Compound interest for this year
                    if (isContinuous) {
                        currentAmount = currentAmount * Math.exp(rate);
                    } else {
                        for (let period = 0; period < frequency; period++) {
                            currentAmount = currentAmount * (1 + rate / frequency);
                            currentAmount += contribution;
                            totalContributions += contribution;
                        }
                    }
                    
                    if (!isContinuous && contribution === 0) {
                        // Simple compound formula for no contributions
                        currentAmount = principal * Math.pow(1 + rate / frequency, frequency * year);
                    }
                    
                    schedule.push({
                        year: year,
                        principal: totalContributions,
                        amount: currentAmount,
                        interest: currentAmount - totalContributions
                    });
                }
                
                finalAmount = currentAmount;
                totalPrincipal = totalContributions;
            }
            
            // If no contributions, calculate simple compound
            if (contribution === 0) {
                schedule = [];
                for (let year = 1; year <= years; year++) {
                    let amount;
                    if (isContinuous) {
                        amount = principal * Math.exp(rate * year);
                    } else {
                        amount = principal * Math.pow(1 + rate / frequency, frequency * year);
                    }
                    schedule.push({
                        year: year,
                        principal: principal,
                        amount: amount,
                        interest: amount - principal
                    });
                }
                finalAmount = schedule[schedule.length - 1].amount;
                totalPrincipal = principal;
            }
            
            const totalInterest = finalAmount - totalPrincipal;
            const returnRate = totalPrincipal > 0 ? (totalInterest / totalPrincipal) * 100 : 0;
            
            // Update display
            document.getElementById('finalAmount').textContent = formatMoney(finalAmount);
            document.getElementById('totalInterest').textContent = formatMoney(totalInterest);
            document.getElementById('totalPrincipal').textContent = formatMoney(totalPrincipal);
            document.getElementById('returnRate').textContent = returnRate.toFixed(2) + '%';
            
            // Update chart
            drawChart(schedule);
            
            // Update schedule table
            updateScheduleTable(schedule);
        }
        
        function formatMoney(amount) {
            if (amount >= 100000000) {
                return (amount / 100000000).toFixed(2) + 'äº¿';
            } else if (amount >= 10000) {
                return (amount / 10000).toFixed(2) + 'ä¸‡';
            }
            return amount.toFixed(2);
        }
        
        function drawChart(schedule) {
            const svg = document.getElementById('chart');
            const width = 400;
            const height = 280;
            const padding = { top: 20, right: 20, bottom: 40, left: 60 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            if (schedule.length === 0) {
                svg.textContent = '';
                return;
            }
            
            const maxAmount = Math.max.apply(null, schedule.map(function(s) { return s.amount; }));
            const minYear = 0;
            const maxYear = schedule.length;
            
            // Clear and setup
            svg.textContent = '';
            
            // Create group for chart area
            const chartArea = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            chartArea.setAttribute('transform', 'translate(' + padding.left + ',' + padding.top + ')');
            
            // Draw grid lines
            for (let i = 0; i <= 5; i++) {
                const y = chartHeight - (i / 5) * chartHeight;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', 0);
                line.setAttribute('y1', y);
                line.setAttribute('x2', chartWidth);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', 'currentColor');
                line.setAttribute('stroke-opacity', '0.1');
                chartArea.appendChild(line);
                
                // Y axis labels
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', -5);
                label.setAttribute('y', y + 4);
                label.setAttribute('text-anchor', 'end');
                label.setAttribute('font-size', '10');
                label.setAttribute('fill', 'currentColor');
                label.setAttribute('opacity', '0.6');
                label.textContent = formatMoney((i / 5) * maxAmount);
                chartArea.appendChild(label);
            }
            
            // Calculate points
            const points = schedule.map(function(s, i) {
                return {
                    x: (i + 1) / maxYear * chartWidth,
                    y: chartHeight - (s.amount / maxAmount) * chartHeight,
                    principalY: chartHeight - (s.principal / maxAmount) * chartHeight,
                    interestY: chartHeight - (s.interest / maxAmount) * chartHeight
                };
            });
            
            // Draw principal area (blue)
            let principalPath = 'M 0 ' + chartHeight;
            points.forEach(function(p) { principalPath += ' L ' + p.x + ' ' + p.principalY; });
            principalPath += ' L ' + chartWidth + ' ' + chartHeight + ' Z';
            
            const principalArea = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            principalArea.setAttribute('d', principalPath);
            principalArea.setAttribute('fill', '#3498db');
            principalArea.setAttribute('opacity', '0.3');
            chartArea.appendChild(principalArea);
            
            // Draw total amount line
            let linePath = 'M 0 ' + chartHeight;
            points.forEach(function(p) { linePath += ' L ' + p.x + ' ' + p.y; });
            
            const totalLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            totalLine.setAttribute('d', linePath);
            totalLine.setAttribute('fill', 'none');
            totalLine.setAttribute('stroke', 'var(--pico-primary)');
            totalLine.setAttribute('stroke-width', '2');
            chartArea.appendChild(totalLine);
            
            // Draw interest area (green) between principal and total
            let interestPath = 'M ' + points[0].x + ' ' + points[0].principalY;
            points.forEach(function(p) { interestPath += ' L ' + p.x + ' ' + p.y; });
            for (let i = points.length - 1; i >= 0; i--) {
                interestPath += ' L ' + points[i].x + ' ' + points[i].principalY;
            }
            interestPath += ' Z';
            
            const interestArea = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            interestArea.setAttribute('d', interestPath);
            interestArea.setAttribute('fill', '#2ecc71');
            interestArea.setAttribute('opacity', '0.3');
            chartArea.appendChild(interestArea);
            
            // Draw points
            points.forEach(function(p) {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', p.x);
                circle.setAttribute('cy', p.y);
                circle.setAttribute('r', '3');
                circle.setAttribute('fill', 'var(--pico-primary)');
                chartArea.appendChild(circle);
            });
            
            // X axis labels
            const step = Math.ceil(schedule.length / 10);
            schedule.forEach(function(s, i) {
                if ((i + 1) % step === 0 || i === 0 || i === schedule.length - 1) {
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', (i + 1) / maxYear * chartWidth);
                    label.setAttribute('y', chartHeight + 20);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('font-size', '10');
                    label.setAttribute('fill', 'currentColor');
                    label.setAttribute('opacity', '0.6');
                    label.textContent = s.year + 'å¹´';
                    chartArea.appendChild(label);
                }
            });
            
            svg.appendChild(chartArea);
        }
        
        function updateScheduleTable(schedule) {
            const tbody = document.getElementById('scheduleBody');
            tbody.textContent = '';
            
            schedule.forEach(function(s) {
                const row = document.createElement('tr');
                
                const yearCell = document.createElement('td');
                yearCell.textContent = 'ç¬¬' + s.year + 'å¹´';
                row.appendChild(yearCell);
                
                const principalCell = document.createElement('td');
                principalCell.textContent = s.principal.toFixed(2);
                row.appendChild(principalCell);
                
                const interestCell = document.createElement('td');
                interestCell.textContent = s.interest.toFixed(2);
                row.appendChild(interestCell);
                
                const amountCell = document.createElement('td');
                amountCell.textContent = s.amount.toFixed(2);
                row.appendChild(amountCell);
                
                tbody.appendChild(row);
            });
        }
        
        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.getElementById('themeBtn');
            if (html.getAttribute('data-theme') === 'light') {
                html.setAttribute('data-theme', 'dark');
                btn.textContent = 'â˜€ï¸ æµ…è‰²';
            } else {
                html.setAttribute('data-theme', 'light');
                btn.textContent = 'ğŸŒ™ æ·±è‰²';
            }
        }
        
        // Initialize
        calculate();
    </script>
</body>
</html>

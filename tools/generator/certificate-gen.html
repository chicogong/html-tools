<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯ä¹¦ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --primary-color: #1095c1;
        }
        
        body {
            padding: 1rem;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .header h1 {
            margin: 0;
        }
        
        .theme-toggle {
            cursor: pointer;
            font-size: 1.5rem;
            background: none;
            border: none;
            padding: 0.5rem;
        }
        
        .container-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1rem;
        }
        
        @media (max-width: 900px) {
            .container-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .card h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--pico-muted-border-color);
            padding-bottom: 0.5rem;
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .template-btn {
            padding: 0.75rem;
            border: 2px solid var(--pico-muted-border-color);
            border-radius: 8px;
            background: var(--pico-card-background-color);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .template-btn:hover {
            border-color: var(--primary-color);
        }
        
        .template-btn.active {
            border-color: var(--primary-color);
            background: var(--pico-primary-focus);
        }
        
        .template-btn .icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .template-btn .name {
            font-size: 0.85rem;
        }
        
        .color-picker-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .color-picker-group input[type="color"] {
            width: 50px;
            height: 40px;
            padding: 0;
            border: none;
            cursor: pointer;
        }
        
        .color-picker-group label {
            flex: 1;
            margin-bottom: 0;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        /* è¯ä¹¦é¢„è§ˆåŒºåŸŸ */
        .preview-wrapper {
            overflow: auto;
            padding: 1rem;
            background: #e0e0e0;
            border-radius: var(--pico-border-radius);
            min-height: 500px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        [data-theme="dark"] .preview-wrapper {
            background: #2a2a2a;
        }
        
        /* è¯ä¹¦åŸºç¡€æ ·å¼ */
        .certificate {
            width: 800px;
            min-height: 566px;
            padding: 40px;
            box-sizing: border-box;
            position: relative;
            font-family: 'SimSun', 'STSong', serif;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .certificate-inner {
            height: 100%;
            padding: 30px;
            position: relative;
        }
        
        .certificate-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .certificate-logo {
            max-height: 60px;
            margin-bottom: 10px;
        }
        
        .certificate-org {
            font-size: 1.2rem;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .certificate-title {
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 8px;
            margin: 20px 0;
        }
        
        .certificate-body {
            text-align: center;
            line-height: 2;
            font-size: 1.1rem;
        }
        
        .certificate-name {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            display: inline-block;
            border-bottom: 2px solid currentColor;
            padding: 0 40px 5px;
        }
        
        .certificate-content {
            max-width: 600px;
            margin: 0 auto;
            text-align: justify;
            text-indent: 2em;
        }
        
        .certificate-footer {
            position: absolute;
            bottom: 40px;
            left: 40px;
            right: 40px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .certificate-date {
            font-size: 0.95rem;
        }
        
        .certificate-seal {
            text-align: center;
        }
        
        .seal-placeholder {
            width: 100px;
            height: 100px;
            border: 2px dashed #999;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: #999;
        }
        
        .certificate-number {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 0.8rem;
            color: #666;
        }
        
        /* æ¨¡æ¿æ ·å¼ - è£èª‰è¯ä¹¦ */
        .template-honor {
            background: linear-gradient(135deg, #fff9e6 0%, #fff5cc 100%);
            border: 8px double #c9a227;
        }
        
        .template-honor .certificate-inner {
            border: 2px solid #c9a227;
        }
        
        .template-honor .certificate-title {
            color: #8b0000;
        }
        
        .template-honor .certificate-name {
            color: #c9a227;
        }
        
        /* æ¨¡æ¿æ ·å¼ - ç»“ä¸šè¯ä¹¦ */
        .template-completion {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f2ff 100%);
            border: 6px solid #1a5276;
        }
        
        .template-completion .certificate-inner {
            border: 2px solid #1a5276;
        }
        
        .template-completion .certificate-title {
            color: #1a5276;
        }
        
        .template-completion .certificate-name {
            color: #1a5276;
        }
        
        /* æ¨¡æ¿æ ·å¼ - åŸ¹è®­è¯ä¹¦ */
        .template-training {
            background: linear-gradient(135deg, #f5fff5 0%, #e6ffe6 100%);
            border: 6px solid #228b22;
        }
        
        .template-training .certificate-inner {
            border: 2px solid #228b22;
        }
        
        .template-training .certificate-title {
            color: #228b22;
        }
        
        .template-training .certificate-name {
            color: #2e8b2e;
        }
        
        /* æ¨¡æ¿æ ·å¼ - ä¼˜ç§€å‘˜å·¥ */
        .template-employee {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            border: 6px solid #8b0000;
        }
        
        .template-employee .certificate-inner {
            border: 2px solid #8b0000;
        }
        
        .template-employee .certificate-title {
            color: #8b0000;
        }
        
        .template-employee .certificate-name {
            color: #b22222;
        }
        
        /* æ¨¡æ¿æ ·å¼ - å¿—æ„¿è€… */
        .template-volunteer {
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4ec 100%);
            border: 6px solid #c71585;
        }
        
        .template-volunteer .certificate-inner {
            border: 2px solid #c71585;
        }
        
        .template-volunteer .certificate-title {
            color: #c71585;
        }
        
        .template-volunteer .certificate-name {
            color: #db7093;
        }
        
        /* æ¨¡æ¿æ ·å¼ - å¥–çŠ¶ */
        .template-award {
            background: linear-gradient(135deg, #fffef0 0%, #fff8dc 100%);
            border: 8px double #ffd700;
        }
        
        .template-award .certificate-inner {
            border: 3px solid #ffd700;
            background: linear-gradient(135deg, rgba(255,215,0,0.05) 0%, rgba(255,215,0,0.1) 100%);
        }
        
        .template-award .certificate-title {
            color: #b8860b;
        }
        
        .template-award .certificate-name {
            color: #daa520;
        }
        
        /* æ¨¡æ¿æ ·å¼ - è˜ä¹¦ */
        .template-appointment {
            background: linear-gradient(135deg, #f8f8ff 0%, #e6e6fa 100%);
            border: 6px solid #4b0082;
        }
        
        .template-appointment .certificate-inner {
            border: 2px solid #4b0082;
        }
        
        .template-appointment .certificate-title {
            color: #4b0082;
        }
        
        .template-appointment .certificate-name {
            color: #6a5acd;
        }
        
        /* æ¨¡æ¿æ ·å¼ - æ„Ÿè°¢çŠ¶ */
        .template-thanks {
            background: linear-gradient(135deg, #f0ffff 0%, #e0ffff 100%);
            border: 6px solid #008b8b;
        }
        
        .template-thanks .certificate-inner {
            border: 2px solid #008b8b;
        }
        
        .template-thanks .certificate-title {
            color: #008b8b;
        }
        
        .template-thanks .certificate-name {
            color: #20b2aa;
        }
        
        /* æ‰“å°æ ·å¼ */
        @media print {
            body {
                padding: 0;
                background: white;
            }
            
            .no-print {
                display: none !important;
            }
            
            .preview-wrapper {
                background: none;
                padding: 0;
                overflow: visible;
            }
            
            .certificate {
                box-shadow: none;
                margin: 0;
                page-break-after: always;
            }
        }
        
        /* è£…é¥°è§’ */
        .corner-decoration {
            position: absolute;
            width: 60px;
            height: 60px;
            opacity: 0.6;
        }
        
        .corner-tl {
            top: 10px;
            left: 10px;
            border-top: 3px solid currentColor;
            border-left: 3px solid currentColor;
        }
        
        .corner-tr {
            top: 10px;
            right: 10px;
            border-top: 3px solid currentColor;
            border-right: 3px solid currentColor;
        }
        
        .corner-bl {
            bottom: 10px;
            left: 10px;
            border-bottom: 3px solid currentColor;
            border-left: 3px solid currentColor;
        }
        
        .corner-br {
            bottom: 10px;
            right: 10px;
            border-bottom: 3px solid currentColor;
            border-right: 3px solid currentColor;
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <div class="header no-print">
            <h1>ğŸ† è¯ä¹¦ç”Ÿæˆå™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
        </div>
        
        <div class="container-grid">
            <!-- å·¦ä¾§ï¼šè®¾ç½®é¢æ¿ -->
            <div class="no-print">
                <!-- æ¨¡æ¿é€‰æ‹© -->
                <div class="card">
                    <h3>ğŸ“„ é€‰æ‹©æ¨¡æ¿</h3>
                    <div class="template-grid" id="templateGrid">
                        <div class="template-btn active" data-template="honor" onclick="selectTemplate('honor')">
                            <span class="icon">ğŸ…</span>
                            <span class="name">è£èª‰è¯ä¹¦</span>
                        </div>
                        <div class="template-btn" data-template="completion" onclick="selectTemplate('completion')">
                            <span class="icon">ğŸ“œ</span>
                            <span class="name">ç»“ä¸šè¯ä¹¦</span>
                        </div>
                        <div class="template-btn" data-template="training" onclick="selectTemplate('training')">
                            <span class="icon">ğŸ“š</span>
                            <span class="name">åŸ¹è®­è¯ä¹¦</span>
                        </div>
                        <div class="template-btn" data-template="employee" onclick="selectTemplate('employee')">
                            <span class="icon">â­</span>
                            <span class="name">ä¼˜ç§€å‘˜å·¥</span>
                        </div>
                        <div class="template-btn" data-template="volunteer" onclick="selectTemplate('volunteer')">
                            <span class="icon">â¤ï¸</span>
                            <span class="name">å¿—æ„¿è€…è¯ä¹¦</span>
                        </div>
                        <div class="template-btn" data-template="award" onclick="selectTemplate('award')">
                            <span class="icon">ğŸ†</span>
                            <span class="name">å¥–çŠ¶</span>
                        </div>
                        <div class="template-btn" data-template="appointment" onclick="selectTemplate('appointment')">
                            <span class="icon">ğŸ“‹</span>
                            <span class="name">è˜ä¹¦</span>
                        </div>
                        <div class="template-btn" data-template="thanks" onclick="selectTemplate('thanks')">
                            <span class="icon">ğŸ™</span>
                            <span class="name">æ„Ÿè°¢çŠ¶</span>
                        </div>
                    </div>
                </div>
                
                <!-- é¢å‘æœºæ„ -->
                <div class="card">
                    <h3>ğŸ¢ é¢å‘æœºæ„</h3>
                    <label>
                        æœºæ„åç§°
                        <input type="text" id="orgName" placeholder="XXå…¬å¸/å­¦æ ¡/ç»„ç»‡" oninput="updatePreview()">
                    </label>
                    <label>
                        Logoï¼ˆå¯é€‰ï¼‰
                        <input type="file" id="logoFile" accept="image/*" onchange="handleLogoUpload(event)">
                    </label>
                </div>
                
                <!-- è¯ä¹¦å†…å®¹ -->
                <div class="card">
                    <h3>âœï¸ è¯ä¹¦å†…å®¹</h3>
                    <label>
                        è¯ä¹¦æ ‡é¢˜
                        <input type="text" id="certTitle" placeholder="è£èª‰è¯ä¹¦" oninput="updatePreview()">
                    </label>
                    <label>
                        è·å¾—è€…å§“å
                        <input type="text" id="recipientName" placeholder="å¼ ä¸‰" oninput="updatePreview()">
                    </label>
                    <label>
                        è¯ä¹¦æ­£æ–‡
                        <textarea id="certContent" rows="4" placeholder="åœ¨XXæ´»åŠ¨ä¸­è¡¨ç°çªå‡ºï¼Œç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ã€‚" oninput="updatePreview()"></textarea>
                    </label>
                    <div class="form-row">
                        <label>
                            é¢å‘æ—¥æœŸ
                            <input type="date" id="issueDate" oninput="updatePreview()">
                        </label>
                        <label>
                            è¯ä¹¦ç¼–å·
                            <input type="text" id="certNumber" placeholder="CERT-001" oninput="updatePreview()">
                        </label>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="action-buttons">
                    <button onclick="printCertificate()">ğŸ–¨ï¸ æ‰“å°</button>
                    <button onclick="exportPDF()" class="secondary">ğŸ“¥ å¯¼å‡ºPDF</button>
                </div>
                
                <div class="action-buttons" style="margin-top: 0.5rem;">
                    <button onclick="saveData()" class="contrast">ğŸ’¾ ä¿å­˜</button>
                    <button onclick="loadData()" class="outline">ğŸ“‚ åŠ è½½</button>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šè¯ä¹¦é¢„è§ˆ -->
            <div class="preview-wrapper">
                <div class="certificate template-honor" id="certificatePreview">
                    <div class="corner-decoration corner-tl"></div>
                    <div class="corner-decoration corner-tr"></div>
                    <div class="corner-decoration corner-bl"></div>
                    <div class="corner-decoration corner-br"></div>
                    <div class="certificate-number" id="previewNumber">ç¼–å·ï¼šCERT-001</div>
                    <div class="certificate-inner">
                        <div class="certificate-header">
                            <img class="certificate-logo" id="previewLogo" src="" alt="" style="display: none;">
                            <div class="certificate-org" id="previewOrg">XXå…¬å¸</div>
                            <div class="certificate-title" id="previewTitle">è£èª‰è¯ä¹¦</div>
                        </div>
                        <div class="certificate-body">
                            <div class="certificate-name" id="previewName">å¼ ä¸‰</div>
                            <div class="certificate-content" id="previewContent">
                                åœ¨XXæ´»åŠ¨ä¸­è¡¨ç°çªå‡ºï¼Œç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ã€‚
                            </div>
                        </div>
                        <div class="certificate-footer">
                            <div class="certificate-date" id="previewDate">é¢å‘æ—¥æœŸï¼š2024å¹´1æœˆ1æ—¥</div>
                            <div class="certificate-seal">
                                <div class="seal-placeholder">ç›–ç« å¤„</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- html2pdfåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script>
        // å½“å‰æ¨¡æ¿
        let currentTemplate = 'honor';
        let logoDataUrl = '';
        
        // æ¨¡æ¿é…ç½®
        const templateConfig = {
            honor: {
                title: 'è£èª‰è¯ä¹¦',
                content: 'åœ¨å·¥ä½œä¸­è¡¨ç°ä¼˜å¼‚ï¼Œæˆç»©çªå‡ºï¼Œç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ã€‚'
            },
            completion: {
                title: 'ç»“ä¸šè¯ä¹¦',
                content: 'å·²å®Œæˆæœ¬æœºæ„ä¸¾åŠçš„åŸ¹è®­è¯¾ç¨‹å…¨éƒ¨å­¦ä¹ å†…å®¹ï¼Œæˆç»©åˆæ ¼ï¼Œå‡†äºˆç»“ä¸šã€‚'
            },
            training: {
                title: 'åŸ¹è®­è¯ä¹¦',
                content: 'å‚åŠ äº†æœ¬æœºæ„ä¸¾åŠçš„ä¸“ä¸šåŸ¹è®­è¯¾ç¨‹ï¼Œç»è€ƒæ ¸åˆæ ¼ï¼Œç‰¹é¢å‘æ­¤è¯ä¹¦ã€‚'
            },
            employee: {
                title: 'ä¼˜ç§€å‘˜å·¥è¯ä¹¦',
                content: 'åœ¨å¹´åº¦å·¥ä½œä¸­å‹¤å‹‰å°½è´£ã€ä¸šç»©çªå‡ºï¼Œè¢«è¯„ä¸ºä¼˜ç§€å‘˜å·¥ï¼Œç‰¹å‘æ­¤è¯ã€‚'
            },
            volunteer: {
                title: 'å¿—æ„¿è€…è¯ä¹¦',
                content: 'ç§¯æå‚ä¸å¿—æ„¿æœåŠ¡æ´»åŠ¨ï¼Œæ— ç§å¥‰çŒ®ï¼Œè¡¨ç°ä¼˜ç§€ï¼Œç‰¹é¢å‘æ­¤è¯ä¹¦ä»¥è¡¨å½°ã€‚'
            },
            award: {
                title: 'å¥– çŠ¶',
                content: 'åœ¨æœ¬æ¬¡æ´»åŠ¨/æ¯”èµ›ä¸­è¡¨ç°å‡ºè‰²ï¼Œè£è·ä¼˜ç§€å¥–ï¼Œç‰¹å‘æ­¤çŠ¶ï¼Œä»¥èµ„é¼“åŠ±ã€‚'
            },
            appointment: {
                title: 'è˜ ä¹¦',
                content: 'ç»ç ”ç©¶å†³å®šï¼Œè˜ä»»ä¸ºæœ¬æœºæ„é¡¾é—®/ä¸“å®¶ï¼Œè˜æœŸä¸€å¹´ï¼Œç‰¹å‘æ­¤è¯ã€‚'
            },
            thanks: {
                title: 'æ„Ÿè°¢çŠ¶',
                content: 'æ„Ÿè°¢æ‚¨å¯¹æœ¬æœºæ„å·¥ä½œçš„å¤§åŠ›æ”¯æŒä¸å¸®åŠ©ï¼Œç‰¹é¢å‘æ­¤çŠ¶ï¼Œä»¥è¡¨è°¢æ„ã€‚'
            }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('issueDate').value = today;
            
            // ç”Ÿæˆè¯ä¹¦ç¼–å·
            document.getElementById('certNumber').value = 'CERT-' + Date.now().toString().slice(-6);
            
            // è®¾ç½®é»˜è®¤å†…å®¹
            document.getElementById('certTitle').value = templateConfig.honor.title;
            document.getElementById('certContent').value = templateConfig.honor.content;
            
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('cert-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
            
            updatePreview();
        });
        
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('cert-theme', newTheme);
        }
        
        // é€‰æ‹©æ¨¡æ¿
        function selectTemplate(template) {
            currentTemplate = template;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const targetBtn = document.querySelector('[data-template="' + template + '"]');
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // æ›´æ–°è¯ä¹¦æ ·å¼
            const cert = document.getElementById('certificatePreview');
            cert.className = 'certificate template-' + template;
            
            // æ›´æ–°é»˜è®¤å†…å®¹
            const config = templateConfig[template];
            document.getElementById('certTitle').value = config.title;
            document.getElementById('certContent').value = config.content;
            
            updatePreview();
        }
        
        // å¤„ç†Logoä¸Šä¼ 
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoDataUrl = e.target.result;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return year + 'å¹´' + month + 'æœˆ' + day + 'æ—¥';
        }
        
        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const orgName = document.getElementById('orgName').value || 'XXå…¬å¸';
            const certTitle = document.getElementById('certTitle').value || 'è£èª‰è¯ä¹¦';
            const recipientName = document.getElementById('recipientName').value || 'å¼ ä¸‰';
            const certContent = document.getElementById('certContent').value || 'ç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ã€‚';
            const issueDate = document.getElementById('issueDate').value;
            const certNumber = document.getElementById('certNumber').value || 'CERT-001';
            
            document.getElementById('previewOrg').textContent = orgName;
            document.getElementById('previewTitle').textContent = certTitle;
            document.getElementById('previewName').textContent = recipientName;
            document.getElementById('previewContent').textContent = certContent;
            document.getElementById('previewDate').textContent = 'é¢å‘æ—¥æœŸï¼š' + formatDate(issueDate);
            document.getElementById('previewNumber').textContent = 'ç¼–å·ï¼š' + certNumber;
            
            const logoImg = document.getElementById('previewLogo');
            if (logoDataUrl) {
                logoImg.src = logoDataUrl;
                logoImg.style.display = 'block';
            } else {
                logoImg.style.display = 'none';
            }
        }
        
        // æ‰“å°è¯ä¹¦
        function printCertificate() {
            window.print();
        }
        
        // å¯¼å‡ºPDF
        function exportPDF() {
            const element = document.getElementById('certificatePreview');
            const recipientName = document.getElementById('recipientName').value || 'certificate';
            const certTitle = document.getElementById('certTitle').value || 'certificate';
            
            const opt = {
                margin: 0,
                filename: certTitle + '-' + recipientName + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            
            html2pdf().set(opt).from(element).save();
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            const data = {
                template: currentTemplate,
                orgName: document.getElementById('orgName').value,
                logoDataUrl: logoDataUrl,
                certTitle: document.getElementById('certTitle').value,
                recipientName: document.getElementById('recipientName').value,
                certContent: document.getElementById('certContent').value,
                issueDate: document.getElementById('issueDate').value,
                certNumber: document.getElementById('certNumber').value
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'certificate-' + (data.recipientName || 'data') + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.template) {
                                selectTemplate(data.template);
                            }
                            
                            document.getElementById('orgName').value = data.orgName || '';
                            document.getElementById('certTitle').value = data.certTitle || '';
                            document.getElementById('recipientName').value = data.recipientName || '';
                            document.getElementById('certContent').value = data.certContent || '';
                            document.getElementById('issueDate').value = data.issueDate || '';
                            document.getElementById('certNumber').value = data.certNumber || '';
                            
                            if (data.logoDataUrl) {
                                logoDataUrl = data.logoDataUrl;
                            }
                            
                            updatePreview();
                            alert('æ•°æ®åŠ è½½æˆåŠŸï¼');
                        } catch (err) {
                            alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æœ‰æ•ˆçš„JSONæ–‡ä»¶');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
    </script>
</body>
</html>

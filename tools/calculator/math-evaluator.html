<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="è®¡ç®—å¤æ‚æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒå‡½æ•°å’Œå¸¸é‡" />
  <meta name="keywords" content="æ•°å­¦ è¡¨è¾¾å¼ è®¡ç®—å™¨ å…¬å¼ å‡½æ•° math" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/calculator/math-evaluator.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨ - WebUtils" />
  <meta property="og:description" content="è®¡ç®—å¤æ‚æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒå‡½æ•°å’Œå¸¸é‡" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/calculator/math-evaluator.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨ - WebUtils" />
  <meta name="twitter:description" content="è®¡ç®—å¤æ‚æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒå‡½æ•°å’Œå¸¸é‡" />
  <!-- OG Image -->
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --glow-red: rgb(244, 63, 94, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-input: #f5f5f5;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --border-strong: #d5d5d5;
    }

    :root {
      --bg: #f8f9fa;
      --card-bg: #fff;
      --text: #212529;
      --text-muted: #6c757d;
      --border: #dee2e6;
      --primary: #0d6efd;
      --primary-hover: #0b5ed7;
      --success: #198754;
      --danger: #dc3545;
      --shadow: 0 2px 8px rgb(0,0,0,0.08);
      --radius: 8px;
    }
    [data-theme="dark"] {
      --bg: #0a0a0f;
      --card-bg: #1a1a24;
      --text: #e8e8ed;
      --text-muted: #999;
      --border: #2a2a36;
      --shadow: 0 2px 8px rgb(0,0,0,0.3);
    }
    .theme-toggle{position:fixed;top:1rem;right:1rem;width:40px;height:40px;border-radius:50%;border:1px solid var(--border);background:var(--card-bg);cursor:pointer;font-size:1.2rem;z-index:100;transition:all .2s}.theme-toggle:hover{transform:scale(1.1)}
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 24px; min-height: 100vh; }
    .container { max-width: 800px; margin: 0 auto; }
    .back-link { display: inline-block; margin-bottom: 16px; color: var(--primary); text-decoration: none; font-size: 0.9rem; }
    .back-link:hover { text-decoration: underline; }
    h1 { font-size: 1.75rem; margin: 0 0 8px; }
    .desc { color: var(--text-muted); margin: 0 0 24px; font-size: 0.95rem; }
    .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); margin-bottom: 20px; }
    .input-group { display: flex; gap: 12px; margin-bottom: 16px; }
    .input-group input { flex: 1; padding: 12px 16px; font-size: 1.1rem; font-family: ui-monospace, monospace; border: 1px solid var(--border); border-radius: var(--radius); background: var(--card-bg); color: var(--text); }
    .input-group input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgb(13,110,253,0.15); }
    button { padding: 10px 20px; font-size: 1rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--card-bg); color: var(--text); cursor: pointer; transition: all 0.2s; }
    button:hover { border-color: var(--primary); color: var(--primary); }
    button.primary { background: var(--primary); border-color: var(--primary); color: #fff; }
    button.primary:hover { background: var(--primary-hover); color: #fff; }
    .result-box { padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 16px; }
    .result-box .label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; }
    .result-box .value { font-size: 1.5rem; font-family: ui-monospace, monospace; word-break: break-all; }
    .result-box .value.error { color: var(--danger); font-size: 1rem; }
    .history { margin-top: 20px; }
    .history h3 { font-size: 1rem; margin: 0 0 12px; color: var(--text-muted); }
    .history-list { max-height: 200px; overflow-y: auto; }
    .history-item { display: flex; justify-content: space-between; padding: 8px 12px; background: var(--bg); border-radius: 4px; margin-bottom: 6px; font-family: ui-monospace, monospace; font-size: 0.9rem; cursor: pointer; }
    .history-item:hover { background: var(--border); }
    .history-item .expr { color: var(--text-muted); }
    .history-item .result { color: var(--success); font-weight: 600; }
    .functions { margin-top: 20px; }
    .functions h3 { font-size: 1rem; margin: 0 0 12px; color: var(--text-muted); }
    .function-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px; }
    .function-item { padding: 8px 12px; background: var(--bg); border-radius: 4px; font-family: ui-monospace, monospace; font-size: 0.85rem; cursor: pointer; }
    .function-item:hover { background: var(--border); }
    .function-item code { color: var(--primary); }
    .btn-row { display: flex; gap: 8px; flex-wrap: wrap; }
    footer { text-align: center; margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--border); color: var(--text-muted); font-size: 0.85rem; }
    footer a { color: var(--primary); text-decoration: none; }
  
        .breadcrumb {     background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span>æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨</nav>
  <div class="container">
    <a href="../../index.html" class="back-link">â† è¿”å›å·¥å…·åˆ—è¡¨</a>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">â˜€ï¸</button>
    <h1>æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨</h1>
    <p class="desc">è®¡ç®—å¤æ‚æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒæ‹¬å·ã€å¹‚è¿ç®—ã€ä¸‰è§’å‡½æ•°ç­‰</p>
    <div class="card">
      <div class="input-group">
        <input type="text" id="expression" placeholder="è¾“å…¥è¡¨è¾¾å¼ï¼Œå¦‚ 2*(3+4)^2 æˆ– sin(pi/2)" autofocus />
        <button id="btnCalc" class="primary">è®¡ç®—</button>
      </div>
      <div class="result-box">
        <div class="label">ç»“æœ</div>
        <div class="value" id="result">-</div>
      </div>
      <div class="btn-row">
        <button id="btnCopy">å¤åˆ¶ç»“æœ</button>
        <button id="btnClear">æ¸…ç©º</button>
        <button id="btnClearHistory">æ¸…é™¤å†å²</button>
      </div>
      <div class="history" id="historySection" style="display:none">
        <h3>è®¡ç®—å†å²</h3>
        <div class="history-list" id="historyList"></div>
      </div>
      <div class="functions">
        <h3>æ”¯æŒçš„å‡½æ•°å’Œå¸¸é‡ï¼ˆç‚¹å‡»æ’å…¥ï¼‰</h3>
        <div class="function-grid" id="functionGrid"></div>
      </div>
    </div>
    <footer>
      <a href="https://github.com/chicogong/html-tools/blob/main/tools/calculator/math-evaluator.html" target="_blank">View source</a>
      Â· çº¯å‰ç«¯å·¥å…· Â· æ— æœåŠ¡å™¨ Â· 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.2/lib/browser/math.min.js"></script>
  <script>
    const expressionEl = document.getElementById('expression');
    const resultEl = document.getElementById('result');
    const historySection = document.getElementById('historySection');
    const historyList = document.getElementById('historyList');
    const functionGrid = document.getElementById('functionGrid');
    const LS_HISTORY_KEY = 'math_eval_history_v1';

    const FUNCTIONS = [
      { name: 'sin(x)', desc: 'æ­£å¼¦' },
      { name: 'cos(x)', desc: 'ä½™å¼¦' },
      { name: 'tan(x)', desc: 'æ­£åˆ‡' },
      { name: 'asin(x)', desc: 'åæ­£å¼¦' },
      { name: 'acos(x)', desc: 'åä½™å¼¦' },
      { name: 'atan(x)', desc: 'åæ­£åˆ‡' },
      { name: 'sqrt(x)', desc: 'å¹³æ–¹æ ¹' },
      { name: 'cbrt(x)', desc: 'ç«‹æ–¹æ ¹' },
      { name: 'abs(x)', desc: 'ç»å¯¹å€¼' },
      { name: 'log(x)', desc: 'è‡ªç„¶å¯¹æ•°' },
      { name: 'log10(x)', desc: 'å¸¸ç”¨å¯¹æ•°' },
      { name: 'log2(x)', desc: 'ä»¥2ä¸ºåº•' },
      { name: 'exp(x)', desc: 'e^x' },
      { name: 'floor(x)', desc: 'å‘ä¸‹å–æ•´' },
      { name: 'ceil(x)', desc: 'å‘ä¸Šå–æ•´' },
      { name: 'round(x)', desc: 'å››èˆäº”å…¥' },
      { name: 'pow(x,y)', desc: 'xçš„yæ¬¡æ–¹' },
      { name: 'min(a,b)', desc: 'æœ€å°å€¼' },
      { name: 'max(a,b)', desc: 'æœ€å¤§å€¼' },
      { name: 'pi', desc: 'åœ†å‘¨ç‡Ï€' },
      { name: 'e', desc: 'è‡ªç„¶å¸¸æ•°e' },
    ];

    function renderFunctionGrid() {
      functionGrid.innerHTML = '';
      FUNCTIONS.forEach(function(fn) {
        const item = document.createElement('div');
        item.className = 'function-item';
        const code = document.createElement('code');
        code.textContent = fn.name;
        item.appendChild(code);
        item.appendChild(document.createTextNode(' ' + fn.desc));
        item.addEventListener('click', function() { insertFunction(fn.name); });
        functionGrid.appendChild(item);
      });
    }

    function insertFunction(fnName) {
      const pos = expressionEl.selectionStart;
      const text = expressionEl.value;
      expressionEl.value = text.substring(0, pos) + fnName + text.substring(pos);
      expressionEl.focus();
      if (fnName.includes('(x)')) {
        expressionEl.setSelectionRange(pos + fnName.indexOf('x'), pos + fnName.indexOf('x') + 1);
      } else {
        expressionEl.setSelectionRange(pos + fnName.length, pos + fnName.length);
      }
    }

    function formatResult(num) {
      if (typeof num === 'object') return math.format(num, {precision: 14});
      if (Number.isInteger(num)) return num.toString();
      if (Math.abs(num) < 1e-10 || Math.abs(num) > 1e10) return num.toExponential(10);
      return (Math.round(num * 1e12) / 1e12).toString();
    }

    window.calculate = function() {
      const expr = expressionEl.value.trim();
      if (!expr) { resultEl.textContent = '-'; resultEl.classList.remove('error'); return; }
      try {
        const result = math.evaluate(expr);
        const formatted = formatResult(result);
        resultEl.textContent = formatted;
        resultEl.classList.remove('error');
        addToHistory(expr, formatted);
      } catch (e) {
        resultEl.textContent = e.message || 'è®¡ç®—é”™è¯¯';
        resultEl.classList.add('error');
      }
    };

    window.loadHistory = function() { try { return JSON.parse(localStorage.getItem(LS_HISTORY_KEY)) || []; } catch(e) { return []; } };
    function saveHistory(h) { localStorage.setItem(LS_HISTORY_KEY, JSON.stringify(h)); }
    function addToHistory(expr, result) {
      let h = loadHistory().filter(i => i.expr !== expr);
      h.unshift({ expr, result });
      if (h.length > 20) h = h.slice(0, 20);
      saveHistory(h);
      renderHistory();
    }
    function renderHistory() {
      const h = loadHistory();
      if (!h.length) { historySection.style.display = 'none'; return; }
      historySection.style.display = 'block';
      historyList.innerHTML = '';
      h.forEach(function(item) {
        const div = document.createElement('div');
        div.className = 'history-item';
        const exprSpan = document.createElement('span');
        exprSpan.className = 'expr';
        exprSpan.textContent = item.expr;
        const resultSpan = document.createElement('span');
        resultSpan.className = 'result';
        resultSpan.textContent = '= ' + item.result;
        div.appendChild(exprSpan);
        div.appendChild(resultSpan);
        div.addEventListener('click', function() { expressionEl.value = item.expr; calculate(); });
        historyList.appendChild(div);
      });
    }

    document.getElementById('btnCalc').addEventListener('click', calculate);
    expressionEl.addEventListener('keydown', function(e) { if (e.key === 'Enter') calculate(); });
    document.getElementById('btnCopy').addEventListener('click', async function() {
      const r = resultEl.textContent;
      if (r !== '-' && !resultEl.classList.contains('error')) { try { await navigator.clipboard.writeText(r); } catch(e){} }
    });
    document.getElementById('btnClear').addEventListener('click', function() {
      expressionEl.value = ''; resultEl.textContent = '-'; resultEl.classList.remove('error'); expressionEl.focus();
    });
    document.getElementById('btnClearHistory').addEventListener('click', function() {
      localStorage.removeItem(LS_HISTORY_KEY); renderHistory();
    });

    renderFunctionGrid();
    renderHistory();

    window.toggleTheme = function(){const html=document.documentElement;const btn=document.querySelector('.theme-toggle');const next=html.getAttribute('data-theme')==='dark'?'':'dark';html.setAttribute('data-theme',next);btn.textContent=next==='dark'?'ğŸŒ™':'â˜€ï¸';localStorage.setItem('theme',next||'light');};(function(){const saved=localStorage.getItem('theme');if(saved==='dark'){document.documentElement.setAttribute('data-theme','dark');const btn=document.querySelector('.theme-toggle');if(btn)btn.textContent='ğŸŒ™';}})();
  </script>
</body>
</html>

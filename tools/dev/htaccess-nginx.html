<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>htaccessËΩ¨Nginx - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-tertiary: #1a1a25; --text-primary: #ffffff; --text-secondary: #8888aa; --accent: #6366f1; --border: #2a2a3a; --success: #22c55e; }
        [data-theme="light"] { --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9; --text-primary: #1e293b; --text-secondary: #64748b; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(135deg, #f97316, #ea580c); padding: 2rem; text-align: center; }
        .header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .nav { display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 1rem; }
        .back-link { color: rgba(255,255,255,0.9); text-decoration: none; }
        .theme-toggle { background: rgba(255,255,255,0.2); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; color: white; cursor: pointer; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 900px) { .editor-grid { grid-template-columns: 1fr; } }
        .editor-box { display: flex; flex-direction: column; }
        .editor-box h3 { margin-bottom: 0.75rem; display: flex; justify-content: space-between; align-items: center; }
        .editor-box h3 img { height: 24px; }
        textarea { width: 100%; min-height: 400px; padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-tertiary); color: var(--text-primary); font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; resize: vertical; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 1rem; transition: all 0.2s; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-row { display: flex; gap: 1rem; justify-content: center; margin: 1rem 0; flex-wrap: wrap; }
        .examples { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
        .example-btn { padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: 0.25rem; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; font-size: 0.85rem; }
        .example-btn:hover { border-color: var(--accent); }
        .warning { background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; font-size: 0.9rem; color: #f59e0b; }
        .toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); background: var(--success); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="../../index.html" class="back-link">‚Üê ËøîÂõûÈ¶ñÈ°µ</a>
            <button class="theme-toggle" onclick="toggleTheme()">üåì ‰∏ªÈ¢ò</button>
        </div>
        <h1>üîÑ htaccessËΩ¨Nginx</h1>
        <p>Â∞ÜApache .htaccessËßÑÂàôËΩ¨Êç¢‰∏∫NginxÈÖçÁΩÆ</p>
    </div>
    <div class="container">
        <div class="card">
            <div class="warning">
                ‚ö†Ô∏è Ê≥®ÊÑèÔºöÊ≠§Â∑•ÂÖ∑Êèê‰æõÂü∫Á°ÄËΩ¨Êç¢ÔºåÂ§çÊùÇËßÑÂàôÂèØËÉΩÈúÄË¶ÅÊâãÂä®Ë∞ÉÊï¥„ÄÇÂª∫ËÆÆËΩ¨Êç¢Âêé‰ªîÁªÜÊ£ÄÊü•Âπ∂ÊµãËØï„ÄÇ
            </div>
            
            <div class="examples">
                <span style="color: var(--text-secondary); margin-right: 0.5rem;">Á§∫‰æã:</span>
                <button class="example-btn" onclick="loadExample('rewrite')">URLÈáçÂÜô</button>
                <button class="example-btn" onclick="loadExample('redirect')">ÈáçÂÆöÂêë</button>
                <button class="example-btn" onclick="loadExample('auth')">ËÆøÈóÆÊéßÂà∂</button>
                <button class="example-btn" onclick="loadExample('cache')">ÁºìÂ≠òËÆæÁΩÆ</button>
                <button class="example-btn" onclick="loadExample('gzip')">GzipÂéãÁº©</button>
            </div>
            
            <div class="btn-row">
                <button class="btn btn-primary" onclick="convert()">üîÑ ËΩ¨Êç¢</button>
            </div>
        </div>
        
        <div class="editor-grid">
            <div class="card editor-box">
                <h3>
                    Apache .htaccess
                </h3>
                <textarea id="htaccessInput" placeholder="Á≤òË¥¥.htaccessÂÜÖÂÆπ...">RewriteEngine On
RewriteBase /

# Redirect to HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove trailing slash
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [L,R=301]

# Front controller
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [L,QSA]

# Cache static files
<FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js)$">
    Header set Cache-Control "max-age=31536000, public"
</FilesMatch></textarea>
            </div>
            
            <div class="card editor-box">
                <h3>
                    NginxÈÖçÁΩÆ
                    <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;" onclick="copyOutput()">Â§çÂà∂</button>
                </h3>
                <textarea id="nginxOutput" placeholder="ËΩ¨Êç¢ÂêéÁöÑNginxÈÖçÁΩÆ..." readonly></textarea>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</div>
    
    <script>
        const examples = {
            rewrite: `RewriteEngine On
RewriteBase /

# Pretty URLs
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?url=$1 [L,QSA]

# Remove .php extension
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([^.]+)$ $1.php [NC,L]`,
            
            redirect: `# Redirect old URLs to new
Redirect 301 /old-page /new-page
Redirect 301 /blog/old-post /articles/new-post

# Redirect entire domain
RewriteCond %{HTTP_HOST} ^old-domain.com$ [NC]
RewriteRule ^(.*)$ https://new-domain.com/$1 [R=301,L]

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]`,
            
            auth: `# Block specific IPs
Order Allow,Deny
Allow from all
Deny from 123.456.789.0

# Password protect directory
AuthType Basic
AuthName "Restricted Area"
AuthUserFile /path/to/.htpasswd
Require valid-user

# Block bad bots
RewriteCond %{HTTP_USER_AGENT} (bot|crawler|spider) [NC]
RewriteRule .* - [F,L]`,
            
            cache: `# Cache static files
<FilesMatch "\.(jpg|jpeg|png|gif|ico)$">
    Header set Cache-Control "max-age=31536000, public"
</FilesMatch>

<FilesMatch "\.(css|js)$">
    Header set Cache-Control "max-age=604800, public"
</FilesMatch>

<FilesMatch "\.(html|htm)$">
    Header set Cache-Control "max-age=3600, public"
</FilesMatch>`,
            
            gzip: `# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
</IfModule>`
        };
        
        function loadExample(name) {
            document.getElementById('htaccessInput').value = examples[name];
            convert();
        }
        
        function convert() {
            const htaccess = document.getElementById('htaccessInput').value;
            const nginx = convertToNginx(htaccess);
            document.getElementById('nginxOutput').value = nginx;
        }
        
        function convertToNginx(htaccess) {
            const lines = htaccess.split('\n');
            let nginx = [];
            let inLocationBlock = false;
            let rewriteConditions = [];
            
            nginx.push('# Converted from .htaccess');
            nginx.push('# Please review and adjust as needed');
            nginx.push('');
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                
                // Skip empty lines and comments
                if (!line || line.startsWith('#')) {
                    if (line.startsWith('#')) {
                        nginx.push(line);
                    }
                    continue;
                }
                
                // Skip RewriteEngine and RewriteBase
                if (line.startsWith('RewriteEngine') || line.startsWith('RewriteBase')) {
                    continue;
                }
                
                // Handle RewriteCond
                if (line.startsWith('RewriteCond')) {
                    rewriteConditions.push(parseRewriteCond(line));
                    continue;
                }
                
                // Handle RewriteRule
                if (line.startsWith('RewriteRule')) {
                    const rule = parseRewriteRule(line, rewriteConditions);
                    nginx.push(...rule);
                    rewriteConditions = [];
                    continue;
                }
                
                // Handle Redirect
                if (line.startsWith('Redirect')) {
                    const match = line.match(/Redirect\s+(\d+)?\s*([^\s]+)\s+([^\s]+)/i);
                    if (match) {
                        const code = match[1] || '301';
                        nginx.push(`rewrite ^${match[2]}$ ${match[3]} permanent;`);
                    }
                    continue;
                }
                
                // Handle FilesMatch for caching
                if (line.startsWith('<FilesMatch')) {
                    const match = line.match(/<FilesMatch\s+"([^"]+)">/i);
                    if (match) {
                        const extensions = match[1].replace(/\\/g, '').replace(/\|/g, '|');
                        nginx.push(`location ~* \\.(${extensions})$ {`);
                        inLocationBlock = true;
                    }
                    continue;
                }
                
                if (line.startsWith('</FilesMatch>')) {
                    nginx.push('}');
                    nginx.push('');
                    inLocationBlock = false;
                    continue;
                }
                
                // Handle Header set
                if (line.startsWith('Header set')) {
                    const match = line.match(/Header\s+set\s+([^\s]+)\s+"([^"]+)"/i);
                    if (match) {
                        nginx.push(`    add_header ${match[1]} "${match[2]}";`);
                    }
                    continue;
                }
                
                // Handle IfModule for compression
                if (line.includes('mod_deflate')) {
                    nginx.push('gzip on;');
                    nginx.push('gzip_vary on;');
                    nginx.push('gzip_proxied any;');
                    nginx.push('gzip_comp_level 6;');
                    continue;
                }
                
                // Handle AddOutputFilterByType
                if (line.startsWith('AddOutputFilterByType')) {
                    const match = line.match(/AddOutputFilterByType\s+DEFLATE\s+(.+)/i);
                    if (match) {
                        const type = match[1].trim();
                        if (!nginx.includes('gzip_types text/plain text/css application/json application/javascript text/xml application/xml;')) {
                            nginx.push('gzip_types text/plain text/css application/json application/javascript text/xml application/xml;');
                        }
                    }
                    continue;
                }
                
                // Handle Deny/Allow
                if (line.startsWith('Deny from')) {
                    const ip = line.replace('Deny from', '').trim();
                    nginx.push(`deny ${ip};`);
                    continue;
                }
                
                if (line.startsWith('Allow from')) {
                    const ip = line.replace('Allow from', '').trim();
                    if (ip !== 'all') {
                        nginx.push(`allow ${ip};`);
                    }
                    continue;
                }
                
                // Handle auth
                if (line.startsWith('AuthType') || line.startsWith('AuthName') || 
                    line.startsWith('AuthUserFile') || line.startsWith('Require')) {
                    if (line.startsWith('AuthUserFile')) {
                        const path = line.replace('AuthUserFile', '').trim();
                        nginx.push('auth_basic "Restricted Area";');
                        nginx.push(`auth_basic_user_file ${path};`);
                    }
                    continue;
                }
            }
            
            return nginx.join('\n');
        }
        
        function parseRewriteCond(line) {
            // Parse common RewriteCond patterns
            if (line.includes('%{HTTPS}') && line.includes('off')) {
                return { type: 'https', negate: false };
            }
            if (line.includes('%{REQUEST_FILENAME}') && line.includes('!-f')) {
                return { type: 'not_file' };
            }
            if (line.includes('%{REQUEST_FILENAME}') && line.includes('!-d')) {
                return { type: 'not_dir' };
            }
            if (line.includes('%{HTTP_HOST}')) {
                const match = line.match(/%{HTTP_HOST}\s+\^?([^$\s\[]+)/);
                return { type: 'host', value: match ? match[1] : '' };
            }
            if (line.includes('%{HTTP_USER_AGENT}')) {
                const match = line.match(/\(([^)]+)\)/);
                return { type: 'user_agent', value: match ? match[1] : '' };
            }
            return { type: 'unknown', raw: line };
        }
        
        function parseRewriteRule(line, conditions) {
            const result = [];
            const match = line.match(/RewriteRule\s+\^?([^\s]+)\$?\s+([^\s\[]+)\s*(\[([^\]]+)\])?/i);
            
            if (!match) return result;
            
            const pattern = match[1];
            let replacement = match[2];
            const flags = match[4] || '';
            
            const isRedirect = flags.includes('R=301') || flags.includes('R=302');
            const isPermanent = flags.includes('R=301');
            
            // Check for HTTPS redirect
            const httpsCondition = conditions.find(c => c.type === 'https');
            if (httpsCondition && replacement.includes('https://')) {
                result.push('if ($scheme != "https") {');
                result.push('    return 301 https://$host$request_uri;');
                result.push('}');
                return result;
            }
            
            // Check for file/dir conditions
            const hasNotFile = conditions.some(c => c.type === 'not_file');
            const hasNotDir = conditions.some(c => c.type === 'not_dir');
            
            if (hasNotFile && hasNotDir) {
                result.push('location / {');
                result.push('    try_files $uri $uri/ /' + replacement.replace('$1', '$uri') + ';');
                result.push('}');
                return result;
            }
            
            // User agent blocking
            const uaCondition = conditions.find(c => c.type === 'user_agent');
            if (uaCondition && flags.includes('F')) {
                result.push(`if ($http_user_agent ~* "${uaCondition.value}") {`);
                result.push('    return 403;');
                result.push('}');
                return result;
            }
            
            // Simple rewrite
            if (isRedirect) {
                const redirect = isPermanent ? 'permanent' : 'redirect';
                result.push(`rewrite ^/${pattern}$ ${replacement} ${redirect};`);
            } else {
                result.push(`rewrite ^/${pattern}$ ${replacement} last;`);
            }
            
            return result;
        }
        
        function copyOutput() {
            const output = document.getElementById('nginxOutput').value;
            if (!output) {
                alert('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }
            navigator.clipboard.writeText(output);
            showToast();
        }
        
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // Initial conversion
        convert();
        
        function toggleTheme() {
            const t = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
        }
        document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
    </script>
</body>
</html>

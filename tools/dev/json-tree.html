<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ÂèØËßÜÂåñÊ†ë - HTML Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --tool-primary: #f59e0b;
            --tool-secondary: #d97706;
            --type-string: #22c55e;
            --type-number: #3b82f6;
            --type-bool: #a855f7;
            --type-null: #6b7280;
            --type-key: #ef4444;
        }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
        }
        h1 { margin: 0; font-size: 1.75rem; color: var(--tool-primary); }
        .theme-toggle {
            background: none; border: 2px solid var(--tool-primary);
            color: var(--tool-primary); cursor: pointer; padding: 0.5rem;
            border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
        }
        .back-link {
            color: var(--tool-primary); text-decoration: none;
            display: flex; align-items: center; gap: 0.25rem; font-size: 0.9rem;
        }
        .main-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
            height: calc(100vh - 150px); min-height: 500px;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; height: auto; }
        }
        .panel {
            background: var(--pico-card-background-color);
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
        }
        .panel-header {
            padding: 0.75rem 1rem; background: var(--pico-secondary-background);
            border-bottom: 1px solid var(--pico-muted-border-color);
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600;
        }
        .panel-actions { display: flex; gap: 0.5rem; }
        .panel-actions button {
            padding: 0.25rem 0.5rem; font-size: 0.75rem;
            background: var(--pico-background-color); border: 1px solid var(--pico-muted-border-color);
            border-radius: 4px; cursor: pointer;
        }
        .panel-actions button:hover {
            background: var(--tool-primary); color: white; border-color: var(--tool-primary);
        }
        .panel-body { flex: 1; overflow: auto; }
        #jsonInput {
            width: 100%; height: 100%; border: none; resize: none;
            padding: 1rem; font-family: monospace; font-size: 0.9rem;
            background: transparent;
        }
        .tree-view { padding: 1rem; font-family: monospace; font-size: 0.85rem; }
        .tree-node { margin-left: 1.25rem; }
        .tree-root { margin-left: 0; }
        .tree-line {
            display: flex; align-items: flex-start; gap: 0.25rem;
            padding: 0.15rem 0; line-height: 1.4;
        }
        .tree-toggle {
            cursor: pointer; user-select: none; width: 1rem;
            text-align: center; color: var(--pico-muted-color);
            flex-shrink: 0;
        }
        .tree-toggle:hover { color: var(--tool-primary); }
        .tree-key { color: var(--type-key); }
        .tree-colon { color: var(--pico-muted-color); margin: 0 0.25rem; }
        .tree-string { color: var(--type-string); }
        .tree-string::before, .tree-string::after { content: '"'; opacity: 0.6; }
        .tree-number { color: var(--type-number); }
        .tree-boolean { color: var(--type-bool); }
        .tree-null { color: var(--type-null); font-style: italic; }
        .tree-bracket { color: var(--pico-muted-color); }
        .tree-count {
            color: var(--pico-muted-color); font-size: 0.75rem;
            margin-left: 0.5rem; opacity: 0.7;
        }
        .tree-collapsed .tree-children { display: none; }
        .tree-path {
            padding: 0.5rem 1rem; background: var(--pico-code-background-color);
            border-top: 1px solid var(--pico-muted-border-color);
            font-family: monospace; font-size: 0.8rem;
            color: var(--pico-muted-color); min-height: 2rem;
        }
        .tree-path code { color: var(--tool-primary); }
        .error-msg {
            padding: 1rem; color: var(--pico-del-color);
            background: rgba(239, 68, 68, 0.1);
        }
        .stats-bar {
            padding: 0.5rem 1rem; background: var(--pico-secondary-background);
            border-top: 1px solid var(--pico-muted-border-color);
            font-size: 0.8rem; color: var(--pico-muted-color);
            display: flex; gap: 1.5rem; flex-wrap: wrap;
        }
        .toolbar {
            padding: 0.5rem 1rem; background: var(--pico-secondary-background);
            border-bottom: 1px solid var(--pico-muted-border-color);
            display: flex; gap: 0.5rem; flex-wrap: wrap;
        }
        .toolbar input {
            padding: 0.3rem 0.6rem; font-size: 0.8rem;
            border: 1px solid var(--pico-muted-border-color); border-radius: 4px;
            min-width: 180px;
        }
        .highlight { background: rgba(245, 158, 11, 0.3); border-radius: 2px; }
        .tree-line:hover { background: var(--pico-code-background-color); }
        .tree-line.selected { background: rgba(245, 158, 11, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <a href="../../index.html" class="back-link">‚Üê ËøîÂõûÂ∑•ÂÖ∑ÂàóË°®</a>
                <h1>JSON ÂèØËßÜÂåñÊ†ë</h1>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">
                <span class="theme-icon">üåô</span>
            </button>
        </header>
        
        <div class="main-grid">
            <div class="panel">
                <div class="panel-header">
                    <span>JSON ËæìÂÖ•</span>
                    <div class="panel-actions">
                        <button onclick="formatInput()">Ê†ºÂºèÂåñ</button>
                        <button onclick="minifyInput()">ÂéãÁº©</button>
                        <button onclick="clearInput()">Ê∏ÖÁ©∫</button>
                        <button onclick="loadSample()">Á§∫‰æã</button>
                    </div>
                </div>
                <div class="panel-body">
                    <textarea id="jsonInput" placeholder="Á≤òË¥¥ÊàñËæìÂÖ• JSON Êï∞ÊçÆ..." spellcheck="false"></textarea>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <span>Ê†ëÂΩ¢ËßÜÂõæ</span>
                    <div class="panel-actions">
                        <button onclick="expandAll()">ÂÖ®ÈÉ®Â±ïÂºÄ</button>
                        <button onclick="collapseAll()">ÂÖ®ÈÉ®ÊäòÂè†</button>
                        <button onclick="copyPath()">Â§çÂà∂Ë∑ØÂæÑ</button>
                    </div>
                </div>
                <div class="toolbar">
                    <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢ÈîÆÊàñÂÄº..." oninput="searchTree()">
                </div>
                <div class="panel-body">
                    <div class="tree-view" id="treeView"></div>
                </div>
                <div class="tree-path" id="treePath">ÁÇπÂáªËäÇÁÇπÊü•ÁúãË∑ØÂæÑ</div>
                <div class="stats-bar" id="statsBar"></div>
            </div>
        </div>
    </div>
    
    <script>
        var currentPath = '';
        var jsonData = null;
        
        function toggleTheme() {
            var html = document.documentElement;
            var newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-icon').textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }
        (function() {
            var savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-icon').textContent = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        })();
        
        var input = document.getElementById('jsonInput');
        var debounceTimer;
        input.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(parseAndRender, 300);
        });
        
        function parseAndRender() {
            var text = input.value.trim();
            var treeView = document.getElementById('treeView');
            var statsBar = document.getElementById('statsBar');
            
            if (!text) {
                treeView.innerHTML = '<div style="padding:2rem;text-align:center;color:var(--pico-muted-color);">ËæìÂÖ• JSON Êï∞ÊçÆÂºÄÂßãÂèØËßÜÂåñ</div>';
                statsBar.innerHTML = '';
                jsonData = null;
                return;
            }
            
            try {
                jsonData = JSON.parse(text);
                var stats = getStats(jsonData);
                treeView.innerHTML = renderNode(jsonData, '', true);
                statsBar.innerHTML = '<span>ÂØπË±°: ' + stats.objects + '</span>' +
                    '<span>Êï∞ÁªÑ: ' + stats.arrays + '</span>' +
                    '<span>Â≠óÁ¨¶‰∏≤: ' + stats.strings + '</span>' +
                    '<span>Êï∞Â≠ó: ' + stats.numbers + '</span>' +
                    '<span>Â∏ÉÂ∞î: ' + stats.booleans + '</span>' +
                    '<span>Null: ' + stats.nulls + '</span>' +
                    '<span>Ê∑±Â∫¶: ' + stats.depth + '</span>';
            } catch (e) {
                treeView.innerHTML = '<div class="error-msg">JSON Ëß£ÊûêÈîôËØØ: ' + e.message + '</div>';
                statsBar.innerHTML = '';
                jsonData = null;
            }
        }
        
        function renderNode(data, path, isRoot) {
            var type = getType(data);
            var html = '<div class="tree-node' + (isRoot ? ' tree-root' : '') + '">';
            
            if (type === 'object') {
                var keys = Object.keys(data);
                html += '<div class="tree-line" onclick="selectNode(this, \'' + escapePath(path) + '\')">';
                if (keys.length > 0) {
                    html += '<span class="tree-toggle" onclick="toggleNode(event, this)">‚ñº</span>';
                } else {
                    html += '<span class="tree-toggle"></span>';
                }
                html += '<span class="tree-bracket">{</span>';
                html += '<span class="tree-count">' + keys.length + ' keys</span>';
                html += '</div>';
                html += '<div class="tree-children">';
                keys.forEach(function(key, idx) {
                    var childPath = path ? path + '.' + key : key;
                    if (key.match(/[.\[\]]/)) childPath = path ? path + '["' + key + '"]' : '["' + key + '"]';
                    html += renderKeyValue(key, data[key], childPath, idx === keys.length - 1);
                });
                html += '</div>';
                html += '<div class="tree-line"><span class="tree-toggle"></span><span class="tree-bracket">}</span></div>';
            } else if (type === 'array') {
                html += '<div class="tree-line" onclick="selectNode(this, \'' + escapePath(path) + '\')">';
                if (data.length > 0) {
                    html += '<span class="tree-toggle" onclick="toggleNode(event, this)">‚ñº</span>';
                } else {
                    html += '<span class="tree-toggle"></span>';
                }
                html += '<span class="tree-bracket">[</span>';
                html += '<span class="tree-count">' + data.length + ' items</span>';
                html += '</div>';
                html += '<div class="tree-children">';
                data.forEach(function(item, idx) {
                    var childPath = path + '[' + idx + ']';
                    html += renderKeyValue(idx, item, childPath, idx === data.length - 1);
                });
                html += '</div>';
                html += '<div class="tree-line"><span class="tree-toggle"></span><span class="tree-bracket">]</span></div>';
            } else {
                html += renderValue(data, path);
            }
            
            html += '</div>';
            return html;
        }
        
        function renderKeyValue(key, value, path, isLast) {
            var type = getType(value);
            var html = '';
            
            if (type === 'object' || type === 'array') {
                var count = type === 'object' ? Object.keys(value).length : value.length;
                var bracket = type === 'object' ? '{' : '[';
                var closeBracket = type === 'object' ? '}' : ']';
                var label = type === 'object' ? count + ' keys' : count + ' items';
                
                html += '<div class="tree-node">';
                html += '<div class="tree-line" onclick="selectNode(this, \'' + escapePath(path) + '\')">';
                if (count > 0) {
                    html += '<span class="tree-toggle" onclick="toggleNode(event, this)">‚ñº</span>';
                } else {
                    html += '<span class="tree-toggle"></span>';
                }
                html += '<span class="tree-key">' + escapeHtml(String(key)) + '</span>';
                html += '<span class="tree-colon">:</span>';
                html += '<span class="tree-bracket">' + bracket + '</span>';
                html += '<span class="tree-count">' + label + '</span>';
                html += '</div>';
                
                if (count > 0) {
                    html += '<div class="tree-children">';
                    if (type === 'object') {
                        var keys = Object.keys(value);
                        keys.forEach(function(k, i) {
                            var childPath = path + '.' + k;
                            if (k.match(/[.\[\]]/)) childPath = path + '["' + k + '"]';
                            html += renderKeyValue(k, value[k], childPath, i === keys.length - 1);
                        });
                    } else {
                        value.forEach(function(item, i) {
                            html += renderKeyValue(i, item, path + '[' + i + ']', i === value.length - 1);
                        });
                    }
                    html += '</div>';
                }
                html += '<div class="tree-line"><span class="tree-toggle"></span><span class="tree-bracket">' + closeBracket + '</span></div>';
                html += '</div>';
            } else {
                html += '<div class="tree-line" onclick="selectNode(this, \'' + escapePath(path) + '\')">';
                html += '<span class="tree-toggle"></span>';
                html += '<span class="tree-key">' + escapeHtml(String(key)) + '</span>';
                html += '<span class="tree-colon">:</span>';
                html += renderValueSpan(value);
                html += '</div>';
            }
            
            return html;
        }
        
        function renderValue(value, path) {
            return '<div class="tree-line" onclick="selectNode(this, \'' + escapePath(path) + '\')">' +
                '<span class="tree-toggle"></span>' + renderValueSpan(value) + '</div>';
        }
        
        function renderValueSpan(value) {
            var type = getType(value);
            if (type === 'string') {
                return '<span class="tree-string">' + escapeHtml(value) + '</span>';
            } else if (type === 'number') {
                return '<span class="tree-number">' + value + '</span>';
            } else if (type === 'boolean') {
                return '<span class="tree-boolean">' + value + '</span>';
            } else if (type === 'null') {
                return '<span class="tree-null">null</span>';
            }
            return '<span>' + escapeHtml(String(value)) + '</span>';
        }
        
        function getType(value) {
            if (value === null) return 'null';
            if (Array.isArray(value)) return 'array';
            return typeof value;
        }
        
        function getStats(data, depth) {
            depth = depth || 1;
            var stats = { objects: 0, arrays: 0, strings: 0, numbers: 0, booleans: 0, nulls: 0, depth: depth };
            
            function count(val, d) {
                var type = getType(val);
                if (type === 'object') {
                    stats.objects++;
                    Object.values(val).forEach(function(v) { count(v, d + 1); });
                } else if (type === 'array') {
                    stats.arrays++;
                    val.forEach(function(v) { count(v, d + 1); });
                } else if (type === 'string') stats.strings++;
                else if (type === 'number') stats.numbers++;
                else if (type === 'boolean') stats.booleans++;
                else if (type === 'null') stats.nulls++;
                if (d > stats.depth) stats.depth = d;
            }
            count(data, 1);
            return stats;
        }
        
        function toggleNode(e, el) {
            e.stopPropagation();
            var node = el.closest('.tree-node');
            node.classList.toggle('tree-collapsed');
            el.textContent = node.classList.contains('tree-collapsed') ? '‚ñ∂' : '‚ñº';
        }
        
        function selectNode(el, path) {
            document.querySelectorAll('.tree-line.selected').forEach(function(n) { n.classList.remove('selected'); });
            el.classList.add('selected');
            currentPath = path || '$';
            document.getElementById('treePath').innerHTML = 'Ë∑ØÂæÑ: <code>' + (path || '$') + '</code>';
        }
        
        function expandAll() {
            document.querySelectorAll('.tree-node.tree-collapsed').forEach(function(n) {
                n.classList.remove('tree-collapsed');
                var toggle = n.querySelector('.tree-toggle');
                if (toggle && toggle.textContent === '‚ñ∂') toggle.textContent = '‚ñº';
            });
        }
        
        function collapseAll() {
            document.querySelectorAll('.tree-node').forEach(function(n) {
                if (n.querySelector('.tree-children')) {
                    n.classList.add('tree-collapsed');
                    var toggle = n.querySelector('.tree-toggle');
                    if (toggle && toggle.textContent === '‚ñº') toggle.textContent = '‚ñ∂';
                }
            });
        }
        
        function copyPath() {
            if (currentPath) {
                navigator.clipboard.writeText(currentPath);
                alert('Ë∑ØÂæÑÂ∑≤Â§çÂà∂: ' + currentPath);
            }
        }
        
        function searchTree() {
            var query = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.highlight').forEach(function(el) { el.classList.remove('highlight'); });
            if (!query) return;
            
            document.querySelectorAll('.tree-key, .tree-string, .tree-number').forEach(function(el) {
                if (el.textContent.toLowerCase().includes(query)) {
                    el.classList.add('highlight');
                    var node = el.closest('.tree-node');
                    while (node) {
                        node.classList.remove('tree-collapsed');
                        var toggle = node.querySelector(':scope > .tree-line .tree-toggle');
                        if (toggle && toggle.textContent === '‚ñ∂') toggle.textContent = '‚ñº';
                        node = node.parentElement.closest('.tree-node');
                    }
                }
            });
        }
        
        function formatInput() {
            try {
                var data = JSON.parse(input.value);
                input.value = JSON.stringify(data, null, 2);
            } catch (e) {}
        }
        
        function minifyInput() {
            try {
                var data = JSON.parse(input.value);
                input.value = JSON.stringify(data);
            } catch (e) {}
        }
        
        function clearInput() {
            input.value = '';
            parseAndRender();
        }
        
        function loadSample() {
            input.value = JSON.stringify({
                "name": "HTML Tools",
                "version": "1.0.0",
                "description": "Âú®Á∫øÂºÄÂèëÂ∑•ÂÖ∑ÈõÜÂêà",
                "features": ["JSON Ê†ºÂºèÂåñ", "Base64 ÁºñËß£Á†Å", "Êó∂Èó¥Êà≥ËΩ¨Êç¢", "È¢úËâ≤ËΩ¨Êç¢"],
                "stats": { "tools": 150, "categories": 12, "active": true },
                "author": { "name": "Developer", "email": "dev@example.com" },
                "tags": null,
                "config": { "theme": "dark", "lang": "zh-CN", "autoSave": false }
            }, null, 2);
            parseAndRender();
        }
        
        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
        
        function escapePath(path) {
            return path.replace(/'/g, "\\'");
        }
        
        loadSample();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils" />
  <meta name="keywords" content="totp-generator,security,tools,webutils" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/security/totp-generator.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils" />
  <meta property="og:description" content="TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/security/totp-generator.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils" />
  <meta name="twitter:description" content="TOTP ç”Ÿæˆå™¨ - åŒå› ç´ è®¤è¯ç ç”Ÿæˆ - WebUtils" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <meta name="description" content="åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç (TOTP)ç”Ÿæˆå™¨ï¼Œæ”¯æŒGoogle Authenticatorå…¼å®¹å¯†é’¥ï¼Œå®æ—¶ç”Ÿæˆ6ä½æˆ–8ä½éªŒè¯ç ">
    <meta name="keywords" content="TOTP,OTP,åŒå› ç´ è®¤è¯,2FA,Google Authenticator,ä¸€æ¬¡æ€§å¯†ç ,éªŒè¯ç ç”Ÿæˆå™¨">
    <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --glow-red: rgb(244, 63, 94, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-input: #f5f5f5;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --border-strong: #d5d5d5;
    }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #fff;
            --text-secondary: #a0a0a0;
            --accent: #00d9ff;
            --accent-hover: #00b8d9;
            --border: #2a2a4a;
            --success: #00c853;
            --warning: #ffc107;
            --error: #ff5252;
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #fff;
            --bg-tertiary: #e8e8e8;
            --text-primary: #1a1a2e;
            --text-secondary: #666;
            --border: #ddd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
        }

        .back-link {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .back-link:hover {
            opacity: 1;
        }

        .theme-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            border-color: var(--accent);
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #a855f7);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 217, 255, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        /* TOTP Display */
        .totp-display {
            text-align: center;
            padding: 30px;
        }

        .totp-code {
            font-family: Monaco, Menlo, 'Ubuntu Mono', monospace;
            font-size: 4rem;
            font-weight: bold;
            letter-spacing: 0.3em;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            user-select: all;
        }

        .totp-timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .timer-bar {
            width: 200px;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #a855f7);
            border-radius: 4px;
            transition: width 1s linear;
        }

        .timer-progress.warning {
            background: linear-gradient(90deg, var(--warning), #ff9800);
        }

        .timer-progress.danger {
            background: linear-gradient(90deg, var(--error), #ff1744);
        }

        .timer-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 40px;
        }

        .timer-text.warning {
            color: var(--warning);
        }

        .timer-text.danger {
            color: var(--error);
        }

        /* Secret Key Display */
        .secret-display {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .secret-value {
            font-family: Monaco, Menlo, monospace;
            font-size: 14px;
            word-break: break-all;
            flex: 1;
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: var(--accent-hover);
        }

        /* QR Code Section */
        .qr-section {
            text-align: center;
            padding: 20px;
        }

        .qr-code {
            background: white;
            padding: 16px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 16px;
        }

        .qr-code canvas {
            display: block;
        }

        .uri-display {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            text-align: left;
            margin-top: 16px;
            color: var(--text-secondary);
        }

        /* Status Messages */
        .status {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }

        .status.success {
            display: block;
            background: rgba(0, 200, 83, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status.error {
            display: block;
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        /* Info Box */
        .info-box {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .info-box h4 {
            color: var(--accent);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-box p {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.6;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--accent);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* History List */
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            border: 1px solid var(--accent);
        }

        .history-item-info {
            flex: 1;
        }

        .history-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .history-item-issuer {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .history-item-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            color: var(--accent);
        }

        .icon-btn.delete:hover {
            color: var(--error);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .totp-code {
                font-size: 2.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .back-link span {
                display: none;
            }
        }
    
        .breadcrumb { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span><a href="../../index.html#security">å®‰å…¨å·¥å…·</a><span>â€º</span>TOTP ç”Ÿæˆå™¨</nav>
    <div class="container">
        <div class="header">
            <a href="../../index.html" class="back-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                <span>è¿”å›é¦–é¡µ</span>
            </a>
            <h1>ğŸ” TOTP ç”Ÿæˆå™¨</h1>
            <p>åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç ç”Ÿæˆå™¨</p>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('generate')">ç”Ÿæˆå¯†é’¥</button>
            <button class="tab" onclick="switchTab('verify')">éªŒè¯ç </button>
            <button class="tab" onclick="switchTab('saved')">å·²ä¿å­˜</button>
        </div>

        <!-- Generate Tab -->
        <div id="tab-generate" class="tab-content active">
            <div class="card">
                <div class="card-title">
                    <span>ğŸ”‘</span>
                    é…ç½® TOTP å‚æ•°
                </div>

                <div class="form-group">
                    <label>è´¦æˆ·åç§°</label>
                    <input type="text" id="accountName" placeholder="ä¾‹å¦‚ï¼šuser@example.com" value="user@example.com">
                </div>

                <div class="form-group">
                    <label>å‘è¡Œè€… (Issuer)</label>
                    <input type="text" id="issuer" placeholder="ä¾‹å¦‚ï¼šGitHub, Google" value="HTML Tools">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>å¯†é’¥é•¿åº¦</label>
                        <select id="secretLength">
                            <option value="16">16 å­—ç¬¦ (80 bits)</option>
                            <option value="20" selected>20 å­—ç¬¦ (100 bits)</option>
                            <option value="32">32 å­—ç¬¦ (160 bits)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>éªŒè¯ç ä½æ•°</label>
                        <select id="digits">
                            <option value="6" selected>6 ä½</option>
                            <option value="8">8 ä½</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>æ—¶é—´æ­¥é•¿ (ç§’)</label>
                        <select id="period">
                            <option value="30" selected>30 ç§’</option>
                            <option value="60">60 ç§’</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å“ˆå¸Œç®—æ³•</label>
                        <select id="algorithm">
                            <option value="SHA1" selected>SHA-1</option>
                            <option value="SHA256">SHA-256</option>
                            <option value="SHA512">SHA-512</option>
                        </select>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generateSecret()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                        </svg>
                        ç”Ÿæˆæ–°å¯†é’¥
                    </button>
                    <button class="btn btn-secondary" onclick="importSecret()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                        </svg>
                        å¯¼å…¥å¯†é’¥
                    </button>
                </div>
            </div>

            <div class="card" id="secretCard" style="display: none;">
                <div class="card-title">
                    <span>ğŸ“‹</span>
                    ç”Ÿæˆçš„å¯†é’¥
                </div>

                <div class="secret-display">
                    <span class="secret-value" id="secretValue"></span>
                    <button class="copy-btn" onclick="copySecret()">å¤åˆ¶</button>
                </div>

                <div class="qr-section">
                    <div class="qr-code">
                        <canvas id="qrCanvas"></canvas>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        ä½¿ç”¨ Google Authenticator æˆ–å…¶ä»– TOTP åº”ç”¨æ‰«æ
                    </p>
                </div>

                <div class="uri-display" id="uriDisplay"></div>

                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-primary" onclick="saveAndVerify()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        ä¿å­˜å¹¶æŸ¥çœ‹éªŒè¯ç 
                    </button>
                </div>
            </div>

            <div class="info-box">
                <h4>ğŸ’¡ ä»€ä¹ˆæ˜¯ TOTPï¼Ÿ</h4>
                <p>
                    TOTPï¼ˆåŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç ï¼‰æ˜¯ä¸€ç§åŒå› ç´ è®¤è¯æ–¹å¼ã€‚å®ƒæ ¹æ®å…±äº«å¯†é’¥å’Œå½“å‰æ—¶é—´ç”Ÿæˆä¸€ä¸ªçŸ­æœŸæœ‰æ•ˆçš„éªŒè¯ç ã€‚
                    å¸¸è§åº”ç”¨åŒ…æ‹¬ Google Authenticatorã€Microsoft Authenticatorã€Authy ç­‰ã€‚
                </p>
            </div>
        </div>

        <!-- Verify Tab -->
        <div id="tab-verify" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <span>â±ï¸</span>
                    å½“å‰éªŒè¯ç 
                </div>

                <div id="noActiveSecret" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    è¯·å…ˆç”Ÿæˆæˆ–é€‰æ‹©ä¸€ä¸ªå¯†é’¥
                </div>

                <div id="activeSecretInfo" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-secondary);" id="activeAccountInfo"></div>
                    </div>

                    <div class="totp-display">
                        <div class="totp-code" id="totpCode">------</div>
                        <div class="totp-timer">
                            <div class="timer-bar">
                                <div class="timer-progress" id="timerProgress"></div>
                            </div>
                            <span class="timer-text" id="timerText">30s</span>
                        </div>
                    </div>

                    <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="copyCode()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            å¤åˆ¶éªŒè¯ç 
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>ğŸ”</span>
                    éªŒè¯è¾“å…¥çš„å¯†é’¥
                </div>

                <div class="form-group">
                    <label>è¾“å…¥ Base32 å¯†é’¥</label>
                    <input type="text" id="verifySecretInput" placeholder="ä¾‹å¦‚ï¼šJBSWY3DPEHPK3PXP">
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="verifyInputSecret()">
                        ç”ŸæˆéªŒè¯ç 
                    </button>
                </div>

                <div id="verifyResult" style="display: none; margin-top: 20px;">
                    <div class="totp-display">
                        <div class="totp-code" id="verifyTotpCode">------</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Tab -->
        <div id="tab-saved" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <span>ğŸ“</span>
                    å·²ä¿å­˜çš„å¯†é’¥
                </div>

                <div class="history-list" id="savedList">
                    <div class="empty-state">
                        <p>æš‚æ— ä¿å­˜çš„å¯†é’¥</p>
                        <p style="font-size: 12px; margin-top: 8px;">ç”Ÿæˆæ–°å¯†é’¥åç‚¹å‡»"ä¿å­˜"å³å¯æ·»åŠ </p>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>âš ï¸ å®‰å…¨æç¤º</h4>
                <p>
                    å¯†é’¥ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä»…ä¾›æµ‹è¯•å’Œæ¼”ç¤ºä½¿ç”¨ã€‚
                    åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ä½¿ç”¨ä¸“ä¸šçš„èº«ä»½éªŒè¯å™¨åº”ç”¨å­˜å‚¨æ‚¨çš„ TOTP å¯†é’¥ã€‚
                </p>
            </div>
        </div>

        <div id="status" class="status"></div>
    </div>

    <!-- QR Code Library -->
    <script>
        // Simple QR Code Generator (minimal implementation)
        const QRCode = {
            generate: function(text, canvas, size = 200) {
                // Use a simple approach with an external API for QR generation
                // In production, you'd use a proper QR library
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    const ctx = canvas.getContext('2d');
                    canvas.width = size;
                    canvas.height = size;
                    ctx.drawImage(img, 0, 0, size, size);
                };
                img.onerror = function() {
                    // Fallback: draw placeholder
                    const ctx = canvas.getContext('2d');
                    canvas.width = size;
                    canvas.height = size;
                    ctx.fillStyle = '#f0f0f0';
                    ctx.fillRect(0, 0, size, size);
                    ctx.fillStyle = '#666';
                    ctx.font = '14px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('QR Code', size/2, size/2 - 10);
                    ctx.fillText('(éœ€è¦åœ¨çº¿ç”Ÿæˆ)', size/2, size/2 + 10);
                };
                img.src = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}`;
            }
        };
    </script>

    <script>
        // TOTP Implementation
        const base32Chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';

        function base32Encode(buffer) {
            let result = '';
            let bits = 0;
            let value = 0;

            for (let i = 0; i < buffer.length; i++) {
                value = (value << 8) | buffer[i];
                bits += 8;

                while (bits >= 5) {
                    result += base32Chars[(value >>> (bits - 5)) & 31];
                    bits -= 5;
                }
            }

            if (bits > 0) {
                result += base32Chars[(value << (5 - bits)) & 31];
            }

            return result;
        }

        function base32Decode(str) {
            str = str.toUpperCase().replace(/[^A-Z2-7]/g, '');
            const buffer = [];
            let bits = 0;
            let value = 0;

            for (let i = 0; i < str.length; i++) {
                const idx = base32Chars.indexOf(str[i]);
                if (idx === -1) continue;

                value = (value << 5) | idx;
                bits += 5;

                if (bits >= 8) {
                    buffer.push((value >>> (bits - 8)) & 255);
                    bits -= 8;
                }
            }

            return new Uint8Array(buffer);
        }

        function generateRandomSecret(length) {
            const buffer = new Uint8Array(length);
            crypto.getRandomValues(buffer);
            return base32Encode(buffer);
        }

        async function hmacSha(algorithm, key, message) {
            const cryptoKey = await crypto.subtle.importKey(
                'raw',
                key,
                { name: 'HMAC', hash: algorithm },
                false,
                ['sign']
            );
            const signature = await crypto.subtle.sign('HMAC', cryptoKey, message);
            return new Uint8Array(signature);
        }

        async function generateTOTP(secret, options = {}) {
            const {
                digits = 6,
                period = 30,
                algorithm = 'SHA-1',
                timestamp = Date.now()
            } = options;

            const key = base32Decode(secret);
            const time = Math.floor(timestamp / 1000 / period);

            // Convert time to 8-byte buffer
            const timeBuffer = new ArrayBuffer(8);
            const timeView = new DataView(timeBuffer);
            timeView.setUint32(4, time, false);

            const hmac = await hmacSha(algorithm, key, new Uint8Array(timeBuffer));

            // Dynamic truncation
            const offset = hmac[hmac.length - 1] & 0x0f;
            const binary = ((hmac[offset] & 0x7f) << 24) |
                          ((hmac[offset + 1] & 0xff) << 16) |
                          ((hmac[offset + 2] & 0xff) << 8) |
                          (hmac[offset + 3] & 0xff);

            const otp = binary % Math.pow(10, digits);
            return otp.toString().padStart(digits, '0');
        }

        // State
        let currentConfig = null;
        let updateInterval = null;
        let savedSecrets = [];

        // Theme
        window.toggleTheme = function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        };

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // Tabs
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`.tab:nth-child(${tabName === 'generate' ? 1 : tabName === 'verify' ? 2 : 3})`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');

            if (tabName === 'saved') {
                renderSavedList();
            }
        };

        // Generate
        window.generateSecret = function() {
            const accountName = document.getElementById('accountName').value || 'user@example.com';
            const issuer = document.getElementById('issuer').value || 'HTML Tools';
            const secretLength = parseInt(document.getElementById('secretLength').value);
            const digits = parseInt(document.getElementById('digits').value);
            const period = parseInt(document.getElementById('period').value);
            const algorithm = document.getElementById('algorithm').value;

            const secret = generateRandomSecret(secretLength);

            currentConfig = {
                secret,
                accountName,
                issuer,
                digits,
                period,
                algorithm
            };

            displayGeneratedSecret();
        };

        function displayGeneratedSecret() {
            if (!currentConfig) return;

            const { secret, accountName, issuer, digits, period, algorithm } = currentConfig;

            document.getElementById('secretValue').textContent = secret;

            // Generate URI
            const uri = `otpauth://totp/${encodeURIComponent(issuer)}:${encodeURIComponent(accountName)}?secret=${secret}&issuer=${encodeURIComponent(issuer)}&digits=${digits}&period=${period}&algorithm=${algorithm}`;

            document.getElementById('uriDisplay').textContent = uri;

            // Generate QR Code
            QRCode.generate(uri, document.getElementById('qrCanvas'), 200);

            document.getElementById('secretCard').style.display = 'block';
            showStatus('å¯†é’¥ç”ŸæˆæˆåŠŸï¼', 'success');
        }

        window.importSecret = function() {
            const secret = prompt('è¯·è¾“å…¥ Base32 ç¼–ç çš„å¯†é’¥ï¼š');
            if (!secret) return;

            // Validate
            const cleanSecret = secret.toUpperCase().replace(/[^A-Z2-7]/g, '');
            if (cleanSecret.length < 16) {
                showStatus('å¯†é’¥é•¿åº¦ä¸è¶³ï¼Œè¯·è¾“å…¥è‡³å°‘ 16 ä¸ªå­—ç¬¦', 'error');
                return;
            }

            const accountName = document.getElementById('accountName').value || 'user@example.com';
            const issuer = document.getElementById('issuer').value || 'HTML Tools';
            const digits = parseInt(document.getElementById('digits').value);
            const period = parseInt(document.getElementById('period').value);
            const algorithm = document.getElementById('algorithm').value;

            currentConfig = {
                secret: cleanSecret,
                accountName,
                issuer,
                digits,
                period,
                algorithm
            };

            displayGeneratedSecret();
        };

        window.copySecret = function() {
            if (!currentConfig) return;
            navigator.clipboard.writeText(currentConfig.secret);
            showStatus('å¯†é’¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        };

        window.saveAndVerify = function() {
            if (!currentConfig) return;

            // Save to localStorage
            savedSecrets.push({
                ...currentConfig,
                id: Date.now(),
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('totp_secrets', JSON.stringify(savedSecrets));

            showStatus('å¯†é’¥å·²ä¿å­˜', 'success');
            switchTab('verify');
            activateSecret(currentConfig);
        };

        // Verify
        function activateSecret(config) {
            currentConfig = config;

            document.getElementById('noActiveSecret').style.display = 'none';
            document.getElementById('activeSecretInfo').style.display = 'block';
            document.getElementById('activeAccountInfo').textContent = 
                `${config.issuer} - ${config.accountName}`;

            // Clear previous interval
            if (updateInterval) {
                clearInterval(updateInterval);
            }

            // Start updating
            updateTOTP();
            updateInterval = setInterval(updateTOTP, 1000);
        }

        async function updateTOTP() {
            if (!currentConfig) return;

            const { secret, digits, period, algorithm } = currentConfig;
            const algorithmMap = {
                'SHA1': 'SHA-1',
                'SHA256': 'SHA-256',
                'SHA512': 'SHA-512'
            };

            try {
                const code = await generateTOTP(secret, {
                    digits,
                    period,
                    algorithm: algorithmMap[algorithm] || algorithm
                });

                document.getElementById('totpCode').textContent = code;

                // Update timer
                const now = Math.floor(Date.now() / 1000);
                const remaining = period - (now % period);
                const progress = (remaining / period) * 100;

                const timerProgress = document.getElementById('timerProgress');
                const timerText = document.getElementById('timerText');

                timerProgress.style.width = progress + '%';
                timerText.textContent = remaining + 's';

                // Warning colors
                timerProgress.classList.remove('warning', 'danger');
                timerText.classList.remove('warning', 'danger');

                if (remaining <= 5) {
                    timerProgress.classList.add('danger');
                    timerText.classList.add('danger');
                } else if (remaining <= 10) {
                    timerProgress.classList.add('warning');
                    timerText.classList.add('warning');
                }
            } catch (error) {
                console.error('TOTP generation error:', error);
                document.getElementById('totpCode').textContent = 'ERROR';
            }
        }

        window.copyCode = function() {
            const code = document.getElementById('totpCode').textContent;
            if (code && code !== '------' && code !== 'ERROR') {
                navigator.clipboard.writeText(code);
                showStatus('éªŒè¯ç å·²å¤åˆ¶', 'success');
            }
        };

        window.verifyInputSecret = async function() {
            const secret = document.getElementById('verifySecretInput').value;
            if (!secret) {
                showStatus('è¯·è¾“å…¥å¯†é’¥', 'error');
                return;
            }

            const cleanSecret = secret.toUpperCase().replace(/[^A-Z2-7]/g, '');
            if (cleanSecret.length < 16) {
                showStatus('å¯†é’¥æ ¼å¼æ— æ•ˆ', 'error');
                return;
            }

            try {
                const code = await generateTOTP(cleanSecret);
                document.getElementById('verifyTotpCode').textContent = code;
                document.getElementById('verifyResult').style.display = 'block';

                // Update this code every second
                const updateVerify = async () => {
                    const newCode = await generateTOTP(cleanSecret);
                    document.getElementById('verifyTotpCode').textContent = newCode;
                };

                // Clear any existing interval for verify
                if (window.verifyInterval) {
                    clearInterval(window.verifyInterval);
                }
                window.verifyInterval = setInterval(updateVerify, 1000);

            } catch (error) {
                showStatus('ç”ŸæˆéªŒè¯ç å¤±è´¥ï¼š' + error.message, 'error');
            }
        };

        // Saved List
        function loadSavedSecrets() {
            const saved = localStorage.getItem('totp_secrets');
            if (saved) {
                savedSecrets = JSON.parse(saved);
            }
        }

        function renderSavedList() {
            const container = document.getElementById('savedList');

            if (savedSecrets.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>æš‚æ— ä¿å­˜çš„å¯†é’¥</p>
                        <p style="font-size: 12px; margin-top: 8px;">ç”Ÿæˆæ–°å¯†é’¥åç‚¹å‡»"ä¿å­˜"å³å¯æ·»åŠ </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = savedSecrets.map(item => `
                <div class="history-item" onclick="selectSaved(${item.id})">
                    <div class="history-item-info">
                        <div class="history-item-name">${escapeHtml(item.accountName)}</div>
                        <div class="history-item-issuer">${escapeHtml(item.issuer)} Â· ${item.digits}ä½ Â· ${item.period}ç§’</div>
                    </div>
                    <div class="history-item-actions">
                        <button class="icon-btn" onclick="event.stopPropagation(); copySavedSecret(${item.id})" title="å¤åˆ¶å¯†é’¥">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                        <button class="icon-btn delete" onclick="event.stopPropagation(); deleteSaved(${item.id})" title="åˆ é™¤">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        window.selectSaved = function(id) {
            const item = savedSecrets.find(s => s.id === id);
            if (item) {
                activateSecret(item);
                switchTab('verify');
            }
        };

        window.copySavedSecret = function(id) {
            const item = savedSecrets.find(s => s.id === id);
            if (item) {
                navigator.clipboard.writeText(item.secret);
                showStatus('å¯†é’¥å·²å¤åˆ¶', 'success');
            }
        };

        window.deleteSaved = function(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯†é’¥å—ï¼Ÿ')) {
                savedSecrets = savedSecrets.filter(s => s.id !== id);
                localStorage.setItem('totp_secrets', JSON.stringify(savedSecrets));
                renderSavedList();
                showStatus('å¯†é’¥å·²åˆ é™¤', 'success');
            }
        };

        // Utilities
        window.escapeHtml = function(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        };

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            setTimeout(() => {
                status.className = 'status';
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadSavedSecrets();
        });
    </script>
</body>
</html>

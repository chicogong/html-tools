<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å¼‚å¸¸å€¼æ£€æµ‹å™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="æ£€æµ‹æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼Œæ”¯æŒIQRå’ŒZ-scoreæ–¹æ³•ï¼Œå¯è§†åŒ–æ˜¾ç¤ºæ­£å¸¸å€¼å’Œå¼‚å¸¸å€¼" />
    <meta name="keywords" content="outlier detector å¼‚å¸¸å€¼æ£€æµ‹ IQR Z-score æ•°æ®åˆ†æ ç»Ÿè®¡" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/data/outlier-detector.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="å¼‚å¸¸å€¼æ£€æµ‹å™¨ - WebUtils" />
    <meta property="og:description" content="æ£€æµ‹æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼Œæ”¯æŒIQRå’ŒZ-scoreæ–¹æ³•ï¼Œå¯è§†åŒ–æ˜¾ç¤ºæ­£å¸¸å€¼å’Œå¼‚å¸¸å€¼" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/data/outlier-detector.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="å¼‚å¸¸å€¼æ£€æµ‹å™¨ - WebUtils" />
    <meta name="twitter:description" content="æ£€æµ‹æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼Œæ”¯æŒIQRå’ŒZ-scoreæ–¹æ³•ï¼Œå¯è§†åŒ–æ˜¾ç¤ºæ­£å¸¸å€¼å’Œå¼‚å¸¸å€¼" />
    <!-- OG Image -->
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <!-- JSON-LD BreadcrumbList Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "é¦–é¡µ",
            "item": "https://tools.realtime-ai.chat/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "æ•°æ®å·¥å…·",
            "item": "https://tools.realtime-ai.chat/#data"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "å¼‚å¸¸å€¼æ£€æµ‹å™¨",
            "item": "https://tools.realtime-ai.chat/tools/data/outlier-detector.html"
          }
        ]
      }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --font-sans:
          "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }
      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }
      .theme-toggle:hover {
        transform: scale(1.1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-bg-deep);
        color: var(--color-text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      .bg-grid {
        position: fixed;
        inset: 0;
        background-image:
          linear-gradient(rgb(0, 245, 212, 0.02) 1px, transparent 1px),
          linear-gradient(90deg, rgb(0, 245, 212, 0.02) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        padding: 8px 14px;
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        flex-wrap: wrap;
      }

      .breadcrumb a {
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .breadcrumb a:hover {
        color: var(--color-accent-cyan);
      }

      .breadcrumb-separator {
        color: var(--color-text-muted);
        user-select: none;
      }

      .breadcrumb-current {
        color: var(--color-text-primary);
        font-weight: 500;
      }

      .title-section {
        flex: 1;
      }

      .title-section h1 {
        font-family: var(--font-mono);
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .title-section h1 .icon {
        font-size: 1.8rem;
      }

      .title-section p {
        color: var(--color-text-secondary);
        margin-top: 4px;
        font-size: 0.9rem;
      }

      .main-content {
        background: var(--color-bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 24px;
        flex: 1;
      }

      .tool-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      @media (max-width: 900px) {
        .tool-layout {
          grid-template-columns: 1fr;
        }
      }

      .tool-section {
        margin-bottom: 24px;
      }

      .tool-section:last-child {
        margin-bottom: 0;
      }

      .section-title {
        font-family: var(--font-mono);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-subtle);
      }

      .input-group {
        margin-bottom: 16px;
      }

      .input-label {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-secondary);
        margin-bottom: 8px;
      }

      .input-hint {
        font-size: 0.75rem;
        color: var(--color-text-muted);
        margin-top: 4px;
      }

      input[type="text"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 10px 14px;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-primary);
        transition: border-color 0.2s;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--color-accent-cyan);
      }

      textarea {
        min-height: 200px;
        resize: vertical;
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 600px) {
        .input-row {
          grid-template-columns: 1fr;
        }
      }

      .btn-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .btn {
        flex: 1;
        min-width: 100px;
        padding: 12px 20px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--color-accent-cyan);
        color: var(--color-bg-deep);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px var(--glow-cyan);
      }

      .btn-secondary {
        background: var(--color-bg-surface);
        color: var(--color-text-primary);
        border: 1px solid var(--border-subtle);
      }

      .btn-secondary:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .btn-success {
        background: var(--accent-green);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px var(--glow-green);
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 14px;
        text-align: center;
      }

      .stat-card .stat-value {
        font-family: var(--font-mono);
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--color-accent-cyan);
        margin-bottom: 4px;
      }

      .stat-card .stat-label {
        font-size: 0.75rem;
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stat-card.outlier .stat-value {
        color: var(--accent-red);
      }

      .stat-card.normal .stat-value {
        color: var(--accent-green);
      }

      /* Results List */
      .results-container {
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 16px;
        max-height: 350px;
        overflow-y: auto;
      }

      .results-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 150px;
        color: var(--color-text-muted);
        font-family: var(--font-mono);
        font-size: 0.9rem;
      }

      .result-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        margin-bottom: 8px;
        border-radius: var(--radius-sm);
        font-family: var(--font-mono);
        font-size: 0.9rem;
        transition: all 0.2s;
      }

      .result-item:last-child {
        margin-bottom: 0;
      }

      .result-item.normal {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: var(--accent-green);
      }

      .result-item.outlier {
        background: rgba(244, 63, 94, 0.15);
        border: 1px solid rgba(244, 63, 94, 0.4);
        color: var(--accent-red);
      }

      .result-item .value {
        font-weight: 600;
      }

      .result-item .badge {
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .result-item.normal .badge {
        background: rgba(16, 185, 129, 0.2);
      }

      .result-item.outlier .badge {
        background: rgba(244, 63, 94, 0.2);
      }

      /* Bounds Info */
      .bounds-info {
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 16px;
        margin-top: 16px;
      }

      .bounds-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border-subtle);
        font-family: var(--font-mono);
        font-size: 0.85rem;
      }

      .bounds-row:last-child {
        border-bottom: none;
      }

      .bounds-label {
        color: var(--color-text-secondary);
      }

      .bounds-value {
        color: var(--color-accent-cyan);
        font-weight: 500;
      }

      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--accent-green);
        color: var(--color-bg-deep);
        padding: 12px 24px;
        border-radius: var(--radius-md);
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }

      .toast.error {
        background: var(--accent-red);
        color: white;
      }

      @media (max-width: 600px) {
        .container {
          padding: 16px;
        }

        .btn-row {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-grid"></div>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>

    <div class="container">
      <header class="header">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../../index.html">é¦–é¡µ</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">å¼‚å¸¸å€¼æ£€æµ‹å™¨</span>
        </nav>
        <div class="title-section">
          <h1>
            <span class="icon">ğŸ“Š</span>
            å¼‚å¸¸å€¼æ£€æµ‹å™¨
          </h1>
          <p>æ£€æµ‹æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼Œæ”¯æŒ IQR å’Œ Z-score æ–¹æ³•</p>
        </div>
      </header>

      <main class="main-content">
        <div class="tool-layout">
          <!-- Left: Input -->
          <div class="input-panel">
            <div class="tool-section">
              <div class="section-title">æ£€æµ‹è®¾ç½®</div>
              <div class="input-row">
                <div class="input-group">
                  <label class="input-label">æ£€æµ‹æ–¹æ³•</label>
                  <select id="method" onchange="updateMethodOptions()">
                    <option value="iqr">IQRï¼ˆå››åˆ†ä½è·ï¼‰</option>
                    <option value="zscore">Z-scoreï¼ˆæ ‡å‡†åˆ†æ•°ï¼‰</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label" id="thresholdLabel">IQR ä¹˜æ•°</label>
                  <select id="threshold">
                    <option value="1.5">1.5ï¼ˆæ ‡å‡†ï¼‰</option>
                    <option value="2.2">2.2ï¼ˆä¸­ç­‰ï¼‰</option>
                    <option value="3">3ï¼ˆå®½æ¾ï¼‰</option>
                  </select>
                </div>
              </div>
              <div class="input-hint" id="methodHint">
                IQR æ–¹æ³•ï¼šå¼‚å¸¸å€¼ = å€¼ &lt; Q1 - kÃ—IQR æˆ– å€¼ &gt; Q3 + kÃ—IQR
              </div>
            </div>

            <div class="tool-section">
              <div class="section-title">æ•°æ®è¾“å…¥</div>
              <div class="input-group">
                <label class="input-label">è¾“å…¥æ•°å€¼ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                <textarea id="dataInput" placeholder="è¾“å…¥æ•°å€¼ï¼Œæ¯è¡Œä¸€ä¸ª

ç¤ºä¾‹ï¼š
10
12
14
15
100
18
20
22
-50
25"></textarea>
              </div>
              <div class="btn-row">
                <button class="btn btn-primary" onclick="detectOutliers()">ğŸ” æ£€æµ‹å¼‚å¸¸å€¼</button>
                <button class="btn btn-secondary" onclick="pasteData()">ğŸ“‹ ç²˜è´´</button>
                <button class="btn btn-secondary" onclick="loadSampleData()">ğŸ“ ç¤ºä¾‹</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ”„ æ¸…ç©º</button>
              </div>
            </div>
          </div>

          <!-- Right: Results -->
          <div class="output-panel">
            <div class="tool-section">
              <div class="section-title">ç»Ÿè®¡ä¿¡æ¯</div>
              <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                  <div class="stat-value" id="totalCount">-</div>
                  <div class="stat-label">æ€»æ•°é‡</div>
                </div>
                <div class="stat-card normal">
                  <div class="stat-value" id="normalCount">-</div>
                  <div class="stat-label">æ­£å¸¸å€¼</div>
                </div>
                <div class="stat-card outlier">
                  <div class="stat-value" id="outlierCount">-</div>
                  <div class="stat-label">å¼‚å¸¸å€¼</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="outlierPercent">-</div>
                  <div class="stat-label">å¼‚å¸¸æ¯”ä¾‹</div>
                </div>
              </div>

              <div class="bounds-info" id="boundsInfo" style="display: none;">
                <div class="bounds-row">
                  <span class="bounds-label">ä¸‹ç•Œ</span>
                  <span class="bounds-value" id="lowerBound">-</span>
                </div>
                <div class="bounds-row">
                  <span class="bounds-label">ä¸Šç•Œ</span>
                  <span class="bounds-value" id="upperBound">-</span>
                </div>
                <div class="bounds-row">
                  <span class="bounds-label">å¹³å‡å€¼</span>
                  <span class="bounds-value" id="meanValue">-</span>
                </div>
                <div class="bounds-row">
                  <span class="bounds-label">ä¸­ä½æ•°</span>
                  <span class="bounds-value" id="medianValue">-</span>
                </div>
                <div class="bounds-row">
                  <span class="bounds-label">æ ‡å‡†å·®</span>
                  <span class="bounds-value" id="stdValue">-</span>
                </div>
              </div>
            </div>

            <div class="tool-section">
              <div class="section-title">æ£€æµ‹ç»“æœ</div>
              <div class="results-container" id="resultsContainer">
                <div class="results-placeholder" id="resultsPlaceholder">è¾“å…¥æ•°æ®åæ˜¾ç¤ºç»“æœ</div>
              </div>
              <div class="btn-row" style="margin-top: 16px;">
                <button class="btn btn-success" onclick="copyResults()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button class="btn btn-secondary" onclick="copyOutliersOnly()">ğŸ“‹ ä»…å¤åˆ¶å¼‚å¸¸å€¼</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div class="toast" id="toast">æ“ä½œæˆåŠŸ</div>

    <script>
      var LS_KEY = 'outlier-detector-data';
      var lastResults = null;

      // Theme toggle
      function toggleTheme() {
        var body = document.body;
        var isDark = body.getAttribute('data-theme') !== 'light';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
      }

      // Load theme
      (function () {
        var saved = localStorage.getItem('theme');
        if (saved === 'light') {
          document.body.setAttribute('data-theme', 'light');
        }
      })();

      // Update method options
      function updateMethodOptions() {
        var method = document.getElementById('method').value;
        var thresholdLabel = document.getElementById('thresholdLabel');
        var thresholdSelect = document.getElementById('threshold');
        var methodHint = document.getElementById('methodHint');

        if (method === 'iqr') {
          thresholdLabel.textContent = 'IQR ä¹˜æ•°';
          thresholdSelect.innerHTML = '<option value="1.5">1.5ï¼ˆæ ‡å‡†ï¼‰</option><option value="2.2">2.2ï¼ˆä¸­ç­‰ï¼‰</option><option value="3">3ï¼ˆå®½æ¾ï¼‰</option>';
          methodHint.textContent = 'IQR æ–¹æ³•ï¼šå¼‚å¸¸å€¼ = å€¼ < Q1 - kÃ—IQR æˆ– å€¼ > Q3 + kÃ—IQR';
        } else {
          thresholdLabel.textContent = 'Z-score é˜ˆå€¼';
          thresholdSelect.innerHTML = '<option value="2">2ï¼ˆä¸¥æ ¼ï¼‰</option><option value="2.5">2.5ï¼ˆä¸­ç­‰ï¼‰</option><option value="3">3ï¼ˆå®½æ¾ï¼‰</option>';
          methodHint.textContent = 'Z-score æ–¹æ³•ï¼šå¼‚å¸¸å€¼ = |z| > é˜ˆå€¼ï¼Œz = (x - Î¼) / Ïƒ';
        }
        saveToStorage();
      }

      // Parse input data
      function parseData(input) {
        var lines = input.trim().split('\n');
        var values = [];
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i].trim();
          if (line === '') continue;
          var num = parseFloat(line);
          if (!isNaN(num)) {
            values.push(num);
          }
        }
        return values;
      }

      // Calculate statistics
      function calculateStats(values) {
        var n = values.length;
        if (n === 0) return null;

        var sorted = values.slice().sort(function(a, b) { return a - b; });

        // Mean
        var sum = 0;
        for (var i = 0; i < n; i++) sum += values[i];
        var mean = sum / n;

        // Standard deviation
        var sqSum = 0;
        for (var i = 0; i < n; i++) sqSum += Math.pow(values[i] - mean, 2);
        var std = Math.sqrt(sqSum / n);

        // Median
        var median;
        var mid = Math.floor(n / 2);
        if (n % 2 === 0) {
          median = (sorted[mid - 1] + sorted[mid]) / 2;
        } else {
          median = sorted[mid];
        }

        // Quartiles
        var q1Idx = Math.floor(n * 0.25);
        var q3Idx = Math.floor(n * 0.75);
        var q1 = sorted[q1Idx];
        var q3 = sorted[q3Idx];
        var iqr = q3 - q1;

        return {
          mean: mean,
          std: std,
          median: median,
          q1: q1,
          q3: q3,
          iqr: iqr,
          min: sorted[0],
          max: sorted[n - 1]
        };
      }

      // IQR method
      function detectIQR(values, multiplier) {
        var stats = calculateStats(values);
        if (!stats) return null;

        var lowerBound = stats.q1 - multiplier * stats.iqr;
        var upperBound = stats.q3 + multiplier * stats.iqr;

        var results = [];
        for (var i = 0; i < values.length; i++) {
          var v = values[i];
          var isOutlier = v < lowerBound || v > upperBound;
          results.push({
            value: v,
            isOutlier: isOutlier,
            reason: isOutlier ? (v < lowerBound ? 'ä½äºä¸‹ç•Œ' : 'é«˜äºä¸Šç•Œ') : ''
          });
        }

        return {
          results: results,
          stats: stats,
          lowerBound: lowerBound,
          upperBound: upperBound,
          method: 'IQR',
          threshold: multiplier
        };
      }

      // Z-score method
      function detectZScore(values, threshold) {
        var stats = calculateStats(values);
        if (!stats) return null;

        var lowerBound = stats.mean - threshold * stats.std;
        var upperBound = stats.mean + threshold * stats.std;

        var results = [];
        for (var i = 0; i < values.length; i++) {
          var v = values[i];
          var zScore = stats.std > 0 ? (v - stats.mean) / stats.std : 0;
          var isOutlier = Math.abs(zScore) > threshold;
          results.push({
            value: v,
            isOutlier: isOutlier,
            zScore: zScore,
            reason: isOutlier ? ('Z-score = ' + zScore.toFixed(2)) : ''
          });
        }

        return {
          results: results,
          stats: stats,
          lowerBound: lowerBound,
          upperBound: upperBound,
          method: 'Z-score',
          threshold: threshold
        };
      }

      // Main detection function
      function detectOutliers() {
        var input = document.getElementById('dataInput').value;
        var values = parseData(input);

        if (values.length < 4) {
          showToast('è¯·è¾“å…¥è‡³å°‘ 4 ä¸ªæ•°å€¼', 'error');
          return;
        }

        var method = document.getElementById('method').value;
        var threshold = parseFloat(document.getElementById('threshold').value);

        var result;
        if (method === 'iqr') {
          result = detectIQR(values, threshold);
        } else {
          result = detectZScore(values, threshold);
        }

        if (!result) {
          showToast('æ£€æµ‹å¤±è´¥', 'error');
          return;
        }

        lastResults = result;
        displayResults(result);
        saveToStorage();
        showToast('æ£€æµ‹å®Œæˆ');
      }

      // Display results
      function displayResults(result) {
        var stats = result.stats;
        var results = result.results;

        // Count stats
        var total = results.length;
        var outlierCount = 0;
        for (var i = 0; i < results.length; i++) {
          if (results[i].isOutlier) outlierCount++;
        }
        var normalCount = total - outlierCount;
        var outlierPercent = ((outlierCount / total) * 100).toFixed(1) + '%';

        document.getElementById('totalCount').textContent = total;
        document.getElementById('normalCount').textContent = normalCount;
        document.getElementById('outlierCount').textContent = outlierCount;
        document.getElementById('outlierPercent').textContent = outlierPercent;

        // Bounds info
        document.getElementById('lowerBound').textContent = result.lowerBound.toFixed(4);
        document.getElementById('upperBound').textContent = result.upperBound.toFixed(4);
        document.getElementById('meanValue').textContent = stats.mean.toFixed(4);
        document.getElementById('medianValue').textContent = stats.median.toFixed(4);
        document.getElementById('stdValue').textContent = stats.std.toFixed(4);
        document.getElementById('boundsInfo').style.display = 'block';

        // Results list
        var container = document.getElementById('resultsContainer');
        container.textContent = '';

        for (var i = 0; i < results.length; i++) {
          var r = results[i];
          var item = document.createElement('div');
          item.className = 'result-item ' + (r.isOutlier ? 'outlier' : 'normal');

          var valueSpan = document.createElement('span');
          valueSpan.className = 'value';
          valueSpan.textContent = r.value;

          var badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = r.isOutlier ? 'å¼‚å¸¸' : 'æ­£å¸¸';

          item.appendChild(valueSpan);
          item.appendChild(badge);
          container.appendChild(item);
        }
      }

      // Copy results
      function copyResults() {
        if (!lastResults) {
          showToast('è¯·å…ˆæ£€æµ‹å¼‚å¸¸å€¼', 'error');
          return;
        }

        var lines = ['æ£€æµ‹æ–¹æ³•: ' + lastResults.method + ' (é˜ˆå€¼: ' + lastResults.threshold + ')'];
        lines.push('ä¸‹ç•Œ: ' + lastResults.lowerBound.toFixed(4));
        lines.push('ä¸Šç•Œ: ' + lastResults.upperBound.toFixed(4));
        lines.push('');
        lines.push('å€¼\tçŠ¶æ€');
        lines.push('--------------------');

        for (var i = 0; i < lastResults.results.length; i++) {
          var r = lastResults.results[i];
          lines.push(r.value + '\t' + (r.isOutlier ? 'å¼‚å¸¸' : 'æ­£å¸¸'));
        }

        navigator.clipboard.writeText(lines.join('\n')).then(function() {
          showToast('ç»“æœå·²å¤åˆ¶');
        }).catch(function() {
          showToast('å¤åˆ¶å¤±è´¥', 'error');
        });
      }

      // Copy outliers only
      function copyOutliersOnly() {
        if (!lastResults) {
          showToast('è¯·å…ˆæ£€æµ‹å¼‚å¸¸å€¼', 'error');
          return;
        }

        var outliers = [];
        for (var i = 0; i < lastResults.results.length; i++) {
          var r = lastResults.results[i];
          if (r.isOutlier) outliers.push(r.value);
        }

        if (outliers.length === 0) {
          showToast('æ²¡æœ‰æ£€æµ‹åˆ°å¼‚å¸¸å€¼', 'error');
          return;
        }

        navigator.clipboard.writeText(outliers.join('\n')).then(function() {
          showToast('å¼‚å¸¸å€¼å·²å¤åˆ¶');
        }).catch(function() {
          showToast('å¤åˆ¶å¤±è´¥', 'error');
        });
      }

      // Paste data
      function pasteData() {
        navigator.clipboard.readText().then(function(text) {
          document.getElementById('dataInput').value = text;
          saveToStorage();
          showToast('å·²ç²˜è´´');
        }).catch(function() {
          showToast('æ— æ³•è®¿é—®å‰ªè´´æ¿', 'error');
        });
      }

      // Load sample data
      function loadSampleData() {
        var sample = '10\n12\n14\n15\n16\n18\n20\n22\n24\n25\n100\n-50\n28\n30\n32';
        document.getElementById('dataInput').value = sample;
        saveToStorage();
        detectOutliers();
      }

      // Clear all
      function clearAll() {
        document.getElementById('dataInput').value = '';
        document.getElementById('method').value = 'iqr';
        updateMethodOptions();

        document.getElementById('totalCount').textContent = '-';
        document.getElementById('normalCount').textContent = '-';
        document.getElementById('outlierCount').textContent = '-';
        document.getElementById('outlierPercent').textContent = '-';
        document.getElementById('boundsInfo').style.display = 'none';

        var container = document.getElementById('resultsContainer');
        container.textContent = '';
        var placeholder = document.createElement('div');
        placeholder.className = 'results-placeholder';
        placeholder.textContent = 'è¾“å…¥æ•°æ®åæ˜¾ç¤ºç»“æœ';
        container.appendChild(placeholder);

        lastResults = null;
        localStorage.removeItem(LS_KEY);
        window.location.hash = '';

        showToast('å·²æ¸…ç©º');
      }

      // Save to localStorage
      function saveToStorage() {
        var data = {
          input: document.getElementById('dataInput').value,
          method: document.getElementById('method').value,
          threshold: document.getElementById('threshold').value
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      }

      // Load from localStorage
      function loadFromStorage() {
        if (window.location.hash) return;

        var saved = localStorage.getItem(LS_KEY);
        if (!saved) return;

        try {
          var data = JSON.parse(saved);
          if (data.input) document.getElementById('dataInput').value = data.input;
          if (data.method) {
            document.getElementById('method').value = data.method;
            updateMethodOptions();
          }
          if (data.threshold) document.getElementById('threshold').value = data.threshold;
        } catch (e) {
          // Ignore parse errors
        }
      }

      // Load from URL
      function loadFromUrl() {
        var hash = window.location.hash.slice(1);
        if (!hash) return;

        try {
          var data = JSON.parse(decodeURIComponent(atob(hash)));
          if (data.input) document.getElementById('dataInput').value = data.input;
          if (data.method) {
            document.getElementById('method').value = data.method;
            updateMethodOptions();
          }
          if (data.threshold) document.getElementById('threshold').value = data.threshold;

          if (data.input) {
            setTimeout(detectOutliers, 100);
          }
        } catch (e) {
          // Ignore parse errors
        }
      }

      // Show toast
      function showToast(msg, type) {
        type = type || 'success';
        var toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.className = 'toast' + (type === 'error' ? ' error' : '');
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 2000);
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', function () {
        loadFromStorage();
        loadFromUrl();

        // Auto-save
        document.querySelectorAll('input, textarea, select').forEach(function(el) {
          el.addEventListener('input', saveToStorage);
          el.addEventListener('change', saveToStorage);
        });
      });
    </script>
  </body>
</html>

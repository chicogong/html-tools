<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="keywords" content="websocket-test,dev,tools,webutils" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/websocket-test.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta property="og:description" content="WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/websocket-test.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="twitter:description" content="WebSocketæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --glow-red: rgb(244, 63, 94, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-input: #f5f5f5;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --border-strong: #d5d5d5;
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

        :root {
            --msg-sent-bg: #dbeafe;
            --msg-received-bg: #dcfce7;
            --msg-error-bg: #fee2e2;
            --msg-system-bg: #f3f4f6;
        }
        [data-theme="dark"] {
            --msg-sent-bg: #1e3a5f;
            --msg-received-bg: #14532d;
            --msg-error-bg: #7f1d1d;
            --msg-system-bg: #374151;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        .connection-panel {
            background: var(--pico-card-background-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .connection-row {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        .connection-row input {
            flex: 1;
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            background: var(--pico-card-background-color);
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #9ca3af;
        }
        .status-dot.connected {
            background: #22c55e;
            animation: pulse 2s infinite;
        }
        .status-dot.connecting {
            background: #eab308;
            animation: pulse 1s infinite;
        }
        .status-dot.error {
            background: #ef4444;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .messages-container {
            background: var(--pico-card-background-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            height: 500px;
        }
        .messages-header {
            padding: 1rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .messages-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .message-item {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            word-break: break-all;
        }
        .message-item.sent {
            background: var(--msg-sent-bg);
            margin-left: 2rem;
        }
        .message-item.received {
            background: var(--msg-received-bg);
            margin-right: 2rem;
        }
        .message-item.error {
            background: var(--msg-error-bg);
        }
        .message-item.system {
            background: var(--msg-system-bg);
            text-align: center;
            font-style: italic;
        }
        .message-meta {
            font-size: 0.75rem;
            color: var(--pico-muted-color);
            margin-bottom: 0.25rem;
        }
        .message-content {
            white-space: pre-wrap;
        }
        .send-panel {
            padding: 1rem;
            border-top: 1px solid var(--pico-muted-border-color);
        }
        .send-row {
            display: flex;
            gap: 0.5rem;
        }
        .send-row textarea {
            flex: 1;
            resize: none;
            min-height: 60px;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .panel {
            background: var(--pico-card-background-color);
            padding: 1rem;
            border-radius: 8px;
        }
        .panel h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        .saved-messages {
            max-height: 200px;
            overflow-y: auto;
        }
        .saved-message {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--pico-background-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .saved-message:hover {
            background: var(--pico-secondary-background);
        }
        .saved-message-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .history-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--pico-background-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .history-item:hover {
            background: var(--pico-secondary-background);
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.85rem;
        }
        .stat-item {
            text-align: center;
            padding: 0.5rem;
            background: var(--pico-background-color);
            border-radius: 4px;
        }
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--pico-primary);
        }
        .protocol-select {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .protocol-select button {
            flex: 1;
            padding: 0.5rem;
        }
        .protocol-select button.active {
            background: var(--pico-primary);
            border-color: var(--pico-primary);
            color: white;
        }
        .format-options {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .format-options label {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85rem;
        }
    
        .breadcrumb { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
    <span id="theme-icon">ğŸŒ™</span>
  </button>

    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span><a href="../../index.html#dev">å¼€å‘å·¥å…·</a><span>â€º</span>WebSocketæµ‹è¯•å®¢æˆ·ç«¯</nav>
    <div class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>WebSocketæµ‹è¯•å®¢æˆ·ç«¯</h1>
            <button id="themeToggle" class="outline">åˆ‡æ¢ä¸»é¢˜</button>
        </header>

        <div class="connection-panel">
            <div class="protocol-select">
                <button id="wsBtn" class="active outline">WS (ä¸å®‰å…¨)</button>
                <button id="wssBtn" class="outline">WSS (å®‰å…¨)</button>
            </div>
            <div class="connection-row">
                <label style="flex: 1;">
                    æœåŠ¡å™¨åœ°å€
                    <input type="text" id="wsUrl" placeholder="localhost:8080/ws">
                </label>
                <button id="connectBtn">è¿æ¥</button>
                <button id="disconnectBtn" class="secondary" disabled>æ–­å¼€</button>
            </div>
            <div style="margin-top: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                <div class="status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">æœªè¿æ¥</span>
                </div>
                <small id="connectionInfo" style="color: var(--pico-muted-color);"></small>
            </div>
        </div>

        <div class="main-content">
            <div class="chat-panel">
                <div class="messages-container">
                    <div class="messages-header">
                        <span>æ¶ˆæ¯è®°å½•</span>
                        <button id="clearMessagesBtn" class="outline" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">æ¸…ç©º</button>
                    </div>
                    <div class="messages-list" id="messagesList"></div>
                    <div class="send-panel">
                        <div class="format-options">
                            <label>
                                <input type="radio" name="msgFormat" value="text" checked> æ–‡æœ¬
                            </label>
                            <label>
                                <input type="radio" name="msgFormat" value="json"> JSON
                            </label>
                            <label>
                                <input type="checkbox" id="prettyJson"> ç¾åŒ–JSON
                            </label>
                        </div>
                        <div class="send-row">
                            <textarea id="messageInput" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯..." disabled></textarea>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button id="sendBtn" disabled>å‘é€</button>
                                <button id="saveMessageBtn" class="outline" style="padding: 0.5rem;">ä¿å­˜</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>è¿æ¥ç»Ÿè®¡</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="sentCount">0</div>
                            <div>å·²å‘é€</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="receivedCount">0</div>
                            <div>å·²æ¥æ”¶</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="sentBytes">0</div>
                            <div>å‘é€å­—èŠ‚</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="receivedBytes">0</div>
                            <div>æ¥æ”¶å­—èŠ‚</div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3>ä¿å­˜çš„æ¶ˆæ¯</h3>
                    <div class="saved-messages" id="savedMessages">
                        <p style="color: var(--pico-muted-color); font-size: 0.85rem; text-align: center;">æš‚æ— ä¿å­˜çš„æ¶ˆæ¯</p>
                    </div>
                </div>

                <div class="panel">
                    <h3>è¿æ¥å†å²</h3>
                    <div id="connectionHistory">
                        <p style="color: var(--pico-muted-color); font-size: 0.85rem; text-align: center;">æš‚æ— å†å²è®°å½•</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // çŠ¶æ€
        let ws = null;
        let protocol = 'ws';
        let stats = {
            sent: 0,
            received: 0,
            sentBytes: 0,
            receivedBytes: 0
        };
        let savedMessages = JSON.parse(localStorage.getItem('wsSavedMessages') || '[]');
        let connectionHistory = JSON.parse(localStorage.getItem('wsConnectionHistory') || '[]');

        // åˆå§‹åŒ–
        function init() {
            renderSavedMessages();
            renderConnectionHistory();
            bindEvents();
        }

        // ä¸»é¢˜åˆ‡æ¢
        document.getElementById('themeToggle').addEventListener('click', function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // åè®®åˆ‡æ¢
            document.getElementById('wsBtn').addEventListener('click', function() {
                protocol = 'ws';
                this.classList.add('active');
                document.getElementById('wssBtn').classList.remove('active');
            });

            document.getElementById('wssBtn').addEventListener('click', function() {
                protocol = 'wss';
                this.classList.add('active');
                document.getElementById('wsBtn').classList.remove('active');
            });

            // è¿æ¥
            document.getElementById('connectBtn').addEventListener('click', connect);
            document.getElementById('disconnectBtn').addEventListener('click', disconnect);

            // å‘é€æ¶ˆæ¯
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    sendMessage();
                }
            });

            // ä¿å­˜æ¶ˆæ¯
            document.getElementById('saveMessageBtn').addEventListener('click', saveCurrentMessage);

            // æ¸…ç©ºæ¶ˆæ¯
            document.getElementById('clearMessagesBtn').addEventListener('click', function() {
                document.getElementById('messagesList').replaceChildren();
            });

            // å›è½¦è¿æ¥
            document.getElementById('wsUrl').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    connect();
                }
            });
        }

        // è¿æ¥WebSocket
        function connect() {
            const urlInput = document.getElementById('wsUrl').value.trim();
            if (!urlInput) {
                addSystemMessage('è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€');
                return;
            }

            const url = protocol + '://' + urlInput;
            
            updateStatus('connecting', 'è¿æ¥ä¸­...');
            
            try {
                ws = new WebSocket(url);
                
                ws.onopen = function() {
                    updateStatus('connected', 'å·²è¿æ¥');
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                    document.getElementById('messageInput').disabled = false;
                    document.getElementById('sendBtn').disabled = false;
                    document.getElementById('connectionInfo').textContent = 'è¿æ¥æ—¶é—´: ' + new Date().toLocaleTimeString();
                    
                    addSystemMessage('å·²è¿æ¥åˆ° ' + url);
                    
                    // ä¿å­˜åˆ°å†å²
                    addToHistory(urlInput);
                };
                
                ws.onmessage = function(event) {
                    stats.received++;
                    stats.receivedBytes += event.data.length;
                    updateStats();
                    
                    let content = event.data;
                    const prettyJson = document.getElementById('prettyJson').checked;
                    
                    if (prettyJson) {
                        try {
                            const parsed = JSON.parse(event.data);
                            content = JSON.stringify(parsed, null, 2);
                        } catch (e) {
                            // ä¸æ˜¯JSONï¼Œä¿æŒåŸæ ·
                        }
                    }
                    
                    addMessage('received', content);
                };
                
                ws.onerror = function(error) {
                    updateStatus('error', 'è¿æ¥é”™è¯¯');
                    addSystemMessage('è¿æ¥å‘ç”Ÿé”™è¯¯', 'error');
                };
                
                ws.onclose = function(event) {
                    updateStatus('disconnected', 'æœªè¿æ¥');
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    document.getElementById('messageInput').disabled = true;
                    document.getElementById('sendBtn').disabled = true;
                    
                    let reason = event.reason || 'è¿æ¥å…³é—­';
                    addSystemMessage('è¿æ¥å·²å…³é—­: ' + reason + ' (ä»£ç : ' + event.code + ')');
                    
                    ws = null;
                };
            } catch (error) {
                updateStatus('error', 'è¿æ¥å¤±è´¥');
                addSystemMessage('æ— æ³•åˆ›å»ºWebSocketè¿æ¥: ' + error.message, 'error');
            }
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addSystemMessage('æœªè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
                return;
            }
            
            const input = document.getElementById('messageInput');
            let message = input.value.trim();
            
            if (!message) return;
            
            const format = document.querySelector('input[name="msgFormat"]:checked').value;
            
            if (format === 'json') {
                try {
                    JSON.parse(message);
                } catch (e) {
                    addSystemMessage('JSONæ ¼å¼é”™è¯¯: ' + e.message, 'error');
                    return;
                }
            }
            
            ws.send(message);
            stats.sent++;
            stats.sentBytes += message.length;
            updateStats();
            
            addMessage('sent', message);
            input.value = '';
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°åˆ—è¡¨
        function addMessage(type, content) {
            const list = document.getElementById('messagesList');
            const item = document.createElement('div');
            item.className = 'message-item ' + type;
            
            const meta = document.createElement('div');
            meta.className = 'message-meta';
            meta.textContent = (type === 'sent' ? 'å‘é€' : 'æ¥æ”¶') + ' - ' + new Date().toLocaleTimeString();
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            item.appendChild(meta);
            item.appendChild(contentDiv);
            list.appendChild(item);
            
            list.scrollTop = list.scrollHeight;
        }

        // æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
        function addSystemMessage(text, type) {
            const list = document.getElementById('messagesList');
            const item = document.createElement('div');
            item.className = 'message-item ' + (type || 'system');
            item.textContent = text;
            list.appendChild(item);
            list.scrollTop = list.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(state, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            dot.className = 'status-dot';
            if (state === 'connected') {
                dot.classList.add('connected');
            } else if (state === 'connecting') {
                dot.classList.add('connecting');
            } else if (state === 'error') {
                dot.classList.add('error');
            }
            
            statusText.textContent = text;
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('sentCount').textContent = stats.sent;
            document.getElementById('receivedCount').textContent = stats.received;
            document.getElementById('sentBytes').textContent = formatBytes(stats.sentBytes);
            document.getElementById('receivedBytes').textContent = formatBytes(stats.receivedBytes);
        }

        // æ ¼å¼åŒ–å­—èŠ‚
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + 'B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + 'K';
            return (bytes / (1024 * 1024)).toFixed(1) + 'M';
        }

        // ä¿å­˜å½“å‰æ¶ˆæ¯
        function saveCurrentMessage() {
            const message = document.getElementById('messageInput').value.trim();
            if (!message) {
                alert('è¯·å…ˆè¾“å…¥è¦ä¿å­˜çš„æ¶ˆæ¯');
                return;
            }
            
            if (savedMessages.length >= 10) {
                savedMessages.shift();
            }
            
            savedMessages.push({
                content: message,
                time: new Date().toLocaleString()
            });
            
            localStorage.setItem('wsSavedMessages', JSON.stringify(savedMessages));
            renderSavedMessages();
            alert('æ¶ˆæ¯å·²ä¿å­˜');
        }

        // æ¸²æŸ“ä¿å­˜çš„æ¶ˆæ¯
        function renderSavedMessages() {
            const container = document.getElementById('savedMessages');
            container.replaceChildren();
            
            if (savedMessages.length === 0) {
                const p = document.createElement('p');
                p.style.cssText = 'color: var(--pico-muted-color); font-size: 0.85rem; text-align: center;';
                p.textContent = 'æš‚æ— ä¿å­˜çš„æ¶ˆæ¯';
                container.appendChild(p);
                return;
            }
            
            savedMessages.forEach(function(msg, index) {
                const item = document.createElement('div');
                item.className = 'saved-message';
                
                const text = document.createElement('span');
                text.className = 'saved-message-text';
                text.textContent = msg.content;
                text.addEventListener('click', function() {
                    document.getElementById('messageInput').value = msg.content;
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'outline';
                deleteBtn.style.cssText = 'padding: 0.1rem 0.3rem; font-size: 0.7rem;';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    savedMessages.splice(index, 1);
                    localStorage.setItem('wsSavedMessages', JSON.stringify(savedMessages));
                    renderSavedMessages();
                });
                
                item.appendChild(text);
                item.appendChild(deleteBtn);
                container.appendChild(item);
            });
        }

        // æ·»åŠ åˆ°è¿æ¥å†å²
        function addToHistory(url) {
            connectionHistory = connectionHistory.filter(function(h) { return h !== url; });
            connectionHistory.unshift(url);
            if (connectionHistory.length > 5) {
                connectionHistory.pop();
            }
            localStorage.setItem('wsConnectionHistory', JSON.stringify(connectionHistory));
            renderConnectionHistory();
        }

        // æ¸²æŸ“è¿æ¥å†å²
        function renderConnectionHistory() {
            const container = document.getElementById('connectionHistory');
            container.replaceChildren();
            
            if (connectionHistory.length === 0) {
                const p = document.createElement('p');
                p.style.cssText = 'color: var(--pico-muted-color); font-size: 0.85rem; text-align: center;';
                p.textContent = 'æš‚æ— å†å²è®°å½•';
                container.appendChild(p);
                return;
            }
            
            connectionHistory.forEach(function(url) {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = url;
                item.addEventListener('click', function() {
                    document.getElementById('wsUrl').value = url;
                });
                container.appendChild(item);
            });
        }

        // å¯åŠ¨
        init();
    
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', newTheme);
    }


</script>
</body>
</html>

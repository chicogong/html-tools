<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦‚ç‡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }
        .grid-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .result-box {
            background: var(--pico-primary-focus);
            border: 2px solid var(--pico-primary);
            border-radius: var(--pico-border-radius);
            padding: var(--spacing-lg);
            text-align: center;
            margin: var(--spacing-md) 0;
        }
        .result-box h2 {
            margin: 0;
            font-size: 2rem;
        }
        .result-box p {
            margin: var(--spacing-sm) 0 0 0;
            color: var(--pico-muted-color);
        }
        .btn-group {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: var(--spacing-md);
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            border-bottom: 2px solid var(--pico-muted-border-color);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }
        .tab {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            border-bottom-color: var(--pico-primary);
            color: var(--pico-primary);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .formula-box {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            font-family: monospace;
        }
        .formula-title {
            font-weight: bold;
            margin-bottom: var(--spacing-sm);
            color: var(--pico-primary);
        }
        .event-list {
            margin-top: var(--spacing-md);
        }
        .event-item {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        .event-item input {
            flex: 1;
        }
        .event-item button {
            padding: 0.5rem;
            width: auto;
        }
        .dice-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        .dice-btn {
            aspect-ratio: 1;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dice-btn.selected {
            background: var(--pico-primary);
            color: var(--pico-primary-inverse);
        }
    </style>
</head>
<body>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <div class="header">
            <h1>æ¦‚ç‡è®¡ç®—å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
        </div>

        <article>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('basic')">åŸºæœ¬æ¦‚ç‡</button>
                <button class="tab" onclick="switchTab('combined')">ç»„åˆæ¦‚ç‡</button>
                <button class="tab" onclick="switchTab('conditional')">æ¡ä»¶æ¦‚ç‡</button>
                <button class="tab" onclick="switchTab('binomial')">äºŒé¡¹åˆ†å¸ƒ</button>
                <button class="tab" onclick="switchTab('dice')">éª°å­æ¦‚ç‡</button>
            </div>

            <!-- Basic Probability Tab -->
            <div id="basic-tab" class="tab-content active">
                <div class="formula-box">
                    <div class="formula-title">åŸºæœ¬æ¦‚ç‡å…¬å¼</div>
                    <div>P(A) = æœ‰åˆ©ç»“æœæ•° / æ€»å¯èƒ½ç»“æœæ•°</div>
                </div>

                <div class="grid-inputs">
                    <label>
                        æœ‰åˆ©ç»“æœæ•°
                        <input type="number" id="favorable" value="1" min="0">
                    </label>
                    <label>
                        æ€»å¯èƒ½ç»“æœæ•°
                        <input type="number" id="total" value="6" min="1">
                    </label>
                </div>

                <div class="btn-group">
                    <button onclick="calculateBasic()">è®¡ç®—æ¦‚ç‡</button>
                    <button class="secondary" onclick="clearBasic()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- Combined Probability Tab -->
            <div id="combined-tab" class="tab-content">
                <div class="formula-box">
                    <div class="formula-title">ç»„åˆæ¦‚ç‡å…¬å¼</div>
                    <div>P(A ä¸” B) = P(A) Ã— P(B)  [ç‹¬ç«‹äº‹ä»¶]</div>
                    <div>P(A æˆ– B) = P(A) + P(B) - P(A ä¸” B)</div>
                </div>

                <div class="grid-inputs">
                    <label>
                        P(A) æ¦‚ç‡
                        <input type="number" id="probA" value="0.5" min="0" max="1" step="0.01">
                    </label>
                    <label>
                        P(B) æ¦‚ç‡
                        <input type="number" id="probB" value="0.3" min="0" max="1" step="0.01">
                    </label>
                    <label>
                        è¿ç®—ç±»å‹
                        <select id="combineType">
                            <option value="and">A ä¸” B (åŒæ—¶å‘ç”Ÿ)</option>
                            <option value="or">A æˆ– B (è‡³å°‘ä¸€ä¸ªå‘ç”Ÿ)</option>
                            <option value="not">é A (A ä¸å‘ç”Ÿ)</option>
                            <option value="xor">ä»…ä¸€ä¸ªå‘ç”Ÿ</option>
                        </select>
                    </label>
                </div>

                <label>
                    <input type="checkbox" id="independent" checked>
                    äº‹ä»¶ç‹¬ç«‹
                </label>

                <div class="btn-group">
                    <button onclick="calculateCombined()">è®¡ç®—æ¦‚ç‡</button>
                    <button class="secondary" onclick="clearCombined()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- Conditional Probability Tab -->
            <div id="conditional-tab" class="tab-content">
                <div class="formula-box">
                    <div class="formula-title">æ¡ä»¶æ¦‚ç‡ (è´å¶æ–¯å…¬å¼)</div>
                    <div>P(A|B) = P(B|A) Ã— P(A) / P(B)</div>
                </div>

                <div class="grid-inputs">
                    <label>
                        P(A) å…ˆéªŒæ¦‚ç‡
                        <input type="number" id="priorA" value="0.01" min="0" max="1" step="0.001">
                    </label>
                    <label>
                        P(B|A) åœ¨Aå‘ç”Ÿæ—¶Bçš„æ¦‚ç‡
                        <input type="number" id="probBgivenA" value="0.9" min="0" max="1" step="0.01">
                    </label>
                    <label>
                        P(B|éA) åœ¨Aä¸å‘ç”Ÿæ—¶Bçš„æ¦‚ç‡
                        <input type="number" id="probBgivenNotA" value="0.05" min="0" max="1" step="0.01">
                    </label>
                </div>

                <div class="btn-group">
                    <button onclick="calculateConditional()">è®¡ç®—åéªŒæ¦‚ç‡</button>
                    <button class="secondary" onclick="clearConditional()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- Binomial Distribution Tab -->
            <div id="binomial-tab" class="tab-content">
                <div class="formula-box">
                    <div class="formula-title">äºŒé¡¹åˆ†å¸ƒå…¬å¼</div>
                    <div>P(X=k) = C(n,k) Ã— p^k Ã— (1-p)^(n-k)</div>
                </div>

                <div class="grid-inputs">
                    <label>
                        è¯•éªŒæ¬¡æ•° (n)
                        <input type="number" id="trials" value="10" min="1" max="1000">
                    </label>
                    <label>
                        æˆåŠŸæ¦‚ç‡ (p)
                        <input type="number" id="successProb" value="0.5" min="0" max="1" step="0.01">
                    </label>
                    <label>
                        æˆåŠŸæ¬¡æ•° (k)
                        <input type="number" id="successes" value="5" min="0">
                    </label>
                    <label>
                        è®¡ç®—ç±»å‹
                        <select id="binomialType">
                            <option value="exact">æ°å¥½ k æ¬¡</option>
                            <option value="atLeast">è‡³å°‘ k æ¬¡</option>
                            <option value="atMost">è‡³å¤š k æ¬¡</option>
                            <option value="between">ä»‹äº k1 å’Œ k2 ä¹‹é—´</option>
                        </select>
                    </label>
                </div>

                <div id="k2Container" style="display: none;">
                    <label>
                        æˆåŠŸæ¬¡æ•°ä¸Šé™ (k2)
                        <input type="number" id="successes2" value="7" min="0">
                    </label>
                </div>

                <div class="btn-group">
                    <button onclick="calculateBinomial()">è®¡ç®—æ¦‚ç‡</button>
                    <button class="secondary" onclick="clearBinomial()">æ¸…ç©º</button>
                </div>
            </div>

            <!-- Dice Probability Tab -->
            <div id="dice-tab" class="tab-content">
                <div class="formula-box">
                    <div class="formula-title">éª°å­æ¦‚ç‡è®¡ç®—</div>
                    <div>é€‰æ‹©ç›®æ ‡ç‚¹æ•°è®¡ç®—æŠ•æ·æ¦‚ç‡</div>
                </div>

                <div class="grid-inputs">
                    <label>
                        éª°å­æ•°é‡
                        <input type="number" id="diceCount" value="2" min="1" max="10">
                    </label>
                    <label>
                        éª°å­é¢æ•°
                        <input type="number" id="diceFaces" value="6" min="2" max="20">
                    </label>
                </div>

                <label>é€‰æ‹©ç›®æ ‡ç‚¹æ•° (ç‚¹å‡»åˆ‡æ¢)</label>
                <div class="dice-grid" id="diceGrid"></div>

                <div class="grid-inputs">
                    <label>
                        è®¡ç®—ç±»å‹
                        <select id="diceType">
                            <option value="exact">æ°å¥½ç­‰äºé€‰ä¸­æ€»å’Œ</option>
                            <option value="atLeast">å¤§äºç­‰äºé€‰ä¸­æœ€å°å€¼</option>
                            <option value="atMost">å°äºç­‰äºé€‰ä¸­æœ€å¤§å€¼</option>
                            <option value="any">æŠ•å‡ºä»»æ„é€‰ä¸­ç‚¹æ•°</option>
                        </select>
                    </label>
                </div>

                <div class="btn-group">
                    <button onclick="calculateDice()">è®¡ç®—æ¦‚ç‡</button>
                    <button class="secondary" onclick="clearDice()">æ¸…ç©º</button>
                </div>
            </div>

            <div class="result-box">
                <h2 id="result">--</h2>
                <p id="resultDetail">è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—</p>
            </div>
        </article>
    </main>

    <script>
        let selectedDice = [];

        window.toggleTheme = function() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
        };

        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
            document.querySelector('[onclick="switchTab(\'' + tabName + '\')"]').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'dice') {
                updateDiceGrid();
            }
        };

        // Factorial with memoization
        const factorialCache = {};
        window.factorial = function(n) {
            if (n <= 1) return 1;
            if (factorialCache[n]) return factorialCache[n];
            factorialCache[n] = n * factorial(n - 1);
            return factorialCache[n];
        };

        // Combination C(n, k)
        function combination(n, k) {
            if (k > n || k < 0) return 0;
            if (k === 0 || k === n) return 1;
            return factorial(n) / (factorial(k) * factorial(n - k));
        }

        function formatProbability(p) {
            const percent = (p * 100).toFixed(4);
            const fraction = toFraction(p);
            return percent + '%' + (fraction ? ' (' + fraction + ')' : '');
        }

        function toFraction(decimal, tolerance) {
            tolerance = tolerance || 0.0001;
            if (decimal === 0) return '0';
            if (decimal === 1) return '1';
            
            let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
            let b = decimal;
            
            do {
                const a = Math.floor(b);
                let aux = h1;
                h1 = a * h1 + h2;
                h2 = aux;
                aux = k1;
                k1 = a * k1 + k2;
                k2 = aux;
                b = 1 / (b - a);
            } while (Math.abs(decimal - h1 / k1) > decimal * tolerance && k1 < 10000);
            
            if (k1 > 1000) return null;
            return h1 + '/' + k1;
        }

        window.calculateBasic = function() {
            const favorable = parseInt(document.getElementById('favorable').value) || 0;
            const total = parseInt(document.getElementById('total').value) || 1;
            
            if (favorable > total) {
                alert('æœ‰åˆ©ç»“æœæ•°ä¸èƒ½å¤§äºæ€»å¯èƒ½ç»“æœæ•°');
                return;
            }

            const prob = favorable / total;
            document.getElementById('result').textContent = formatProbability(prob);
            document.getElementById('resultDetail').textContent = favorable + ' / ' + total + ' = ' + prob.toFixed(6);
        };

        window.clearBasic = function() {
            document.getElementById('favorable').value = 1;
            document.getElementById('total').value = 6;
            document.getElementById('result').textContent = '--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—';
        };

        window.calculateCombined = function() {
            const pA = parseFloat(document.getElementById('probA').value) || 0;
            const pB = parseFloat(document.getElementById('probB').value) || 0;
            const type = document.getElementById('combineType').value;
            
            let result, detail;
            
            switch (type) {
                case 'and':
                    result = pA * pB;
                    detail = 'P(A ä¸” B) = ' + pA + ' Ã— ' + pB + ' = ' + result.toFixed(6);
                    break;
                case 'or':
                    result = pA + pB - (pA * pB);
                    detail = 'P(A æˆ– B) = ' + pA + ' + ' + pB + ' - ' + (pA * pB).toFixed(6) + ' = ' + result.toFixed(6);
                    break;
                case 'not':
                    result = 1 - pA;
                    detail = 'P(éA) = 1 - ' + pA + ' = ' + result.toFixed(6);
                    break;
                case 'xor':
                    result = pA + pB - 2 * pA * pB;
                    detail = 'P(ä»…ä¸€ä¸ª) = ' + pA + ' + ' + pB + ' - 2Ã—' + (pA * pB).toFixed(6) + ' = ' + result.toFixed(6);
                    break;
            }
            
            document.getElementById('result').textContent = formatProbability(result);
            document.getElementById('resultDetail').textContent = detail;
        };

        window.clearCombined = function() {
            document.getElementById('probA').value = 0.5;
            document.getElementById('probB').value = 0.3;
            document.getElementById('combineType').value = 'and';
            document.getElementById('result').textContent = '--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—';
        };

        window.calculateConditional = function() {
            const pA = parseFloat(document.getElementById('priorA').value) || 0;
            const pBgivenA = parseFloat(document.getElementById('probBgivenA').value) || 0;
            const pBgivenNotA = parseFloat(document.getElementById('probBgivenNotA').value) || 0;
            
            // P(B) = P(B|A)P(A) + P(B|éA)P(éA)
            const pB = pBgivenA * pA + pBgivenNotA * (1 - pA);
            
            // P(A|B) = P(B|A)P(A) / P(B)
            const pAgivenB = (pBgivenA * pA) / pB;
            
            document.getElementById('result').textContent = formatProbability(pAgivenB);
            document.getElementById('resultDetail').textContent = 'P(A|B) = (' + pBgivenA + ' Ã— ' + pA + ') / ' + pB.toFixed(6) + ' = ' + pAgivenB.toFixed(6);
        };

        window.clearConditional = function() {
            document.getElementById('priorA').value = 0.01;
            document.getElementById('probBgivenA').value = 0.9;
            document.getElementById('probBgivenNotA').value = 0.05;
            document.getElementById('result').textContent = '--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—';
        };

        // Binomial probability
        function binomialProb(n, k, p) {
            return combination(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }

        document.getElementById('binomialType').addEventListener('change', function() {
            document.getElementById('k2Container').style.display = 
                this.value === 'between' ? 'block' : 'none';
        });

        window.calculateBinomial = function() {
            const n = parseInt(document.getElementById('trials').value) || 10;
            const p = parseFloat(document.getElementById('successProb').value) || 0.5;
            const k = parseInt(document.getElementById('successes').value) || 0;
            const type = document.getElementById('binomialType').value;
            
            let result, detail;
            
            switch (type) {
                case 'exact':
                    result = binomialProb(n, k, p);
                    detail = 'P(X=' + k + ') = C(' + n + ',' + k + ') Ã— ' + p + '^' + k + ' Ã— ' + (1 - p).toFixed(2) + '^' + (n - k);
                    break;
                case 'atLeast':
                    result = 0;
                    for (let i = k; i <= n; i++) {
                        result += binomialProb(n, i, p);
                    }
                    detail = 'P(Xâ‰¥' + k + ') = Î£ P(X=i), i=' + k + ' to ' + n;
                    break;
                case 'atMost':
                    result = 0;
                    for (let i = 0; i <= k; i++) {
                        result += binomialProb(n, i, p);
                    }
                    detail = 'P(Xâ‰¤' + k + ') = Î£ P(X=i), i=0 to ' + k;
                    break;
                case 'between':
                    const k2 = parseInt(document.getElementById('successes2').value) || k;
                    result = 0;
                    for (let i = k; i <= k2; i++) {
                        result += binomialProb(n, i, p);
                    }
                    detail = 'P(' + k + 'â‰¤Xâ‰¤' + k2 + ') = Î£ P(X=i), i=' + k + ' to ' + k2;
                    break;
            }
            
            document.getElementById('result').textContent = formatProbability(result);
            document.getElementById('resultDetail').textContent = detail;
        };

        window.clearBinomial = function() {
            document.getElementById('trials').value = 10;
            document.getElementById('successProb').value = 0.5;
            document.getElementById('successes').value = 5;
            document.getElementById('binomialType').value = 'exact';
            document.getElementById('k2Container').style.display = 'none';
            document.getElementById('result').textContent = '--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—';
        };

        function updateDiceGrid() {
            const faces = parseInt(document.getElementById('diceFaces').value) || 6;
            const grid = document.getElementById('diceGrid');
            
            while (grid.firstChild) {
                grid.removeChild(grid.firstChild);
            }
            selectedDice = [];
            
            for (let i = 1; i <= faces; i++) {
                const btn = document.createElement('button');
                btn.className = 'dice-btn secondary';
                btn.textContent = i;
                btn.onclick = function() { toggleDice(i, this); };
                grid.appendChild(btn);
            }
        }

        function toggleDice(value, btn) {
            const index = selectedDice.indexOf(value);
            if (index > -1) {
                selectedDice.splice(index, 1);
                btn.classList.remove('selected');
            } else {
                selectedDice.push(value);
                btn.classList.add('selected');
            }
        }

        document.getElementById('diceFaces').addEventListener('change', updateDiceGrid);
        document.getElementById('diceCount').addEventListener('change', updateDiceGrid);

        window.calculateDice = function() {
            const numDice = parseInt(document.getElementById('diceCount').value) || 1;
            const faces = parseInt(document.getElementById('diceFaces').value) || 6;
            const type = document.getElementById('diceType').value;
            
            if (selectedDice.length === 0) {
                alert('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªç›®æ ‡ç‚¹æ•°');
                return;
            }

            const totalOutcomes = Math.pow(faces, numDice);
            let favorableOutcomes = 0;
            
            if (type === 'any' && numDice === 1) {
                favorableOutcomes = selectedDice.length;
            } else if (type === 'exact' && numDice === 2) {
                const targetSum = selectedDice.reduce(function(a, b) { return a + b; }, 0);
                for (let i = 1; i <= faces; i++) {
                    for (let j = 1; j <= faces; j++) {
                        if (i + j === targetSum) favorableOutcomes++;
                    }
                }
            } else if (type === 'atLeast' && numDice === 2) {
                const minTarget = Math.min.apply(null, selectedDice);
                for (let i = 1; i <= faces; i++) {
                    for (let j = 1; j <= faces; j++) {
                        if (i + j >= minTarget) favorableOutcomes++;
                    }
                }
            } else if (type === 'atMost' && numDice === 2) {
                const maxTarget = Math.max.apply(null, selectedDice);
                for (let i = 1; i <= faces; i++) {
                    for (let j = 1; j <= faces; j++) {
                        if (i + j <= maxTarget) favorableOutcomes++;
                    }
                }
            } else if (type === 'any') {
                // Probability of getting at least one of the selected faces
                const probSingle = selectedDice.length / faces;
                const prob = 1 - Math.pow(1 - probSingle, numDice);
                document.getElementById('result').textContent = formatProbability(prob);
                document.getElementById('resultDetail').textContent = 'è‡³å°‘ä¸€æ¬¡æŠ•å‡ºé€‰ä¸­ç‚¹æ•°çš„æ¦‚ç‡';
                return;
            } else {
                // Generic calculation for single die
                favorableOutcomes = selectedDice.length;
            }
            
            const prob = favorableOutcomes / totalOutcomes;
            document.getElementById('result').textContent = formatProbability(prob);
            document.getElementById('resultDetail').textContent = favorableOutcomes + ' / ' + totalOutcomes + ' ç§æƒ…å†µ';
        };

        window.clearDice = function() {
            document.getElementById('diceCount').value = 2;
            document.getElementById('diceFaces').value = 6;
            document.getElementById('diceType').value = 'exact';
            updateDiceGrid();
            document.getElementById('result').textContent = '--';
            document.getElementById('resultDetail').textContent = 'è¾“å…¥æ•°å€¼å¹¶ç‚¹å‡»è®¡ç®—';
        };

        // Initialize
        updateDiceGrid();
    </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å›¾ç‰‡é¢œè‰²æå– - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="å›¾ç‰‡é¢œè‰²æå– - WebUtils" />
    <meta name="keywords" content="image-color-picker,media,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link
      rel="canonical"
      href="https://tools.realtime-ai.chat/tools/media/image-color-picker.html"
    />

    <!-- Open Graph -->
    <meta property="og:title" content="å›¾ç‰‡é¢œè‰²æå– - WebUtils" />
    <meta property="og:description" content="å›¾ç‰‡é¢œè‰²æå– - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/media/image-color-picker.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="å›¾ç‰‡é¢œè‰²æå– - WebUtils" />
    <meta name="twitter:description" content="å›¾ç‰‡é¢œè‰²æå– - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      body {
        font-size: 16px;
        line-height: 1.6;
        min-height: 100vh;
        padding: 1rem;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .tool-grid {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 2rem;
      }

      @media (max-width: 900px) {
        .tool-grid {
          grid-template-columns: 1fr;
        }
      }

      .drop-zone {
        border: 3px dashed var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 1rem;
      }

      .drop-zone:hover,
      .drop-zone.dragover {
        border-color: var(--pico-primary);
        background: var(--pico-primary-focus);
      }

      .drop-zone-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .current-color {
        background: var(--pico-card-background-color);
        border-radius: var(--pico-border-radius);
        padding: 1rem;
        margin: 1rem 0;
      }

      .color-display {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1rem;
      }

      .color-swatch {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        border: 2px solid var(--pico-muted-border-color);
        background: #fff;
      }

      .color-values {
        flex: 1;
      }

      .color-value-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.25rem 0;
        font-family: var(--font-mono);
      }

      .color-value-item button {
        padding: 0.25rem 0.5rem;
        font-size: 12px;
      }

      .color-history {
        margin-top: 1rem;
      }

      .color-history h4 {
        margin-bottom: 0.5rem;
      }

      .history-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .history-item {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s;
      }

      .history-item:hover {
        transform: scale(1.1);
        border-color: var(--pico-primary);
      }

      .canvas-container {
        position: relative;
        display: inline-block;
        cursor: crosshair;
      }

      #mainCanvas {
        max-width: 100%;
        border-radius: 8px;
      }

      .magnifier {
        position: absolute;
        width: 120px;
        height: 120px;
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        pointer-events: none;
        display: none;
        overflow: hidden;
        z-index: 100;
      }

      .magnifier-canvas {
        width: 100%;
        height: 100%;
      }

      .magnifier-center {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 10px;
        height: 10px;
        border: 2px solid white;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 0 1px black;
      }

      .preview-area {
        background: var(--pico-card-background-color);
        border-radius: var(--pico-border-radius);
        padding: 1rem;
        min-height: 400px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .placeholder {
        color: var(--pico-muted-color);
        text-align: center;
      }

      .placeholder-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }

      .palette-section {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--pico-muted-border-color);
      }

      .palette-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .palette-color {
        aspect-ratio: 1;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s;
        position: relative;
      }

      .palette-color:hover {
        transform: scale(1.1);
        border-color: var(--pico-primary);
      }

      .palette-color span {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 2px;
        text-align: center;
        border-radius: 0 0 6px 6px;
      }

      .btn-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .btn-group button {
        flex: 1;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      å›¾ç‰‡é¢œè‰²æå–
    </nav>
    <div class="container">
      <header>
        <h1>å›¾ç‰‡é¢œè‰²æå–</h1>
        <button id="themeToggle" class="outline">ğŸŒ™ æš—è‰²æ¨¡å¼</button>
      </header>

      <div class="tool-grid">
        <article>
          <h3>ä¸Šä¼ å›¾ç‰‡</h3>

          <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">ğŸ¨</div>
            <p>æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œæˆ–ç‚¹å‡»ä¸Šä¼ </p>
            <input type="file" id="fileInput" accept="image/*" hidden />
          </div>

          <div class="current-color">
            <h4>å½“å‰é¢œè‰²</h4>
            <div class="color-display">
              <div class="color-swatch" id="colorSwatch"></div>
              <div class="color-values">
                <div class="color-value-item">
                  <span>HEX</span>
                  <code id="hexValue">#FFFFFF</code>
                  <button onclick="copyColor('hex')" class="outline" aria-label="å¤åˆ¶">å¤åˆ¶</button>
                </div>
                <div class="color-value-item">
                  <span>RGB</span>
                  <code id="rgbValue">rgb(255, 255, 255)</code>
                  <button onclick="copyColor('rgb')" class="outline" aria-label="å¤åˆ¶">å¤åˆ¶</button>
                </div>
                <div class="color-value-item">
                  <span>HSL</span>
                  <code id="hslValue">hsl(0, 0%, 100%)</code>
                  <button onclick="copyColor('hsl')" class="outline" aria-label="å¤åˆ¶">å¤åˆ¶</button>
                </div>
              </div>
            </div>
          </div>

          <div class="palette-section">
            <h4>ä¸»è‰²è°ƒæå–</h4>
            <div class="palette-grid" id="paletteGrid">
              <!-- è‡ªåŠ¨æå–çš„ä¸»è‰²è°ƒ -->
            </div>
            <button
              id="extractPaletteBtn"
              class="secondary"
              style="width: 100%; margin-top: 0.5rem"
              disabled
            >
              ğŸ¨ æå–ä¸»è‰²è°ƒ
            </button>
          </div>

          <div class="color-history">
            <h4>å–è‰²å†å²</h4>
            <div class="history-list" id="historyList"></div>
            <button id="clearHistoryBtn" class="outline" style="width: 100%; margin-top: 0.5rem">
              ğŸ—‘ï¸ æ¸…ç©ºå†å²
            </button>
          </div>

          <div class="btn-group">
            <button id="exportPaletteBtn" class="primary" disabled>ğŸ“¥ å¯¼å‡ºè°ƒè‰²æ¿</button>
          </div>
        </article>

        <article>
          <h3>å–è‰²åŒºåŸŸ</h3>
          <div class="preview-area" id="previewArea">
            <div class="placeholder" id="placeholder">
              <div class="placeholder-icon">ğŸ–¼ï¸</div>
              <p>è¯·ä¸Šä¼ å›¾ç‰‡</p>
              <p><small>ç‚¹å‡»å›¾ç‰‡ä»»æ„ä½ç½®å–è‰²</small></p>
            </div>
            <div class="canvas-container" id="canvasContainer" style="display: none">
              <canvas id="mainCanvas"></canvas>
              <div class="magnifier" id="magnifier">
                <canvas class="magnifier-canvas" id="magnifierCanvas"></canvas>
                <div class="magnifier-center"></div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </div>

    <script>
      // ä¸»é¢˜åˆ‡æ¢
      const themeToggle = document.getElementById("themeToggle");
      const html = document.documentElement;

      window.toggleTheme = function () {
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        themeToggle.textContent = newTheme === "light" ? "ğŸŒ™ æš—è‰²æ¨¡å¼" : "â˜€ï¸ äº®è‰²æ¨¡å¼";
        localStorage.setItem("theme", newTheme);
      };

      themeToggle.addEventListener("click", toggleTheme);

      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        html.setAttribute("data-theme", savedTheme);
        themeToggle.textContent = savedTheme === "light" ? "ğŸŒ™ æš—è‰²æ¨¡å¼" : "â˜€ï¸ äº®è‰²æ¨¡å¼";
      }

      // çŠ¶æ€
      const canvas = document.getElementById("mainCanvas");
      const ctx = canvas.getContext("2d");
      const magnifier = document.getElementById("magnifier");
      const magnifierCanvas = document.getElementById("magnifierCanvas");
      const magnifierCtx = magnifierCanvas.getContext("2d");

      let imageLoaded = false;
      let colorHistory = JSON.parse(localStorage.getItem("colorHistory") || "[]");
      let currentColor = { r: 255, g: 255, b: 255 };
      let palette = [];

      // åˆå§‹åŒ–æ”¾å¤§é•œç”»å¸ƒ
      magnifierCanvas.width = 120;
      magnifierCanvas.height = 120;

      // æ¸²æŸ“å†å²
      renderHistory();

      // æ–‡ä»¶ä¸Šä¼ 
      const dropZone = document.getElementById("dropZone");
      const fileInput = document.getElementById("fileInput");

      dropZone.addEventListener("click", () => fileInput.click());

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        if (e.dataTransfer.files[0]) {
          loadImage(e.dataTransfer.files[0]);
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files[0]) {
          loadImage(e.target.files[0]);
        }
      });

      window.loadImage = function (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const maxWidth = 800;
            const scale = img.width > maxWidth ? maxWidth / img.width : 1;
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;

            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            document.getElementById("placeholder").style.display = "none";
            document.getElementById("canvasContainer").style.display = "inline-block";

            imageLoaded = true;
            document.getElementById("extractPaletteBtn").disabled = false;
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      };

      // ç”»å¸ƒäº‹ä»¶
      canvas.addEventListener("mousemove", (e) => {
        if (!imageLoaded) return;

        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = (e.clientX - rect.left) * scaleX;
        const y = (e.clientY - rect.top) * scaleY;

        // è·å–é¢œè‰²
        const pixel = ctx.getImageData(x, y, 1, 1).data;
        updateCurrentColor(pixel[0], pixel[1], pixel[2]);

        // æ˜¾ç¤ºæ”¾å¤§é•œ
        magnifier.style.display = "block";
        magnifier.style.left = e.clientX - rect.left - 60 + "px";
        magnifier.style.top = e.clientY - rect.top - 130 + "px";

        // ç»˜åˆ¶æ”¾å¤§é•œå†…å®¹
        const zoom = 8;
        const size = 15;
        magnifierCtx.imageSmoothingEnabled = false;
        magnifierCtx.drawImage(canvas, x - size / 2, y - size / 2, size, size, 0, 0, 120, 120);
      });

      canvas.addEventListener("mouseleave", () => {
        magnifier.style.display = "none";
      });

      canvas.addEventListener("click", (e) => {
        if (!imageLoaded) return;

        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = (e.clientX - rect.left) * scaleX;
        const y = (e.clientY - rect.top) * scaleY;

        const pixel = ctx.getImageData(x, y, 1, 1).data;
        addToHistory(pixel[0], pixel[1], pixel[2]);
      });

      function updateCurrentColor(r, g, b) {
        currentColor = { r, g, b };

        const hex = rgbToHex(r, g, b);
        const hsl = rgbToHsl(r, g, b);

        document.getElementById("colorSwatch").style.background = hex;
        document.getElementById("hexValue").textContent = hex;
        document.getElementById("rgbValue").textContent = `rgb(${r}, ${g}, ${b})`;
        document.getElementById("hslValue").textContent = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
      }

      function addToHistory(r, g, b) {
        const hex = rgbToHex(r, g, b);

        // é¿å…é‡å¤
        if (!colorHistory.includes(hex)) {
          colorHistory.unshift(hex);
          if (colorHistory.length > 20) {
            colorHistory.pop();
          }
          localStorage.setItem("colorHistory", JSON.stringify(colorHistory));
          renderHistory();
        }
      }

      function renderHistory() {
        const list = document.getElementById("historyList");
        list.textContent = "";

        colorHistory.forEach((hex) => {
          const item = document.createElement("div");
          item.className = "history-item";
          item.style.background = hex;
          item.title = hex;
          item.addEventListener("click", () => {
            const rgb = hexToRgb(hex);
            updateCurrentColor(rgb.r, rgb.g, rgb.b);
          });
          list.appendChild(item);
        });
      }

      // æ¸…ç©ºå†å²
      document.getElementById("clearHistoryBtn").addEventListener("click", () => {
        colorHistory = [];
        localStorage.setItem("colorHistory", "[]");
        renderHistory();
      });

      // å¤åˆ¶é¢œè‰²
      window.copyColor = function (type) {
        let text = "";
        const { r, g, b } = currentColor;

        switch (type) {
          case "hex":
            text = rgbToHex(r, g, b);
            break;
          case "rgb":
            text = `rgb(${r}, ${g}, ${b})`;
            break;
          case "hsl":
            const hsl = rgbToHsl(r, g, b);
            text = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
            break;
        }

        navigator.clipboard.writeText(text).then(() => {
          alert("å·²å¤åˆ¶: " + text);
        });
      };

      // é¢œè‰²è½¬æ¢å‡½æ•°
      function rgbToHex(r, g, b) {
        return "#" + [r, g, b].map((x) => x.toString(16).padStart(2, "0")).join("");
      }

      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? {
              r: parseInt(result[1], 16),
              g: parseInt(result[2], 16),
              b: parseInt(result[3], 16)
            }
          : null;
      }

      function rgbToHsl(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          l = (max + min) / 2;

        if (max === min) {
          h = s = 0;
        } else {
          const d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch (max) {
            case r:
              h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
              break;
            case g:
              h = ((b - r) / d + 2) / 6;
              break;
            case b:
              h = ((r - g) / d + 4) / 6;
              break;
          }
        }

        return {
          h: Math.round(h * 360),
          s: Math.round(s * 100),
          l: Math.round(l * 100)
        };
      }

      // æå–ä¸»è‰²è°ƒ
      document.getElementById("extractPaletteBtn").addEventListener("click", () => {
        if (!imageLoaded) return;

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        palette = extractPalette(imageData.data, 10);
        renderPalette();
        document.getElementById("exportPaletteBtn").disabled = false;
      });

      function extractPalette(data, colorCount) {
        // ç®€å•çš„é¢œè‰²é‡åŒ–ç®—æ³•
        const colors = {};
        const step = 4; // é‡‡æ ·æ­¥é•¿

        for (let i = 0; i < data.length; i += 4 * step) {
          const r = Math.round(data[i] / 32) * 32;
          const g = Math.round(data[i + 1] / 32) * 32;
          const b = Math.round(data[i + 2] / 32) * 32;
          const key = `${r},${g},${b}`;
          colors[key] = (colors[key] || 0) + 1;
        }

        // æ’åºå¹¶å–å‰ N ä¸ª
        const sorted = Object.entries(colors)
          .sort((a, b) => b[1] - a[1])
          .slice(0, colorCount)
          .map(([key]) => {
            const [r, g, b] = key.split(",").map(Number);
            return { r, g, b, hex: rgbToHex(r, g, b) };
          });

        return sorted;
      }

      function renderPalette() {
        const grid = document.getElementById("paletteGrid");
        grid.textContent = "";

        palette.forEach((color) => {
          const item = document.createElement("div");
          item.className = "palette-color";
          item.style.background = color.hex;
          item.title = color.hex;

          const label = document.createElement("span");
          label.textContent = color.hex;
          item.appendChild(label);

          item.addEventListener("click", () => {
            updateCurrentColor(color.r, color.g, color.b);
            addToHistory(color.r, color.g, color.b);
          });

          grid.appendChild(item);
        });
      }

      // å¯¼å‡ºè°ƒè‰²æ¿
      document.getElementById("exportPaletteBtn").addEventListener("click", () => {
        if (palette.length === 0) return;

        // ç”Ÿæˆè°ƒè‰²æ¿å›¾ç‰‡
        const paletteCanvas = document.createElement("canvas");
        const pctx = paletteCanvas.getContext("2d");
        const size = 100;
        paletteCanvas.width = size * Math.min(palette.length, 5);
        paletteCanvas.height = size * Math.ceil(palette.length / 5);

        palette.forEach((color, i) => {
          const x = (i % 5) * size;
          const y = Math.floor(i / 5) * size;
          pctx.fillStyle = color.hex;
          pctx.fillRect(x, y, size, size);

          // æ·»åŠ æ–‡å­—
          pctx.fillStyle = color.r + color.g + color.b > 384 ? "#000" : "#fff";
          pctx.font = "12px monospace";
          pctx.textAlign = "center";
          pctx.fillText(color.hex, x + size / 2, y + size / 2 + 4);
        });

        const link = document.createElement("a");
        link.download = `palette-${Date.now()}.png`;
        link.href = paletteCanvas.toDataURL("image/png");
        link.click();
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>农历阳历转换 - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #f59e0b; --accent2: #ef4444; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; font-weight: 500; }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; text-align: center; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s; background: var(--bg); }
        .tab.active { background: linear-gradient(135deg, var(--accent), var(--accent2)); border-color: transparent; color: white; }
        .tab:hover:not(.active) { border-color: var(--accent); }
        .form-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
        @media (max-width: 500px) { .form-row { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 0; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text2); }
        select, input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        select:focus, input:focus { outline: none; border-color: var(--accent); }
        .checkbox-group { display: flex; align-items: center; gap: 8px; padding: 12px 0; }
        .checkbox-group input { width: auto; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; transition: all 0.2s; }
        .btn:hover { opacity: 0.9; }
        .result-hero { background: linear-gradient(135deg, var(--accent), var(--accent2)); padding: 32px; border-radius: 12px; text-align: center; color: white; margin-bottom: 20px; }
        .result-hero .label { opacity: 0.9; font-size: 0.9rem; margin-bottom: 8px; }
        .result-hero .main { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .result-hero .sub { font-size: 1.1rem; opacity: 0.9; }
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (max-width: 500px) { .info-grid { grid-template-columns: 1fr; } }
        .info-item { background: var(--bg); border-radius: 8px; padding: 16px; }
        .info-item .label { font-size: 0.85rem; color: var(--text2); margin-bottom: 6px; }
        .info-item .value { font-size: 1.1rem; font-weight: 500; }
        .info-item .value.highlight { color: var(--accent); }
        .hidden { display: none; }
        .today-btn { padding: 10px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; color: var(--text); font-size: 0.9rem; margin-bottom: 16px; }
        .today-btn:hover { border-color: var(--accent); }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← 返回</a>
        <h1>农历阳历转换</h1>
        <p class="subtitle">公历农历相互转换，查看传统历法信息</p>
        
        <div class="card">
            <div class="tabs">
                <div class="tab active" data-mode="solar" onclick="switchMode('solar')">公历转农历</div>
                <div class="tab" data-mode="lunar" onclick="switchMode('lunar')">农历转公历</div>
            </div>
            
            <button class="today-btn" onclick="setToday()">今天</button>
            
            <div id="solarForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>公历年</label>
                        <select id="solarYear"></select>
                    </div>
                    <div class="form-group">
                        <label>公历月</label>
                        <select id="solarMonth"></select>
                    </div>
                    <div class="form-group">
                        <label>公历日</label>
                        <select id="solarDay"></select>
                    </div>
                </div>
            </div>
            
            <div id="lunarForm" class="hidden">
                <div class="form-row">
                    <div class="form-group">
                        <label>农历年</label>
                        <select id="lunarYear"></select>
                    </div>
                    <div class="form-group">
                        <label>农历月</label>
                        <select id="lunarMonth"></select>
                    </div>
                    <div class="form-group">
                        <label>农历日</label>
                        <select id="lunarDay"></select>
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="isLeapMonth">
                    <label for="isLeapMonth">闰月</label>
                </div>
            </div>
            
            <button class="btn" onclick="convert()">转换</button>
        </div>
        
        <div class="card hidden" id="resultCard">
            <div class="result-hero">
                <div class="label" id="resultLabel">农历日期</div>
                <div class="main" id="resultMain">-</div>
                <div class="sub" id="resultSub">-</div>
            </div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="label">天干地支</div>
                    <div class="value highlight" id="ganzhi">-</div>
                </div>
                <div class="info-item">
                    <div class="label">生肖</div>
                    <div class="value" id="zodiac">-</div>
                </div>
                <div class="info-item">
                    <div class="label">节气</div>
                    <div class="value" id="solarTerm">-</div>
                </div>
                <div class="info-item">
                    <div class="label">星期</div>
                    <div class="value" id="weekday">-</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 农历数据 1900-2100
        const lunarInfo = [
            0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
            0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0
        ];
        
        const tianGan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const diZhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const zodiacs = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
        const lunarMonths = ['正', '二', '三', '四', '五', '六', '七', '八', '九', '十', '冬', '腊'];
        const lunarDays = ['初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
                          '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
                          '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'];
        const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        const solarTerms = ['小寒', '大寒', '立春', '雨水', '惊蛰', '春分', '清明', '谷雨', '立夏', '小满', 
                           '芒种', '夏至', '小暑', '大暑', '立秋', '处暑', '白露', '秋分', '寒露', '霜降', 
                           '立冬', '小雪', '大雪', '冬至'];
        
        let mode = 'solar';
        
        // 获取农历年的总天数
        function getLunarYearDays(year) {
            let sum = 348;
            for (let i = 0x8000; i > 0x8; i >>= 1) {
                sum += (lunarInfo[year - 1900] & i) ? 1 : 0;
            }
            return sum + getLeapMonthDays(year);
        }
        
        // 获取闰月天数
        function getLeapMonthDays(year) {
            if (getLeapMonth(year)) {
                return (lunarInfo[year - 1900] & 0x10000) ? 30 : 29;
            }
            return 0;
        }
        
        // 获取闰月月份
        function getLeapMonth(year) {
            return lunarInfo[year - 1900] & 0xf;
        }
        
        // 获取农历月天数
        function getLunarMonthDays(year, month) {
            return (lunarInfo[year - 1900] & (0x10000 >> month)) ? 30 : 29;
        }
        
        // 公历转农历
        function solarToLunar(year, month, day) {
            const baseDate = new Date(1900, 0, 31);
            const objDate = new Date(year, month - 1, day);
            let offset = Math.floor((objDate - baseDate) / 86400000);
            
            let lunarYear = 1900;
            let lunarMonth = 1;
            let lunarDay = 1;
            let isLeap = false;
            
            // 计算年
            let yearDays;
            for (lunarYear = 1900; lunarYear < 2100 && offset > 0; lunarYear++) {
                yearDays = getLunarYearDays(lunarYear);
                offset -= yearDays;
            }
            if (offset < 0) {
                offset += yearDays;
                lunarYear--;
            }
            
            // 计算月
            const leapMonth = getLeapMonth(lunarYear);
            let monthDays;
            for (lunarMonth = 1; lunarMonth < 13 && offset > 0; lunarMonth++) {
                if (leapMonth > 0 && lunarMonth === leapMonth + 1 && !isLeap) {
                    lunarMonth--;
                    isLeap = true;
                    monthDays = getLeapMonthDays(lunarYear);
                } else {
                    monthDays = getLunarMonthDays(lunarYear, lunarMonth);
                }
                
                if (isLeap && lunarMonth === leapMonth + 1) {
                    isLeap = false;
                }
                offset -= monthDays;
            }
            
            if (offset < 0) {
                offset += monthDays;
                lunarMonth--;
            }
            
            if (offset === 0 && leapMonth > 0 && lunarMonth === leapMonth + 1) {
                if (isLeap) {
                    isLeap = false;
                } else {
                    isLeap = true;
                    lunarMonth--;
                }
            }
            
            lunarDay = offset + 1;
            
            return { year: lunarYear, month: lunarMonth, day: lunarDay, isLeap };
        }
        
        // 农历转公历
        function lunarToSolar(year, month, day, isLeap) {
            const leapMonth = getLeapMonth(year);
            
            let offset = 0;
            for (let i = 1900; i < year; i++) {
                offset += getLunarYearDays(i);
            }
            
            for (let i = 1; i < month; i++) {
                offset += getLunarMonthDays(year, i);
                if (i === leapMonth) {
                    offset += getLeapMonthDays(year);
                }
            }
            
            if (isLeap && month === leapMonth) {
                offset += getLunarMonthDays(year, month);
            }
            
            offset += day - 1;
            
            const baseDate = new Date(1900, 0, 31);
            const result = new Date(baseDate.getTime() + offset * 86400000);
            
            return {
                year: result.getFullYear(),
                month: result.getMonth() + 1,
                day: result.getDate()
            };
        }
        
        // 获取干支年
        function getGanZhiYear(year) {
            const gan = tianGan[(year - 4) % 10];
            const zhi = diZhi[(year - 4) % 12];
            return gan + zhi + '年';
        }
        
        // 获取生肖
        function getZodiac(year) {
            return zodiacs[(year - 4) % 12];
        }
        
        // 初始化下拉框
        function initSelects() {
            const solarYear = document.getElementById('solarYear');
            const solarMonth = document.getElementById('solarMonth');
            const solarDay = document.getElementById('solarDay');
            const lunarYear = document.getElementById('lunarYear');
            const lunarMonth = document.getElementById('lunarMonth');
            const lunarDay = document.getElementById('lunarDay');
            
            // 年份
            for (let y = 1900; y <= 2099; y++) {
                const opt1 = document.createElement('option');
                opt1.value = y;
                opt1.textContent = y + '年';
                solarYear.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = y;
                opt2.textContent = y + '年';
                lunarYear.appendChild(opt2);
            }
            
            // 月份
            for (let m = 1; m <= 12; m++) {
                const opt1 = document.createElement('option');
                opt1.value = m;
                opt1.textContent = m + '月';
                solarMonth.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = m;
                opt2.textContent = lunarMonths[m - 1] + '月';
                lunarMonth.appendChild(opt2);
            }
            
            // 日期
            for (let d = 1; d <= 31; d++) {
                const opt1 = document.createElement('option');
                opt1.value = d;
                opt1.textContent = d + '日';
                solarDay.appendChild(opt1);
            }
            
            for (let d = 1; d <= 30; d++) {
                const opt2 = document.createElement('option');
                opt2.value = d;
                opt2.textContent = lunarDays[d - 1];
                lunarDay.appendChild(opt2);
            }
            
            // 设置今天
            setToday();
        }
        
        function setToday() {
            const today = new Date();
            document.getElementById('solarYear').value = today.getFullYear();
            document.getElementById('solarMonth').value = today.getMonth() + 1;
            document.getElementById('solarDay').value = today.getDate();
            
            const lunar = solarToLunar(today.getFullYear(), today.getMonth() + 1, today.getDate());
            document.getElementById('lunarYear').value = lunar.year;
            document.getElementById('lunarMonth').value = lunar.month;
            document.getElementById('lunarDay').value = lunar.day;
            document.getElementById('isLeapMonth').checked = lunar.isLeap;
        }
        
        function switchMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            document.getElementById('solarForm').classList.toggle('hidden', mode !== 'solar');
            document.getElementById('lunarForm').classList.toggle('hidden', mode !== 'lunar');
        }
        
        function convert() {
            const resultCard = document.getElementById('resultCard');
            resultCard.classList.remove('hidden');
            
            let solarDate, lunarDate;
            
            if (mode === 'solar') {
                const year = parseInt(document.getElementById('solarYear').value);
                const month = parseInt(document.getElementById('solarMonth').value);
                const day = parseInt(document.getElementById('solarDay').value);
                
                solarDate = { year, month, day };
                lunarDate = solarToLunar(year, month, day);
                
                document.getElementById('resultLabel').textContent = '农历日期';
                document.getElementById('resultMain').textContent = 
                    (lunarDate.isLeap ? '闰' : '') + lunarMonths[lunarDate.month - 1] + '月' + lunarDays[lunarDate.day - 1];
                document.getElementById('resultSub').textContent = 
                    lunarDate.year + '年 ' + getGanZhiYear(lunarDate.year);
            } else {
                const year = parseInt(document.getElementById('lunarYear').value);
                const month = parseInt(document.getElementById('lunarMonth').value);
                const day = parseInt(document.getElementById('lunarDay').value);
                const isLeap = document.getElementById('isLeapMonth').checked;
                
                lunarDate = { year, month, day, isLeap };
                solarDate = lunarToSolar(year, month, day, isLeap);
                
                document.getElementById('resultLabel').textContent = '公历日期';
                document.getElementById('resultMain').textContent = 
                    solarDate.year + '年' + solarDate.month + '月' + solarDate.day + '日';
                document.getElementById('resultSub').textContent = 
                    '农历 ' + (lunarDate.isLeap ? '闰' : '') + lunarMonths[lunarDate.month - 1] + '月' + lunarDays[lunarDate.day - 1];
            }
            
            // 干支
            document.getElementById('ganzhi').textContent = getGanZhiYear(lunarDate.year);
            
            // 生肖
            document.getElementById('zodiac').textContent = getZodiac(lunarDate.year);
            
            // 星期
            const dateObj = new Date(solarDate.year, solarDate.month - 1, solarDate.day);
            document.getElementById('weekday').textContent = weekdays[dateObj.getDay()];
            
            // 节气（简化处理）
            document.getElementById('solarTerm').textContent = '-';
        }
        
        initSelects();
    </script>
</body>
</html>

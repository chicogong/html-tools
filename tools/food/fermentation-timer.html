<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发酵计时器 - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #84cc16; --accent2: #a3e635; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .preset-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .preset-btn { padding: 16px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg); color: var(--text); cursor: pointer; text-align: left; transition: all 0.2s; }
        .preset-btn:hover { border-color: var(--accent); }
        .preset-btn.active { border-color: var(--accent); background: rgba(132, 204, 22, 0.1); }
        .preset-btn .name { font-weight: 600; margin-bottom: 4px; }
        .preset-btn .time { font-size: 0.85rem; color: var(--text2); }
        .timer-display { text-align: center; padding: 40px 20px; }
        .timer-value { font-size: 4rem; font-weight: 700; font-family: 'Courier New', monospace; }
        .timer-label { color: var(--text2); margin-top: 8px; }
        .progress-ring { width: 200px; height: 200px; margin: 0 auto 20px; }
        .progress-ring circle { fill: none; stroke-width: 8; }
        .progress-ring .bg { stroke: var(--border); }
        .progress-ring .progress { stroke: var(--accent); stroke-linecap: round; transform: rotate(-90deg); transform-origin: 50% 50%; transition: stroke-dashoffset 0.3s; }
        .timer-controls { display: flex; gap: 12px; justify-content: center; margin-top: 20px; }
        .timer-btn { padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 500; }
        .timer-btn.primary { background: var(--accent); color: #000; }
        .timer-btn.secondary { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
        .timer-btn:hover { opacity: 0.9; }
        .custom-time { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
        .custom-time .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: var(--text2); text-align: center; }
        .custom-time input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1.2rem; text-align: center; }
        .custom-time input:focus { outline: none; border-color: var(--accent); }
        .temp-adjust { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .temp-adjust label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text2); }
        .temp-slider { display: flex; align-items: center; gap: 12px; }
        .temp-slider input[type="range"] { flex: 1; height: 8px; -webkit-appearance: none; background: var(--border); border-radius: 4px; }
        .temp-slider input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--accent); border-radius: 50%; cursor: pointer; }
        .temp-value { min-width: 60px; text-align: center; font-weight: 600; }
        .tips-box { padding: 16px; background: var(--bg); border-radius: 8px; font-size: 0.85rem; color: var(--text2); line-height: 1.8; }
        .history-list { margin-top: 16px; }
        .history-item { display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
        .history-item .info { flex: 1; }
        .history-item .name { font-weight: 500; }
        .history-item .time { font-size: 0.85rem; color: var(--text2); }
        .history-item .status { font-size: 0.85rem; color: var(--accent); }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← 返回</a>
        <h1>发酵计时器</h1>
        <p class="subtitle">精确控制发酵时间</p>
        
        <div class="card">
            <h3 style="margin-bottom: 16px;">选择发酵类型</h3>
            <div class="preset-grid">
                <button class="preset-btn" data-type="bread" onclick="selectPreset('bread')">
                    <div class="name">面包一发</div>
                    <div class="time">60-90分钟</div>
                </button>
                <button class="preset-btn" data-type="bread2" onclick="selectPreset('bread2')">
                    <div class="name">面包二发</div>
                    <div class="time">30-45分钟</div>
                </button>
                <button class="preset-btn" data-type="yogurt" onclick="selectPreset('yogurt')">
                    <div class="name">酸奶</div>
                    <div class="time">8-12小时</div>
                </button>
                <button class="preset-btn" data-type="sourdough" onclick="selectPreset('sourdough')">
                    <div class="name">酵母</div>
                    <div class="time">4-8小时</div>
                </button>
                <button class="preset-btn" data-type="kimchi" onclick="selectPreset('kimchi')">
                    <div class="name">泡菜</div>
                    <div class="time">1-3天</div>
                </button>
                <button class="preset-btn" data-type="kombucha" onclick="selectPreset('kombucha')">
                    <div class="name">康普茶</div>
                    <div class="time">7-14天</div>
                </button>
            </div>
            
            <div class="custom-time">
                <div class="form-group">
                    <label>天</label>
                    <input type="number" id="days" value="0" min="0" max="30" onchange="updateCustomTime()">
                </div>
                <div class="form-group">
                    <label>小时</label>
                    <input type="number" id="hours" value="1" min="0" max="23" onchange="updateCustomTime()">
                </div>
                <div class="form-group">
                    <label>分钟</label>
                    <input type="number" id="minutes" value="0" min="0" max="59" onchange="updateCustomTime()">
                </div>
            </div>
            
            <div class="temp-adjust">
                <label>环境温度调整 (影响发酵速度)</label>
                <div class="temp-slider">
                    <span>冷</span>
                    <input type="range" id="tempSlider" min="15" max="35" value="25" oninput="updateTemp()">
                    <span>热</span>
                    <span class="temp-value" id="tempValue">25°C</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="timer-display">
                <svg class="progress-ring" viewBox="0 0 200 200">
                    <circle class="bg" cx="100" cy="100" r="90"></circle>
                    <circle class="progress" cx="100" cy="100" r="90" stroke-dasharray="565.48" stroke-dashoffset="0" id="progressCircle"></circle>
                </svg>
                <div class="timer-value" id="timerDisplay">01:00:00</div>
                <div class="timer-label" id="timerLabel">面包一发</div>
            </div>
            
            <div class="timer-controls">
                <button class="timer-btn primary" id="startBtn" onclick="toggleTimer()">开始</button>
                <button class="timer-btn secondary" onclick="resetTimer()">重置</button>
            </div>
        </div>
        
        <div class="card">
            <h3 style="margin-bottom: 12px;">发酵技巧</h3>
            <div class="tips-box" id="tips">
                选择一个发酵类型查看相关技巧
            </div>
        </div>
        
        <div class="card">
            <h3 style="margin-bottom: 12px;">最近记录</h3>
            <div class="history-list" id="historyList">
                <div style="color: var(--text2); text-align: center; padding: 20px;">暂无记录</div>
            </div>
        </div>
    </div>
    
    <script>
        const presets = {
            bread: { name: '面包一发', hours: 1, minutes: 30, tips: '温度影响发酵速度很大。25°C约60-90分钟，30°C约45-60分钟。面团涨到2倍大即可。用手指戳洞，不回弹说明发酵完成。' },
            bread2: { name: '面包二发', hours: 0, minutes: 40, tips: '二发时间通常是一发的一半。整形后放入烤盘，盖上保鲜膜。涨到1.5-2倍大即可进烤箱。' },
            yogurt: { name: '酸奶', hours: 10, minutes: 0, tips: '最佳发酵温度42-45°C。时间越长酸度越高。8小时口感温和，12小时更酸浓。发酵后冷藏可增加浓稠度。' },
            sourdough: { name: '酵种', hours: 6, minutes: 0, tips: '室温发酵4-8小时，体积涨到2-3倍。气泡丰富、香气浓郁时使用最佳。可冷藏保存，使用前回温激活。' },
            kimchi: { name: '泡菜', hours: 48, minutes: 0, tips: '室温发酵1-2天启动乳酸菌，然后转冷藏慢发酵。夏天发酵快，冬天慢。3-5天即可食用，一周后风味最佳。' },
            kombucha: { name: '康普茶', hours: 168, minutes: 0, tips: '一发7-14天，取决于温度和口味偏好。PH降到3.5以下即可。二发加果汁2-3天增加气泡。注意保持无菌操作。' }
        };
        
        let totalSeconds = 5400;
        let remainingSeconds = 5400;
        let timerInterval = null;
        let isRunning = false;
        let currentPreset = 'bread';
        let history = JSON.parse(localStorage.getItem('fermentHistory') || '[]');
        
        function selectPreset(type) {
            currentPreset = type;
            const preset = presets[type];
            
            document.querySelectorAll('.preset-btn').forEach(function(btn) {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            
            document.getElementById('days').value = Math.floor(preset.hours / 24);
            document.getElementById('hours').value = preset.hours % 24;
            document.getElementById('minutes').value = preset.minutes;
            document.getElementById('timerLabel').textContent = preset.name;
            document.getElementById('tips').textContent = preset.tips;
            
            updateCustomTime();
        }
        
        function updateCustomTime() {
            const days = parseInt(document.getElementById('days').value) || 0;
            const hours = parseInt(document.getElementById('hours').value) || 0;
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            
            totalSeconds = (days * 24 * 3600) + (hours * 3600) + (minutes * 60);
            remainingSeconds = totalSeconds;
            updateDisplay();
        }
        
        function updateTemp() {
            const temp = document.getElementById('tempSlider').value;
            document.getElementById('tempValue').textContent = temp + '°C';
            
            const baseFactor = 1;
            const factor = 1 + (temp - 25) * 0.05;
            const adjusted = Math.round(totalSeconds / factor);
            remainingSeconds = adjusted;
            updateDisplay();
        }
        
        function formatTime(seconds) {
            const d = Math.floor(seconds / 86400);
            const h = Math.floor((seconds % 86400) / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            
            if (d > 0) {
                return d + '天 ' + String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
            }
            return String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
        }
        
        function updateDisplay() {
            document.getElementById('timerDisplay').textContent = formatTime(remainingSeconds);
            
            const progress = totalSeconds > 0 ? (remainingSeconds / totalSeconds) : 1;
            const circumference = 2 * Math.PI * 90;
            const offset = circumference * (1 - progress);
            document.getElementById('progressCircle').style.strokeDashoffset = offset;
        }
        
        function toggleTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                document.getElementById('startBtn').textContent = '继续';
            } else {
                isRunning = true;
                document.getElementById('startBtn').textContent = '暂停';
                timerInterval = setInterval(function() {
                    if (remainingSeconds > 0) {
                        remainingSeconds--;
                        updateDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isRunning = false;
                        document.getElementById('startBtn').textContent = '开始';
                        notifyComplete();
                    }
                }, 1000);
            }
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            remainingSeconds = totalSeconds;
            document.getElementById('startBtn').textContent = '开始';
            updateDisplay();
        }
        
        function notifyComplete() {
            const preset = presets[currentPreset] || { name: '自定义' };
            
            history.unshift({
                name: preset.name,
                time: formatTime(totalSeconds),
                date: new Date().toLocaleString('zh-CN')
            });
            
            if (history.length > 10) history.pop();
            localStorage.setItem('fermentHistory', JSON.stringify(history));
            renderHistory();
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('发酵完成！', { body: preset.name + ' 发酵计时结束' });
            }
            alert('发酵完成！');
        }
        
        function renderHistory() {
            const list = document.getElementById('historyList');
            while (list.firstChild) list.removeChild(list.firstChild);
            
            if (history.length === 0) {
                const empty = document.createElement('div');
                empty.style.cssText = 'color: var(--text2); text-align: center; padding: 20px;';
                empty.textContent = '暂无记录';
                list.appendChild(empty);
                return;
            }
            
            history.forEach(function(item) {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const info = document.createElement('div');
                info.className = 'info';
                const name = document.createElement('div');
                name.className = 'name';
                name.textContent = item.name;
                const time = document.createElement('div');
                time.className = 'time';
                time.textContent = item.time;
                info.appendChild(name);
                info.appendChild(time);
                
                const status = document.createElement('div');
                status.className = 'status';
                status.textContent = item.date;
                
                div.appendChild(info);
                div.appendChild(status);
                list.appendChild(div);
            });
        }
        
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        selectPreset('bread');
        renderHistory();
    </script>
</body>
</html>

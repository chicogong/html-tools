<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SQLæŸ¥è¯¢æ„å»ºå™¨ - WebUtils</title>
    <meta name="description" content="å¯è§†åŒ–æ„å»ºSQLæŸ¥è¯¢è¯­å¥ï¼Œæ”¯æŒSELECTã€INSERTã€UPDATEã€DELETEæ“ä½œ" />
    <meta name="keywords" content="SQL query builder æŸ¥è¯¢æ„å»ºå™¨ SELECT INSERT UPDATE DELETE" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/data/sql-query-builder.html" />
    <meta property="og:title" content="SQLæŸ¥è¯¢æ„å»ºå™¨ - WebUtils" />
    <meta property="og:description" content="å¯è§†åŒ–æ„å»ºSQLæŸ¥è¯¢è¯­å¥" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/data/sql-query-builder.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="SQLæŸ¥è¯¢æ„å»ºå™¨ - WebUtils" />
    <meta name="twitter:description" content="å¯è§†åŒ–æ„å»ºSQLæŸ¥è¯¢è¯­å¥" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"é¦–é¡µ","item":"https://tools.realtime-ai.chat/"},{"@type":"ListItem","position":2,"name":"æ•°æ®å·¥å…·","item":"https://tools.realtime-ai.chat/#data"},{"@type":"ListItem","position":3,"name":"SQLæŸ¥è¯¢æ„å»ºå™¨","item":"https://tools.realtime-ai.chat/tools/data/sql-query-builder.html"}]}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0 245 212 / 15%);
        --glow-green: rgb(16 185 129 / 15%);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --font-sans: "Space Grotesk", -apple-system, blinkmacsystemfont, "Segoe UI", roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Courier New", monospace;
      }

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--border-subtle);
        background: var(--color-bg-card);
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 100;
        transition: all 0.2s;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-bg-deep);
        color: var(--color-text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      .bg-grid {
        position: fixed;
        inset: 0;
        background-image: linear-gradient(rgb(0 245 212 / 2%) 1px, transparent 1px),
          linear-gradient(90deg, rgb(0 245 212 / 2%) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        padding: 8px 14px;
        background: var(--color-bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        flex-wrap: wrap;
      }

      .breadcrumb a {
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .breadcrumb a:hover {
        color: var(--color-accent-cyan);
      }

      .breadcrumb-separator {
        color: var(--color-text-muted);
        user-select: none;
      }

      .breadcrumb-current {
        color: var(--color-text-primary);
        font-weight: 500;
      }

      .title-section {
        flex: 1;
      }

      .title-section h1 {
        font-family: var(--font-mono);
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .title-section h1 .icon {
        font-size: 1.8rem;
      }

      .title-section p {
        color: var(--color-text-secondary);
        margin-top: 4px;
        font-size: 0.9rem;
      }

      .main-content {
        background: var(--color-bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 24px;
        flex: 1;
      }

      .tool-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      @media (max-width: 900px) {
        .tool-layout {
          grid-template-columns: 1fr;
        }
      }

      .tool-section {
        margin-bottom: 24px;
      }

      .section-title {
        font-family: var(--font-mono);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--color-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-subtle);
      }

      .input-group {
        margin-bottom: 16px;
      }

      .input-label {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-secondary);
        margin-bottom: 8px;
      }

      .input-hint {
        font-size: 0.75rem;
        color: var(--color-text-muted);
        margin-top: 4px;
      }

      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 10px 14px;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        color: var(--color-text-primary);
        transition: border-color 0.2s;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--color-accent-cyan);
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .input-row-3 {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 12px;
        align-items: end;
      }

      @media (max-width: 500px) {
        .input-row,
        .input-row-3 {
          grid-template-columns: 1fr;
        }
      }

      .btn-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .btn {
        flex: 1;
        min-width: 100px;
        padding: 12px 20px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--color-accent-cyan);
        color: var(--color-bg-deep);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px var(--glow-cyan);
      }

      .btn-secondary {
        background: var(--color-bg-surface);
        color: var(--color-text-primary);
        border: 1px solid var(--border-subtle);
      }

      .btn-secondary:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .btn-small {
        padding: 8px 12px;
        font-size: 0.8rem;
        flex: 0;
        min-width: auto;
      }

      .operation-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }

      .op-tab {
        padding: 10px 20px;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        background: var(--bg-input);
        color: var(--color-text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .op-tab:hover {
        border-color: var(--color-accent-cyan);
        color: var(--color-accent-cyan);
      }

      .op-tab.active {
        background: var(--color-accent-cyan);
        color: var(--color-bg-deep);
        border-color: var(--color-accent-cyan);
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
      }

      .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--color-accent-cyan);
        cursor: pointer;
      }

      .checkbox-group label {
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-secondary);
        cursor: pointer;
        user-select: none;
      }

      .condition-list {
        margin-bottom: 16px;
      }

      .condition-item {
        display: grid;
        grid-template-columns: 1fr auto 1fr auto;
        gap: 8px;
        margin-bottom: 8px;
        align-items: center;
      }

      .condition-item input,
      .condition-item select {
        min-width: 0;
      }

      .column-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 16px;
        min-height: 32px;
      }

      .column-chip {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: 20px;
        font-family: var(--font-mono);
        font-size: 0.8rem;
      }

      .column-chip .remove {
        cursor: pointer;
        color: var(--color-text-muted);
        font-size: 1rem;
        line-height: 1;
      }

      .column-chip .remove:hover {
        color: var(--accent-red);
      }

      .sql-output {
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 16px;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        color: var(--color-accent-cyan);
        min-height: 180px;
        white-space: pre-wrap;
        overflow-wrap: break-word;
        line-height: 1.8;
      }

      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--accent-green);
        color: var(--color-bg-deep);
        padding: 12px 24px;
        border-radius: var(--radius-md);
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }

      .toast.error {
        background: var(--accent-red);
        color: white;
      }

      .empty-state {
        color: var(--color-text-muted);
        font-size: 0.85rem;
        font-style: italic;
      }

      @media (max-width: 600px) {
        .container {
          padding: 16px;
        }

        .btn-row {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .condition-item {
          grid-template-columns: 1fr;
          gap: 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-grid"></div>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
    <div class="container">
      <header class="header">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../../index.html">é¦–é¡µ</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">SQLæŸ¥è¯¢æ„å»ºå™¨</span>
        </nav>
        <div class="title-section">
          <h1><span class="icon">ğŸ”§</span>SQLæŸ¥è¯¢æ„å»ºå™¨</h1>
          <p>å¯è§†åŒ–æ„å»ºSQLæŸ¥è¯¢è¯­å¥ï¼Œæ”¯æŒSELECTã€INSERTã€UPDATEã€DELETE</p>
        </div>
      </header>
      <main class="main-content">
        <div class="tool-layout">
          <div class="input-panel">
            <!-- æ“ä½œç±»å‹é€‰æ‹© -->
            <div class="tool-section">
              <div class="section-title">æ“ä½œç±»å‹</div>
              <div class="operation-tabs">
                <button class="op-tab active" data-op="select" onclick="selectOperation('select')">SELECT</button>
                <button class="op-tab" data-op="insert" onclick="selectOperation('insert')">INSERT</button>
                <button class="op-tab" data-op="update" onclick="selectOperation('update')">UPDATE</button>
                <button class="op-tab" data-op="delete" onclick="selectOperation('delete')">DELETE</button>
              </div>
            </div>

            <!-- è¡¨è®¾ç½® -->
            <div class="tool-section">
              <div class="section-title">è¡¨è®¾ç½®</div>
              <div class="input-group">
                <label class="input-label">è¡¨å</label>
                <input type="text" id="tableName" placeholder="users" value="users" oninput="generateSQL()" />
              </div>
            </div>

            <!-- DISTINCTé€‰é¡¹ (SELECT) -->
            <div class="tool-section" id="distinctSection">
              <div class="checkbox-group">
                <input type="checkbox" id="distinctCheck" onchange="generateSQL()" />
                <label for="distinctCheck">ä½¿ç”¨ DISTINCT (å»é‡)</label>
              </div>
            </div>

            <!-- åˆ—é€‰æ‹© (SELECT/INSERT) -->
            <div class="tool-section" id="columnsSection">
              <div class="section-title">åˆ— (Columns)</div>
              <div class="input-row-3">
                <div class="input-group" style="margin-bottom: 0">
                  <label class="input-label">åˆ—å</label>
                  <input type="text" id="columnInput" placeholder="column_name" />
                </div>
                <div class="input-group" id="aliasGroup" style="margin-bottom: 0">
                  <label class="input-label">åˆ«å (å¯é€‰)</label>
                  <input type="text" id="aliasInput" placeholder="alias" />
                </div>
                <button class="btn btn-secondary btn-small" onclick="addColumn()">+ æ·»åŠ </button>
              </div>
              <div class="column-list" id="columnList">
                <span class="empty-state">ç•™ç©ºè¡¨ç¤º SELECT *</span>
              </div>
            </div>

            <!-- å€¼è®¾ç½® (INSERT/UPDATE) -->
            <div class="tool-section" id="valuesSection" style="display: none">
              <div class="section-title">å­—æ®µå€¼ (SET)</div>
              <div id="valuesList"></div>
              <button class="btn btn-secondary btn-small" onclick="addValue()" style="margin-top: 8px">+ æ·»åŠ å­—æ®µ</button>
            </div>

            <!-- WHEREæ¡ä»¶ -->
            <div class="tool-section" id="conditionsSection">
              <div class="section-title">WHERE æ¡ä»¶</div>
              <div class="condition-list" id="conditionList">
                <span class="empty-state">æ— æ¡ä»¶ (å¯é€‰)</span>
              </div>
              <button class="btn btn-secondary btn-small" onclick="addCondition()">+ æ·»åŠ æ¡ä»¶</button>
            </div>

            <!-- ORDER BY (SELECT) -->
            <div class="tool-section" id="orderSection">
              <div class="section-title">æ’åº (ORDER BY)</div>
              <div class="input-row">
                <div class="input-group">
                  <label class="input-label">æ’åºåˆ—</label>
                  <input type="text" id="orderBy" placeholder="column_name" oninput="generateSQL()" />
                </div>
                <div class="input-group">
                  <label class="input-label">é¡ºåº</label>
                  <select id="orderDir" onchange="generateSQL()">
                    <option value="">-- é€‰æ‹© --</option>
                    <option value="ASC">ASC å‡åº</option>
                    <option value="DESC">DESC é™åº</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- LIMIT (SELECT) -->
            <div class="tool-section" id="limitSection">
              <div class="section-title">é™åˆ¶ (LIMIT)</div>
              <div class="input-row">
                <div class="input-group">
                  <label class="input-label">LIMIT</label>
                  <input type="number" id="limitVal" placeholder="10" min="0" oninput="generateSQL()" />
                </div>
                <div class="input-group">
                  <label class="input-label">OFFSET</label>
                  <input type="number" id="offsetVal" placeholder="0" min="0" oninput="generateSQL()" />
                </div>
              </div>
            </div>
          </div>

          <!-- è¾“å‡ºé¢æ¿ -->
          <div class="output-panel">
            <div class="tool-section">
              <div class="section-title">ç”Ÿæˆçš„ SQL</div>
              <div class="sql-output" id="sqlOutput"></div>
              <div class="btn-row" style="margin-top: 16px">
                <button class="btn btn-primary" onclick="copySQL()">ğŸ“‹ å¤åˆ¶ SQL</button>
                <button class="btn btn-secondary" onclick="shareQuery()">ğŸ”— åˆ†äº«</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ”„ é‡ç½®</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <div class="toast" id="toast">æ“ä½œæˆåŠŸ</div>
    <script>
      // çŠ¶æ€ç®¡ç†
      var currentOp = "select";
      var columns = [];
      var conditions = [];
      var values = [];
      var LS_KEY = "sql-query-builder-data";

      // ä¸»é¢˜åˆ‡æ¢
      function toggleTheme() {
        var body = document.body;
        var isDark = body.getAttribute("data-theme") !== "light";
        body.setAttribute("data-theme", isDark ? "light" : "dark");
        localStorage.setItem("theme", isDark ? "light" : "dark");
      }

      // åŠ è½½ä¸»é¢˜
      (function () {
        var saved = localStorage.getItem("theme");
        if (saved === "light") {
          document.body.setAttribute("data-theme", "light");
        }
      })();

      // æ“ä½œç±»å‹åˆ‡æ¢
      function selectOperation(op) {
        currentOp = op;
        var tabs = document.querySelectorAll(".op-tab");
        tabs.forEach(function (tab) {
          tab.classList.toggle("active", tab.getAttribute("data-op") === op);
        });

        // æ§åˆ¶å„åŒºå—æ˜¾ç¤º
        document.getElementById("distinctSection").style.display = op === "select" ? "block" : "none";
        document.getElementById("columnsSection").style.display = op === "select" || op === "insert" ? "block" : "none";
        document.getElementById("aliasGroup").style.display = op === "select" ? "block" : "none";
        document.getElementById("valuesSection").style.display = op === "insert" || op === "update" ? "block" : "none";
        document.getElementById("conditionsSection").style.display = op !== "insert" ? "block" : "none";
        document.getElementById("orderSection").style.display = op === "select" ? "block" : "none";
        document.getElementById("limitSection").style.display = op === "select" ? "block" : "none";

        generateSQL();
        saveToStorage();
      }

      // æ·»åŠ åˆ—
      function addColumn() {
        var input = document.getElementById("columnInput");
        var aliasInput = document.getElementById("aliasInput");
        var col = input.value.trim();
        var aliasGroupVisible = document.getElementById("aliasGroup").style.display !== "none";
        var alias = aliasGroupVisible ? aliasInput.value.trim() : "";

        if (!col) {
          showToast("è¯·è¾“å…¥åˆ—å", "error");
          return;
        }

        columns.push({ name: col, alias: alias });
        input.value = "";
        if (aliasInput) aliasInput.value = "";
        input.focus();

        renderColumns();
        generateSQL();
        saveToStorage();
      }

      // ç§»é™¤åˆ—
      function removeColumn(index) {
        columns.splice(index, 1);
        renderColumns();
        generateSQL();
        saveToStorage();
      }

      // æ¸²æŸ“åˆ—åˆ—è¡¨
      function renderColumns() {
        var list = document.getElementById("columnList");
        list.textContent = "";

        if (columns.length === 0) {
          var empty = document.createElement("span");
          empty.className = "empty-state";
          empty.textContent = currentOp === "select" ? "ç•™ç©ºè¡¨ç¤º SELECT *" : "è¯·æ·»åŠ åˆ—";
          list.appendChild(empty);
          return;
        }

        columns.forEach(function (col, i) {
          var chip = document.createElement("div");
          chip.className = "column-chip";

          var span = document.createElement("span");
          var displayText = typeof col === "string" ? col : col.name;
          if (col.alias && currentOp === "select") {
            displayText += " AS " + col.alias;
          }
          span.textContent = displayText;

          var remove = document.createElement("span");
          remove.className = "remove";
          remove.textContent = "Ã—";
          remove.onclick = function () {
            removeColumn(i);
          };

          chip.appendChild(span);
          chip.appendChild(remove);
          list.appendChild(chip);
        });
      }

      // æ·»åŠ WHEREæ¡ä»¶
      function addCondition() {
        conditions.push({ column: "", operator: "=", value: "" });
        renderConditions();
        saveToStorage();
      }

      // ç§»é™¤æ¡ä»¶
      function removeCondition(index) {
        conditions.splice(index, 1);
        renderConditions();
        generateSQL();
        saveToStorage();
      }

      // æ›´æ–°æ¡ä»¶
      function updateCondition(index, field, value) {
        conditions[index][field] = value;
        // å½“æ“ä½œç¬¦æ”¹å˜æ—¶ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°å€¼è¾“å…¥æ¡†çš„çŠ¶æ€
        if (field === "operator") {
          renderConditions();
        }
        generateSQL();
        saveToStorage();
      }

      // æ¸²æŸ“æ¡ä»¶åˆ—è¡¨
      function renderConditions() {
        var list = document.getElementById("conditionList");
        list.textContent = "";

        if (conditions.length === 0) {
          var empty = document.createElement("span");
          empty.className = "empty-state";
          empty.textContent = "æ— æ¡ä»¶ (å¯é€‰)";
          list.appendChild(empty);
          return;
        }

        conditions.forEach(function (cond, i) {
          var item = document.createElement("div");
          item.className = "condition-item";

          // åˆ—åè¾“å…¥
          var colInput = document.createElement("input");
          colInput.type = "text";
          colInput.placeholder = "åˆ—å";
          colInput.value = cond.column;
          colInput.oninput = function () {
            updateCondition(i, "column", this.value);
          };

          // æ“ä½œç¬¦é€‰æ‹©
          var opSelect = document.createElement("select");
          var operators = ["=", "!=", "<>", ">", "<", ">=", "<=", "LIKE", "NOT LIKE", "IN", "NOT IN", "BETWEEN", "IS NULL", "IS NOT NULL"];
          operators.forEach(function (op) {
            var opt = document.createElement("option");
            opt.value = op;
            opt.textContent = op;
            if (op === cond.operator) opt.selected = true;
            opSelect.appendChild(opt);
          });
          opSelect.onchange = function () {
            updateCondition(i, "operator", this.value);
          };

          // å€¼è¾“å…¥
          var valInput = document.createElement("input");
          valInput.type = "text";
          if (cond.operator === "IN" || cond.operator === "NOT IN") {
            valInput.placeholder = "val1, val2, ...";
          } else if (cond.operator === "BETWEEN") {
            valInput.placeholder = "min, max";
          } else {
            valInput.placeholder = "å€¼";
          }
          valInput.value = cond.value;
          valInput.oninput = function () {
            updateCondition(i, "value", this.value);
          };
          // IS NULL å’Œ IS NOT NULL ä¸éœ€è¦å€¼
          if (cond.operator === "IS NULL" || cond.operator === "IS NOT NULL") {
            valInput.disabled = true;
            valInput.placeholder = "N/A";
            valInput.value = "";
          }

          // åˆ é™¤æŒ‰é’®
          var removeBtn = document.createElement("button");
          removeBtn.className = "btn btn-secondary btn-small";
          removeBtn.textContent = "Ã—";
          removeBtn.onclick = function () {
            removeCondition(i);
          };

          item.appendChild(colInput);
          item.appendChild(opSelect);
          item.appendChild(valInput);
          item.appendChild(removeBtn);
          list.appendChild(item);
        });
      }

      // æ·»åŠ å­—æ®µå€¼ (INSERT/UPDATE)
      function addValue() {
        values.push({ column: "", value: "" });
        renderValues();
        saveToStorage();
      }

      // ç§»é™¤å€¼
      function removeValue(index) {
        values.splice(index, 1);
        renderValues();
        generateSQL();
        saveToStorage();
      }

      // æ›´æ–°å€¼
      function updateValue(index, field, val) {
        values[index][field] = val;
        generateSQL();
        saveToStorage();
      }

      // æ¸²æŸ“å€¼åˆ—è¡¨
      function renderValues() {
        var list = document.getElementById("valuesList");
        list.textContent = "";

        if (values.length === 0) {
          var empty = document.createElement("span");
          empty.className = "empty-state";
          empty.textContent = "è¯·æ·»åŠ å­—æ®µå’Œå€¼";
          list.appendChild(empty);
          return;
        }

        values.forEach(function (v, i) {
          var item = document.createElement("div");
          item.className = "condition-item";

          var colInput = document.createElement("input");
          colInput.type = "text";
          colInput.placeholder = "åˆ—å";
          colInput.value = v.column;
          colInput.oninput = function () {
            updateValue(i, "column", this.value);
          };

          var eqSpan = document.createElement("span");
          eqSpan.textContent = "=";
          eqSpan.style.color = "var(--color-text-muted)";
          eqSpan.style.fontFamily = "var(--font-mono)";
          eqSpan.style.fontWeight = "600";

          var valInput = document.createElement("input");
          valInput.type = "text";
          valInput.placeholder = "å€¼";
          valInput.value = v.value;
          valInput.oninput = function () {
            updateValue(i, "value", this.value);
          };

          var removeBtn = document.createElement("button");
          removeBtn.className = "btn btn-secondary btn-small";
          removeBtn.textContent = "Ã—";
          removeBtn.onclick = function () {
            removeValue(i);
          };

          item.appendChild(colInput);
          item.appendChild(eqSpan);
          item.appendChild(valInput);
          item.appendChild(removeBtn);
          list.appendChild(item);
        });
      }

      // è½¬ä¹‰å€¼
      function escapeValue(val) {
        if (val === "" || val === null || val === undefined) return "''";
        // æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
        var trimmed = val.toString().trim();
        if (trimmed !== "" && !isNaN(trimmed) && !isNaN(parseFloat(trimmed))) {
          return trimmed;
        }
        // æ£€æŸ¥æ˜¯å¦ä¸ºNULL
        if (trimmed.toUpperCase() === "NULL") {
          return "NULL";
        }
        // è½¬ä¹‰å•å¼•å·
        return "'" + val.replace(/'/g, "''") + "'";
      }

      // ç”ŸæˆSQL
      function generateSQL() {
        var table = document.getElementById("tableName").value.trim() || "table_name";
        var sql = "";

        switch (currentOp) {
          case "select":
            var distinct = document.getElementById("distinctCheck").checked;
            var cols =
              columns.length > 0
                ? columns
                    .map(function (c) {
                      if (typeof c === "string") return c;
                      return c.alias ? c.name + " AS " + c.alias : c.name;
                    })
                    .join(", ")
                : "*";

            sql = "SELECT ";
            if (distinct) sql += "DISTINCT ";
            sql += cols + "\nFROM " + table;

            // WHERE
            if (conditions.length > 0) {
              var whereParts = conditions
                .filter(function (c) {
                  return c.column;
                })
                .map(function (c) {
                  if (c.operator === "IS NULL" || c.operator === "IS NOT NULL") {
                    return c.column + " " + c.operator;
                  }
                  if (c.operator === "IN" || c.operator === "NOT IN") {
                    var vals = c.value
                      .split(",")
                      .map(function (v) {
                        return escapeValue(v.trim());
                      })
                      .join(", ");
                    return c.column + " " + c.operator + " (" + vals + ")";
                  }
                  if (c.operator === "BETWEEN") {
                    var parts = c.value.split(",").map(function (v) {
                      return escapeValue(v.trim());
                    });
                    if (parts.length >= 2) {
                      return c.column + " BETWEEN " + parts[0] + " AND " + parts[1];
                    }
                    return c.column + " BETWEEN " + escapeValue(c.value) + " AND " + escapeValue(c.value);
                  }
                  return c.column + " " + c.operator + " " + escapeValue(c.value);
                });
              if (whereParts.length > 0) {
                sql += "\nWHERE " + whereParts.join("\n  AND ");
              }
            }

            // ORDER BY
            var orderBy = document.getElementById("orderBy").value.trim();
            var orderDir = document.getElementById("orderDir").value;
            if (orderBy) {
              sql += "\nORDER BY " + orderBy;
              if (orderDir) sql += " " + orderDir;
            }

            // LIMIT
            var limit = document.getElementById("limitVal").value.trim();
            var offset = document.getElementById("offsetVal").value.trim();
            if (limit) {
              sql += "\nLIMIT " + limit;
              if (offset && parseInt(offset) > 0) {
                sql += " OFFSET " + offset;
              }
            }
            break;

          case "insert":
            var insertCols =
              columns.length > 0
                ? columns.map(function (c) {
                    return typeof c === "string" ? c : c.name;
                  })
                : values
                    .filter(function (v) {
                      return v.column;
                    })
                    .map(function (v) {
                      return v.column;
                    });

            var insertVals = values
              .filter(function (v) {
                return v.column;
              })
              .map(function (v) {
                return escapeValue(v.value);
              });

            if (insertCols.length > 0 && insertVals.length > 0) {
              sql = "INSERT INTO " + table + " (" + insertCols.join(", ") + ")\nVALUES (" + insertVals.join(", ") + ")";
            } else {
              sql = "INSERT INTO " + table + " (column1, column2)\nVALUES ('value1', 'value2')";
            }
            break;

          case "update":
            var setParts = values
              .filter(function (v) {
                return v.column;
              })
              .map(function (v) {
                return v.column + " = " + escapeValue(v.value);
              });

            sql = "UPDATE " + table;
            if (setParts.length > 0) {
              sql += "\nSET " + setParts.join(",\n    ");
            } else {
              sql += "\nSET column1 = 'value1'";
            }

            // WHERE
            if (conditions.length > 0) {
              var whereParts2 = conditions
                .filter(function (c) {
                  return c.column;
                })
                .map(function (c) {
                  if (c.operator === "IS NULL" || c.operator === "IS NOT NULL") {
                    return c.column + " " + c.operator;
                  }
                  if (c.operator === "IN" || c.operator === "NOT IN") {
                    var vals = c.value
                      .split(",")
                      .map(function (v) {
                        return escapeValue(v.trim());
                      })
                      .join(", ");
                    return c.column + " " + c.operator + " (" + vals + ")";
                  }
                  return c.column + " " + c.operator + " " + escapeValue(c.value);
                });
              if (whereParts2.length > 0) {
                sql += "\nWHERE " + whereParts2.join("\n  AND ");
              }
            }
            break;

          case "delete":
            sql = "DELETE FROM " + table;

            // WHERE
            if (conditions.length > 0) {
              var whereParts3 = conditions
                .filter(function (c) {
                  return c.column;
                })
                .map(function (c) {
                  if (c.operator === "IS NULL" || c.operator === "IS NOT NULL") {
                    return c.column + " " + c.operator;
                  }
                  if (c.operator === "IN" || c.operator === "NOT IN") {
                    var vals = c.value
                      .split(",")
                      .map(function (v) {
                        return escapeValue(v.trim());
                      })
                      .join(", ");
                    return c.column + " " + c.operator + " (" + vals + ")";
                  }
                  return c.column + " " + c.operator + " " + escapeValue(c.value);
                });
              if (whereParts3.length > 0) {
                sql += "\nWHERE " + whereParts3.join("\n  AND ");
              }
            }
            break;
        }

        sql += ";";

        // æ˜¾ç¤ºSQLï¼ˆä½¿ç”¨textContenté¿å…XSSï¼‰
        document.getElementById("sqlOutput").textContent = sql;
      }

      // å¤åˆ¶SQL
      function copySQL() {
        var sql = document.getElementById("sqlOutput").textContent;
        navigator.clipboard
          .writeText(sql)
          .then(function () {
            showToast("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
          })
          .catch(function () {
            showToast("å¤åˆ¶å¤±è´¥", "error");
          });
      }

      // åˆ†äº«æŸ¥è¯¢
      function shareQuery() {
        var data = {
          op: currentOp,
          table: document.getElementById("tableName").value,
          distinct: document.getElementById("distinctCheck").checked,
          columns: columns,
          conditions: conditions,
          values: values,
          orderBy: document.getElementById("orderBy").value,
          orderDir: document.getElementById("orderDir").value,
          limit: document.getElementById("limitVal").value,
          offset: document.getElementById("offsetVal").value,
        };

        var encoded = btoa(encodeURIComponent(JSON.stringify(data)));
        var url = window.location.href.split("#")[0] + "#" + encoded;

        navigator.clipboard
          .writeText(url)
          .then(function () {
            showToast("åˆ†äº«é“¾æ¥å·²å¤åˆ¶");
          })
          .catch(function () {
            showToast("å¤åˆ¶å¤±è´¥", "error");
          });
      }

      // ä»URLåŠ è½½
      function loadFromUrl() {
        var hash = window.location.hash.slice(1);
        if (!hash) return false;

        try {
          var data = JSON.parse(decodeURIComponent(atob(hash)));
          restoreState(data);
          return true;
        } catch (e) {
          return false;
        }
      }

      // ä¿å­˜åˆ°localStorage
      function saveToStorage() {
        var data = {
          op: currentOp,
          table: document.getElementById("tableName").value,
          distinct: document.getElementById("distinctCheck").checked,
          columns: columns,
          conditions: conditions,
          values: values,
          orderBy: document.getElementById("orderBy").value,
          orderDir: document.getElementById("orderDir").value,
          limit: document.getElementById("limitVal").value,
          offset: document.getElementById("offsetVal").value,
        };
        localStorage.setItem(LS_KEY, JSON.stringify(data));
      }

      // ä»localStorageåŠ è½½
      function loadFromStorage() {
        var saved = localStorage.getItem(LS_KEY);
        if (!saved) return false;

        try {
          var data = JSON.parse(saved);
          restoreState(data);
          return true;
        } catch (e) {
          return false;
        }
      }

      // æ¢å¤çŠ¶æ€
      function restoreState(data) {
        if (data.table) document.getElementById("tableName").value = data.table;
        if (data.distinct !== undefined) document.getElementById("distinctCheck").checked = data.distinct;
        if (data.columns) columns = data.columns;
        if (data.conditions) conditions = data.conditions;
        if (data.values) values = data.values;
        if (data.orderBy) document.getElementById("orderBy").value = data.orderBy;
        if (data.orderDir) document.getElementById("orderDir").value = data.orderDir;
        if (data.limit) document.getElementById("limitVal").value = data.limit;
        if (data.offset) document.getElementById("offsetVal").value = data.offset;

        renderColumns();
        renderConditions();
        renderValues();

        if (data.op) {
          selectOperation(data.op);
        } else {
          generateSQL();
        }
      }

      // æ¸…ç©ºæ‰€æœ‰
      function clearAll() {
        columns = [];
        conditions = [];
        values = [];

        document.getElementById("tableName").value = "users";
        document.getElementById("distinctCheck").checked = false;
        document.getElementById("orderBy").value = "";
        document.getElementById("orderDir").value = "";
        document.getElementById("limitVal").value = "";
        document.getElementById("offsetVal").value = "";
        document.getElementById("columnInput").value = "";
        document.getElementById("aliasInput").value = "";

        renderColumns();
        renderConditions();
        renderValues();
        selectOperation("select");

        localStorage.removeItem(LS_KEY);
        window.location.hash = "";

        showToast("å·²é‡ç½®");
      }

      // æ˜¾ç¤ºæç¤º
      function showToast(msg, type) {
        type = type || "success";
        var toast = document.getElementById("toast");
        toast.textContent = msg;
        toast.className = "toast" + (type === "error" ? " error" : "");
        toast.classList.add("show");
        setTimeout(function () {
          toast.classList.remove("show");
        }, 2000);
      }

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        // å›è½¦æ·»åŠ åˆ—
        document.getElementById("columnInput").addEventListener("keypress", function (e) {
          if (e.key === "Enter") addColumn();
        });
        document.getElementById("aliasInput").addEventListener("keypress", function (e) {
          if (e.key === "Enter") addColumn();
        });

        // ä»URLåŠ è½½ä¼˜å…ˆ
        if (!loadFromUrl()) {
          loadFromStorage();
        }

        // åˆå§‹æ¸²æŸ“
        renderColumns();
        renderConditions();
        renderValues();
        generateSQL();
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å¯¹æ¯”</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1e1e1e; min-height: 100vh; padding: 20px; color: #d4d4d4; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #569cd6; text-align: center; margin-bottom: 20px; }
        .inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 900px) { .inputs { grid-template-columns: 1fr; } }
        .input-card { background: #252526; border-radius: 12px; padding: 16px; }
        .input-card h3 { color: #569cd6; margin-bottom: 12px; font-size: 14px; }
        textarea { width: 100%; height: 200px; padding: 12px; background: #1e1e1e; border: 1px solid #3c3c3c; border-radius: 8px; color: #d4d4d4; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; resize: vertical; }
        textarea:focus { outline: none; border-color: #569cd6; }
        .toolbar { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; align-items: center; }
        .btn { padding: 10px 20px; background: #0e639c; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .btn:hover { background: #1177bb; }
        .btn-secondary { background: #3c3c3c; }
        .btn-secondary:hover { background: #4c4c4c; }
        .stats { display: flex; gap: 16px; color: #808080; font-size: 13px; }
        .stat { display: flex; align-items: center; gap: 6px; }
        .stat-dot { width: 12px; height: 12px; border-radius: 3px; }
        .stat-add { background: #2ea043; }
        .stat-del { background: #f85149; }
        .stat-mod { background: #d29922; }
        .diff-view { background: #1e1e1e; border-radius: 12px; overflow: hidden; }
        .diff-header { display: flex; background: #252526; border-bottom: 1px solid #3c3c3c; }
        .diff-header-item { flex: 1; padding: 12px 16px; font-size: 13px; color: #808080; }
        .diff-content { display: flex; max-height: 500px; overflow: auto; }
        .diff-pane { flex: 1; border-right: 1px solid #3c3c3c; }
        .diff-pane:last-child { border-right: none; }
        .diff-line { display: flex; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; line-height: 1.5; }
        .line-num { min-width: 50px; padding: 0 12px; text-align: right; color: #6e7681; background: #161b22; user-select: none; }
        .line-content { flex: 1; padding: 0 12px; white-space: pre-wrap; word-break: break-all; }
        .line-add { background: rgba(46, 160, 67, 0.15); }
        .line-add .line-content { background: rgba(46, 160, 67, 0.25); }
        .line-del { background: rgba(248, 81, 73, 0.15); }
        .line-del .line-content { background: rgba(248, 81, 73, 0.25); }
        .line-mod { background: rgba(210, 153, 34, 0.15); }
        .char-add { background: rgba(46, 160, 67, 0.4); border-radius: 2px; }
        .char-del { background: rgba(248, 81, 73, 0.4); border-radius: 2px; }
        .unified-view .diff-content { flex-direction: column; }
        .unified-view .diff-pane { border-right: none; border-bottom: 1px solid #3c3c3c; }
        .unified-view .diff-pane:last-child { border-bottom: none; }
        .view-toggle { display: flex; background: #3c3c3c; border-radius: 6px; overflow: hidden; }
        .view-toggle button { padding: 8px 16px; background: transparent; border: none; color: #808080; cursor: pointer; font-size: 13px; }
        .view-toggle button.active { background: #0e639c; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æ–‡æœ¬å¯¹æ¯”å·¥å…·</h1>
        <div class="inputs">
            <div class="input-card">
                <h3>åŸå§‹æ–‡æœ¬</h3>
                <textarea id="text1" placeholder="è¾“å…¥åŸå§‹æ–‡æœ¬...">è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡æœ¬ã€‚
ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚
æˆ‘ä»¬å»å…¬å›­æ•£æ­¥ã€‚
çœ‹åˆ°äº†å¾ˆå¤šèŠ±ã€‚</textarea>
            </div>
            <div class="input-card">
                <h3>ä¿®æ”¹åæ–‡æœ¬</h3>
                <textarea id="text2" placeholder="è¾“å…¥ä¿®æ”¹åæ–‡æœ¬...">è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡æœ¬ã€‚
ä»Šå¤©å¤©æ°”éå¸¸å¥½ï¼
æˆ‘ä»¬å»å…¬å›­è·‘æ­¥ã€‚
çœ‹åˆ°äº†å¾ˆå¤šç¾ä¸½çš„èŠ±æœµã€‚
è¿˜é‡åˆ°äº†æœ‹å‹ã€‚</textarea>
            </div>
        </div>
        <div class="toolbar">
            <button class="btn" onclick="compare()">ğŸ” å¯¹æ¯”</button>
            <button class="btn btn-secondary" onclick="swapTexts()">ğŸ”„ äº¤æ¢</button>
            <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <div class="view-toggle">
                <button class="active" onclick="setView('split')">å¹¶æ’è§†å›¾</button>
                <button onclick="setView('unified')">ç»Ÿä¸€è§†å›¾</button>
            </div>
            <div class="stats" id="stats"></div>
        </div>
        <div class="diff-view" id="diffView"></div>
    </div>
    <script>
        let viewMode = 'split';
        
        function compare() {
            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;
            const lines1 = text1.split('\n');
            const lines2 = text2.split('\n');
            
            // Simple LCS-based diff
            const diff = computeDiff(lines1, lines2);
            
            // Stats
            let added = 0, deleted = 0, modified = 0;
            diff.forEach(d => {
                if (d.type === 'add') added++;
                else if (d.type === 'del') deleted++;
                else if (d.type === 'mod') modified++;
            });
            
            document.getElementById('stats').innerHTML = `
                <div class="stat"><span class="stat-dot stat-add"></span> æ–°å¢: ${added}</div>
                <div class="stat"><span class="stat-dot stat-del"></span> åˆ é™¤: ${deleted}</div>
                <div class="stat"><span class="stat-dot stat-mod"></span> ä¿®æ”¹: ${modified}</div>
            `;
            
            renderDiff(diff);
        }
        
        function computeDiff(lines1, lines2) {
            const result = [];
            const maxLen = Math.max(lines1.length, lines2.length);
            
            // Simple line-by-line comparison
            let i = 0, j = 0;
            while (i < lines1.length || j < lines2.length) {
                if (i >= lines1.length) {
                    // Remaining lines in text2 are additions
                    result.push({ type: 'add', line1: null, line2: lines2[j], num1: null, num2: j + 1 });
                    j++;
                } else if (j >= lines2.length) {
                    // Remaining lines in text1 are deletions
                    result.push({ type: 'del', line1: lines1[i], line2: null, num1: i + 1, num2: null });
                    i++;
                } else if (lines1[i] === lines2[j]) {
                    // Lines are equal
                    result.push({ type: 'eq', line1: lines1[i], line2: lines2[j], num1: i + 1, num2: j + 1 });
                    i++;
                    j++;
                } else {
                    // Check if it's a modification or add/delete
                    const similarity = getSimilarity(lines1[i], lines2[j]);
                    if (similarity > 0.3) {
                        // Modified line
                        result.push({ type: 'mod', line1: lines1[i], line2: lines2[j], num1: i + 1, num2: j + 1 });
                        i++;
                        j++;
                    } else {
                        // Check if next line matches
                        if (i + 1 < lines1.length && lines1[i + 1] === lines2[j]) {
                            result.push({ type: 'del', line1: lines1[i], line2: null, num1: i + 1, num2: null });
                            i++;
                        } else if (j + 1 < lines2.length && lines1[i] === lines2[j + 1]) {
                            result.push({ type: 'add', line1: null, line2: lines2[j], num1: null, num2: j + 1 });
                            j++;
                        } else {
                            result.push({ type: 'mod', line1: lines1[i], line2: lines2[j], num1: i + 1, num2: j + 1 });
                            i++;
                            j++;
                        }
                    }
                }
            }
            
            return result;
        }
        
        function getSimilarity(str1, str2) {
            if (!str1 || !str2) return 0;
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            if (longer.length === 0) return 1.0;
            return (longer.length - editDistance(longer, shorter)) / longer.length;
        }
        
        function editDistance(s1, s2) {
            const m = s1.length, n = s2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
            for (let i = 0; i <= m; i++) dp[i][0] = i;
            for (let j = 0; j <= n; j++) dp[0][j] = j;
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (s1[i-1] === s2[j-1]) dp[i][j] = dp[i-1][j-1];
                    else dp[i][j] = 1 + Math.min(dp[i-1][j], dp[i][j-1], dp[i-1][j-1]);
                }
            }
            return dp[m][n];
        }
        
        function highlightDiff(line1, line2) {
            if (!line1 || !line2) return { html1: escapeHtml(line1 || ''), html2: escapeHtml(line2 || '') };
            
            // Character-level diff highlighting
            let html1 = '', html2 = '';
            const words1 = line1.split('');
            const words2 = line2.split('');
            
            let i = 0, j = 0;
            while (i < words1.length || j < words2.length) {
                if (i >= words1.length) {
                    html2 += `<span class="char-add">${escapeHtml(words2[j])}</span>`;
                    j++;
                } else if (j >= words2.length) {
                    html1 += `<span class="char-del">${escapeHtml(words1[i])}</span>`;
                    i++;
                } else if (words1[i] === words2[j]) {
                    html1 += escapeHtml(words1[i]);
                    html2 += escapeHtml(words2[j]);
                    i++;
                    j++;
                } else {
                    html1 += `<span class="char-del">${escapeHtml(words1[i])}</span>`;
                    html2 += `<span class="char-add">${escapeHtml(words2[j])}</span>`;
                    i++;
                    j++;
                }
            }
            
            return { html1, html2 };
        }
        
        function renderDiff(diff) {
            const container = document.getElementById('diffView');
            container.className = viewMode === 'unified' ? 'diff-view unified-view' : 'diff-view';
            
            if (viewMode === 'split') {
                let leftHtml = '', rightHtml = '';
                
                diff.forEach(d => {
                    const { html1, html2 } = d.type === 'mod' ? highlightDiff(d.line1, d.line2) : { html1: escapeHtml(d.line1 || ''), html2: escapeHtml(d.line2 || '') };
                    
                    if (d.type === 'eq') {
                        leftHtml += `<div class="diff-line"><span class="line-num">${d.num1}</span><span class="line-content">${html1}</span></div>`;
                        rightHtml += `<div class="diff-line"><span class="line-num">${d.num2}</span><span class="line-content">${html2}</span></div>`;
                    } else if (d.type === 'add') {
                        leftHtml += `<div class="diff-line"><span class="line-num"></span><span class="line-content"></span></div>`;
                        rightHtml += `<div class="diff-line line-add"><span class="line-num">${d.num2}</span><span class="line-content">${html2}</span></div>`;
                    } else if (d.type === 'del') {
                        leftHtml += `<div class="diff-line line-del"><span class="line-num">${d.num1}</span><span class="line-content">${html1}</span></div>`;
                        rightHtml += `<div class="diff-line"><span class="line-num"></span><span class="line-content"></span></div>`;
                    } else if (d.type === 'mod') {
                        leftHtml += `<div class="diff-line line-mod"><span class="line-num">${d.num1}</span><span class="line-content">${html1}</span></div>`;
                        rightHtml += `<div class="diff-line line-mod"><span class="line-num">${d.num2}</span><span class="line-content">${html2}</span></div>`;
                    }
                });
                
                container.innerHTML = `
                    <div class="diff-header">
                        <div class="diff-header-item">åŸå§‹æ–‡æœ¬</div>
                        <div class="diff-header-item">ä¿®æ”¹åæ–‡æœ¬</div>
                    </div>
                    <div class="diff-content">
                        <div class="diff-pane">${leftHtml}</div>
                        <div class="diff-pane">${rightHtml}</div>
                    </div>
                `;
            } else {
                let html = '';
                diff.forEach(d => {
                    const { html1, html2 } = d.type === 'mod' ? highlightDiff(d.line1, d.line2) : { html1: escapeHtml(d.line1 || ''), html2: escapeHtml(d.line2 || '') };
                    
                    if (d.type === 'eq') {
                        html += `<div class="diff-line"><span class="line-num">${d.num1}</span><span class="line-content">${html1}</span></div>`;
                    } else if (d.type === 'add') {
                        html += `<div class="diff-line line-add"><span class="line-num">+${d.num2}</span><span class="line-content">${html2}</span></div>`;
                    } else if (d.type === 'del') {
                        html += `<div class="diff-line line-del"><span class="line-num">-${d.num1}</span><span class="line-content">${html1}</span></div>`;
                    } else if (d.type === 'mod') {
                        html += `<div class="diff-line line-del"><span class="line-num">-${d.num1}</span><span class="line-content">${html1}</span></div>`;
                        html += `<div class="diff-line line-add"><span class="line-num">+${d.num2}</span><span class="line-content">${html2}</span></div>`;
                    }
                });
                
                container.innerHTML = `
                    <div class="diff-header">
                        <div class="diff-header-item">ç»Ÿä¸€å¯¹æ¯”è§†å›¾</div>
                    </div>
                    <div class="diff-content">
                        <div class="diff-pane">${html}</div>
                    </div>
                `;
            }
        }
        
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
        
        function setView(mode) {
            viewMode = mode;
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(mode === 'split' ? 'å¹¶æ’' : 'ç»Ÿä¸€'));
            });
            compare();
        }
        
        function swapTexts() {
            const text1 = document.getElementById('text1');
            const text2 = document.getElementById('text2');
            const temp = text1.value;
            text1.value = text2.value;
            text2.value = temp;
            compare();
        }
        
        function clearAll() {
            document.getElementById('text1').value = '';
            document.getElementById('text2').value = '';
            document.getElementById('diffView').innerHTML = '';
            document.getElementById('stats').innerHTML = '';
        }
        
        compare();
    </script>
</body>
</html>
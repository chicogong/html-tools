<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>代码统计器 - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="代码统计器 - WebUtils" />
    <meta name="keywords" content="code-stats,dev,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/code-stats.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="代码统计器 - WebUtils" />
    <meta property="og:description" content="代码统计器 - WebUtils" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/code-stats.html" />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="代码统计器 - WebUtils" />
    <meta name="twitter:description" content="代码统计器 - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* 字体变量 */
  --font-sans: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
      }
      .main-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }
      @media (max-width: 768px) {
        .main-container {
          grid-template-columns: 1fr;
        }
      }
      .input-panel {
        display: flex;
        flex-direction: column;
      }
      .input-panel label {
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .input-panel textarea {
        font-family: var(--font-mono);
        font-size: 0.875rem;
        min-height: 400px;
        resize: vertical;
        tab-size: 4;
      }
      .controls {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }
      .controls select {
        width: auto;
        min-width: 150px;
      }
      .stats-panel {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .stat-card {
        background: var(--pico-card-background-color);
        border-radius: 0.5rem;
        padding: 1rem;
        border: 1px solid var(--pico-muted-border-color);
      }
      .stat-card h3 {
        margin: 0 0 1rem;
        font-size: 1rem;
        color: var(--pico-muted-color);
      }
      .stat-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      .stat-item {
        text-align: center;
      }
      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--pico-primary);
      }
      .stat-label {
        font-size: 0.75rem;
        color: var(--pico-muted-color);
        margin-top: 0.25rem;
      }
      .progress-bar {
        height: 8px;
        background: var(--pico-secondary-background);
        border-radius: 4px;
        overflow: hidden;
        margin: 0.5rem 0;
      }
      .progress-fill {
        height: 100%;
        transition: width 0.3s ease;
      }
      .progress-code {
        background: #22c55e;
      }
      .progress-comment {
        background: #3b82f6;
      }
      .progress-blank {
        background: #9ca3af;
      }
      .legend {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
      }
      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }
      .char-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        font-size: 0.875rem;
      }
      .char-stat {
        background: var(--pico-code-background-color);
        padding: 0.5rem;
        border-radius: 0.25rem;
        text-align: center;
      }
      .char-stat-value {
        font-weight: bold;
        font-size: 1.25rem;
      }
      .complexity-meter {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }
      .complexity-bar {
        flex: 1;
        height: 20px;
        background: linear-gradient(to right, #22c55e, #eab308, #ef4444);
        border-radius: 10px;
        position: relative;
      }
      .complexity-indicator {
        position: absolute;
        width: 4px;
        height: 24px;
        background: var(--pico-contrast);
        top: -2px;
        border-radius: 2px;
        transition: left 0.3s ease;
      }
      .complexity-label {
        font-size: 0.875rem;
        min-width: 60px;
      }
      .file-drop {
        border: 2px dashed var(--pico-muted-border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        text-align: center;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
      }
      .file-drop.dragover {
        border-color: var(--pico-primary);
        background: var(--pico-primary-background);
      }
      .file-drop input {
        display: none;
      }
      .top-items {
        font-size: 0.875rem;
      }
      .top-item {
        display: flex;
        justify-content: space-between;
        padding: 0.25rem 0;
        border-bottom: 1px solid var(--pico-muted-border-color);
      }
      .top-item:last-child {
        border-bottom: none;
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">首页</a>
      <span>›</span>
      代码统计器
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()">切换主题</button>

    <main class="container">
      <h1>代码统计器</h1>
      <p>统计代码行数、空行、注释行等详细信息</p>

      <div class="controls">
        <select id="languageSelect">
          <option value="auto">自动检测语言</option>
          <option value="javascript">JavaScript</option>
          <option value="typescript">TypeScript</option>
          <option value="python">Python</option>
          <option value="java">Java</option>
          <option value="c">C/C++</option>
          <option value="csharp">C#</option>
          <option value="go">Go</option>
          <option value="rust">Rust</option>
          <option value="php">PHP</option>
          <option value="ruby">Ruby</option>
          <option value="swift">Swift</option>
          <option value="kotlin">Kotlin</option>
          <option value="html">HTML</option>
          <option value="css">CSS</option>
          <option value="sql">SQL</option>
          <option value="shell">Shell</option>
        </select>
        <button onclick="analyzeCode()">分析代码</button>
        <button class="secondary" onclick="clearCode()">清空</button>
        <button class="secondary" onclick="loadSample()">加载示例</button>
      </div>

      <div class="file-drop" id="fileDrop">
        <p>
          拖放文件到此处，或
          <label for="fileInput" style="color: var(--pico-primary); cursor: pointer">
            点击选择文件
          </label>
        </p>
        <input
          type="file"
          id="fileInput"
          accept=".js,.ts,.jsx,.tsx,.py,.java,.c,.cpp,.h,.cs,.go,.rs,.php,.rb,.swift,.kt,.html,.css,.sql,.sh"
        />
      </div>

      <div class="main-container">
        <div class="input-panel">
          <label for="codeInput">代码内容</label>
          <textarea id="codeInput" placeholder="在此粘贴代码..."></textarea>
        </div>

        <div class="stats-panel">
          <div class="stat-card">
            <h3>行数统计</h3>
            <div class="stat-grid">
              <div class="stat-item">
                <div class="stat-value" id="totalLines">0</div>
                <div class="stat-label">总行数</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="codeLines">0</div>
                <div class="stat-label">代码行</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="commentLines">0</div>
                <div class="stat-label">注释行</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="blankLines">0</div>
                <div class="stat-label">空白行</div>
              </div>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill progress-code"
                id="codeProgress"
                style="width: 0%; display: inline-block"
              ></div>
              <div
                class="progress-fill progress-comment"
                id="commentProgress"
                style="width: 0%; display: inline-block"
              ></div>
              <div
                class="progress-fill progress-blank"
                id="blankProgress"
                style="width: 0%; display: inline-block"
              ></div>
            </div>
            <div class="legend">
              <div class="legend-item">
                <div class="legend-color" style="background: #22c55e"></div>
                代码
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6"></div>
                注释
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #9ca3af"></div>
                空白
              </div>
            </div>
          </div>

          <div class="stat-card">
            <h3>字符统计</h3>
            <div class="char-stats">
              <div class="char-stat">
                <div class="char-stat-value" id="totalChars">0</div>
                <div>总字符</div>
              </div>
              <div class="char-stat">
                <div class="char-stat-value" id="nonSpaceChars">0</div>
                <div>非空字符</div>
              </div>
              <div class="char-stat">
                <div class="char-stat-value" id="wordCount">0</div>
                <div>单词数</div>
              </div>
              <div class="char-stat">
                <div class="char-stat-value" id="avgLineLength">0</div>
                <div>平均行长</div>
              </div>
              <div class="char-stat">
                <div class="char-stat-value" id="maxLineLength">0</div>
                <div>最长行</div>
              </div>
              <div class="char-stat">
                <div class="char-stat-value" id="indentSpaces">0</div>
                <div>缩进空格</div>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <h3>代码复杂度指标</h3>
            <div class="complexity-meter">
              <span class="complexity-label">简单</span>
              <div class="complexity-bar">
                <div class="complexity-indicator" id="complexityIndicator" style="left: 0%"></div>
              </div>
              <span class="complexity-label">复杂</span>
            </div>
            <div style="margin-top: 1rem">
              <div class="char-stats">
                <div class="char-stat">
                  <div class="char-stat-value" id="functionCount">0</div>
                  <div>函数/方法</div>
                </div>
                <div class="char-stat">
                  <div class="char-stat-value" id="classCount">0</div>
                  <div>类/接口</div>
                </div>
                <div class="char-stat">
                  <div class="char-stat-value" id="importCount">0</div>
                  <div>导入语句</div>
                </div>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <h3>常用关键字 Top 5</h3>
            <div class="top-items" id="topKeywords">
              <div class="top-item">
                <span>-</span>
                <span>0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // 语言配置
      const langConfig = {
        javascript: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\b(function|const|let|var)\s+\w+\s*[=]?\s*(\(|async|function)/g,
          classes: /\bclass\s+\w+/g,
          imports: /\b(import|require)\b/g,
          keywords: [
            "function",
            "const",
            "let",
            "var",
            "if",
            "else",
            "for",
            "while",
            "return",
            "async",
            "await",
            "class",
            "export",
            "import",
            "try",
            "catch"
          ]
        },
        typescript: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\b(function|const|let|var)\s+\w+\s*[=:]?\s*(\(|async|function)/g,
          classes: /\b(class|interface|type)\s+\w+/g,
          imports: /\b(import|require)\b/g,
          keywords: [
            "function",
            "const",
            "let",
            "var",
            "if",
            "else",
            "for",
            "while",
            "return",
            "async",
            "await",
            "class",
            "interface",
            "type",
            "export",
            "import"
          ]
        },
        python: {
          singleComment: "#",
          multiCommentStart: '"""',
          multiCommentEnd: '"""',
          functions: /\bdef\s+\w+/g,
          classes: /\bclass\s+\w+/g,
          imports: /\b(import|from)\b/g,
          keywords: [
            "def",
            "class",
            "if",
            "elif",
            "else",
            "for",
            "while",
            "return",
            "import",
            "from",
            "try",
            "except",
            "with",
            "as",
            "lambda",
            "yield"
          ]
        },
        java: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions:
            /\b(public|private|protected|static)?\s*(void|int|String|boolean|\w+)\s+\w+\s*\(/g,
          classes: /\b(class|interface|enum)\s+\w+/g,
          imports: /\bimport\b/g,
          keywords: [
            "public",
            "private",
            "protected",
            "class",
            "interface",
            "void",
            "int",
            "String",
            "if",
            "else",
            "for",
            "while",
            "return",
            "new",
            "static",
            "final"
          ]
        },
        c: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\b(void|int|char|float|double|\w+)\s+\w+\s*\([^)]*\)\s*\{/g,
          classes: /\bstruct\s+\w+/g,
          imports: /\#include/g,
          keywords: [
            "int",
            "char",
            "void",
            "float",
            "double",
            "if",
            "else",
            "for",
            "while",
            "return",
            "struct",
            "typedef",
            "sizeof",
            "switch",
            "case",
            "break"
          ]
        },
        go: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\bfunc\s+(\(\w+\s+\*?\w+\)\s+)?\w+/g,
          classes: /\btype\s+\w+\s+(struct|interface)/g,
          imports: /\bimport\b/g,
          keywords: [
            "func",
            "type",
            "struct",
            "interface",
            "if",
            "else",
            "for",
            "range",
            "return",
            "go",
            "defer",
            "chan",
            "select",
            "package",
            "import",
            "var",
            "const"
          ]
        },
        rust: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\bfn\s+\w+/g,
          classes: /\b(struct|enum|trait|impl)\s+\w+/g,
          imports: /\buse\b/g,
          keywords: [
            "fn",
            "let",
            "mut",
            "struct",
            "enum",
            "impl",
            "trait",
            "if",
            "else",
            "for",
            "while",
            "loop",
            "match",
            "return",
            "use",
            "mod",
            "pub"
          ]
        },
        php: {
          singleComment: "//",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\bfunction\s+\w+/g,
          classes: /\b(class|interface|trait)\s+\w+/g,
          imports: /\b(use|require|include)\b/g,
          keywords: [
            "function",
            "class",
            "public",
            "private",
            "protected",
            "if",
            "else",
            "for",
            "foreach",
            "while",
            "return",
            "echo",
            "use",
            "namespace",
            "new",
            "static"
          ]
        },
        ruby: {
          singleComment: "#",
          multiCommentStart: "=begin",
          multiCommentEnd: "=end",
          functions: /\bdef\s+\w+/g,
          classes: /\bclass\s+\w+/g,
          imports: /\b(require|include)\b/g,
          keywords: [
            "def",
            "class",
            "module",
            "if",
            "elsif",
            "else",
            "unless",
            "while",
            "until",
            "for",
            "do",
            "end",
            "return",
            "require",
            "attr_accessor",
            "self"
          ]
        },
        html: {
          singleComment: null,
          multiCommentStart: "<!--",
          multiCommentEnd: "-->",
          functions: null,
          classes: /\bclass\s*=\s*["'][^"']+["']/g,
          imports: /<link|<script/g,
          keywords: [
            "div",
            "span",
            "p",
            "a",
            "img",
            "ul",
            "li",
            "table",
            "form",
            "input",
            "button",
            "head",
            "body",
            "html",
            "meta",
            "title"
          ]
        },
        css: {
          singleComment: null,
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /@(media|keyframes|import)/g,
          classes: /\.[a-zA-Z][\w-]*/g,
          imports: /@import/g,
          keywords: [
            "display",
            "position",
            "margin",
            "padding",
            "color",
            "background",
            "font",
            "width",
            "height",
            "border",
            "flex",
            "grid",
            "transform",
            "transition",
            "animation"
          ]
        },
        sql: {
          singleComment: "--",
          multiCommentStart: "/*",
          multiCommentEnd: "*/",
          functions: /\b(CREATE|ALTER)\s+(FUNCTION|PROCEDURE)/gi,
          classes: /\b(CREATE|ALTER)\s+TABLE/gi,
          imports: null,
          keywords: [
            "SELECT",
            "FROM",
            "WHERE",
            "INSERT",
            "UPDATE",
            "DELETE",
            "JOIN",
            "LEFT",
            "RIGHT",
            "INNER",
            "GROUP",
            "ORDER",
            "BY",
            "HAVING",
            "CREATE",
            "TABLE"
          ]
        },
        shell: {
          singleComment: "#",
          multiCommentStart: null,
          multiCommentEnd: null,
          functions: /\b\w+\s*\(\)\s*\{/g,
          classes: null,
          imports: /\b(source|\.)\s+/g,
          keywords: [
            "if",
            "then",
            "else",
            "elif",
            "fi",
            "for",
            "while",
            "do",
            "done",
            "case",
            "esac",
            "function",
            "return",
            "exit",
            "echo",
            "export"
          ]
        }
      };

      // 别名
      langConfig.csharp = langConfig.java;
      langConfig.swift = langConfig.java;
      langConfig.kotlin = langConfig.java;

      let currentLang = "auto";

      // 初始化
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) {
          document.documentElement.setAttribute("data-theme", savedTheme);
        }

        setupFileDrop();

        document.getElementById("codeInput").addEventListener("input", analyzeCode);
        document.getElementById("languageSelect").addEventListener("change", (e) => {
          currentLang = e.target.value;
          analyzeCode();
        });
      });

      // 设置文件拖放
      function setupFileDrop() {
        const dropZone = document.getElementById("fileDrop");
        const fileInput = document.getElementById("fileInput");

        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.classList.add("dragover");
        });

        dropZone.addEventListener("dragleave", () => {
          dropZone.classList.remove("dragover");
        });

        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.classList.remove("dragover");
          const file = e.dataTransfer.files[0];
          if (file) loadFile(file);
        });

        fileInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file) loadFile(file);
        });
      }

      // 加载文件
      window.loadFile = function (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById("codeInput").value = e.target.result;
          detectLanguage(file.name);
          analyzeCode();
        };
        reader.readAsText(file);
      };

      // 检测语言
      function detectLanguage(filename) {
        const ext = filename.split(".").pop().toLowerCase();
        const extMap = {
          js: "javascript",
          jsx: "javascript",
          ts: "typescript",
          tsx: "typescript",
          py: "python",
          java: "java",
          c: "c",
          cpp: "c",
          h: "c",
          hpp: "c",
          cs: "csharp",
          go: "go",
          rs: "rust",
          php: "php",
          rb: "ruby",
          swift: "swift",
          kt: "kotlin",
          html: "html",
          htm: "html",
          css: "css",
          scss: "css",
          less: "css",
          sql: "sql",
          sh: "shell",
          bash: "shell"
        };

        if (extMap[ext]) {
          currentLang = extMap[ext];
          document.getElementById("languageSelect").value = currentLang;
        }
      }

      // 自动检测语言
      function autoDetectLanguage(code) {
        if (/\bdef\s+\w+.*:\s*$/m.test(code) || /^import\s+\w+$/m.test(code)) return "python";
        if (/\bfunc\s+\w+.*\{/m.test(code) || /^package\s+\w+$/m.test(code)) return "go";
        if (/\bfn\s+\w+.*->/m.test(code) || /^use\s+\w+::/m.test(code)) return "rust";
        if (/<\?php/i.test(code)) return "php";
        if (/^#!.*\/(ba)?sh/m.test(code)) return "shell";
        if (/<html|<div|<body/i.test(code)) return "html";
        if (/^\s*\{[\s\S]*\}[\s\S]*\{/m.test(code) || /@media|@keyframes/i.test(code)) return "css";
        if (/\bSELECT\b.*\bFROM\b/i.test(code)) return "sql";
        if (/\bpublic\s+class\b/i.test(code)) return "java";
        if (/\binterface\s+\w+\s*\{|:\s*\w+\s*[=;]/m.test(code)) return "typescript";
        return "javascript";
      }

      // 分析代码
      function analyzeCode() {
        const code = document.getElementById("codeInput").value;

        if (!code.trim()) {
          resetStats();
          return;
        }

        const lang = currentLang === "auto" ? autoDetectLanguage(code) : currentLang;
        const config = langConfig[lang] || langConfig.javascript;

        const lines = code.split("\n");
        const stats = {
          total: lines.length,
          code: 0,
          comment: 0,
          blank: 0,
          chars: code.length,
          nonSpaceChars: code.replace(/\s/g, "").length,
          words: (code.match(/\b\w+\b/g) || []).length,
          functions: 0,
          classes: 0,
          imports: 0
        };

        // 统计行
        let inMultiComment = false;
        const lineLengths = [];
        let indentSpaces = 0;

        lines.forEach((line) => {
          const trimmed = line.trim();
          lineLengths.push(line.length);

          // 统计缩进
          const leadingSpaces = line.match(/^\s*/)[0];
          indentSpaces += leadingSpaces.length;

          if (!trimmed) {
            stats.blank++;
            return;
          }

          // 多行注释检测
          if (
            config.multiCommentStart &&
            !inMultiComment &&
            trimmed.includes(config.multiCommentStart)
          ) {
            inMultiComment = true;
            if (
              !trimmed.includes(config.multiCommentEnd) ||
              trimmed.indexOf(config.multiCommentStart) > trimmed.indexOf(config.multiCommentEnd)
            ) {
              stats.comment++;
              return;
            }
          }

          if (inMultiComment) {
            stats.comment++;
            if (config.multiCommentEnd && trimmed.includes(config.multiCommentEnd)) {
              inMultiComment = false;
            }
            return;
          }

          // 单行注释检测
          if (config.singleComment && trimmed.startsWith(config.singleComment)) {
            stats.comment++;
            return;
          }

          stats.code++;
        });

        // 统计函数/类/导入
        if (config.functions) {
          stats.functions = (code.match(config.functions) || []).length;
        }
        if (config.classes) {
          stats.classes = (code.match(config.classes) || []).length;
        }
        if (config.imports) {
          stats.imports = (code.match(config.imports) || []).length;
        }

        // 计算关键字频率
        const keywordCounts = {};
        if (config.keywords) {
          config.keywords.forEach((kw) => {
            const regex = new RegExp("\\b" + kw + "\\b", "gi");
            const count = (code.match(regex) || []).length;
            if (count > 0) {
              keywordCounts[kw] = count;
            }
          });
        }

        // 更新 UI
        updateUI(stats, lineLengths, indentSpaces, keywordCounts);
      }

      // 更新 UI
      window.updateUI = function (stats, lineLengths, indentSpaces, keywordCounts) {
        // 行数
        document.getElementById("totalLines").textContent = stats.total;
        document.getElementById("codeLines").textContent = stats.code;
        document.getElementById("commentLines").textContent = stats.comment;
        document.getElementById("blankLines").textContent = stats.blank;

        // 进度条
        const total = stats.total || 1;
        document.getElementById("codeProgress").style.width = (stats.code / total) * 100 + "%";
        document.getElementById("commentProgress").style.width =
          (stats.comment / total) * 100 + "%";
        document.getElementById("blankProgress").style.width = (stats.blank / total) * 100 + "%";

        // 字符统计
        document.getElementById("totalChars").textContent = stats.chars.toLocaleString();
        document.getElementById("nonSpaceChars").textContent = stats.nonSpaceChars.toLocaleString();
        document.getElementById("wordCount").textContent = stats.words.toLocaleString();
        document.getElementById("avgLineLength").textContent =
          Math.round(lineLengths.reduce((a, b) => a + b, 0) / lineLengths.length) || 0;
        document.getElementById("maxLineLength").textContent = Math.max(...lineLengths) || 0;
        document.getElementById("indentSpaces").textContent = indentSpaces.toLocaleString();

        // 复杂度
        document.getElementById("functionCount").textContent = stats.functions;
        document.getElementById("classCount").textContent = stats.classes;
        document.getElementById("importCount").textContent = stats.imports;

        // 复杂度指标计算
        const complexity = Math.min(
          100,
          stats.functions * 5 + stats.classes * 10 + stats.total / 10
        );
        document.getElementById("complexityIndicator").style.left = complexity + "%";

        // Top 关键字
        const topKeywords = Object.entries(keywordCounts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);

        const keywordsContainer = document.getElementById("topKeywords");
        keywordsContainer.textContent = "";

        if (topKeywords.length === 0) {
          const div = document.createElement("div");
          div.className = "top-item";
          div.innerHTML = "<span>-</span><span>0</span>";
          keywordsContainer.appendChild(div);
        } else {
          topKeywords.forEach(([kw, count]) => {
            const div = document.createElement("div");
            div.className = "top-item";

            const kwSpan = document.createElement("code");
            kwSpan.textContent = kw;

            const countSpan = document.createElement("span");
            countSpan.textContent = count;

            div.appendChild(kwSpan);
            div.appendChild(countSpan);
            keywordsContainer.appendChild(div);
          });
        }
      };

      // 重置统计
      window.resetStats = function () {
        const ids = [
          "totalLines",
          "codeLines",
          "commentLines",
          "blankLines",
          "totalChars",
          "nonSpaceChars",
          "wordCount",
          "avgLineLength",
          "maxLineLength",
          "indentSpaces",
          "functionCount",
          "classCount",
          "importCount"
        ];
        ids.forEach((id) => (document.getElementById(id).textContent = "0"));

        document.getElementById("codeProgress").style.width = "0%";
        document.getElementById("commentProgress").style.width = "0%";
        document.getElementById("blankProgress").style.width = "0%";
        document.getElementById("complexityIndicator").style.left = "0%";

        document.getElementById("topKeywords").innerHTML =
          '<div class="top-item"><span>-</span><span>0</span></div>';
      };

      // 清空
      window.clearCode = function () {
        document.getElementById("codeInput").value = "";
        resetStats();
      };

      // 加载示例
      window.loadSample = function () {
        const sampleCode = `// 示例 JavaScript 代码
import React, { useState, useEffect } from 'react';
import { fetchData } from './api';

/**
 * 用户列表组件
 * @param {Object} props - 组件属性
 */
function UserList({ initialUsers = [] }) {
    const [users, setUsers] = useState(initialUsers);
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);

    // 加载用户数据
    useEffect(() => {
        const loadUsers = async () => {
            setLoading(true);
            try {
                const data = await fetchData('/api/users');
                setUsers(data);
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        loadUsers();
    }, []);

    // 渲染加载状态
    if (loading) {
        return <div className="loading">加载中...</div>;
    }

    // 渲染错误状态
    if (error) {
        return <div className="error">错误: {error}</div>;
    }

    // 渲染用户列表
    return (
        <ul className="user-list">
            {users.map(user => (
                <li key={user.id} className="user-item">
                    <span className="user-name">{user.name}</span>
                    <span className="user-email">{user.email}</span>
                </li>
            ))}
        </ul>
    );
}

export default UserList;`;

        document.getElementById("codeInput").value = sampleCode;
        document.getElementById("languageSelect").value = "javascript";
        currentLang = "javascript";
        analyzeCode();
      };

      // 主题切换
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        html.setAttribute("data-theme", currentTheme === "light" ? "dark" : "light");
        localStorage.setItem("theme", html.getAttribute("data-theme"));
      };
    </script>
  </body>
</html>

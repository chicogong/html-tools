<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒå‰æ ‘å¯è§†åŒ– - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #8b5cf6; --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .main-grid { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text2); }
        input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        input:focus { outline: none; border-color: var(--accent); }
        .btn { padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; width: 100%; margin-bottom: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn:hover { opacity: 0.9; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .canvas-container { background: var(--bg); border-radius: 8px; overflow: hidden; min-height: 400px; }
        canvas { display: block; width: 100%; }
        .traversal-box { padding: 12px; background: var(--bg); border-radius: 8px; margin-top: 12px; font-family: 'Courier New', monospace; min-height: 40px; word-break: break-all; }
        .traversal-title { font-size: 0.85rem; color: var(--text2); margin-bottom: 4px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .info-row:last-child { border-bottom: none; }
        .info-row .label { color: var(--text2); }
        .info-row .value { font-weight: 600; }
        .preset-btns { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .preset-btn { padding: 6px 10px; border: 1px solid var(--border); border-radius: 4px; background: transparent; color: var(--text2); cursor: pointer; font-size: 0.8rem; }
        .preset-btn:hover { border-color: var(--accent); color: var(--text); }
        .highlight { animation: pulse 0.5s ease; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .note { font-size: 0.85rem; color: var(--text2); margin-top: 12px; padding: 12px; background: var(--bg); border-radius: 8px; line-height: 1.6; }
            .back-link { display: inline-block; margin-bottom: 16px; color: var(--accent); text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">â† è¿”å›</a>
        <h1>ğŸŒ³ äºŒå‰æ ‘å¯è§†åŒ–</h1>
        <p class="subtitle">æ’å…¥ã€åˆ é™¤ã€éå†äºŒå‰æœç´¢æ ‘</p>
        
        <div class="main-grid">
            <div>
                <div class="card">
                    <div class="card-title">æ“ä½œ</div>
                    <div class="form-group">
                        <label>è¾“å…¥æ•°å€¼</label>
                        <input type="number" id="valueInput" placeholder="è¾“å…¥ä¸€ä¸ªæ•´æ•°">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="insertNode()">æ’å…¥</button>
                        <button class="btn btn-danger" onclick="deleteNode()">åˆ é™¤</button>
                    </div>
                    <button class="btn btn-warning" onclick="searchNode()">æŸ¥æ‰¾</button>
                    <button class="btn btn-outline" onclick="clearTree()">æ¸…ç©ºæ ‘</button>
                    
                    <div class="card-title" style="margin-top: 20px;">å¿«é€Ÿæ„å»º</div>
                    <div class="preset-btns">
                        <button class="preset-btn" onclick="buildPreset([50,30,70,20,40,60,80])">å¹³è¡¡æ ‘</button>
                        <button class="preset-btn" onclick="buildPreset([10,20,30,40,50])">å³æ–œæ ‘</button>
                        <button class="preset-btn" onclick="buildPreset([50,40,30,20,10])">å·¦æ–œæ ‘</button>
                        <button class="preset-btn" onclick="buildRandom()">éšæœº</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">éå†</div>
                    <button class="btn btn-primary" onclick="traverse('preorder')">å‰åºéå†</button>
                    <button class="btn btn-primary" onclick="traverse('inorder')">ä¸­åºéå†</button>
                    <button class="btn btn-primary" onclick="traverse('postorder')">ååºéå†</button>
                    <button class="btn btn-primary" onclick="traverse('levelorder')">å±‚åºéå†</button>
                    
                    <div class="traversal-box" id="traversalResult">
                        <div class="traversal-title">éå†ç»“æœ</div>
                        <div id="traversalOutput">-</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">æ ‘ä¿¡æ¯</div>
                    <div class="info-row">
                        <span class="label">èŠ‚ç‚¹æ•°</span>
                        <span class="value" id="nodeCount">0</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æ ‘é«˜åº¦</span>
                        <span class="value" id="treeHeight">0</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æœ€å°å€¼</span>
                        <span class="value" id="minValue">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æœ€å¤§å€¼</span>
                        <span class="value" id="maxValue">-</span>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="card">
                    <div class="canvas-container">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">äºŒå‰æœç´¢æ ‘æ€§è´¨</div>
                    <div class="note">
                        <p><strong>äºŒå‰æœç´¢æ ‘ (BST)</strong> æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼š</p>
                        <p>â€¢ å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ &lt; æ ¹èŠ‚ç‚¹çš„å€¼</p>
                        <p>â€¢ å³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ &gt; æ ¹èŠ‚ç‚¹çš„å€¼</p>
                        <p>â€¢ å·¦å³å­æ ‘ä¹Ÿéƒ½æ˜¯äºŒå‰æœç´¢æ ‘</p>
                        <br>
                        <p><strong>éå†æ–¹å¼ï¼š</strong></p>
                        <p>â€¢ å‰åºï¼šæ ¹ â†’ å·¦ â†’ å³</p>
                        <p>â€¢ ä¸­åºï¼šå·¦ â†’ æ ¹ â†’ å³ï¼ˆå‡åºè¾“å‡ºï¼‰</p>
                        <p>â€¢ ååºï¼šå·¦ â†’ å³ â†’ æ ¹</p>
                        <p>â€¢ å±‚åºï¼šé€å±‚ä»å·¦åˆ°å³</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var root = null;
        var highlightedNode = null;
        
        function TreeNode(value) {
            this.value = value;
            this.left = null;
            this.right = null;
        }
        
        function insert(node, value) {
            if (node === null) {
                return new TreeNode(value);
            }
            if (value < node.value) {
                node.left = insert(node.left, value);
            } else if (value > node.value) {
                node.right = insert(node.right, value);
            }
            return node;
        }
        
        function findMin(node) {
            while (node.left !== null) {
                node = node.left;
            }
            return node;
        }
        
        function deleteNodeHelper(node, value) {
            if (node === null) return null;
            
            if (value < node.value) {
                node.left = deleteNodeHelper(node.left, value);
            } else if (value > node.value) {
                node.right = deleteNodeHelper(node.right, value);
            } else {
                if (node.left === null) return node.right;
                if (node.right === null) return node.left;
                
                var minNode = findMin(node.right);
                node.value = minNode.value;
                node.right = deleteNodeHelper(node.right, minNode.value);
            }
            return node;
        }
        
        function search(node, value) {
            if (node === null) return null;
            if (value === node.value) return node;
            if (value < node.value) return search(node.left, value);
            return search(node.right, value);
        }
        
        function getHeight(node) {
            if (node === null) return 0;
            return 1 + Math.max(getHeight(node.left), getHeight(node.right));
        }
        
        function countNodes(node) {
            if (node === null) return 0;
            return 1 + countNodes(node.left) + countNodes(node.right);
        }
        
        function getMin(node) {
            if (node === null) return null;
            while (node.left !== null) node = node.left;
            return node.value;
        }
        
        function getMax(node) {
            if (node === null) return null;
            while (node.right !== null) node = node.right;
            return node.value;
        }
        
        function preorder(node, result) {
            if (node === null) return;
            result.push(node.value);
            preorder(node.left, result);
            preorder(node.right, result);
        }
        
        function inorder(node, result) {
            if (node === null) return;
            inorder(node.left, result);
            result.push(node.value);
            inorder(node.right, result);
        }
        
        function postorder(node, result) {
            if (node === null) return;
            postorder(node.left, result);
            postorder(node.right, result);
            result.push(node.value);
        }
        
        function levelorder(node) {
            if (node === null) return [];
            var result = [];
            var queue = [node];
            while (queue.length > 0) {
                var current = queue.shift();
                result.push(current.value);
                if (current.left) queue.push(current.left);
                if (current.right) queue.push(current.right);
            }
            return result;
        }
        
        function insertNode() {
            var value = parseInt(document.getElementById('valueInput').value);
            if (isNaN(value)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•´æ•°');
                return;
            }
            root = insert(root, value);
            highlightedNode = value;
            draw();
            updateInfo();
            document.getElementById('valueInput').value = '';
            setTimeout(function() { highlightedNode = null; draw(); }, 1000);
        }
        
        function deleteNode() {
            var value = parseInt(document.getElementById('valueInput').value);
            if (isNaN(value)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•´æ•°');
                return;
            }
            root = deleteNodeHelper(root, value);
            draw();
            updateInfo();
            document.getElementById('valueInput').value = '';
        }
        
        function searchNode() {
            var value = parseInt(document.getElementById('valueInput').value);
            if (isNaN(value)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•´æ•°');
                return;
            }
            var found = search(root, value);
            if (found) {
                highlightedNode = value;
                draw();
                setTimeout(function() { highlightedNode = null; draw(); }, 1500);
            } else {
                alert('æœªæ‰¾åˆ°èŠ‚ç‚¹ ' + value);
            }
        }
        
        function clearTree() {
            root = null;
            draw();
            updateInfo();
            document.getElementById('traversalOutput').textContent = '-';
        }
        
        function buildPreset(values) {
            root = null;
            values.forEach(function(v) {
                root = insert(root, v);
            });
            draw();
            updateInfo();
        }
        
        function buildRandom() {
            root = null;
            var count = 7 + Math.floor(Math.random() * 8);
            var values = [];
            while (values.length < count) {
                var v = Math.floor(Math.random() * 100) + 1;
                if (values.indexOf(v) === -1) {
                    values.push(v);
                    root = insert(root, v);
                }
            }
            draw();
            updateInfo();
        }
        
        function traverse(type) {
            var result = [];
            switch (type) {
                case 'preorder':
                    preorder(root, result);
                    break;
                case 'inorder':
                    inorder(root, result);
                    break;
                case 'postorder':
                    postorder(root, result);
                    break;
                case 'levelorder':
                    result = levelorder(root);
                    break;
            }
            document.getElementById('traversalOutput').textContent = result.length > 0 ? result.join(' â†’ ') : '-';
        }
        
        function updateInfo() {
            document.getElementById('nodeCount').textContent = countNodes(root);
            document.getElementById('treeHeight').textContent = getHeight(root);
            var min = getMin(root);
            var max = getMax(root);
            document.getElementById('minValue').textContent = min !== null ? min : '-';
            document.getElementById('maxValue').textContent = max !== null ? max : '-';
        }
        
        function draw() {
            var container = canvas.parentElement;
            var width = container.clientWidth;
            var height = Math.max(400, getHeight(root) * 80 + 100);
            
            canvas.width = width;
            canvas.height = height;
            
            var isDark = window.matchMedia('(prefers-color-scheme: dark)').matches ||
                         getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() === '#0a0a0f';
            
            ctx.fillStyle = isDark ? '#0a0a0f' : '#f5f5f5';
            ctx.fillRect(0, 0, width, height);
            
            if (root === null) {
                ctx.fillStyle = isDark ? '#888' : '#666';
                ctx.font = '16px system-ui';
                ctx.textAlign = 'center';
                ctx.fillText('ç©ºæ ‘ - è¯·æ’å…¥èŠ‚ç‚¹', width / 2, height / 2);
                return;
            }
            
            var nodeRadius = 22;
            var levelHeight = 70;
            
            function drawNode(node, x, y, level, xOffset) {
                if (node === null) return;
                
                var childY = y + levelHeight;
                var childOffset = xOffset / 2;
                
                // Draw edges
                ctx.strokeStyle = isDark ? '#2a2a3a' : '#e0e0e0';
                ctx.lineWidth = 2;
                
                if (node.left) {
                    ctx.beginPath();
                    ctx.moveTo(x, y + nodeRadius);
                    ctx.lineTo(x - childOffset, childY - nodeRadius);
                    ctx.stroke();
                    drawNode(node.left, x - childOffset, childY, level + 1, childOffset);
                }
                
                if (node.right) {
                    ctx.beginPath();
                    ctx.moveTo(x, y + nodeRadius);
                    ctx.lineTo(x + childOffset, childY - nodeRadius);
                    ctx.stroke();
                    drawNode(node.right, x + childOffset, childY, level + 1, childOffset);
                }
                
                // Draw node circle
                var isHighlighted = node.value === highlightedNode;
                
                ctx.beginPath();
                ctx.arc(x, y, nodeRadius, 0, Math.PI * 2);
                
                if (isHighlighted) {
                    ctx.fillStyle = '#22c55e';
                } else {
                    ctx.fillStyle = '#8b5cf6';
                }
                ctx.fill();
                
                ctx.strokeStyle = isHighlighted ? '#16a34a' : '#7c3aed';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Draw value
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px system-ui';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(node.value.toString(), x, y);
            }
            
            var treeHeight = getHeight(root);
            var initialOffset = Math.min(width / 4, Math.pow(2, treeHeight - 1) * 40);
            
            drawNode(root, width / 2, 50, 0, initialOffset);
        }
        
        // Initialize
        buildPreset([50, 30, 70, 20, 40, 60, 80]);
        
        window.addEventListener('resize', function() {
            draw();
        });
        
        document.getElementById('valueInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                insertNode();
            }
        });
    </script>
</body>
</html>

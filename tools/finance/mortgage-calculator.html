<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿è´·è®¡ç®—å™¨ - HTML Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0f; --card: #12121a; --border: #2a2a3a; --text: #fff; --text2: #888; --accent: #6366f1; --accent2: #f59e0b; }
        @media (prefers-color-scheme: light) { :root { --bg: #f5f5f5; --card: #fff; --border: #e0e0e0; --text: #333; --text2: #666; } }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: var(--text2); margin-bottom: 24px; }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); cursor: pointer; text-align: center; }
        .tab.active { background: var(--accent); border-color: var(--accent); color: white; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 1rem; color: var(--text2); margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text2); }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        input:focus { outline: none; border-color: var(--accent); }
        .quick-btns { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        .quick-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--text); cursor: pointer; font-size: 0.8rem; }
        .quick-btn:hover { border-color: var(--accent); }
        .result-hero { background: linear-gradient(135deg, var(--accent), #8b5cf6); padding: 24px; border-radius: 12px; text-align: center; color: white; }
        .result-hero .big { font-size: 2.2rem; font-weight: 700; }
        .result-hero .label { opacity: 0.9; margin-bottom: 4px; font-size: 0.9rem; }
        .result-hero .note { font-size: 0.8rem; opacity: 0.8; margin-top: 8px; }
        .result-row { display: flex; justify-content: space-between; padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
        .result-row .label { color: var(--text2); }
        .result-row .value { font-weight: 600; }
        .chart-container { margin-top: 16px; }
        .pie-chart { width: 180px; height: 180px; margin: 0 auto; }
        .pie-legend { display: flex; justify-content: center; gap: 20px; margin-top: 12px; font-size: 0.85rem; }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 2px; }
        .table-container { max-height: 300px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 8px; text-align: right; border-bottom: 1px solid var(--border); }
        th { background: var(--bg); position: sticky; top: 0; color: var(--text2); }
        td:first-child, th:first-child { text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ  æˆ¿è´·è®¡ç®—å™¨</h1>
        <p class="subtitle">ç­‰é¢æœ¬æ¯ / ç­‰é¢æœ¬é‡‘å¯¹æ¯”è®¡ç®—</p>
        
        <div class="tabs">
            <div class="tab active" data-type="equal-payment" onclick="setType('equal-payment')">ç­‰é¢æœ¬æ¯</div>
            <div class="tab" data-type="equal-principal" onclick="setType('equal-principal')">ç­‰é¢æœ¬é‡‘</div>
            <div class="tab" data-type="compare" onclick="setType('compare')">æ–¹æ¡ˆå¯¹æ¯”</div>
        </div>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">è´·æ¬¾å‚æ•°</div>
                <div class="form-group">
                    <label>è´·æ¬¾æ€»é¢ (ä¸‡å…ƒ)</label>
                    <input type="number" id="principal" value="100" oninput="calculate()">
                    <div class="quick-btns">
                        <button class="quick-btn" onclick="setPrincipal(50)">50ä¸‡</button>
                        <button class="quick-btn" onclick="setPrincipal(100)">100ä¸‡</button>
                        <button class="quick-btn" onclick="setPrincipal(150)">150ä¸‡</button>
                        <button class="quick-btn" onclick="setPrincipal(200)">200ä¸‡</button>
                        <button class="quick-btn" onclick="setPrincipal(300)">300ä¸‡</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>è´·æ¬¾å¹´é™ (å¹´)</label>
                    <input type="number" id="years" value="30" oninput="calculate()">
                    <div class="quick-btns">
                        <button class="quick-btn" onclick="setYears(10)">10å¹´</button>
                        <button class="quick-btn" onclick="setYears(15)">15å¹´</button>
                        <button class="quick-btn" onclick="setYears(20)">20å¹´</button>
                        <button class="quick-btn" onclick="setYears(25)">25å¹´</button>
                        <button class="quick-btn" onclick="setYears(30)">30å¹´</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>å¹´åˆ©ç‡ (%)</label>
                    <input type="number" id="rate" value="3.1" step="0.01" oninput="calculate()">
                    <div class="quick-btns">
                        <button class="quick-btn" onclick="setRate(2.85)">é¦–å¥—2.85%</button>
                        <button class="quick-btn" onclick="setRate(3.1)">åŸºå‡†3.1%</button>
                        <button class="quick-btn" onclick="setRate(3.55)">äºŒå¥—3.55%</button>
                        <button class="quick-btn" onclick="setRate(4.2)">å…¬ç§¯é‡‘4.2%</button>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="result-hero">
                    <div class="label">æœˆä¾›</div>
                    <div class="big" id="monthlyPayment">Â¥0</div>
                    <div class="note" id="paymentNote"></div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <div class="card-title">è¿˜æ¬¾æ±‡æ€»</div>
                    <div class="result-row">
                        <span class="label">è´·æ¬¾æ€»é¢</span>
                        <span class="value" id="totalPrincipal">Â¥0</span>
                    </div>
                    <div class="result-row">
                        <span class="label">è¿˜æ¬¾æ€»é¢</span>
                        <span class="value" id="totalPayment">Â¥0</span>
                    </div>
                    <div class="result-row">
                        <span class="label">æ”¯ä»˜åˆ©æ¯</span>
                        <span class="value" id="totalInterest">Â¥0</span>
                    </div>
                    <div class="result-row">
                        <span class="label">åˆ©æ¯å æ¯”</span>
                        <span class="value" id="interestRatio">0%</span>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="pieChart" class="pie-chart"></canvas>
                        <div class="pie-legend">
                            <div class="legend-item"><div class="legend-dot" style="background: var(--accent)"></div>æœ¬é‡‘</div>
                            <div class="legend-item"><div class="legend-dot" style="background: var(--accent2)"></div>åˆ©æ¯</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="compareCard" style="display: none;">
            <div class="card-title">ä¸¤ç§è¿˜æ¬¾æ–¹å¼å¯¹æ¯”</div>
            <div class="grid">
                <div class="result-row">
                    <span class="label">ç­‰é¢æœ¬æ¯æœˆä¾›</span>
                    <span class="value" id="ep_monthly">Â¥0</span>
                </div>
                <div class="result-row">
                    <span class="label">ç­‰é¢æœ¬é‡‘é¦–æœˆ</span>
                    <span class="value" id="epp_monthly">Â¥0</span>
                </div>
                <div class="result-row">
                    <span class="label">ç­‰é¢æœ¬æ¯æ€»åˆ©æ¯</span>
                    <span class="value" id="ep_interest">Â¥0</span>
                </div>
                <div class="result-row">
                    <span class="label">ç­‰é¢æœ¬é‡‘æ€»åˆ©æ¯</span>
                    <span class="value" id="epp_interest">Â¥0</span>
                </div>
            </div>
            <div class="result-row" style="margin-top: 16px; background: rgba(16, 185, 129, 0.1);">
                <span class="label">ç­‰é¢æœ¬é‡‘å¯èŠ‚çœåˆ©æ¯</span>
                <span class="value" style="color: #10b981;" id="interestSaved">Â¥0</span>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">è¿˜æ¬¾è®¡åˆ’ï¼ˆå‰12æœŸï¼‰</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>æœŸæ•°</th>
                            <th>æœˆä¾›</th>
                            <th>æœ¬é‡‘</th>
                            <th>åˆ©æ¯</th>
                            <th>å‰©ä½™æœ¬é‡‘</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        let loanType = 'equal-payment';
        
        function setType(type) {
            loanType = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector('[data-type="' + type + '"]').classList.add('active');
            document.getElementById('compareCard').style.display = type === 'compare' ? 'block' : 'none';
            calculate();
        }
        
        function setPrincipal(v) { document.getElementById('principal').value = v; calculate(); }
        function setYears(v) { document.getElementById('years').value = v; calculate(); }
        function setRate(v) { document.getElementById('rate').value = v; calculate(); }
        
        function calculate() {
            const P = parseFloat(document.getElementById('principal').value) * 10000 || 0;
            const years = parseInt(document.getElementById('years').value) || 0;
            const annualRate = parseFloat(document.getElementById('rate').value) / 100 || 0;
            const n = years * 12;
            const r = annualRate / 12;
            
            let monthlyPayment, totalPayment, totalInterest;
            const schedule = [];
            
            if (loanType === 'equal-payment' || loanType === 'compare') {
                // ç­‰é¢æœ¬æ¯
                if (r > 0) {
                    monthlyPayment = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
                } else {
                    monthlyPayment = P / n;
                }
                totalPayment = monthlyPayment * n;
                totalInterest = totalPayment - P;
                
                let remaining = P;
                for (let i = 1; i <= Math.min(n, 12); i++) {
                    const interest = remaining * r;
                    const principal = monthlyPayment - interest;
                    remaining -= principal;
                    schedule.push({ period: i, payment: monthlyPayment, principal: principal, interest: interest, remaining: Math.max(0, remaining) });
                }
            }
            
            if (loanType === 'equal-principal') {
                // ç­‰é¢æœ¬é‡‘
                const monthlyPrincipal = P / n;
                let remaining = P;
                totalInterest = 0;
                
                for (let i = 1; i <= n; i++) {
                    const interest = remaining * r;
                    const payment = monthlyPrincipal + interest;
                    remaining -= monthlyPrincipal;
                    totalInterest += interest;
                    if (i <= 12) {
                        schedule.push({ period: i, payment: payment, principal: monthlyPrincipal, interest: interest, remaining: Math.max(0, remaining) });
                    }
                }
                
                monthlyPayment = schedule[0]?.payment || 0;
                totalPayment = P + totalInterest;
            }
            
            const fmt = (v) => 'Â¥' + v.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            document.getElementById('monthlyPayment').textContent = fmt(monthlyPayment);
            document.getElementById('paymentNote').textContent = loanType === 'equal-principal' ? 'é¦–æœˆæœˆä¾›ï¼ˆé€æœˆé€’å‡ï¼‰' : 'æ¯æœˆå›ºå®šè¿˜æ¬¾';
            document.getElementById('totalPrincipal').textContent = fmt(P);
            document.getElementById('totalPayment').textContent = fmt(totalPayment);
            document.getElementById('totalInterest').textContent = fmt(totalInterest);
            document.getElementById('interestRatio').textContent = ((totalInterest / totalPayment) * 100).toFixed(1) + '%';
            
            // ç»˜åˆ¶é¥¼å›¾
            drawPieChart(P, totalInterest);
            
            // æ›´æ–°è¡¨æ ¼
            const tbody = document.getElementById('scheduleBody');
            tbody.textContent = '';
            schedule.forEach(s => {
                const tr = document.createElement('tr');
                [
                    'ç¬¬' + s.period + 'æœŸ',
                    fmt(s.payment),
                    fmt(s.principal),
                    fmt(s.interest),
                    fmt(s.remaining)
                ].forEach(text => {
                    const td = document.createElement('td');
                    td.textContent = text;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            
            // å¯¹æ¯”æ¨¡å¼
            if (loanType === 'compare') {
                const epMonthly = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
                const epInterest = epMonthly * n - P;
                
                const eppMonthlyPrincipal = P / n;
                let eppInterest = 0;
                let remaining = P;
                for (let i = 1; i <= n; i++) {
                    eppInterest += remaining * r;
                    remaining -= eppMonthlyPrincipal;
                }
                const eppFirstMonth = eppMonthlyPrincipal + P * r;
                
                document.getElementById('ep_monthly').textContent = fmt(epMonthly);
                document.getElementById('epp_monthly').textContent = fmt(eppFirstMonth);
                document.getElementById('ep_interest').textContent = fmt(epInterest);
                document.getElementById('epp_interest').textContent = fmt(eppInterest);
                document.getElementById('interestSaved').textContent = fmt(epInterest - eppInterest);
            }
        }
        
        function drawPieChart(principal, interest) {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const total = principal + interest;
            const principalAngle = (principal / total) * Math.PI * 2;
            
            canvas.width = 180;
            canvas.height = 180;
            const cx = 90, cy = 90, radius = 70;
            
            ctx.clearRect(0, 0, 180, 180);
            
            // Principal
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, -Math.PI / 2, -Math.PI / 2 + principalAngle);
            ctx.closePath();
            ctx.fillStyle = '#6366f1';
            ctx.fill();
            
            // Interest
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, -Math.PI / 2 + principalAngle, -Math.PI / 2 + Math.PI * 2);
            ctx.closePath();
            ctx.fillStyle = '#f59e0b';
            ctx.fill();
            
            // Center hole
            ctx.beginPath();
            ctx.arc(cx, cy, 35, 0, Math.PI * 2);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--card').trim();
            ctx.fill();
        }
        
        calculate();
    </script>
</body>
</html>

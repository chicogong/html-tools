<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–‡å­—è½¬è¯­éŸ³ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="æ–‡å­—è½¬è¯­éŸ³ - WebUtils" />
    <meta name="keywords" content="text-to-speech,media,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/media/text-to-speech.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="æ–‡å­—è½¬è¯­éŸ³ - WebUtils" />
    <meta property="og:description" content="æ–‡å­—è½¬è¯­éŸ³ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/media/text-to-speech.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="æ–‡å­—è½¬è¯­éŸ³ - WebUtils" />
    <meta name="twitter:description" content="æ–‡å­—è½¬è¯­éŸ³ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <meta
      name="description"
      content="ä½¿ç”¨ Web Speech API å°†æ–‡å­—è½¬æ¢ä¸ºè¯­éŸ³ï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œå£°éŸ³é€‰æ‹©"
    />
    <meta name="keywords" content="æ–‡å­—è½¬è¯­éŸ³,TTS,è¯­éŸ³åˆæˆ,Web Speech API" />
    <link rel="canonical" href="https://html-tools.cnb.cool/tools/media/text-to-speech.html" />
    <style>
      :root {
        --color-bg-deep: #0a0a0f;
        --color-bg-surface: #12121a;
        --color-bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --color-text-primary: #e8e8ed;
        --color-text-secondary: #8888a0;
        --color-text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --color-accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --color-accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      
  /* å­—ä½“å˜é‡ */
  --font-sans: 'Space Grotesk', -apple-system, blinkmacsystemfont, 'Segoe UI', roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;
}

      [data-theme="light"] {
        --color-bg-deep: #fafafa;
        --color-bg-surface: #fff;
        --color-bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --color-text-primary: #1a1a1a;
        --color-text-secondary: #666;
        --color-text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --bg-color: var(--color-bg-card);
        --text-color: #333;
        --border-color: #ddd;
        --card-bg: #fff;
        --primary-color: #9c27b0;
        --primary-hover: #7b1fa2;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        --success-color: #4caf50;
        --warning-color: #ff9800;
        --error-color: #f44336;
      }
      [data-theme="dark"] {
        --bg-color: var(--color-text-primary);
        --text-color: #e0e0e0;
        --border-color: #444;
        --card-bg: #2d2d2d;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: var(--font-sans);
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        padding: 20px;
        transition: all 0.3s ease;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        margin-bottom: 30px;
      }
      h1 {
        font-size: 1.8rem;
        margin-bottom: 10px;
        color: var(--primary-color);
      }
      .subtitle {
        color: var(--text-color);
        opacity: 0.7;
        font-size: 0.95rem;
      }
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        background: var(--card-bg);
        color: var(--text-color);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }
      .theme-toggle:hover {
        border-color: var(--primary-color);
      }
      .card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: var(--shadow);
        margin-bottom: 20px;
      }
      .card-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 16px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }
      textarea {
        width: 100%;
        height: 200px;
        padding: 16px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        font-family: inherit;
        resize: vertical;
        background: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
      }
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
      }
      .char-count {
        text-align: right;
        font-size: 12px;
        color: var(--text-color);
        opacity: 0.6;
        margin-top: 8px;
      }
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }
      .setting-item label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 500;
      }
      select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 14px;
        background: var(--bg-color);
        color: var(--text-color);
        cursor: pointer;
      }
      select:focus {
        outline: none;
        border-color: var(--primary-color);
      }
      .slider-item label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 500;
      }
      .slider-value {
        font-weight: normal;
        color: var(--primary-color);
      }
      input[type="range"] {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: var(--border-color);
        outline: none;
        -webkit-appearance: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: transform 0.2s;
      }
      input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }
      .controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }
      .btn {
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn-primary {
        background: var(--primary-color);
        color: white;
      }
      .btn-primary:hover:not(:disabled) {
        background: var(--primary-hover);
      }
      .btn-secondary {
        background: var(--border-color);
        color: var(--text-color);
      }
      .btn-secondary:hover:not(:disabled) {
        background: var(--text-color);
        color: var(--card-bg);
      }
      .btn-danger {
        background: var(--error-color);
        color: white;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .status {
        text-align: center;
        margin-top: 20px;
        padding: 16px;
        border-radius: 8px;
        font-size: 14px;
        display: none;
      }
      .status.show {
        display: block;
      }
      .status.speaking {
        background: rgba(156, 39, 176, 0.1);
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }
      .status.paused {
        background: rgba(255, 152, 0, 0.1);
        color: var(--warning-color);
        border: 1px solid var(--warning-color);
      }
      .status.error {
        background: rgba(244, 67, 54, 0.1);
        color: var(--error-color);
        border: 1px solid var(--error-color);
      }
      .progress-bar {
        width: 100%;
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        margin-top: 12px;
        overflow: hidden;
        display: none;
      }
      .progress-bar.show {
        display: block;
      }
      .progress-fill {
        height: 100%;
        background: var(--primary-color);
        border-radius: 2px;
        transition: width 0.3s;
        width: 0%;
      }
      .voice-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--border-color);
      }
      .voice-info-item {
        font-size: 13px;
      }
      .voice-info-item span {
        color: var(--text-color);
        opacity: 0.6;
      }
      .sample-texts {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }
      .sample-btn {
        padding: 6px 14px;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        background: transparent;
        color: var(--text-color);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .sample-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }
      .tips {
        font-size: 13px;
        color: var(--text-color);
        opacity: 0.7;
        line-height: 1.8;
      }
      .tips li {
        margin-bottom: 6px;
      }
      .not-supported {
        text-align: center;
        padding: 40px;
        color: var(--error-color);
      }
      @media (max-width: 600px) {
        .controls {
          flex-direction: column;
        }
        .btn {
          width: 100%;
          justify-content: center;
        }
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
    <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      æ–‡å­—è½¬è¯­éŸ³
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="ğŸŒ“ ä¸»é¢˜">ğŸŒ“ ä¸»é¢˜</button>

    <div class="container">
      <header>
        <h1>ğŸ”Š æ–‡å­—è½¬è¯­éŸ³</h1>
        <p class="subtitle">ä½¿ç”¨ Web Speech API å°†æ–‡å­—è½¬æ¢ä¸ºè¯­éŸ³æœ—è¯»</p>
      </header>

      <div id="app">
        <div class="card">
          <div class="card-title">è¾“å…¥æ–‡æœ¬</div>
          <div class="sample-texts">
            <button class="sample-btn" onclick="setSampleText('chinese')" aria-label="ä¸­æ–‡ç¤ºä¾‹">
              ä¸­æ–‡ç¤ºä¾‹
            </button>
            <button class="sample-btn" onclick="setSampleText('english')" aria-label="English">
              English
            </button>
            <button class="sample-btn" onclick="setSampleText('poem')" aria-label="å¤è¯—è¯">
              å¤è¯—è¯
            </button>
            <button class="sample-btn" onclick="setSampleText('news')" aria-label="æ–°é—»æ’­æŠ¥">
              æ–°é—»æ’­æŠ¥
            </button>
          </div>
          <textarea id="textInput" placeholder="è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡å­—..."></textarea>
          <div class="char-count">
            <span id="charCount">0</span>
            å­—ç¬¦
          </div>
        </div>

        <div class="card">
          <div class="card-title">è¯­éŸ³è®¾ç½®</div>
          <div class="settings-grid">
            <div class="setting-item">
              <label for="voiceSelect">é€‰æ‹©å£°éŸ³</label>
              <select id="voiceSelect">
                <option value="">åŠ è½½å£°éŸ³åˆ—è¡¨...</option>
              </select>
            </div>
            <div class="setting-item">
              <label for="langSelect">è¯­è¨€ç­›é€‰</label>
              <select id="langSelect">
                <option value="">å…¨éƒ¨è¯­è¨€</option>
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">è‹±æ–‡</option>
                <option value="ja">æ—¥æ–‡</option>
                <option value="ko">éŸ©æ–‡</option>
                <option value="de">å¾·æ–‡</option>
                <option value="fr">æ³•æ–‡</option>
                <option value="es">è¥¿ç­ç‰™æ–‡</option>
              </select>
            </div>
          </div>
          <div class="settings-grid">
            <div class="slider-item">
              <label>
                è¯­é€Ÿ
                <span class="slider-value" id="rateValue">1.0x</span>
              </label>
              <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1" />
            </div>
            <div class="slider-item">
              <label>
                éŸ³è°ƒ
                <span class="slider-value" id="pitchValue">1.0</span>
              </label>
              <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1" />
            </div>
            <div class="slider-item">
              <label>
                éŸ³é‡
                <span class="slider-value" id="volumeValue">100%</span>
              </label>
              <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" />
            </div>
          </div>
          <div class="voice-info" id="voiceInfo" style="display: none">
            <div class="voice-info-item">
              <span>å£°éŸ³åç§°:</span>
              <span id="infoName">-</span>
            </div>
            <div class="voice-info-item">
              <span>è¯­è¨€:</span>
              <span id="infoLang">-</span>
            </div>
            <div class="voice-info-item">
              <span>ç±»å‹:</span>
              <span id="infoType">-</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="controls">
            <button
              class="btn btn-primary"
              id="speakBtn"
              onclick="speak()"
              aria-label="â–¶ï¸ å¼€å§‹æœ—è¯»"
            >
              â–¶ï¸ å¼€å§‹æœ—è¯»
            </button>
            <button class="btn btn-secondary" id="pauseBtn" onclick="togglePause()" disabled>
              â¸ï¸ æš‚åœ
            </button>
            <button
              class="btn btn-danger"
              id="stopBtn"
              onclick="stop()"
              disabled
              aria-label="â¹ï¸ åœæ­¢"
            >
              â¹ï¸ åœæ­¢
            </button>
          </div>
          <div class="status" id="status"></div>
          <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ä½¿ç”¨æç¤º</div>
          <ul class="tips">
            <li>æœ¬å·¥å…·ä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„ Web Speech APIï¼Œæ— éœ€ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨</li>
            <li>ä¸åŒæµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿæ”¯æŒçš„å£°éŸ³åˆ—è¡¨å¯èƒ½ä¸åŒ</li>
            <li>éƒ¨åˆ†å£°éŸ³å¯èƒ½éœ€è¦è”ç½‘æ‰èƒ½ä½¿ç”¨ï¼ˆæ ‡è®°ä¸ºéæœ¬åœ°ï¼‰</li>
            <li>é•¿æ–‡æœ¬æœ—è¯»æ—¶ï¼Œå»ºè®®é€‚å½“é™ä½è¯­é€Ÿä»¥è·å¾—æ›´å¥½çš„æ•ˆæœ</li>
            <li>å¦‚æœæ²¡æœ‰å£°éŸ³ï¼Œè¯·æ£€æŸ¥ç³»ç»ŸéŸ³é‡å’Œæµè§ˆå™¨æƒé™è®¾ç½®</li>
          </ul>
        </div>
      </div>

      <div class="not-supported" id="notSupported" style="display: none">
        <h2>ğŸ˜” æµè§ˆå™¨ä¸æ”¯æŒ</h2>
        <p>æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API</p>
        <p>è¯·å°è¯•ä½¿ç”¨ Chromeã€Edgeã€Safari ç­‰ç°ä»£æµè§ˆå™¨</p>
      </div>
    </div>

    <script>
      // Theme toggle
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      };

      // Initialize theme
      (function () {
        const savedTheme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", savedTheme);
      })();

      // Check browser support
      if (!("speechSynthesis" in window)) {
        document.getElementById("app").style.display = "none";
        document.getElementById("notSupported").style.display = "block";
      }

      const synth = window.speechSynthesis;
      let voices = [];
      let currentUtterance = null;
      let isPaused = false;

      const textInput = document.getElementById("textInput");
      const voiceSelect = document.getElementById("voiceSelect");
      const langSelect = document.getElementById("langSelect");
      const rateSlider = document.getElementById("rateSlider");
      const pitchSlider = document.getElementById("pitchSlider");
      const volumeSlider = document.getElementById("volumeSlider");
      const speakBtn = document.getElementById("speakBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const stopBtn = document.getElementById("stopBtn");
      const status = document.getElementById("status");
      const progressBar = document.getElementById("progressBar");
      const progressFill = document.getElementById("progressFill");

      // Sample texts
      const sampleTexts = {
        chinese:
          "æ¬¢è¿ä½¿ç”¨æ–‡å­—è½¬è¯­éŸ³å·¥å…·ï¼è¿™æ˜¯ä¸€ä¸ªåŸºäº Web Speech API çš„åœ¨çº¿è¯­éŸ³åˆæˆå·¥å…·ï¼Œå¯ä»¥å°†æ‚¨è¾“å…¥çš„æ–‡å­—è½¬æ¢ä¸ºè¯­éŸ³æœ—è¯»ã€‚æ‚¨å¯ä»¥è°ƒæ•´è¯­é€Ÿã€éŸ³è°ƒå’ŒéŸ³é‡ï¼Œé€‰æ‹©ä¸åŒçš„å£°éŸ³æ¥è·å¾—æœ€ä½³çš„æœ—è¯»æ•ˆæœã€‚",
        english:
          "Welcome to the Text-to-Speech tool! This is an online speech synthesis tool based on the Web Speech API. You can adjust the rate, pitch, and volume, and select different voices to get the best reading experience.",
        poem: "é™å¤œæ€\n\nåºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚\nä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚\n\nâ€”â€”æç™½",
        news: "å„ä½è§‚ä¼—æœ‹å‹ä»¬ï¼Œå¤§å®¶å¥½ï¼æ¬¢è¿æ”¶çœ‹ä»Šå¤©çš„æ–°é—»èŠ‚ç›®ã€‚ä»Šå¤©æˆ‘ä»¬å°†ä¸ºæ‚¨å¸¦æ¥æœ€æ–°çš„ç§‘æŠ€èµ„è®¯å’Œè¡Œä¸šåŠ¨æ€ï¼Œè¯·æ‚¨ç»§ç»­å…³æ³¨ã€‚"
      };

      window.setSampleText = function (type) {
        textInput.value = sampleTexts[type] || "";
        updateCharCount();
      };

      // Character count
      function updateCharCount() {
        document.getElementById("charCount").textContent = textInput.value.length;
      }
      textInput.addEventListener("input", updateCharCount);

      // Load voices
      function loadVoices() {
        voices = synth.getVoices();
        if (voices.length === 0) return;

        filterAndPopulateVoices();
      }

      function filterAndPopulateVoices() {
        const langFilter = langSelect.value;
        let filteredVoices = voices;

        if (langFilter) {
          filteredVoices = voices.filter((v) => v.lang.startsWith(langFilter));
        }

        voiceSelect.innerHTML = "";

        if (filteredVoices.length === 0) {
          voiceSelect.innerHTML = '<option value="">æ— å¯ç”¨å£°éŸ³</option>';
          return;
        }

        // Group by language
        const grouped = {};
        filteredVoices.forEach((voice, index) => {
          const lang = voice.lang.split("-")[0];
          if (!grouped[lang]) grouped[lang] = [];
          grouped[lang].push({ voice, index: voices.indexOf(voice) });
        });

        Object.keys(grouped)
          .sort()
          .forEach((lang) => {
            const group = document.createElement("optgroup");
            group.label = getLanguageName(lang);

            grouped[lang].forEach(({ voice, index }) => {
              const option = document.createElement("option");
              option.value = index;
              option.textContent = `${voice.name} (${voice.lang})${voice.localService ? "" : " â˜ï¸"}`;
              if (voice.default) option.textContent += " â˜…";
              group.appendChild(option);
            });

            voiceSelect.appendChild(group);
          });

        // Select default voice
        const defaultVoice = filteredVoices.find((v) => v.default) || filteredVoices[0];
        if (defaultVoice) {
          voiceSelect.value = voices.indexOf(defaultVoice);
          updateVoiceInfo();
        }
      }

      function getLanguageName(code) {
        const names = {
          zh: "ä¸­æ–‡",
          en: "è‹±æ–‡",
          ja: "æ—¥æ–‡",
          ko: "éŸ©æ–‡",
          de: "å¾·æ–‡",
          fr: "æ³•æ–‡",
          es: "è¥¿ç­ç‰™æ–‡",
          it: "æ„å¤§åˆ©æ–‡",
          pt: "è‘¡è„ç‰™æ–‡",
          ru: "ä¿„æ–‡",
          ar: "é˜¿æ‹‰ä¼¯æ–‡",
          hi: "å°åœ°æ–‡",
          nl: "è·å…°æ–‡",
          pl: "æ³¢å…°æ–‡",
          sv: "ç‘å…¸æ–‡",
          tr: "åœŸè€³å…¶æ–‡"
        };
        return names[code] || code.toUpperCase();
      }

      function updateVoiceInfo() {
        const voiceIndex = voiceSelect.value;
        const voiceInfo = document.getElementById("voiceInfo");

        if (voiceIndex === "" || !voices[voiceIndex]) {
          voiceInfo.style.display = "none";
          return;
        }

        const voice = voices[voiceIndex];
        document.getElementById("infoName").textContent = voice.name;
        document.getElementById("infoLang").textContent = voice.lang;
        document.getElementById("infoType").textContent = voice.localService ? "æœ¬åœ°" : "åœ¨çº¿";
        voiceInfo.style.display = "grid";
      }

      langSelect.addEventListener("change", filterAndPopulateVoices);
      voiceSelect.addEventListener("change", updateVoiceInfo);

      // Load voices when ready
      if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = loadVoices;
      }
      loadVoices();

      // Slider updates
      rateSlider.addEventListener("input", () => {
        document.getElementById("rateValue").textContent = rateSlider.value + "x";
      });
      pitchSlider.addEventListener("input", () => {
        document.getElementById("pitchValue").textContent = pitchSlider.value;
      });
      volumeSlider.addEventListener("input", () => {
        document.getElementById("volumeValue").textContent =
          Math.round(volumeSlider.value * 100) + "%";
      });

      // Speech functions
      window.speak = function () {
        const text = textInput.value.trim();
        if (!text) {
          showStatus("è¯·è¾“å…¥è¦æœ—è¯»çš„æ–‡å­—", "error");
          return;
        }

        // Stop any current speech
        synth.cancel();

        currentUtterance = new SpeechSynthesisUtterance(text);

        const voiceIndex = voiceSelect.value;
        if (voiceIndex !== "" && voices[voiceIndex]) {
          currentUtterance.voice = voices[voiceIndex];
        }

        currentUtterance.rate = parseFloat(rateSlider.value);
        currentUtterance.pitch = parseFloat(pitchSlider.value);
        currentUtterance.volume = parseFloat(volumeSlider.value);

        currentUtterance.onstart = () => {
          showStatus("æ­£åœ¨æœ—è¯»...", "speaking");
          progressBar.classList.add("show");
          updateButtons("speaking");
          isPaused = false;
        };

        currentUtterance.onend = () => {
          showStatus("", "");
          progressBar.classList.remove("show");
          progressFill.style.width = "0%";
          updateButtons("idle");
          currentUtterance = null;
        };

        currentUtterance.onerror = (event) => {
          if (event.error !== "canceled") {
            showStatus("æœ—è¯»å‡ºé”™: " + event.error, "error");
          }
          progressBar.classList.remove("show");
          updateButtons("idle");
          currentUtterance = null;
        };

        // Progress simulation (Speech API doesn't provide real progress)
        let progress = 0;
        const totalTime = (text.length * 100) / parseFloat(rateSlider.value);
        const interval = setInterval(() => {
          if (!currentUtterance || synth.paused) return;
          progress += 100;
          const percent = Math.min((progress / totalTime) * 100, 95);
          progressFill.style.width = percent + "%";
          if (percent >= 95) clearInterval(interval);
        }, 100);

        currentUtterance.onend = () => {
          clearInterval(interval);
          showStatus("", "");
          progressBar.classList.remove("show");
          progressFill.style.width = "0%";
          updateButtons("idle");
          currentUtterance = null;
        };

        synth.speak(currentUtterance);
      };

      window.togglePause = function () {
        if (synth.paused) {
          synth.resume();
          showStatus("æ­£åœ¨æœ—è¯»...", "speaking");
          pauseBtn.innerHTML = "â¸ï¸ æš‚åœ";
          isPaused = false;
        } else {
          synth.pause();
          showStatus("å·²æš‚åœ", "paused");
          pauseBtn.innerHTML = "â–¶ï¸ ç»§ç»­";
          isPaused = true;
        }
      };

      window.stop = function () {
        synth.cancel();
        showStatus("", "");
        progressBar.classList.remove("show");
        progressFill.style.width = "0%";
        updateButtons("idle");
        currentUtterance = null;
        isPaused = false;
      };

      function updateButtons(state) {
        switch (state) {
          case "speaking":
            speakBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
            pauseBtn.innerHTML = "â¸ï¸ æš‚åœ";
            break;
          case "idle":
          default:
            speakBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            pauseBtn.innerHTML = "â¸ï¸ æš‚åœ";
            break;
        }
      }

      function showStatus(message, type) {
        if (!message) {
          status.classList.remove("show");
          return;
        }
        status.textContent = message;
        status.className = "status show " + type;
      }

      // Clean up on page unload
      window.addEventListener("beforeunload", () => {
        synth.cancel();
      });
    </script>
  </body>
</html>

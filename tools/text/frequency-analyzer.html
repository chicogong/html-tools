<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬é¢‘ç‡åˆ†æå™¨ | HTML Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { padding: 1rem; }
        .container { max-width: 1200px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        header h1 { margin: 0; font-size: 1.5rem; }
        textarea { font-family: inherit; min-height: 150px; resize: vertical; }
        .controls { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; align-items: center; }
        .controls label { display: flex; align-items: center; gap: 0.5rem; margin: 0; }
        .controls select, .controls input[type="number"] { width: auto; margin: 0; padding: 0.5rem; }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .tabs button { padding: 0.5rem 1rem; border-radius: 4px; }
        .tabs button.active { background: var(--pico-primary); color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--pico-card-background-color); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--pico-muted-border-color); }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--pico-primary); }
        .stat-label { font-size: 0.85rem; color: var(--pico-muted-color); }
        .result-section { margin-top: 1.5rem; }
        .result-section h3 { margin-bottom: 0.5rem; font-size: 1rem; }
        .freq-table { width: 100%; border-collapse: collapse; }
        .freq-table th, .freq-table td { padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--pico-muted-border-color); }
        .freq-table th { background: var(--pico-card-background-color); font-weight: 600; }
        .freq-bar { height: 20px; background: var(--pico-primary); border-radius: 2px; min-width: 2px; }
        .freq-bar-container { width: 150px; background: var(--pico-muted-border-color); border-radius: 2px; }
        .char-display { font-family: monospace; font-size: 1.1rem; padding: 0.25rem 0.5rem; background: var(--pico-card-background-color); border-radius: 4px; }
        .word-cloud { display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 1rem; background: var(--pico-card-background-color); border-radius: 8px; min-height: 100px; align-items: center; justify-content: center; }
        .word-cloud span { padding: 0.25rem 0.5rem; border-radius: 4px; background: var(--pico-primary-background); cursor: default; transition: transform 0.2s; }
        .word-cloud span:hover { transform: scale(1.1); }
        .ngram-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .ngram-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--pico-card-background-color); border-radius: 4px; }
        .ngram-text { font-family: monospace; }
        .ngram-count { font-size: 0.8rem; color: var(--pico-muted-color); }
        .export-btn { padding: 0.5rem 1rem; font-size: 0.85rem; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <main class="container">
        <header>
            <h1>ğŸ“Š æ–‡æœ¬é¢‘ç‡åˆ†æå™¨</h1>
            <button id="themeToggle" class="outline" style="padding: 0.5rem;">ğŸŒ“</button>
        </header>

        <textarea id="textInput" placeholder="è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬...">æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿã€‚å¤œæ¥é£é›¨å£°ï¼ŒèŠ±è½çŸ¥å¤šå°‘ã€‚

The quick brown fox jumps over the lazy dog. The dog was not amused by the fox's antics. Foxes are known for their cunning nature.</textarea>

        <div class="controls">
            <label>
                åˆ†ææ¨¡å¼ï¼š
                <select id="modeSelect">
                    <option value="char">å­—ç¬¦é¢‘ç‡</option>
                    <option value="word">è¯é¢‘åˆ†æ</option>
                    <option value="ngram">N-gram åˆ†æ</option>
                </select>
            </label>
            <label id="ngramSizeLabel">
                N å€¼ï¼š
                <input type="number" id="ngramSize" value="2" min="2" max="5" style="width: 70px;">
            </label>
            <label>
                <input type="checkbox" id="ignoreCase" checked>
                å¿½ç•¥å¤§å°å†™
            </label>
            <label>
                <input type="checkbox" id="ignoreSpaces" checked>
                å¿½ç•¥ç©ºç™½
            </label>
            <label>
                <input type="checkbox" id="ignorePunct">
                å¿½ç•¥æ ‡ç‚¹
            </label>
            <button onclick="analyze()">åˆ†æ</button>
            <button class="outline export-btn" onclick="exportCSV()">å¯¼å‡º CSV</button>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalChars">0</div>
                <div class="stat-label">æ€»å­—ç¬¦æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueItems">0</div>
                <div class="stat-label">å”¯ä¸€é¡¹æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="entropy">0</div>
                <div class="stat-label">ä¿¡æ¯ç†µ (bits)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topItem">-</div>
                <div class="stat-label">æœ€é«˜é¢‘é¡¹</div>
            </div>
        </div>

        <div class="tabs">
            <button class="active" onclick="showView('table')">è¡¨æ ¼è§†å›¾</button>
            <button onclick="showView('chart')">å›¾è¡¨è§†å›¾</button>
            <button onclick="showView('cloud')">è¯äº‘è§†å›¾</button>
        </div>

        <div id="tableView" class="result-section">
            <table class="freq-table">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>å†…å®¹</th>
                        <th>é¢‘æ¬¡</th>
                        <th>å æ¯”</th>
                        <th>åˆ†å¸ƒ</th>
                    </tr>
                </thead>
                <tbody id="freqTableBody"></tbody>
            </table>
        </div>

        <div id="chartView" class="result-section hidden">
            <canvas id="freqChart" height="300"></canvas>
        </div>

        <div id="cloudView" class="result-section hidden">
            <div class="word-cloud" id="wordCloud"></div>
        </div>
    </main>

    <script>
        let currentData = [];
        let currentMode = 'char';

        function analyze() {
            const text = document.getElementById('textInput').value;
            const mode = document.getElementById('modeSelect').value;
            const ignoreCase = document.getElementById('ignoreCase').checked;
            const ignoreSpaces = document.getElementById('ignoreSpaces').checked;
            const ignorePunct = document.getElementById('ignorePunct').checked;
            const ngramSize = parseInt(document.getElementById('ngramSize').value);

            currentMode = mode;
            let processedText = text;
            
            if (ignoreCase) processedText = processedText.toLowerCase();
            if (ignorePunct) processedText = processedText.replace(/[^\w\s\u4e00-\u9fff]/g, '');

            let items = [];
            
            if (mode === 'char') {
                items = processedText.split('');
                if (ignoreSpaces) items = items.filter(c => !/\s/.test(c));
            } else if (mode === 'word') {
                // æ”¯æŒä¸­è‹±æ–‡åˆ†è¯
                items = processedText.match(/[\u4e00-\u9fff]|[a-zA-Z]+/g) || [];
            } else if (mode === 'ngram') {
                const chars = processedText.split('').filter(c => !ignoreSpaces || !/\s/.test(c));
                for (let i = 0; i <= chars.length - ngramSize; i++) {
                    items.push(chars.slice(i, i + ngramSize).join(''));
                }
            }

            // ç»Ÿè®¡é¢‘ç‡
            const freq = {};
            items.forEach(item => {
                freq[item] = (freq[item] || 0) + 1;
            });

            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            currentData = Object.entries(freq)
                .map(([item, count]) => ({ item, count, percent: (count / items.length * 100).toFixed(2) }))
                .sort((a, b) => b.count - a.count);

            // æ›´æ–°ç»Ÿè®¡
            updateStats(items.length, currentData);
            
            // æ›´æ–°è§†å›¾
            updateTableView();
            updateChartView();
            updateCloudView();
        }

        function updateStats(total, data) {
            document.getElementById('totalChars').textContent = total;
            document.getElementById('uniqueItems').textContent = data.length;
            document.getElementById('topItem').textContent = data.length > 0 ? 
                (data[0].item.length > 5 ? data[0].item.slice(0, 5) + '...' : data[0].item) : '-';

            // è®¡ç®—ä¿¡æ¯ç†µ
            let entropy = 0;
            data.forEach(d => {
                const p = d.count / total;
                if (p > 0) entropy -= p * Math.log2(p);
            });
            document.getElementById('entropy').textContent = entropy.toFixed(3);
        }

        function updateTableView() {
            const tbody = document.getElementById('freqTableBody');
            const maxCount = currentData.length > 0 ? currentData[0].count : 1;
            
            tbody.textContent = '';
            currentData.slice(0, 100).forEach((d, i) => {
                const tr = document.createElement('tr');
                
                const rankTd = document.createElement('td');
                rankTd.textContent = i + 1;
                tr.appendChild(rankTd);
                
                const itemTd = document.createElement('td');
                const itemSpan = document.createElement('span');
                itemSpan.className = 'char-display';
                itemSpan.textContent = d.item === ' ' ? 'â£' : (d.item === '\n' ? 'â†µ' : d.item);
                itemTd.appendChild(itemSpan);
                tr.appendChild(itemTd);
                
                const countTd = document.createElement('td');
                countTd.textContent = d.count;
                tr.appendChild(countTd);
                
                const percentTd = document.createElement('td');
                percentTd.textContent = d.percent + '%';
                tr.appendChild(percentTd);
                
                const barTd = document.createElement('td');
                const barContainer = document.createElement('div');
                barContainer.className = 'freq-bar-container';
                const bar = document.createElement('div');
                bar.className = 'freq-bar';
                bar.style.width = (d.count / maxCount * 100) + '%';
                barContainer.appendChild(bar);
                barTd.appendChild(barContainer);
                tr.appendChild(barTd);
                
                tbody.appendChild(tr);
            });
        }

        function updateChartView() {
            const canvas = document.getElementById('freqChart');
            const ctx = canvas.getContext('2d');
            const data = currentData.slice(0, 20);
            
            // æ¸…ç©ºç”»å¸ƒ
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 300;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (data.length === 0) return;

            const padding = { top: 20, right: 20, bottom: 60, left: 50 };
            const chartWidth = canvas.width - padding.left - padding.right;
            const chartHeight = canvas.height - padding.top - padding.bottom;
            const barWidth = chartWidth / data.length * 0.8;
            const barGap = chartWidth / data.length * 0.2;
            const maxCount = data[0].count;

            // ç»˜åˆ¶èƒŒæ™¯è‰²é€‚é…ä¸»é¢˜
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            ctx.fillStyle = isDark ? '#1a1a2e' : '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            data.forEach((d, i) => {
                const x = padding.left + i * (barWidth + barGap);
                const barHeight = (d.count / maxCount) * chartHeight;
                const y = padding.top + chartHeight - barHeight;

                // æ¸å˜è‰²
                const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);

                // æ ‡ç­¾
                ctx.fillStyle = isDark ? '#e0e0e0' : '#333333';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                
                // Xè½´æ ‡ç­¾
                ctx.save();
                ctx.translate(x + barWidth / 2, canvas.height - padding.bottom + 15);
                ctx.rotate(-Math.PI / 4);
                const label = d.item === ' ' ? 'â£' : (d.item.length > 8 ? d.item.slice(0, 8) + '..' : d.item);
                ctx.fillText(label, 0, 0);
                ctx.restore();

                // æ•°å€¼
                ctx.fillText(d.count, x + barWidth / 2, y - 5);
            });

            // Yè½´
            ctx.strokeStyle = isDark ? '#444' : '#ddd';
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, padding.top + chartHeight);
            ctx.stroke();
        }

        function updateCloudView() {
            const cloud = document.getElementById('wordCloud');
            cloud.textContent = '';
            
            const data = currentData.slice(0, 50);
            if (data.length === 0) return;

            const maxCount = data[0].count;
            const minSize = 14;
            const maxSize = 48;

            data.forEach(d => {
                const span = document.createElement('span');
                const size = minSize + (d.count / maxCount) * (maxSize - minSize);
                span.style.fontSize = size + 'px';
                span.style.opacity = 0.5 + (d.count / maxCount) * 0.5;
                span.textContent = d.item === ' ' ? 'â£' : d.item;
                span.title = d.item + ': ' + d.count + ' (' + d.percent + '%)';
                cloud.appendChild(span);
            });
        }

        function showView(view) {
            document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tabs button[onclick*="' + view + '"]').classList.add('active');
            
            document.getElementById('tableView').classList.toggle('hidden', view !== 'table');
            document.getElementById('chartView').classList.toggle('hidden', view !== 'chart');
            document.getElementById('cloudView').classList.toggle('hidden', view !== 'cloud');
            
            if (view === 'chart') updateChartView();
        }

        function exportCSV() {
            if (currentData.length === 0) {
                alert('è¯·å…ˆè¿›è¡Œåˆ†æ');
                return;
            }
            
            const headers = ['æ’å', 'å†…å®¹', 'é¢‘æ¬¡', 'å æ¯”(%)'];
            const rows = currentData.map((d, i) => [i + 1, '"' + d.item.replace(/"/g, '""') + '"', d.count, d.percent]);
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'frequency_analysis.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // æ¨¡å¼åˆ‡æ¢æ—¶æ˜¾ç¤º/éšè— N-gram å¤§å°è®¾ç½®
        document.getElementById('modeSelect').addEventListener('change', function() {
            document.getElementById('ngramSizeLabel').style.display = 
                this.value === 'ngram' ? 'flex' : 'none';
        });

        // ä¸»é¢˜åˆ‡æ¢
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            if (!document.getElementById('chartView').classList.contains('hidden')) {
                updateChartView();
            }
        });

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', () => {
            if (!document.getElementById('chartView').classList.contains('hidden')) {
                updateChartView();
            }
        });

        // åˆå§‹åŒ–
        document.getElementById('ngramSizeLabel').style.display = 'none';
        analyze();
    </script>
</body>
</html>

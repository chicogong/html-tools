<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>cURL ËΩ¨‰ª£Á†Å - WebUtils</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --card-bg: #fff;
      --text: #212529;
      --text-muted: #6c757d;
      --border: #dee2e6;
      --primary: #0d6efd;
      --primary-hover: #0b5ed7;
      --success: #198754;
      --danger: #dc3545;
      --shadow: 0 2px 8px rgb(0,0,0,0.08);
      --radius: 8px;
    }
    [data-theme="dark"] {
      --bg: #0a0a0f;
      --card-bg: #1a1a24;
      --text: #e8e8ed;
      --text-muted: #8888a0;
      --border: #2a2a3a;
      --shadow: 0 2px 8px rgb(0,0,0,0.3);
    }
    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--card-bg);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
    }
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
    }
    .container { max-width: 1000px; margin: 0 auto; }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    h1 { font-size: 1.75rem; margin: 0 0 8px; }
    .desc { color: var(--text-muted); margin: 0 0 24px; font-size: 0.95rem; }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    .btn-row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }

    button {
      padding: 10px 16px;
      font-size: 0.95rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { border-color: var(--primary); color: var(--primary); }
    button.primary { background: var(--primary); border-color: var(--primary); color: #fff; }
    button.primary:hover { background: var(--primary-hover); border-color: var(--primary-hover); color: #fff; }
    label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      font-size: 0.85rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      resize: vertical;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(13,110,253,0.15);
    }

    select {
      padding: 8px 12px;
      font-size: 0.9rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card-bg);
    }
    .options { display: flex; gap: 16px; flex-wrap: wrap; align-items: center; margin-bottom: 16px; }
    .output-area { margin-top: 20px; }
    .output-area textarea { min-height: 300px; background: #1e1e1e; color: #d4d4d4; border-color: #333; }
    .status { font-size: 0.85rem; margin-top: 12px; min-height: 20px; }
    .status.success { color: var(--success); }
    .status.error { color: var(--danger); }

    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    footer a { color: var(--primary); text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <a href="../../index.html" class="back-link">‚Üê ËøîÂõûÂ∑•ÂÖ∑ÂàóË°®</a>
    <button class="theme-toggle" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">‚òÄÔ∏è</button>
    <h1>cURL ËΩ¨‰ª£Á†Å</h1>
    <p class="desc">Â∞Ü cURL ÂëΩ‰ª§ËΩ¨Êç¢‰∏∫ JavaScript„ÄÅPython„ÄÅGo„ÄÅPHP Á≠â‰ª£Á†Å</p>

    <div class="card">
      <div class="btn-row">
        <button id="btnPaste">Á≤òË¥¥</button>
        <button id="btnConvert" class="primary">ËΩ¨Êç¢</button>
        <button id="btnClear">Ê∏ÖÁ©∫</button>
      </div>

      <label for="curlInput">ËæìÂÖ• cURL ÂëΩ‰ª§</label>
      <textarea id="curlInput" placeholder="curl -X POST https://api.example.com/data -H 'Content-Type: application/json' -d '{&quot;key&quot;: &quot;value&quot;}'"></textarea>

      <div class="options">
        <label style="display: inline; font-weight: normal;">
          ÁõÆÊ†áËØ≠Ë®Ä:
          <select id="language">
            <option value="javascript">JavaScript (fetch)</option>
            <option value="node">Node.js (axios)</option>
            <option value="python">Python (requests)</option>
            <option value="go">Go (net/http)</option>
            <option value="php">PHP (cURL)</option>
            <option value="java">Java (HttpClient)</option>
          </select>
        </label>
      </div>

      <div class="output-area">
        <label for="output">ÁîüÊàêÁöÑ‰ª£Á†Å</label>
        <textarea id="output" readonly placeholder="ËΩ¨Êç¢ÂêéÁöÑ‰ª£Á†ÅÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå..."></textarea>
      </div>

      <div class="btn-row" style="margin-top: 12px;">
        <button id="btnCopy">Â§çÂà∂‰ª£Á†Å</button>
      </div>

      <div id="status" class="status"></div>
    </div>

    <footer>
      <a href="https://github.com/chicogong/html-tools" target="_blank" rel="noreferrer">View source</a>
      ¬∑ Á∫ØÂâçÁ´ØÂ∑•ÂÖ∑ ¬∑ Êó†ÊúçÂä°Âô® ¬∑ 
      <a href="../../index.html">WebUtils</a>
    </footer>
  </div>

  <script>
    var curlInput = document.getElementById('curlInput');
    var output = document.getElementById('output');
    var languageEl = document.getElementById('language');
    var statusEl = document.getElementById('status');

    function showStatus(msg, type) {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + (type || '');
    }

    function parseCurl(curlStr) {
      var result = {
        method: 'GET',
        url: '',
        headers: {},
        data: null
      };

      var cmd = curlStr.replace(/\\\n/g, ' ').replace(/\s+/g, ' ').trim();
      cmd = cmd.replace(/^curl\s+/i, '');

      var tokens = [];
      var current = '';
      var inQuote = false;
      var quoteChar = '';

      for (var i = 0; i < cmd.length; i++) {
        var c = cmd[i];
        if ((c === '"' || c === "'") && (i === 0 || cmd[i-1] !== '\\')) {
          if (!inQuote) {
            inQuote = true;
            quoteChar = c;
          } else if (c === quoteChar) {
            inQuote = false;
          } else {
            current += c;
          }
        } else if (c === ' ' && !inQuote) {
          if (current) {
            tokens.push(current);
            current = '';
          }
        } else {
          current += c;
        }
      }
      if (current) tokens.push(current);

      for (var j = 0; j < tokens.length; j++) {
        var token = tokens[j];
        if (token === '-X' || token === '--request') {
          result.method = (tokens[++j] || 'GET').toUpperCase();
        } else if (token === '-H' || token === '--header') {
          var header = tokens[++j];
          if (header) {
            var colonIdx = header.indexOf(':');
            if (colonIdx > 0) {
              var key = header.slice(0, colonIdx).trim();
              var value = header.slice(colonIdx + 1).trim();
              result.headers[key] = value;
            }
          }
        } else if (token === '-d' || token === '--data' || token === '--data-raw') {
          result.data = tokens[++j];
          if (result.method === 'GET') result.method = 'POST';
        } else if (!token.startsWith('-') && (token.startsWith('http://') || token.startsWith('https://'))) {
          result.url = token;
        }
      }

      return result;
    }

    function toJavaScript(parsed) {
      var code = '';
      var hasHeaders = Object.keys(parsed.headers).length > 0;
      var hasBody = parsed.data;

      code += "fetch('" + parsed.url + "'";
      
      if (parsed.method !== 'GET' || hasHeaders || hasBody) {
        code += ", {\n";
        code += "  method: '" + parsed.method + "'";
        
        if (hasHeaders) {
          code += ",\n  headers: {\n";
          var headerLines = [];
          for (var k in parsed.headers) {
            headerLines.push("    '" + k + "': '" + parsed.headers[k] + "'");
          }
          code += headerLines.join(',\n');
          code += "\n  }";
        }
        
        if (hasBody) {
          code += ",\n  body: " + JSON.stringify(parsed.data);
        }
        
        code += "\n}";
      }
      
      code += ")\n  .then(response => response.json())\n  .then(data => console.log(data))\n  .catch(error => console.error('Error:', error));";
      
      return code;
    }

    function toNode(parsed) {
      var code = "const axios = require('axios');\n\n";
      code += "axios({\n";
      code += "  method: '" + parsed.method.toLowerCase() + "',\n";
      code += "  url: '" + parsed.url + "'";
      
      if (Object.keys(parsed.headers).length > 0) {
        code += ",\n  headers: {\n";
        var headerLines = [];
        for (var k in parsed.headers) {
          headerLines.push("    '" + k + "': '" + parsed.headers[k] + "'");
        }
        code += headerLines.join(',\n');
        code += "\n  }";
      }
      
      if (parsed.data) {
        code += ",\n  data: " + parsed.data;
      }
      
      code += "\n})\n  .then(response => console.log(response.data))\n  .catch(error => console.error(error));";
      
      return code;
    }

    function toPython(parsed) {
      var code = "import requests\n\n";
      code += "response = requests." + parsed.method.toLowerCase() + "(\n";
      code += "    '" + parsed.url + "'";
      
      if (Object.keys(parsed.headers).length > 0) {
        code += ",\n    headers={\n";
        var headerLines = [];
        for (var k in parsed.headers) {
          headerLines.push("        '" + k + "': '" + parsed.headers[k] + "'");
        }
        code += headerLines.join(',\n');
        code += "\n    }";
      }
      
      if (parsed.data) {
        code += ",\n    data='" + parsed.data.replace(/'/g, "\\'") + "'";
      }
      
      code += "\n)\n\nprint(response.json())";
      
      return code;
    }

    function toGo(parsed) {
      var code = 'package main\n\nimport (\n    "fmt"\n    "io"\n    "net/http"';
      if (parsed.data) code += '\n    "strings"';
      code += '\n)\n\nfunc main() {\n';
      
      if (parsed.data) {
        code += '    body := strings.NewReader(`' + parsed.data + '`)\n';
        code += '    req, err := http.NewRequest("' + parsed.method + '", "' + parsed.url + '", body)\n';
      } else {
        code += '    req, err := http.NewRequest("' + parsed.method + '", "' + parsed.url + '", nil)\n';
      }
      
      code += '    if err != nil {\n        panic(err)\n    }\n\n';
      
      for (var k in parsed.headers) {
        code += '    req.Header.Set("' + k + '", "' + parsed.headers[k] + '")\n';
      }
      
      code += '\n    client := &http.Client{}\n';
      code += '    resp, err := client.Do(req)\n';
      code += '    if err != nil {\n        panic(err)\n    }\n';
      code += '    defer resp.Body.Close()\n\n';
      code += '    respBody, _ := io.ReadAll(resp.Body)\n';
      code += '    fmt.Println(string(respBody))\n}';
      
      return code;
    }

    function toPHP(parsed) {
      var code = "<?php\n\n$ch = curl_init();\n\n";
      code += "curl_setopt($ch, CURLOPT_URL, '" + parsed.url + "');\n";
      code += "curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n";
      code += "curl_setopt($ch, CURLOPT_CUSTOMREQUEST, '" + parsed.method + "');\n";
      
      if (Object.keys(parsed.headers).length > 0) {
        code += "\ncurl_setopt($ch, CURLOPT_HTTPHEADER, [\n";
        var headerLines = [];
        for (var k in parsed.headers) {
          headerLines.push("    '" + k + ": " + parsed.headers[k] + "'");
        }
        code += headerLines.join(',\n');
        code += "\n]);\n";
      }
      
      if (parsed.data) {
        code += "\ncurl_setopt($ch, CURLOPT_POSTFIELDS, '" + parsed.data.replace(/'/g, "\\'") + "');\n";
      }
      
      code += "\n$response = curl_exec($ch);\ncurl_close($ch);\n\necho $response;\n?>";
      
      return code;
    }

    function toJava(parsed) {
      var code = 'import java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\n\n';
      code += 'public class Main {\n    public static void main(String[] args) throws Exception {\n';
      code += '        HttpClient client = HttpClient.newHttpClient();\n\n';
      code += '        HttpRequest.Builder builder = HttpRequest.newBuilder()\n';
      code += '            .uri(URI.create("' + parsed.url + '"))\n';
      code += '            .method("' + parsed.method + '"';
      
      if (parsed.data) {
        code += ', HttpRequest.BodyPublishers.ofString("' + parsed.data.replace(/"/g, '\\"') + '")';
      } else {
        code += ', HttpRequest.BodyPublishers.noBody()';
      }
      code += ')';
      
      for (var k in parsed.headers) {
        code += '\n            .header("' + k + '", "' + parsed.headers[k] + '")';
      }
      
      code += ';\n\n';
      code += '        HttpRequest request = builder.build();\n';
      code += '        HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());\n\n';
      code += '        System.out.println(response.body());\n    }\n}';
      
      return code;
    }

    function convert() {
      var curl = curlInput.value.trim();
      if (!curl) {
        showStatus('ËØ∑ËæìÂÖ• cURL ÂëΩ‰ª§', 'error');
        return;
      }

      try {
        var parsed = parseCurl(curl);
        if (!parsed.url) {
          showStatus('Êó†Ê≥ïËß£Êûê URL', 'error');
          return;
        }

        var lang = languageEl.value;
        var code = '';

        switch (lang) {
          case 'javascript': code = toJavaScript(parsed); break;
          case 'node': code = toNode(parsed); break;
          case 'python': code = toPython(parsed); break;
          case 'go': code = toGo(parsed); break;
          case 'php': code = toPHP(parsed); break;
          case 'java': code = toJava(parsed); break;
        }

        output.value = code;
        showStatus('ËΩ¨Êç¢ÊàêÂäü', 'success');
      } catch (e) {
        showStatus('ËΩ¨Êç¢Â§±Ë¥•: ' + e.message, 'error');
      }
    }

    document.getElementById('btnPaste').onclick = async function() {
      try {
        curlInput.value = await navigator.clipboard.readText();
        showStatus('Â∑≤Á≤òË¥¥', 'success');
      } catch (e) {
        showStatus('Êó†Ê≥ïËÆøÈóÆÂâ™Ë¥¥Êùø', 'error');
      }
    };

    document.getElementById('btnConvert').onclick = convert;

    document.getElementById('btnClear').onclick = function() {
      curlInput.value = '';
      output.value = '';
      showStatus('Â∑≤Ê∏ÖÁ©∫', 'success');
    };

    document.getElementById('btnCopy').onclick = async function() {
      if (output.value) {
        await navigator.clipboard.writeText(output.value);
        showStatus('Â∑≤Â§çÂà∂', 'success');
      }
    };

    languageEl.onchange = function() {
      if (curlInput.value) convert();
    };

    function toggleTheme() {
      const html = document.documentElement;
      const btn = document.querySelector('.theme-toggle');
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      btn.textContent = next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', next);
    }
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
        const btn = document.querySelector('.theme-toggle');
        if (btn) btn.textContent = saved === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      }
    })();
  </script>
</body>
</html>

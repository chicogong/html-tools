<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨å¤´æ£€æµ‹å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --color-safe: #22c55e;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }
        .theme-toggle {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        .info-box {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .header-card {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .header-card-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        .header-card-title h3 {
            margin: 0;
            font-size: 1rem;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .status-critical {
            background: var(--color-danger);
            color: white;
        }
        .status-important {
            background: var(--color-warning);
            color: black;
        }
        .status-recommended {
            background: var(--color-safe);
            color: white;
        }
        .header-description {
            color: var(--pico-muted-color);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-sm);
        }
        .header-example {
            background: var(--pico-code-background-color);
            padding: var(--spacing-sm);
            border-radius: var(--pico-border-radius);
            font-family: monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .header-details {
            margin-top: var(--spacing-sm);
        }
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            border-bottom: 2px solid var(--pico-muted-border-color);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }
        .tab {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            border-bottom-color: var(--pico-primary);
            color: var(--pico-primary);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--pico-muted-border-color);
        }
        .checklist-item:last-child {
            border-bottom: none;
        }
        .checklist-icon {
            font-size: 1.25rem;
            min-width: 1.5rem;
        }
        .attack-card {
            background: var(--pico-card-background-color);
            border-left: 4px solid var(--color-danger);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .attack-card h4 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--color-danger);
        }
        .mitigation {
            background: var(--pico-code-background-color);
            padding: var(--spacing-sm);
            border-radius: var(--pico-border-radius);
            margin-top: var(--spacing-sm);
        }
        .search-box {
            margin-bottom: var(--spacing-md);
        }
        .filter-tags {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }
        .filter-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            cursor: pointer;
            border: 1px solid var(--pico-muted-border-color);
            background: var(--pico-card-background-color);
        }
        .filter-tag.active {
            background: var(--pico-primary);
            color: var(--pico-primary-inverse);
            border-color: var(--pico-primary);
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <main class="container">
        <div class="header">
            <h1>å®‰å…¨å¤´æ£€æµ‹å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
        </div>

        <article>
            <div class="info-box">
                <p><strong>HTTP å®‰å…¨å¤´</strong>æ˜¯ Web æœåŠ¡å™¨å‘é€çš„å“åº”å¤´ï¼Œç”¨äºä¿æŠ¤ç½‘ç«™å…å—å„ç§æ”»å‡»ã€‚æœ¬å·¥å…·æä¾›å®‰å…¨å¤´çš„å‚è€ƒä¿¡æ¯å’Œæœ€ä½³å®è·µé…ç½®ç¤ºä¾‹ã€‚</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('headers')">å®‰å…¨å¤´å‚è€ƒ</button>
                <button class="tab" onclick="switchTab('attacks')">æ”»å‡»é˜²æŠ¤</button>
                <button class="tab" onclick="switchTab('checklist')">å®‰å…¨æ£€æŸ¥æ¸…å•</button>
                <button class="tab" onclick="switchTab('generator')">é…ç½®ç”Ÿæˆå™¨</button>
            </div>

            <!-- Security Headers Reference Tab -->
            <div id="headers-tab" class="tab-content active">
                <div class="search-box">
                    <input type="search" id="headerSearch" placeholder="æœç´¢å®‰å…¨å¤´..." oninput="filterHeaders()">
                </div>

                <div class="filter-tags">
                    <button class="filter-tag active" data-filter="all" onclick="setFilter('all')">å…¨éƒ¨</button>
                    <button class="filter-tag" data-filter="critical" onclick="setFilter('critical')">å…³é”®</button>
                    <button class="filter-tag" data-filter="important" onclick="setFilter('important')">é‡è¦</button>
                    <button class="filter-tag" data-filter="recommended" onclick="setFilter('recommended')">æ¨è</button>
                </div>

                <div id="headersContainer"></div>
            </div>

            <!-- Attack Prevention Tab -->
            <div id="attacks-tab" class="tab-content">
                <div id="attacksContainer"></div>
            </div>

            <!-- Security Checklist Tab -->
            <div id="checklist-tab" class="tab-content">
                <div id="checklistContainer"></div>
            </div>

            <!-- Config Generator Tab -->
            <div id="generator-tab" class="tab-content">
                <div class="info-box">
                    <h4>é€‰æ‹©æœåŠ¡å™¨ç±»å‹ç”Ÿæˆé…ç½®</h4>
                </div>

                <label>
                    æœåŠ¡å™¨ç±»å‹
                    <select id="serverType" onchange="generateConfig()">
                        <option value="nginx">Nginx</option>
                        <option value="apache">Apache</option>
                        <option value="iis">IIS (web.config)</option>
                        <option value="express">Node.js Express</option>
                        <option value="cloudflare">Cloudflare Workers</option>
                    </select>
                </label>

                <fieldset>
                    <legend>é€‰æ‹©è¦å¯ç”¨çš„å®‰å…¨å¤´</legend>
                    <div id="headerCheckboxes"></div>
                </fieldset>

                <label>
                    CSP ç­–ç•¥çº§åˆ«
                    <select id="cspLevel" onchange="generateConfig()">
                        <option value="strict">ä¸¥æ ¼ (æ¨è)</option>
                        <option value="moderate">ä¸­ç­‰</option>
                        <option value="permissive">å®½æ¾</option>
                    </select>
                </label>

                <div class="header-example" id="generatedConfig" style="min-height: 200px;">
é€‰æ‹©æœåŠ¡å™¨ç±»å‹å’Œå®‰å…¨å¤´åç”Ÿæˆé…ç½®
                </div>

                <button onclick="copyConfig()">å¤åˆ¶é…ç½®</button>
            </div>
        </article>
    </main>

    <script>
        var securityHeaders = [
            {
                name: 'Content-Security-Policy',
                level: 'critical',
                description: 'æ§åˆ¶é¡µé¢å¯ä»¥åŠ è½½å“ªäº›èµ„æºï¼Œæœ‰æ•ˆé˜²æ­¢ XSS æ”»å‡»å’Œæ•°æ®æ³¨å…¥æ”»å‡»ã€‚',
                example: "Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none';",
                details: [
                    "default-src 'self' - é»˜è®¤åªå…è®¸åŒæºèµ„æº",
                    "script-src - æ§åˆ¶ JavaScript æ¥æº",
                    "style-src - æ§åˆ¶ CSS æ¥æº",
                    "img-src - æ§åˆ¶å›¾ç‰‡æ¥æº",
                    "frame-ancestors - é˜²æ­¢ç‚¹å‡»åŠ«æŒ"
                ],
                attacks: ['XSS', 'Data Injection', 'Clickjacking']
            },
            {
                name: 'Strict-Transport-Security',
                level: 'critical',
                description: 'å¼ºåˆ¶æµè§ˆå™¨åªé€šè¿‡ HTTPS è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé˜²æ­¢åè®®é™çº§æ”»å‡»å’Œ Cookie åŠ«æŒã€‚',
                example: 'Strict-Transport-Security: max-age=31536000; includeSubDomains; preload',
                details: [
                    'max-age=31536000 - HSTS æœ‰æ•ˆæœŸä¸€å¹´',
                    'includeSubDomains - åŒ…å«æ‰€æœ‰å­åŸŸå',
                    'preload - å¯æäº¤åˆ° HSTS é¢„åŠ è½½åˆ—è¡¨'
                ],
                attacks: ['Man-in-the-Middle', 'SSL Stripping', 'Cookie Hijacking']
            },
            {
                name: 'X-Content-Type-Options',
                level: 'critical',
                description: 'é˜²æ­¢æµè§ˆå™¨è¿›è¡Œ MIME ç±»å‹å—…æ¢ï¼Œå‡å°‘åŸºäº MIME æ··æ·†çš„æ”»å‡»é£é™©ã€‚',
                example: 'X-Content-Type-Options: nosniff',
                details: [
                    'nosniff - ç¦æ­¢ MIME ç±»å‹å—…æ¢',
                    'ç¡®ä¿æ–‡ä»¶ä»¥å£°æ˜çš„ Content-Type å¤„ç†'
                ],
                attacks: ['MIME Confusion', 'Drive-by Download']
            },
            {
                name: 'X-Frame-Options',
                level: 'important',
                description: 'æ§åˆ¶é¡µé¢æ˜¯å¦å¯ä»¥è¢«åµŒå…¥åˆ° iframe ä¸­ï¼Œé˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚',
                example: 'X-Frame-Options: DENY',
                details: [
                    'DENY - å®Œå…¨ç¦æ­¢è¢«åµŒå…¥',
                    'SAMEORIGIN - åªå…è®¸åŒæºåµŒå…¥',
                    'ALLOW-FROM uri - å…è®¸æŒ‡å®šæ¥æºåµŒå…¥ï¼ˆå·²åºŸå¼ƒï¼‰'
                ],
                attacks: ['Clickjacking', 'UI Redressing']
            },
            {
                name: 'X-XSS-Protection',
                level: 'important',
                description: 'å¯ç”¨æµè§ˆå™¨å†…ç½®çš„ XSS è¿‡æ»¤å™¨ï¼ˆå·²è¢« CSP å–ä»£ï¼Œä½†ä»å»ºè®®è®¾ç½®ï¼‰ã€‚',
                example: 'X-XSS-Protection: 1; mode=block',
                details: [
                    '1 - å¯ç”¨ XSS è¿‡æ»¤å™¨',
                    'mode=block - æ£€æµ‹åˆ°æ”»å‡»æ—¶é˜»æ­¢æ¸²æŸ“',
                    'æ³¨æ„ï¼šç°ä»£æµè§ˆå™¨å·²ç§»é™¤æ­¤åŠŸèƒ½'
                ],
                attacks: ['XSS']
            },
            {
                name: 'Referrer-Policy',
                level: 'important',
                description: 'æ§åˆ¶è¯·æ±‚ä¸­ Referer å¤´çš„ä¿¡æ¯é‡ï¼Œä¿æŠ¤ç”¨æˆ·éšç§ã€‚',
                example: 'Referrer-Policy: strict-origin-when-cross-origin',
                details: [
                    'no-referrer - ä¸å‘é€ Referer',
                    'same-origin - åªåŒæºè¯·æ±‚å‘é€',
                    'strict-origin - åªå‘é€æºï¼Œä¸å‘é€è·¯å¾„',
                    'strict-origin-when-cross-origin - æ¨èè®¾ç½®'
                ],
                attacks: ['Information Leakage', 'Privacy Violation']
            },
            {
                name: 'Permissions-Policy',
                level: 'recommended',
                description: 'æ§åˆ¶æµè§ˆå™¨åŠŸèƒ½çš„ä½¿ç”¨æƒé™ï¼Œå¦‚æ‘„åƒå¤´ã€éº¦å…‹é£ã€åœ°ç†ä½ç½®ç­‰ã€‚',
                example: "Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=()",
                details: [
                    'camera=() - ç¦ç”¨æ‘„åƒå¤´',
                    'microphone=() - ç¦ç”¨éº¦å…‹é£',
                    'geolocation=() - ç¦ç”¨åœ°ç†ä½ç½®',
                    'å¯æŒ‰éœ€å¼€æ”¾ç‰¹å®šåŠŸèƒ½'
                ],
                attacks: ['Privacy Violation', 'Feature Abuse']
            },
            {
                name: 'Cross-Origin-Embedder-Policy',
                level: 'recommended',
                description: 'æ§åˆ¶æ–‡æ¡£æ˜¯å¦å¯ä»¥åŠ è½½æœªæ˜ç¡®æˆæƒçš„è·¨æºèµ„æºã€‚',
                example: 'Cross-Origin-Embedder-Policy: require-corp',
                details: [
                    'require-corp - è¦æ±‚æ‰€æœ‰èµ„æºéƒ½æœ‰ CORP å¤´',
                    'credentialless - ä½¿ç”¨æ— å‡­è¯æ¨¡å¼åŠ è½½',
                    'ä¸ COOP é…åˆä½¿ç”¨å¯å¯ç”¨é«˜ç²¾åº¦è®¡æ—¶å™¨'
                ],
                attacks: ['Spectre', 'Side-Channel']
            },
            {
                name: 'Cross-Origin-Opener-Policy',
                level: 'recommended',
                description: 'éš”ç¦»æµè§ˆä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢è·¨çª—å£æ”»å‡»ã€‚',
                example: 'Cross-Origin-Opener-Policy: same-origin',
                details: [
                    'same-origin - åªä¸åŒæºæ–‡æ¡£å…±äº«ä¸Šä¸‹æ–‡',
                    'same-origin-allow-popups - å…è®¸å¼¹çª—',
                    'é˜²æ­¢ window.opener ç›¸å…³æ”»å‡»'
                ],
                attacks: ['Cross-Window Attack', 'Spectre']
            },
            {
                name: 'Cross-Origin-Resource-Policy',
                level: 'recommended',
                description: 'æ§åˆ¶èµ„æºæ˜¯å¦å¯ä»¥è¢«å…¶ä»–æºåŠ è½½ã€‚',
                example: 'Cross-Origin-Resource-Policy: same-origin',
                details: [
                    'same-origin - åªå…è®¸åŒæºåŠ è½½',
                    'same-site - å…è®¸åŒç«™åŠ è½½',
                    'cross-origin - å…è®¸è·¨æºåŠ è½½'
                ],
                attacks: ['Cross-Origin Resource Theft']
            },
            {
                name: 'Cache-Control',
                level: 'important',
                description: 'æ§åˆ¶å“åº”çš„ç¼“å­˜è¡Œä¸ºï¼Œé˜²æ­¢æ•æ„Ÿæ•°æ®è¢«ç¼“å­˜ã€‚',
                example: 'Cache-Control: no-store, no-cache, must-revalidate, private',
                details: [
                    'no-store - ä¸å­˜å‚¨ä»»ä½•ç¼“å­˜',
                    'no-cache - æ¯æ¬¡éƒ½è¦éªŒè¯',
                    'private - åªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜',
                    'æ•æ„Ÿé¡µé¢åº”ç¦ç”¨ç¼“å­˜'
                ],
                attacks: ['Information Disclosure', 'Cache Poisoning']
            },
            {
                name: 'X-Permitted-Cross-Domain-Policies',
                level: 'recommended',
                description: 'æ§åˆ¶ Adobe Flash å’Œ PDF çš„è·¨åŸŸç­–ç•¥æ–‡ä»¶åŠ è½½ã€‚',
                example: 'X-Permitted-Cross-Domain-Policies: none',
                details: [
                    'none - ä¸å…è®¸ä»»ä½•ç­–ç•¥æ–‡ä»¶',
                    'master-only - åªå…è®¸ä¸»ç­–ç•¥æ–‡ä»¶',
                    'ä¸»è¦ç”¨äºé—ç•™ç³»ç»Ÿå®‰å…¨'
                ],
                attacks: ['Cross-Domain Data Theft']
            }
        ];

        var attacks = [
            {
                name: 'XSS (è·¨ç«™è„šæœ¬æ”»å‡»)',
                description: 'æ”»å‡»è€…å°†æ¶æ„è„šæœ¬æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œçªƒå–ç”¨æˆ·æ•°æ®æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚',
                headers: ['Content-Security-Policy', 'X-XSS-Protection'],
                mitigation: "Content-Security-Policy: script-src 'self'; object-src 'none'"
            },
            {
                name: 'ç‚¹å‡»åŠ«æŒ (Clickjacking)',
                description: 'é€šè¿‡é€æ˜ iframe è¦†ç›–åœ¨åˆæ³•é¡µé¢ä¸Šï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚',
                headers: ['X-Frame-Options', 'Content-Security-Policy'],
                mitigation: "X-Frame-Options: DENY\nContent-Security-Policy: frame-ancestors 'none'"
            },
            {
                name: 'ä¸­é—´äººæ”»å‡» (MITM)',
                description: 'æ”»å‡»è€…æˆªè·å¹¶å¯èƒ½ç¯¡æ”¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚',
                headers: ['Strict-Transport-Security'],
                mitigation: 'Strict-Transport-Security: max-age=31536000; includeSubDomains; preload'
            },
            {
                name: 'MIME æ··æ·†æ”»å‡»',
                description: 'åˆ©ç”¨æµè§ˆå™¨çš„ MIME ç±»å‹å—…æ¢æ‰§è¡Œæ¶æ„å†…å®¹ã€‚',
                headers: ['X-Content-Type-Options'],
                mitigation: 'X-Content-Type-Options: nosniff'
            },
            {
                name: 'Spectre ä¾§ä¿¡é“æ”»å‡»',
                description: 'åˆ©ç”¨ CPU æ¨æµ‹æ‰§è¡Œæ¼æ´è¯»å–å†…å­˜æ•°æ®ã€‚',
                headers: ['Cross-Origin-Embedder-Policy', 'Cross-Origin-Opener-Policy'],
                mitigation: 'Cross-Origin-Embedder-Policy: require-corp\nCross-Origin-Opener-Policy: same-origin'
            },
            {
                name: 'ä¿¡æ¯æ³„éœ²',
                description: 'Referer å¤´æˆ–ç¼“å­˜å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚',
                headers: ['Referrer-Policy', 'Cache-Control'],
                mitigation: 'Referrer-Policy: strict-origin-when-cross-origin\nCache-Control: no-store, private'
            }
        ];

        var checklist = [
            { text: 'å¯ç”¨ HTTPS å¹¶é…ç½® HSTS', critical: true },
            { text: 'é…ç½® Content-Security-Policy', critical: true },
            { text: 'è®¾ç½® X-Content-Type-Options: nosniff', critical: true },
            { text: 'è®¾ç½® X-Frame-Options é˜²æ­¢ç‚¹å‡»åŠ«æŒ', critical: true },
            { text: 'é…ç½® Referrer-Policy ä¿æŠ¤éšç§', critical: false },
            { text: 'è®¾ç½® Permissions-Policy é™åˆ¶ API è®¿é—®', critical: false },
            { text: 'æ•æ„Ÿé¡µé¢ç¦ç”¨ç¼“å­˜', critical: true },
            { text: 'ç§»é™¤ä¸å¿…è¦çš„æœåŠ¡å™¨ä¿¡æ¯å¤´', critical: false },
            { text: 'é…ç½® CORS ç™½åå•', critical: true },
            { text: 'å®šæœŸå®¡æŸ¥å’Œæ›´æ–°å®‰å…¨ç­–ç•¥', critical: false }
        ];

        var currentFilter = 'all';

        function toggleTheme() {
            var html = document.documentElement;
            var current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
            document.querySelector('[onclick="switchTab(\'' + tabName + '\')"]').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function renderHeaders() {
            var container = document.getElementById('headersContainer');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            securityHeaders.forEach(function(header) {
                var card = document.createElement('div');
                card.className = 'header-card';
                card.dataset.level = header.level;
                card.dataset.name = header.name.toLowerCase();

                var levelText = header.level === 'critical' ? 'å…³é”®' : 
                                  header.level === 'important' ? 'é‡è¦' : 'æ¨è';

                var titleDiv = document.createElement('div');
                titleDiv.className = 'header-card-title';
                
                var h3 = document.createElement('h3');
                h3.textContent = header.name;
                
                var badge = document.createElement('span');
                badge.className = 'status-badge status-' + header.level;
                badge.textContent = levelText;
                
                titleDiv.appendChild(h3);
                titleDiv.appendChild(badge);
                
                var descP = document.createElement('p');
                descP.className = 'header-description';
                descP.textContent = header.description;
                
                var exampleDiv = document.createElement('div');
                exampleDiv.className = 'header-example';
                exampleDiv.textContent = header.example;
                
                var detailsDiv = document.createElement('details');
                detailsDiv.className = 'header-details';
                
                var summary = document.createElement('summary');
                summary.textContent = 'è¯¦ç»†è¯´æ˜';
                detailsDiv.appendChild(summary);
                
                var ul = document.createElement('ul');
                header.details.forEach(function(detail) {
                    var li = document.createElement('li');
                    li.textContent = detail;
                    ul.appendChild(li);
                });
                detailsDiv.appendChild(ul);
                
                if (header.attacks && header.attacks.length > 0) {
                    var attacksP = document.createElement('p');
                    var strong = document.createElement('strong');
                    strong.textContent = 'é˜²æŠ¤æ”»å‡»: ';
                    attacksP.appendChild(strong);
                    attacksP.appendChild(document.createTextNode(header.attacks.join(', ')));
                    detailsDiv.appendChild(attacksP);
                }
                
                card.appendChild(titleDiv);
                card.appendChild(descP);
                card.appendChild(exampleDiv);
                card.appendChild(detailsDiv);
                
                container.appendChild(card);
            });
        }

        function renderAttacks() {
            var container = document.getElementById('attacksContainer');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            attacks.forEach(function(attack) {
                var card = document.createElement('div');
                card.className = 'attack-card';
                
                var h4 = document.createElement('h4');
                h4.textContent = attack.name;
                
                var p = document.createElement('p');
                p.textContent = attack.description;
                
                var headersP = document.createElement('p');
                var strong1 = document.createElement('strong');
                strong1.textContent = 'ç›¸å…³å®‰å…¨å¤´: ';
                headersP.appendChild(strong1);
                headersP.appendChild(document.createTextNode(attack.headers.join(', ')));
                
                var mitigationDiv = document.createElement('div');
                mitigationDiv.className = 'mitigation';
                
                var mitigationLabel = document.createElement('strong');
                mitigationLabel.textContent = 'é˜²æŠ¤é…ç½®:';
                mitigationDiv.appendChild(mitigationLabel);
                
                var pre = document.createElement('pre');
                pre.style.margin = '0.5rem 0 0 0';
                pre.textContent = attack.mitigation;
                mitigationDiv.appendChild(pre);
                
                card.appendChild(h4);
                card.appendChild(p);
                card.appendChild(headersP);
                card.appendChild(mitigationDiv);
                
                container.appendChild(card);
            });
        }

        function renderChecklist() {
            var container = document.getElementById('checklistContainer');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            checklist.forEach(function(item, index) {
                var div = document.createElement('div');
                div.className = 'checklist-item';
                
                var icon = document.createElement('span');
                icon.className = 'checklist-icon';
                icon.textContent = item.critical ? 'ğŸ”´' : 'ğŸŸ¡';
                
                var label = document.createElement('label');
                
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'check-' + index;
                
                var text = document.createTextNode(' ' + item.text + (item.critical ? ' (å…³é”®)' : ''));
                
                label.appendChild(checkbox);
                label.appendChild(text);
                
                div.appendChild(icon);
                div.appendChild(label);
                
                container.appendChild(div);
            });
        }

        function renderHeaderCheckboxes() {
            var container = document.getElementById('headerCheckboxes');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            securityHeaders.forEach(function(header, index) {
                var label = document.createElement('label');
                
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'gen-' + index;
                checkbox.checked = header.level === 'critical';
                checkbox.onchange = generateConfig;
                
                var text = document.createTextNode(' ' + header.name);
                
                label.appendChild(checkbox);
                label.appendChild(text);
                
                container.appendChild(label);
            });
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-tag').forEach(function(tag) {
                tag.classList.remove('active');
            });
            document.querySelector('[data-filter="' + filter + '"]').classList.add('active');
            filterHeaders();
        }

        function filterHeaders() {
            var searchTerm = document.getElementById('headerSearch').value.toLowerCase();
            var cards = document.querySelectorAll('.header-card');

            cards.forEach(function(card) {
                var matchesFilter = currentFilter === 'all' || card.dataset.level === currentFilter;
                var matchesSearch = card.dataset.name.indexOf(searchTerm) !== -1 || 
                                      card.textContent.toLowerCase().indexOf(searchTerm) !== -1;
                
                if (matchesFilter && matchesSearch) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }

        function generateConfig() {
            var serverType = document.getElementById('serverType').value;
            var cspLevel = document.getElementById('cspLevel').value;
            
            var selectedHeaders = [];
            securityHeaders.forEach(function(header, index) {
                var checkbox = document.getElementById('gen-' + index);
                if (checkbox && checkbox.checked) {
                    selectedHeaders.push(header);
                }
            });

            var cspValue;
            switch (cspLevel) {
                case 'strict':
                    cspValue = "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self'; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'";
                    break;
                case 'moderate':
                    cspValue = "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'self'";
                    break;
                case 'permissive':
                    cspValue = "default-src 'self' https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:; img-src * data:; font-src * data:; connect-src *";
                    break;
            }

            var config = '';
            
            switch (serverType) {
                case 'nginx':
                    config = '# Nginx Security Headers Configuration\n\n';
                    selectedHeaders.forEach(function(header) {
                        var value = header.example.split(': ')[1];
                        if (header.name === 'Content-Security-Policy') {
                            value = cspValue;
                        }
                        config += 'add_header ' + header.name + ' "' + value + '" always;\n';
                    });
                    break;
                    
                case 'apache':
                    config = '# Apache Security Headers Configuration\n# Add to .htaccess or httpd.conf\n\n';
                    selectedHeaders.forEach(function(header) {
                        var value = header.example.split(': ')[1];
                        if (header.name === 'Content-Security-Policy') {
                            value = cspValue;
                        }
                        config += 'Header always set ' + header.name + ' "' + value + '"\n';
                    });
                    break;
                    
                case 'iis':
                    config = '<?xml version="1.0" encoding="UTF-8"?>\n<configuration>\n  <system.webServer>\n    <httpProtocol>\n      <customHeaders>\n';
                    selectedHeaders.forEach(function(header) {
                        var value = header.example.split(': ')[1];
                        if (header.name === 'Content-Security-Policy') {
                            value = cspValue;
                        }
                        config += '        <add name="' + header.name + '" value="' + value + '" />\n';
                    });
                    config += '      </customHeaders>\n    </httpProtocol>\n  </system.webServer>\n</configuration>';
                    break;
                    
                case 'express':
                    config = '// Node.js Express Security Headers\n// npm install helmet\n\nconst helmet = require("helmet");\n\napp.use(helmet());\n\n// Or manually:\napp.use((req, res, next) => {\n';
                    selectedHeaders.forEach(function(header) {
                        var value = header.example.split(': ')[1];
                        if (header.name === 'Content-Security-Policy') {
                            value = cspValue;
                        }
                        config += '  res.setHeader("' + header.name + '", "' + value + '");\n';
                    });
                    config += '  next();\n});';
                    break;
                    
                case 'cloudflare':
                    config = '// Cloudflare Workers Security Headers\n\nasync function handleRequest(request) {\n  const response = await fetch(request);\n  const newResponse = new Response(response.body, response);\n\n';
                    selectedHeaders.forEach(function(header) {
                        var value = header.example.split(': ')[1];
                        if (header.name === 'Content-Security-Policy') {
                            value = cspValue;
                        }
                        config += '  newResponse.headers.set("' + header.name + '", "' + value + '");\n';
                    });
                    config += '\n  return newResponse;\n}';
                    break;
            }

            document.getElementById('generatedConfig').textContent = config;
        }

        function copyConfig() {
            var config = document.getElementById('generatedConfig').textContent;
            navigator.clipboard.writeText(config).then(function() {
                alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(function() {
                var textarea = document.createElement('textarea');
                textarea.value = config;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // Initialize
        renderHeaders();
        renderAttacks();
        renderChecklist();
        renderHeaderCheckboxes();
        generateConfig();
    </script>
</body>
</html>

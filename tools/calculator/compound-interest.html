<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤åˆ©è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body { min-height: 100vh; padding: 2rem 1rem; }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .calc-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .input-section, .result-section { background: var(--pico-muted-border-color); border-radius: var(--pico-border-radius); padding: 1.5rem; }
        .result-highlight { font-size: 2rem; font-weight: bold; color: var(--pico-primary); margin: 1rem 0; }
        .result-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--pico-muted-border-color); }
        .result-row:last-child { border-bottom: none; }
        .chart-container { margin-top: 2rem; }
        .bar-chart { display: flex; flex-direction: column; gap: 0.5rem; }
        .bar-row { display: flex; align-items: center; gap: 1rem; }
        .bar-label { width: 60px; font-size: 0.8rem; }
        .bar-container { flex: 1; height: 24px; background: var(--pico-muted-border-color); border-radius: 4px; overflow: hidden; display: flex; }
        .bar-principal { background: var(--pico-primary); height: 100%; }
        .bar-interest { background: var(--pico-secondary); height: 100%; }
        .bar-value { font-size: 0.8rem; margin-left: 0.5rem; white-space: nowrap; }
        .legend { display: flex; gap: 1rem; margin-top: 1rem; font-size: 0.9rem; }
        .legend span { display: flex; align-items: center; gap: 0.25rem; }
        .legend-box { width: 16px; height: 16px; border-radius: 2px; }
        table { margin-top: 1rem; font-size: 0.9rem; }
    </style>
</head>
<body>
    <main class="container">
        <header>
            <h1>å¤åˆ©è®¡ç®—å™¨</h1>
            <button id="themeToggle" class="outline" onclick="toggleTheme()">ğŸŒ™</button>
        </header>

        <div class="calc-grid">
            <div class="input-section">
                <h3>æŠ•èµ„å‚æ•°</h3>
                <label>åˆå§‹æœ¬é‡‘ (å…ƒ)</label>
                <input type="number" id="principal" value="100000" min="0" step="1000">
                
                <label>å¹´åˆ©ç‡ (%)</label>
                <input type="number" id="rate" value="5" min="0" step="0.1">
                
                <label>æŠ•èµ„å¹´é™</label>
                <input type="number" id="years" value="10" min="1" max="50">
                
                <label>å¤åˆ©é¢‘ç‡</label>
                <select id="frequency">
                    <option value="1">æ¯å¹´</option>
                    <option value="2">æ¯åŠå¹´</option>
                    <option value="4">æ¯å­£åº¦</option>
                    <option value="12" selected>æ¯æœˆ</option>
                    <option value="365">æ¯æ—¥</option>
                </select>
                
                <label>æ¯æœŸè¿½åŠ æŠ•èµ„ (å…ƒ)</label>
                <input type="number" id="contribution" value="1000" min="0" step="100">
                
                <label>è¿½åŠ æ—¶ç‚¹</label>
                <select id="contributionTiming">
                    <option value="end">æœŸæœ«</option>
                    <option value="start">æœŸåˆ</option>
                </select>
                
                <button onclick="calculate()" style="margin-top: 1rem; width: 100%;">è®¡ç®—</button>
            </div>

            <div class="result-section">
                <h3>è®¡ç®—ç»“æœ</h3>
                <div class="result-highlight" id="finalAmount">Â¥0</div>
                <p style="margin-top: 0; color: var(--pico-muted-color);">æœ€ç»ˆé‡‘é¢</p>
                
                <div class="result-row">
                    <span>æ€»æŠ•å…¥æœ¬é‡‘</span>
                    <strong id="totalPrincipal">Â¥0</strong>
                </div>
                <div class="result-row">
                    <span>ç´¯è®¡åˆ©æ¯</span>
                    <strong id="totalInterest">Â¥0</strong>
                </div>
                <div class="result-row">
                    <span>åˆ©æ¯å æ¯”</span>
                    <strong id="interestRatio">0%</strong>
                </div>
                <div class="result-row">
                    <span>å®é™…å¹´åŒ–æ”¶ç›Šç‡</span>
                    <strong id="effectiveRate">0%</strong>
                </div>
                <div class="result-row">
                    <span>èµ„äº§ç¿»å€æ—¶é—´</span>
                    <strong id="doubleTime">-</strong>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3>èµ„äº§å¢é•¿å›¾è¡¨</h3>
            <div class="bar-chart" id="barChart"></div>
            <div class="legend">
                <span><div class="legend-box" style="background: var(--pico-primary);"></div> æœ¬é‡‘</span>
                <span><div class="legend-box" style="background: var(--pico-secondary);"></div> åˆ©æ¯</span>
            </div>
        </div>

        <details style="margin-top: 2rem;">
            <summary>æŸ¥çœ‹é€å¹´æ˜ç»†</summary>
            <table id="detailTable">
                <thead>
                    <tr><th>å¹´ä»½</th><th>æœŸåˆé‡‘é¢</th><th>æœ¬æœŸæŠ•å…¥</th><th>æœ¬æœŸåˆ©æ¯</th><th>æœŸæœ«é‡‘é¢</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </details>

        <article style="margin-top: 2rem;">
            <h4>å¤åˆ©å…¬å¼</h4>
            <p><strong>åŸºæœ¬å¤åˆ©å…¬å¼</strong>ï¼šA = P(1 + r/n)^(nt)</p>
            <p><strong>å«å®šæœŸæŠ•èµ„</strong>ï¼šA = P(1 + r/n)^(nt) + PMT Ã— [((1 + r/n)^(nt) - 1) / (r/n)]</p>
            <ul>
                <li>A = æœ€ç»ˆé‡‘é¢</li>
                <li>P = åˆå§‹æœ¬é‡‘</li>
                <li>r = å¹´åˆ©ç‡</li>
                <li>n = æ¯å¹´å¤åˆ©æ¬¡æ•°</li>
                <li>t = æŠ•èµ„å¹´æ•°</li>
                <li>PMT = æ¯æœŸæŠ•èµ„é¢</li>
            </ul>
        </article>
    </main>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function formatMoney(num) {
            return 'Â¥' + num.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function calculate() {
            const P = parseFloat(document.getElementById('principal').value) || 0;
            const r = parseFloat(document.getElementById('rate').value) / 100;
            const t = parseInt(document.getElementById('years').value) || 1;
            const n = parseInt(document.getElementById('frequency').value);
            const PMT = parseFloat(document.getElementById('contribution').value) || 0;
            const timing = document.getElementById('contributionTiming').value;

            const yearlyData = [];
            let balance = P;
            let totalContributed = P;

            for (let year = 1; year <= t; year++) {
                const startBalance = balance;
                let yearInterest = 0;
                const yearContribution = PMT * n;
                
                for (let period = 0; period < n; period++) {
                    if (timing === 'start') {
                        balance += PMT;
                    }
                    const interest = balance * (r / n);
                    yearInterest += interest;
                    balance += interest;
                    if (timing === 'end') {
                        balance += PMT;
                    }
                }
                
                totalContributed += yearContribution;
                
                yearlyData.push({
                    year,
                    startBalance,
                    contribution: yearContribution,
                    interest: yearInterest,
                    endBalance: balance,
                    principal: totalContributed,
                    totalInterest: balance - totalContributed
                });
            }

            const finalAmount = balance;
            const totalInterest = finalAmount - totalContributed;
            const interestRatio = (totalInterest / finalAmount) * 100;
            const effectiveRate = (Math.pow(finalAmount / P, 1/t) - 1) * 100;
            const doubleTime = Math.log(2) / Math.log(1 + r);

            document.getElementById('finalAmount').textContent = formatMoney(finalAmount);
            document.getElementById('totalPrincipal').textContent = formatMoney(totalContributed);
            document.getElementById('totalInterest').textContent = formatMoney(totalInterest);
            document.getElementById('interestRatio').textContent = interestRatio.toFixed(2) + '%';
            document.getElementById('effectiveRate').textContent = effectiveRate.toFixed(2) + '%';
            document.getElementById('doubleTime').textContent = doubleTime.toFixed(1) + ' å¹´';

            // Draw chart
            const maxValue = finalAmount;
            const chart = document.getElementById('barChart');
            chart.textContent = '';
            
            const step = Math.max(1, Math.floor(t / 10));
            for (let i = 0; i < yearlyData.length; i += step) {
                const data = yearlyData[i];
                const row = document.createElement('div');
                row.className = 'bar-row';
                
                const principalWidth = (data.principal / maxValue) * 100;
                const interestWidth = (data.totalInterest / maxValue) * 100;
                
                row.innerHTML = '<div class="bar-label">ç¬¬' + data.year + 'å¹´</div>' +
                    '<div class="bar-container">' +
                    '<div class="bar-principal" style="width: ' + principalWidth + '%"></div>' +
                    '<div class="bar-interest" style="width: ' + interestWidth + '%"></div>' +
                    '</div>' +
                    '<div class="bar-value">' + formatMoney(data.endBalance) + '</div>';
                chart.appendChild(row);
            }

            // Update table
            const tbody = document.querySelector('#detailTable tbody');
            tbody.textContent = '';
            yearlyData.forEach(data => {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td>' + data.year + '</td>' +
                    '<td>' + formatMoney(data.startBalance) + '</td>' +
                    '<td>' + formatMoney(data.contribution) + '</td>' +
                    '<td>' + formatMoney(data.interest) + '</td>' +
                    '<td>' + formatMoney(data.endBalance) + '</td>';
                tbody.appendChild(tr);
            });
        }

        loadTheme();
        calculate();
    </script>
</body>
</html>

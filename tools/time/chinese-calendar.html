<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†œåŽ†æ—¥åŽ† - Chinese Calendar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --primary-color: #dc2626; }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 500px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        header h1 { margin: 0; font-size: 1.5rem; }
        .theme-toggle { background: var(--primary-color); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; }
        .panel { background: var(--card-background-color); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--muted-border-color); }
        .nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .nav button { background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0.5rem; }
        .nav .current { font-size: 1.2rem; font-weight: 600; }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 0.8rem; color: var(--muted-color); margin-bottom: 0.5rem; }
        .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
        .day:hover { background: rgba(220, 38, 38, 0.1); }
        .day.today { background: var(--primary-color); color: white; }
        .day.selected { outline: 2px solid var(--primary-color); }
        .day.other-month { opacity: 0.3; }
        .day .lunar { font-size: 0.6rem; color: var(--muted-color); margin-top: 2px; }
        .day.today .lunar { color: rgba(255,255,255,0.8); }
        .day.festival .lunar { color: var(--primary-color); font-weight: 500; }
        .day.today.festival .lunar { color: #fef08a; }
        .detail { margin-top: 1rem; padding: 1rem; background: var(--code-background-color); border-radius: 8px; }
        .detail h3 { margin: 0 0 0.5rem; font-size: 1.2rem; color: var(--primary-color); }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem; }
        .detail-grid .label { color: var(--muted-color); }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 1rem 1.5rem; background: var(--primary-color); color: white; border-radius: 8px; z-index: 1000; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“… å†œåŽ†æ—¥åŽ†</h1>
            <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
        </header>
        <div class="panel">
            <div class="nav">
                <button onclick="changeMonth(-1)">â—€</button>
                <span class="current" id="currentMonth"></span>
                <button onclick="changeMonth(1)">â–¶</button>
            </div>
            <div class="weekdays">
                <span>æ—¥</span><span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span>
            </div>
            <div class="days" id="daysGrid"></div>
            <div class="detail" id="detail"></div>
        </div>
    </div>
    <script>
        const LUNAR_INFO = [0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0];
        const LUNAR_MONTH = ['æ­£','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','å†¬','è…Š'];
        const LUNAR_DAY = ['åˆä¸€','åˆäºŒ','åˆä¸‰','åˆå››','åˆäº”','åˆå…­','åˆä¸ƒ','åˆå…«','åˆä¹','åˆå','åä¸€','åäºŒ','åä¸‰','åå››','åäº”','åå…­','åä¸ƒ','åå…«','åä¹','äºŒå','å»¿ä¸€','å»¿äºŒ','å»¿ä¸‰','å»¿å››','å»¿äº”','å»¿å…­','å»¿ä¸ƒ','å»¿å…«','å»¿ä¹','ä¸‰å'];
        const ANIMALS = ['é¼ ','ç‰›','è™Ž','å…”','é¾™','è›‡','é©¬','ç¾Š','çŒ´','é¸¡','ç‹—','çŒª'];
        const GAN = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
        const ZHI = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
        const FESTIVALS = {'1-1':'æ˜¥èŠ‚','1-15':'å…ƒå®µèŠ‚','5-5':'ç«¯åˆèŠ‚','7-7':'ä¸ƒå¤•','8-15':'ä¸­ç§‹èŠ‚','9-9':'é‡é˜³èŠ‚','12-30':'é™¤å¤•'};
        const SOLAR_FESTIVALS = {'1-1':'å…ƒæ—¦','2-14':'æƒ…äººèŠ‚','3-8':'å¦‡å¥³èŠ‚','4-1':'æ„šäººèŠ‚','5-1':'åŠ³åŠ¨èŠ‚','6-1':'å„¿ç«¥èŠ‚','10-1':'å›½åº†èŠ‚','12-25':'åœ£è¯žèŠ‚'};
        
        let currentYear, currentMonth, selectedDate;
        
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            selectedDate = today;
            render();
        });
        
        function initTheme() { const s = localStorage.getItem('theme'); if (s) document.documentElement.setAttribute('data-theme', s); }
        window.toggleTheme = function() { const c = document.documentElement.getAttribute('data-theme'); const n = c === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('theme', n); };
        
        function lYear(y) { return LUNAR_INFO[y - 1900] & 0xffff; }
        function leapMonth(y) { return LUNAR_INFO[y - 1900] & 0xf; }
        function leapDays(y) { return leapMonth(y) ? ((LUNAR_INFO[y - 1900] & 0x10000) ? 30 : 29) : 0; }
        function monthDays(y, m) { return (LUNAR_INFO[y - 1900] & (0x10000 >> m)) ? 30 : 29; }
        
        function toLunar(date) {
            let y = date.getFullYear(), m = date.getMonth() + 1, d = date.getDate();
            let offset = Math.floor((Date.UTC(y, m - 1, d) - Date.UTC(1900, 0, 31)) / 86400000);
            let ly = 1900, lm = 1, ld, leap = 0, isLeap = false;
            
            for (; ly < 2101 && offset > 0; ly++) offset -= lYear(ly);
            if (offset < 0) { offset += lYear(ly); ly--; }
            
            leap = leapMonth(ly);
            for (lm = 1; lm < 13 && offset > 0; lm++) {
                if (leap > 0 && lm === leap + 1 && !isLeap) { lm--; isLeap = true; }
                else if (isLeap && lm === leap + 1) isLeap = false;
                offset -= isLeap ? leapDays(ly) : monthDays(ly, lm);
            }
            if (offset === 0 && leap > 0 && lm === leap + 1) { if (isLeap) isLeap = false; else { isLeap = true; lm--; } }
            if (offset < 0) { offset += isLeap ? leapDays(ly) : monthDays(ly, lm); lm--; }
            ld = offset + 1;
            
            return { year: ly, month: lm, day: ld, isLeap: isLeap };
        }
        
        function getGanZhi(y) { return GAN[(y - 4) % 10] + ZHI[(y - 4) % 12]; }
        function getAnimal(y) { return ANIMALS[(y - 4) % 12]; }
        
        function render() {
            document.getElementById('currentMonth').textContent = currentYear + 'å¹´' + (currentMonth + 1) + 'æœˆ';
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDay = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            const today = new Date();
            
            let html = '';
            const prevMonth = new Date(currentYear, currentMonth, 0);
            for (let i = startDay - 1; i >= 0; i--) {
                const d = new Date(currentYear, currentMonth - 1, prevMonth.getDate() - i);
                html += renderDay(d, true, today);
            }
            for (let i = 1; i <= daysInMonth; i++) {
                const d = new Date(currentYear, currentMonth, i);
                html += renderDay(d, false, today);
            }
            const remaining = 42 - (startDay + daysInMonth);
            for (let i = 1; i <= remaining; i++) {
                const d = new Date(currentYear, currentMonth + 1, i);
                html += renderDay(d, true, today);
            }
            
            document.getElementById('daysGrid').innerHTML = html;
            showDetail(selectedDate);
        }
        
        function renderDay(date, isOther, today) {
            const lunar = toLunar(date);
            const lunarText = lunar.day === 1 ? (lunar.isLeap ? 'é—°' : '') + LUNAR_MONTH[lunar.month - 1] + 'æœˆ' : LUNAR_DAY[lunar.day - 1];
            const festival = FESTIVALS[lunar.month + '-' + lunar.day] || SOLAR_FESTIVALS[(date.getMonth() + 1) + '-' + date.getDate()];
            const isToday = date.toDateString() === today.toDateString();
            const isSelected = date.toDateString() === selectedDate.toDateString();
            
            let cls = 'day';
            if (isOther) cls += ' other-month';
            if (isToday) cls += ' today';
            if (isSelected) cls += ' selected';
            if (festival) cls += ' festival';
            
            return '<div class="' + cls + '" onclick="selectDate(' + date.getFullYear() + ',' + date.getMonth() + ',' + date.getDate() + ')">' +
                '<span>' + date.getDate() + '</span>' +
                '<span class="lunar">' + (festival || lunarText) + '</span>' +
            '</div>';
        }
        
        window.selectDate = function(y, m, d) {
            selectedDate = new Date(y, m, d);
            render();
        };
        
        function showDetail(date) {
            const lunar = toLunar(date);
            const festival = FESTIVALS[lunar.month + '-' + lunar.day] || SOLAR_FESTIVALS[(date.getMonth() + 1) + '-' + date.getDate()];
            
            document.getElementById('detail').innerHTML = 
                '<h3>' + date.getFullYear() + 'å¹´' + (date.getMonth() + 1) + 'æœˆ' + date.getDate() + 'æ—¥</h3>' +
                '<div class="detail-grid">' +
                    '<span class="label">å†œåŽ†</span><span>' + (lunar.isLeap ? 'é—°' : '') + LUNAR_MONTH[lunar.month - 1] + 'æœˆ' + LUNAR_DAY[lunar.day - 1] + '</span>' +
                    '<span class="label">å¹²æ”¯å¹´</span><span>' + getGanZhi(lunar.year) + 'å¹´ (' + getAnimal(lunar.year) + ')</span>' +
                    '<span class="label">èŠ‚æ—¥</span><span>' + (festival || '-') + '</span>' +
                    '<span class="label">æ˜ŸæœŸ</span><span>æ˜ŸæœŸ' + 'æ—¥ä¸€äºŒä¸‰å››äº”å…­'[date.getDay()] + '</span>' +
                '</div>';
        }
        
        window.changeMonth = function(delta) {
            currentMonth += delta;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            render();
        };
    </script>
</body>
</html>

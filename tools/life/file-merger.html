<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶åˆå¹¶å™¨ - WebUtils</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root { --primary-color: #8b5cf6; --success-color: #10b981; }
        body { padding: 1rem; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        header h1 { margin: 0; font-size: 1.75rem; }
        .theme-toggle { cursor: pointer; background: var(--primary-color); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; }
        .panel { background: var(--card-background-color); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--muted-border-color); margin-bottom: 1rem; }
        .drop-zone { border: 2px dashed var(--muted-border-color); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem; }
        .drop-zone:hover, .drop-zone.dragover { border-color: var(--primary-color); background: rgba(139,92,246,0.1); }
        .drop-zone input { display: none; }
        .file-list { max-height: 300px; overflow-y: auto; }
        .file-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--code-background-color); border-radius: 8px; margin-bottom: 0.5rem; cursor: grab; }
        .file-item.dragging { opacity: 0.5; }
        .file-item .info { flex: 1; }
        .file-item .name { font-weight: 500; font-size: 0.9rem; }
        .file-item .size { font-size: 0.75rem; color: var(--muted-color); }
        .file-item .remove { background: none; border: none; color: #ef4444; cursor: pointer; font-size: 1.2rem; }
        .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .btn-primary { background: var(--primary-color); border-color: var(--primary-color); }
        .btn-success { background: var(--success-color); border-color: var(--success-color); }
        .preview { background: var(--code-background-color); padding: 1rem; border-radius: 8px; max-height: 200px; overflow: auto; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; word-break: break-all; }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 1rem 1.5rem; background: var(--primary-color); color: white; border-radius: 8px; z-index: 1000; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ æ–‡ä»¶åˆå¹¶å™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ¢ä¸»é¢˜</button>
        </header>
        <div class="panel">
            <h3>ğŸ“ æ·»åŠ æ–‡ä»¶</h3>
            <div class="drop-zone" id="dropZone">
                <input type="file" id="fileInput" multiple>
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“„</div>
                <p>æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œ<br><small>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</small></p>
            </div>
            <div class="file-list" id="fileList"></div>
            <button class="outline" style="width: 100%;" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
        </div>
        <div class="panel">
            <h3>âš™ï¸ åˆå¹¶é€‰é¡¹</h3>
            <div class="options">
                <label>åˆ†éš”ç¬¦<select id="separator">
                    <option value="\n">æ¢è¡Œç¬¦</option>
                    <option value="\n\n">åŒæ¢è¡Œ</option>
                    <option value="\n---\n">åˆ†éš”çº¿</option>
                    <option value="">æ— åˆ†éš”</option>
                </select></label>
                <label><input type="checkbox" id="addFilename" checked> æ·»åŠ æ–‡ä»¶åæ³¨é‡Š</label>
                <label><input type="checkbox" id="trimContent"> å»é™¤é¦–å°¾ç©ºç™½</label>
            </div>
        </div>
        <div class="panel">
            <h3>ğŸ‘ï¸ é¢„è§ˆ</h3>
            <div class="preview" id="preview">åˆå¹¶åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button class="btn-primary" onclick="mergeFiles()" style="flex: 1;">ğŸ”„ åˆå¹¶é¢„è§ˆ</button>
                <button class="btn-success" onclick="downloadMerged()" style="flex: 1;">ğŸ’¾ ä¸‹è½½</button>
                <button onclick="copyMerged()" style="flex: 1;">ğŸ“‹ å¤åˆ¶</button>
            </div>
        </div>
    </div>
    <script>
        let files = [], mergedContent = '';
        document.addEventListener('DOMContentLoaded', () => { initTheme(); initDropZone(); });
        function initTheme() { const s = localStorage.getItem('theme'); if (s) document.documentElement.setAttribute('data-theme', s); }
        window.toggleTheme = function() { const c = document.documentElement.getAttribute('data-theme'); const n = c === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('theme', n); };
        function initDropZone() {
            const dz = document.getElementById('dropZone'), fi = document.getElementById('fileInput');
            dz.addEventListener('click', () => fi.click());
            dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
            dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
            dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
            fi.addEventListener('change', e => { handleFiles(e.target.files); e.target.value = ''; });
        }
        function handleFiles(fl) { Array.from(fl).forEach(f => { const r = new FileReader(); r.onload = e => { files.push({name: f.name, size: f.size, content: e.target.result}); renderList(); }; r.readAsText(f); }); }
        function renderList() { document.getElementById('fileList').innerHTML = files.map((f,i) => '<div class="file-item"><span>ğŸ“„</span><div class="info"><div class="name">'+f.name+'</div><div class="size">'+formatSize(f.size)+'</div></div><button class="remove" onclick="files.splice('+i+',1);renderList()">Ã—</button></div>').join(''); }
        window.clearAll = function() { files = []; renderList(); document.getElementById('preview').textContent = 'åˆå¹¶åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...'; };
        function mergeFiles() {
            if (!files.length) { showToast('è¯·å…ˆæ·»åŠ æ–‡ä»¶'); return; }
            let sep = document.getElementById('separator').value.replace(/\\n/g, '\n');
            const addFn = document.getElementById('addFilename').checked, trim = document.getElementById('trimContent').checked;
            mergedContent = files.map(f => { let c = f.content; if (trim) c = c.trim(); if (addFn) c = '// === ' + f.name + ' ===\n' + c; return c; }).join(sep);
            document.getElementById('preview').textContent = mergedContent;
        }
        function downloadMerged() { if (!mergedContent) mergeFiles(); if (!mergedContent) return; const b = new Blob([mergedContent], {type:'text/plain'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'merged.txt'; a.click(); }
        window.copyMerged = async function() { if (!mergedContent) mergeFiles(); if (!mergedContent) return; await navigator.clipboard.writeText(mergedContent); showToast('å·²å¤åˆ¶'); };
        function formatSize(b) { if (b < 1024) return b + ' B'; if (b < 1048576) return (b/1024).toFixed(1) + ' KB'; return (b/1048576).toFixed(2) + ' MB'; }
        function showToast(m) { const t = document.createElement('div'); t.className = 'toast'; t.textContent = m; document.body.appendChild(t); setTimeout(() => t.remove(), 2000); }
    </script>
</body>
</html>

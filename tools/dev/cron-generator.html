<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cron 生成器 - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="可视化生成 Cron 表达式" />
  <meta name="keywords" content="cron 定时任务 生成器 调度 scheduler" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/cron-generator.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Cron 生成器 - WebUtils" />
  <meta property="og:description" content="可视化生成 Cron 表达式" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/cron-generator.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cron 生成器 - WebUtils" />
  <meta name="twitter:description" content="可视化生成 Cron 表达式" />
  <!-- OG Image -->
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }
    .bg-grid {
      position: fixed; inset: 0;
      background-image: 
        linear-gradient(rgb(0, 245, 212, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgb(0, 245, 212, 0.02) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none; z-index: 0;
    }
    .container {
      position: relative; z-index: 1;
      max-width: 900px; margin: 0 auto; padding: 24px;
    }
    .header {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 24px; flex-wrap: wrap;
    }
    .back-link {
      display: inline-flex; align-items: center; gap: 8px;
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      color: var(--text-secondary); text-decoration: none;
      padding: 8px 14px; background: var(--bg-surface);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }
    .back-link:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    .title-section { flex: 1; }
    .title-section h1 {
      font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 600;
      display: flex; align-items: center; gap: 12px;
    }
    .title-icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--accent-cyan), #4cc9f0);
      border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; color: var(--bg-deep);
    }
    .title-section .desc { font-size: 0.9rem; color: var(--text-secondary); margin-top: 4px; }
    .main-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 24px;
    }
    .cron-result {
      background: var(--bg-input); border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md); padding: 20px; margin-bottom: 24px;
      text-align: center;
    }
    .cron-expression {
      font-family: 'JetBrains Mono', monospace; font-size: 1.8rem; font-weight: 600;
      color: var(--accent-cyan); letter-spacing: 0.1em; margin-bottom: 12px;
    }
    .cron-description {
      font-size: 0.9rem; color: var(--text-secondary);
    }
    .cron-actions {
      display: flex; gap: 10px; justify-content: center; margin-top: 16px;
    }
    button {
      font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 500;
      padding: 10px 16px; background: var(--bg-surface);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-sm);
      color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease;
    }
    button:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    button.primary { background: var(--accent-cyan); color: var(--bg-deep); border: none; }
    button.primary:hover { background: #00dfc4; box-shadow: 0 0 20px var(--glow-cyan); }
    .cron-fields { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px; }
    @media (width <= 700px) { .cron-fields { grid-template-columns: repeat(3, 1fr); } }
    @media (width <= 500px) { .cron-fields { grid-template-columns: 1fr 1fr; } }
    .field-group { display: flex; flex-direction: column; gap: 8px; }
    .field-label {
      font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
      color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em;
    }
    select, input[type="text"] {
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      padding: 10px 12px; background: var(--bg-input);
      border: 2px solid var(--border-subtle); border-radius: var(--radius-sm);
      color: var(--text-primary); cursor: pointer; transition: all 0.2s ease;
    }
    select:focus, input:focus { outline: none; border-color: var(--accent-cyan); }
    .presets { margin-bottom: 24px; }
    .presets h3 {
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      color: var(--text-muted); margin-bottom: 12px;
    }
    .preset-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .preset-item {
      font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
      padding: 8px 14px; background: var(--bg-surface);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-sm);
      color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease;
    }
    .preset-item:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    .next-runs {
      background: var(--bg-surface); border-radius: var(--radius-md); padding: 16px;
    }
    .next-runs h3 {
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      color: var(--text-muted); margin-bottom: 12px;
    }
    .run-list { list-style: none; }
    .run-list li {
      font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
      color: var(--text-secondary); padding: 6px 0;
      border-bottom: 1px solid var(--border-subtle);
    }
    .run-list li:last-child { border-bottom: none; }
    footer {
      text-align: center; margin-top: 24px; padding-top: 16px;
      border-top: 1px solid var(--border-subtle);
    }
    footer p {
      font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-muted);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    footer a { color: var(--accent-cyan); text-decoration: none; }
    footer a:hover { color: var(--text-primary); }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="container">
    <div class="header">
      <a href="../../index.html" class="back-link">← 返回</a>
      <div class="title-section">
        <h1><span class="title-icon">⏰</span>Cron 生成器</h1>
        <p class="desc">可视化生成 Cron 表达式，预览执行时间</p>
      </div>
    </div>

    <div class="main-card">
      <div class="cron-result">
        <div class="cron-expression" id="cronExpr">* * * * *</div>
        <div class="cron-description" id="cronDesc">每分钟执行</div>
        <div class="cron-actions">
          <button id="btnCopy" class="primary">复制表达式</button>
          <button id="btnReset">重置</button>
        </div>
      </div>

      <div class="presets">
        <h3>常用预设</h3>
        <div class="preset-list">
          <span class="preset-item" data-cron="* * * * *">每分钟</span>
          <span class="preset-item" data-cron="*/5 * * * *">每5分钟</span>
          <span class="preset-item" data-cron="0 * * * *">每小时</span>
          <span class="preset-item" data-cron="0 0 * * *">每天0点</span>
          <span class="preset-item" data-cron="0 9 * * *">每天9点</span>
          <span class="preset-item" data-cron="0 9 * * 1-5">工作日9点</span>
          <span class="preset-item" data-cron="0 0 * * 0">每周日0点</span>
          <span class="preset-item" data-cron="0 0 1 * *">每月1日0点</span>
          <span class="preset-item" data-cron="0 0 1 1 *">每年1月1日</span>
        </div>
      </div>

      <div class="cron-fields">
        <div class="field-group">
          <label class="field-label">分钟 (0-59)</label>
          <select id="minute">
            <option value="*">每分钟 (*)</option>
            <option value="*/5">每5分钟 (*/5)</option>
            <option value="*/10">每10分钟 (*/10)</option>
            <option value="*/15">每15分钟 (*/15)</option>
            <option value="*/30">每30分钟 (*/30)</option>
            <option value="0">0分</option>
            <option value="15">15分</option>
            <option value="30">30分</option>
            <option value="45">45分</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">小时 (0-23)</label>
          <select id="hour">
            <option value="*">每小时 (*)</option>
            <option value="*/2">每2小时 (*/2)</option>
            <option value="*/6">每6小时 (*/6)</option>
            <option value="*/12">每12小时</option>
            <option value="0">0点</option>
            <option value="6">6点</option>
            <option value="9">9点</option>
            <option value="12">12点</option>
            <option value="18">18点</option>
            <option value="9-18">9-18点</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">日期 (1-31)</label>
          <select id="day">
            <option value="*">每天 (*)</option>
            <option value="1">1日</option>
            <option value="15">15日</option>
            <option value="1,15">1日和15日</option>
            <option value="L">最后一天 (L)</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">月份 (1-12)</label>
          <select id="month">
            <option value="*">每月 (*)</option>
            <option value="1">1月</option>
            <option value="*/3">每季度 (*/3)</option>
            <option value="*/6">每半年 (*/6)</option>
            <option value="1,7">1月和7月</option>
          </select>
        </div>
        <div class="field-group">
          <label class="field-label">星期 (0-6)</label>
          <select id="weekday">
            <option value="*">每天 (*)</option>
            <option value="1-5">周一至周五</option>
            <option value="0,6">周末</option>
            <option value="1">周一</option>
            <option value="5">周五</option>
            <option value="0">周日</option>
          </select>
        </div>
      </div>

      <div class="next-runs">
        <h3>接下来5次执行时间</h3>
        <ul class="run-list" id="nextRuns">
          <li>计算中...</li>
        </ul>
      </div>
    </div>

    <footer>
      <p>
        <a href="https://github.com/chicogong/html-tools" target="_blank">GitHub</a>
        <span>·</span><span>纯前端 · 无服务器</span><span>·</span>
        <a href="../../index.html">WebUtils</a>
      </p>
    </footer>
  </div>

  <script>
    const minuteEl = document.getElementById('minute');
    const hourEl = document.getElementById('hour');
    const dayEl = document.getElementById('day');
    const monthEl = document.getElementById('month');
    const weekdayEl = document.getElementById('weekday');
    const cronExprEl = document.getElementById('cronExpr');
    const cronDescEl = document.getElementById('cronDesc');
    const nextRunsEl = document.getElementById('nextRuns');

    function updateCron() {
      const expr = [minuteEl.value, hourEl.value, dayEl.value, monthEl.value, weekdayEl.value].join(' ');
      cronExprEl.textContent = expr;
      cronDescEl.textContent = describeCron(expr);
      calculateNextRuns(expr);
    }

    function describeCron(expr) {
      const [min, hour, day, month, weekday] = expr.split(' ');
      const parts = [];

      if (min === '*' && hour === '*' && day === '*' && month === '*' && weekday === '*') {
        return '每分钟执行';
      }

      // Minute
      if (min === '*') parts.push('每分钟');
      else if (min.startsWith('*/')) parts.push('每' + min.slice(2) + '分钟');
      else parts.push('第' + min + '分');

      // Hour
      if (hour === '*') {}
      else if (hour.startsWith('*/')) parts.push('每' + hour.slice(2) + '小时');
      else if (hour.includes('-')) parts.push(hour.replace('-', '点到') + '点');
      else parts.push(hour + '点');

      // Day
      if (day !== '*') {
        if (day === 'L') parts.push('每月最后一天');
        else parts.push('每月' + day + '日');
      }

      // Month
      if (month !== '*') {
        if (month.startsWith('*/')) parts.push('每' + month.slice(2) + '个月');
        else parts.push(month + '月');
      }

      // Weekday
      if (weekday !== '*') {
        const weekdayNames = { '0': '周日', '1': '周一', '2': '周二', '3': '周三', '4': '周四', '5': '周五', '6': '周六' };
        if (weekday === '1-5') parts.push('工作日');
        else if (weekday === '0,6') parts.push('周末');
        else parts.push(weekdayNames[weekday] || '周' + weekday);
      }

      return parts.join(' ') + ' 执行';
    }

    function calculateNextRuns(expr) {
      const [minExpr, hourExpr, dayExpr, monthExpr, weekdayExpr] = expr.split(' ');
      const runs = [];
      const now = new Date();
      let current = new Date(now);
      current.setSeconds(0);
      current.setMilliseconds(0);

      for (let i = 0; i < 1000 && runs.length < 5; i++) {
        current = new Date(current.getTime() + 60000);
        if (matchesCron(current, minExpr, hourExpr, dayExpr, monthExpr, weekdayExpr)) {
          runs.push(formatDate(current));
        }
      }

      nextRunsEl.innerHTML = runs.map(r => '<li>' + r + '</li>').join('') || '<li>无法计算</li>';
    }

    function matchesCron(date, minExpr, hourExpr, dayExpr, monthExpr, weekdayExpr) {
      return matchField(date.getMinutes(), minExpr, 0, 59) &&
             matchField(date.getHours(), hourExpr, 0, 23) &&
             matchField(date.getDate(), dayExpr, 1, 31) &&
             matchField(date.getMonth() + 1, monthExpr, 1, 12) &&
             matchField(date.getDay(), weekdayExpr, 0, 6);
    }

    function matchField(value, expr, min, max) {
      if (expr === '*') return true;
      if (expr === 'L') return false; // Simplified
      if (expr.startsWith('*/')) {
        const step = parseInt(expr.slice(2));
        return value % step === 0;
      }
      if (expr.includes(',')) {
        return expr.split(',').map(Number).includes(value);
      }
      if (expr.includes('-')) {
        const [start, end] = expr.split('-').map(Number);
        return value >= start && value <= end;
      }
      return parseInt(expr) === value;
    }

    function formatDate(date) {
      const pad = n => n.toString().padStart(2, '0');
      return date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +
             ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());
    }

    function setCron(expr) {
      const [min, hour, day, month, weekday] = expr.split(' ');
      setSelectValue(minuteEl, min);
      setSelectValue(hourEl, hour);
      setSelectValue(dayEl, day);
      setSelectValue(monthEl, month);
      setSelectValue(weekdayEl, weekday);
      updateCron();
    }

    function setSelectValue(select, value) {
      for (let opt of select.options) {
        if (opt.value === value) { select.value = value; return; }
      }
      // Add custom option if not found
      const opt = document.createElement('option');
      opt.value = value;
      opt.textContent = value;
      select.appendChild(opt);
      select.value = value;
    }

    // Event listeners
    [minuteEl, hourEl, dayEl, monthEl, weekdayEl].forEach(el => {
      el.addEventListener('change', updateCron);
    });

    document.getElementById('btnCopy').onclick = async function() {
      try {
        await navigator.clipboard.writeText(cronExprEl.textContent);
        this.textContent = '已复制!';
        setTimeout(() => this.textContent = '复制表达式', 1500);
      } catch (e) {}
    };

    document.getElementById('btnReset').onclick = function() {
      setCron('* * * * *');
    };

    document.querySelectorAll('.preset-item').forEach(item => {
      item.setAttribute('tabindex', '0');
      item.onclick = function() {
        setCron(this.dataset.cron);
      };
      item.onkeydown = function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          setCron(this.dataset.cron);
        }
      };
    });

    // Initialize
    updateCron();
  </script>
</body>
</html>

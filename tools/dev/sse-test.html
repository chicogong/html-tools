<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="keywords" content="sse-test,dev,tools,webutils" />
  <meta name="author" content="WebUtils" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://tools.realtime-ai.chat/tools/dev/sse-test.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta property="og:description" content="SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tools.realtime-ai.chat/tools/dev/sse-test.html" />
  <meta property="og:site_name" content="WebUtils" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
  <meta property="og:image:width" content="1280" />
  <meta property="og:image:height" content="640" />
  <meta property="og:image:type" content="image/png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="twitter:description" content="SSEæµ‹è¯•å®¢æˆ·ç«¯ - WebUtils" />
  <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-input: #0e0e14;
      --text-primary: #e8e8ed;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --border-subtle: #2a2a3a;
      --border-strong: #3a3a4a;
      --accent-cyan: #00f5d4;
      --accent-green: #10b981;
      --accent-red: #f43f5e;
      --accent-yellow: #fbbf24;
      --accent-purple: #a855f7;
      --glow-cyan: rgb(0, 245, 212, 0.15);
      --glow-green: rgb(16, 185, 129, 0.15);
      --glow-red: rgb(244, 63, 94, 0.15);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    [data-theme="light"] {
      --bg-deep: #fafafa;
      --bg-surface: #fff;
      --bg-card: #fff;
      --bg-input: #f5f5f5;
      --bg-hover: #f5f5f5;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --text-muted: #999;
      --border-subtle: #e5e5e5;
      --border-strong: #d5d5d5;
    }

    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      cursor: pointer;
      font-size: 1.2rem;
      z-index: 100;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

        :root {
            --event-default: #e2e3e5;
            --event-message: #d4edda;
            --event-custom: #cce5ff;
            --event-error: #f8d7da;
            --event-system: #fff3cd;
        }
        [data-theme="dark"] {
            --event-default: #3a3b3c;
            --event-message: #1e4620;
            --event-custom: #004085;
            --event-error: #58151c;
            --event-system: #664d03;
        }
        .container {
            max-width: 1000px;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .status-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-closed .status-dot { background: #dc3545; }
        .status-connecting .status-dot { background: #ffc107; animation: pulse 2s infinite; }
        .status-open .status-dot { background: #28a745; animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .connection-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }
        .connection-form input {
            margin-bottom: 0;
        }
        .event-log {
            height: 450px;
            overflow-y: auto;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--pico-background-color);
            font-family: monospace;
            font-size: 0.9rem;
        }
        .event-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .event-default { background: var(--event-default); border-left-color: #6c757d; }
        .event-message { background: var(--event-message); border-left-color: #28a745; }
        .event-custom { background: var(--event-custom); border-left-color: #007bff; }
        .event-error { background: var(--event-error); border-left-color: #dc3545; }
        .event-system { background: var(--event-system); border-left-color: #ffc107; }
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        .event-type {
            font-weight: bold;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(0,0,0,0.1);
        }
        .event-data {
            word-break: break-all;
            white-space: pre-wrap;
        }
        .event-id {
            font-size: 0.75rem;
            opacity: 0.6;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            text-align: center;
            padding: 1rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            border: 1px solid var(--pico-muted-border-color);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--pico-primary);
        }
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        .filter-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        .filter-section label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .btn-group {
            display: flex;
            gap: 8px;
        }
        .custom-events {
            margin-top: 1rem;
        }
        .custom-events input {
            margin-bottom: 0;
        }
        .event-listeners {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0.5rem;
        }
        .event-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--pico-primary);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .event-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            margin: 0;
            font-size: 1rem;
            line-height: 1;
        }
        .reconnect-info {
            font-size: 0.85rem;
            opacity: 0.8;
        }
    
        .breadcrumb {     background: rgba(255,255,255,0.95); padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 0.85rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 5px; }
    </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="åˆ‡æ¢ä¸»é¢˜">
    <span id="theme-icon">ğŸŒ™</span>
  </button>

    <nav class="breadcrumb"><a href="../../index.html">é¦–é¡µ</a><span>â€º</span>SSEæµ‹è¯•å®¢æˆ·ç«¯</nav>
    <main class="container">
        <a href="../../index.html" style="display:inline-block;margin-bottom:1rem;color:var(--pico-primary);text-decoration:none;">â† è¿”å›é¦–é¡µ</a>
        <div class="header">
            <h1>SSEæµ‹è¯•å®¢æˆ·ç«¯</h1>
            <button id="themeToggle" class="outline">åˆ‡æ¢ä¸»é¢˜</button>
        </div>

        <div class="status-bar">
            <div class="status-indicator status-closed" id="statusIndicator">
                <span class="status-dot"></span>
                <span id="statusText">æœªè¿æ¥</span>
            </div>
            <span class="reconnect-info" id="reconnectInfo"></span>
        </div>

        <article>
            <header>è¿æ¥è®¾ç½®</header>
            <div class="connection-form">
                <div>
                    <label>SSEç«¯ç‚¹URL</label>
                    <input type="text" id="sseUrl" placeholder="https://example.com/events æˆ– /api/sse">
                </div>
                <div class="btn-group">
                    <button id="connectBtn">è¿æ¥</button>
                    <button id="disconnectBtn" class="secondary" disabled>æ–­å¼€</button>
                </div>
            </div>
            <details>
                <summary>é«˜çº§é€‰é¡¹</summary>
                <div style="margin-top: 1rem;">
                    <label>
                        <input type="checkbox" id="withCredentials">
                        å‘é€å‡­è¯ (withCredentials)
                    </label>
                </div>
                <div class="custom-events">
                    <label>è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="customEventInput" placeholder="è¾“å…¥äº‹ä»¶åç§°ï¼Œå¦‚: update, notification">
                        <button id="addEventBtn" class="outline">æ·»åŠ </button>
                    </div>
                    <div class="event-listeners" id="eventListeners"></div>
                </div>
            </details>
        </article>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalEvents">0</div>
                <div class="stat-label">æ€»äº‹ä»¶æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="messageEvents">0</div>
                <div class="stat-label">messageäº‹ä»¶</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="customEventsCount">0</div>
                <div class="stat-label">è‡ªå®šä¹‰äº‹ä»¶</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="errorCount">0</div>
                <div class="stat-label">é”™è¯¯æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="reconnectCount">0</div>
                <div class="stat-label">é‡è¿æ¬¡æ•°</div>
            </div>
        </div>

        <article>
            <header>
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <span>äº‹ä»¶æ—¥å¿—</span>
                    <div class="filter-section">
                        <label><input type="checkbox" id="filterMessage" checked> message</label>
                        <label><input type="checkbox" id="filterCustom" checked> è‡ªå®šä¹‰</label>
                        <label><input type="checkbox" id="filterSystem" checked> ç³»ç»Ÿ</label>
                        <label><input type="checkbox" id="filterError" checked> é”™è¯¯</label>
                    </div>
                    <button class="outline secondary" id="clearLog" style="padding: 4px 12px; font-size: 0.85rem;">æ¸…ç©º</button>
                </div>
            </header>
            <div class="event-log" id="eventLog">
                <div class="event-item event-system" data-type="system">
                    <div class="event-header">
                        <span class="event-type">ç³»ç»Ÿ</span>
                        <span>--:--:--</span>
                    </div>
                    <div class="event-data">ç­‰å¾…è¿æ¥SSEæœåŠ¡å™¨...</div>
                </div>
            </div>
        </article>

        <article>
            <header>ä½¿ç”¨è¯´æ˜</header>
            <ul>
                <li><strong>SSE (Server-Sent Events)ï¼š</strong>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€å®æ—¶æ•°æ®çš„æŠ€æœ¯</li>
                <li><strong>è‡ªåŠ¨é‡è¿ï¼š</strong>è¿æ¥æ–­å¼€åæµè§ˆå™¨ä¼šè‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥</li>
                <li><strong>äº‹ä»¶ç±»å‹ï¼š</strong>
                    <ul>
                        <li><code>message</code> - é»˜è®¤äº‹ä»¶ç±»å‹</li>
                        <li>è‡ªå®šä¹‰äº‹ä»¶ - æœåŠ¡å™¨å¯å‘é€å¸¦æœ‰ <code>event:</code> å­—æ®µçš„è‡ªå®šä¹‰ç±»å‹</li>
                    </ul>
                </li>
                <li><strong>äº‹ä»¶IDï¼š</strong>æœåŠ¡å™¨å¯å‘é€ <code>id:</code> å­—æ®µç”¨äºæ–­ç‚¹ç»­ä¼ </li>
                <li><strong>è‡ªå®šä¹‰ç›‘å¬ï¼š</strong>æ·»åŠ éœ€è¦ç›‘å¬çš„è‡ªå®šä¹‰äº‹ä»¶åç§°</li>
            </ul>
        </article>
    </main>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // SSEç›¸å…³
        let eventSource = null;
        let customEventTypes = new Set();
        let lastEventId = null;
        let stats = {
            total: 0,
            message: 0,
            custom: 0,
            error: 0,
            reconnect: 0
        };

        const sseUrl = document.getElementById('sseUrl');
        const withCredentials = document.getElementById('withCredentials');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const reconnectInfo = document.getElementById('reconnectInfo');
        const eventLog = document.getElementById('eventLog');
        const clearLog = document.getElementById('clearLog');
        const customEventInput = document.getElementById('customEventInput');
        const addEventBtn = document.getElementById('addEventBtn');
        const eventListeners = document.getElementById('eventListeners');

        // ç­›é€‰å™¨
        const filters = {
            message: document.getElementById('filterMessage'),
            custom: document.getElementById('filterCustom'),
            system: document.getElementById('filterSystem'),
            error: document.getElementById('filterError')
        };

        // è·å–å½“å‰æ—¶é—´
        function getTime() {
            return new Date().toLocaleTimeString('zh-CN', { hour12: false });
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalEvents').textContent = stats.total;
            document.getElementById('messageEvents').textContent = stats.message;
            document.getElementById('customEventsCount').textContent = stats.custom;
            document.getElementById('errorCount').textContent = stats.error;
            document.getElementById('reconnectCount').textContent = stats.reconnect;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(status) {
            statusIndicator.className = 'status-indicator status-' + status;
            const statusMap = {
                'closed': 'æœªè¿æ¥',
                'connecting': 'è¿æ¥ä¸­...',
                'open': 'å·²è¿æ¥'
            };
            statusText.textContent = statusMap[status] || status;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(type, eventType, data, eventId) {
            const item = document.createElement('div');
            item.className = 'event-item event-' + type;
            item.dataset.type = type;

            const typeLabel = {
                'message': 'MESSAGE',
                'custom': eventType.toUpperCase(),
                'system': 'ç³»ç»Ÿ',
                'error': 'é”™è¯¯',
                'default': eventType.toUpperCase()
            };

            const header = document.createElement('div');
            header.className = 'event-header';
            
            const typeSpan = document.createElement('span');
            typeSpan.className = 'event-type';
            typeSpan.textContent = typeLabel[type] || typeLabel.default;
            
            const timeSpan = document.createElement('span');
            timeSpan.textContent = getTime() + (eventId ? ' | ID: ' + eventId : '');
            
            header.appendChild(typeSpan);
            header.appendChild(timeSpan);
            
            const dataDiv = document.createElement('div');
            dataDiv.className = 'event-data';
            dataDiv.textContent = data;
            
            item.appendChild(header);
            item.appendChild(dataDiv);

            eventLog.appendChild(item);
            eventLog.scrollTop = eventLog.scrollHeight;
            applyFilters();
        }

        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            const items = eventLog.querySelectorAll('.event-item');
            items.forEach(item => {
                const type = item.dataset.type;
                if (type === 'message') {
                    item.style.display = filters.message.checked ? '' : 'none';
                } else if (type === 'custom') {
                    item.style.display = filters.custom.checked ? '' : 'none';
                } else if (type === 'system') {
                    item.style.display = filters.system.checked ? '' : 'none';
                } else if (type === 'error') {
                    item.style.display = filters.error.checked ? '' : 'none';
                }
            });
        }

        // è®¾ç½®æ§ä»¶çŠ¶æ€
        function setControlsEnabled(connected) {
            connectBtn.disabled = connected;
            disconnectBtn.disabled = !connected;
            sseUrl.disabled = connected;
            withCredentials.disabled = connected;
        }

        // æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬æ ‡ç­¾
        function addEventTag(eventType) {
            const tag = document.createElement('span');
            tag.className = 'event-tag';
            tag.dataset.event = eventType;
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = eventType;
            
            const removeBtn = document.createElement('button');
            removeBtn.textContent = '\u00D7';
            removeBtn.addEventListener('click', () => {
                removeCustomEvent(eventType);
            });
            
            tag.appendChild(nameSpan);
            tag.appendChild(removeBtn);
            eventListeners.appendChild(tag);
        }

        // æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬
        function addCustomEventListener(eventType) {
            if (!eventType || customEventTypes.has(eventType)) return;
            
            customEventTypes.add(eventType);
            addEventTag(eventType);

            if (eventSource && eventSource.readyState === EventSource.OPEN) {
                attachCustomListener(eventType);
            }
        }

        // ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬
        function removeCustomEvent(eventType) {
            customEventTypes.delete(eventType);
            const tag = eventListeners.querySelector('[data-event="' + eventType + '"]');
            if (tag) tag.remove();
        }

        // é™„åŠ è‡ªå®šä¹‰ç›‘å¬å™¨
        function attachCustomListener(eventType) {
            if (!eventSource) return;
            eventSource.addEventListener(eventType, (e) => {
                stats.total++;
                stats.custom++;
                updateStats();
                
                let data = e.data;
                try {
                    const json = JSON.parse(e.data);
                    data = JSON.stringify(json, null, 2);
                } catch (err) {}
                
                addLog('custom', eventType, data, e.lastEventId);
                if (e.lastEventId) lastEventId = e.lastEventId;
            });
        }

        // è¿æ¥SSE
        function connect() {
            const url = sseUrl.value.trim();
            if (!url) {
                addLog('error', 'error', 'è¯·è¾“å…¥SSEç«¯ç‚¹URL', null);
                return;
            }

            updateStatus('connecting');
            addLog('system', 'system', 'æ­£åœ¨è¿æ¥åˆ° ' + url + '...', null);

            try {
                eventSource = new EventSource(url, {
                    withCredentials: withCredentials.checked
                });

                eventSource.onopen = () => {
                    updateStatus('open');
                    setControlsEnabled(true);
                    addLog('system', 'system', 'è¿æ¥æˆåŠŸï¼', null);
                    
                    // é™„åŠ æ‰€æœ‰è‡ªå®šä¹‰ç›‘å¬å™¨
                    customEventTypes.forEach(type => attachCustomListener(type));
                };

                eventSource.onmessage = (e) => {
                    stats.total++;
                    stats.message++;
                    updateStats();
                    
                    let data = e.data;
                    try {
                        const json = JSON.parse(e.data);
                        data = JSON.stringify(json, null, 2);
                    } catch (err) {}
                    
                    addLog('message', 'message', data, e.lastEventId);
                    if (e.lastEventId) lastEventId = e.lastEventId;
                };

                eventSource.onerror = (e) => {
                    stats.error++;
                    updateStats();

                    if (eventSource.readyState === EventSource.CONNECTING) {
                        stats.reconnect++;
                        updateStats();
                        updateStatus('connecting');
                        addLog('system', 'system', 'è¿æ¥æ–­å¼€ï¼Œæ­£åœ¨å°è¯•é‡è¿...', null);
                        reconnectInfo.textContent = 'é‡è¿æ¬¡æ•°: ' + stats.reconnect;
                    } else if (eventSource.readyState === EventSource.CLOSED) {
                        updateStatus('closed');
                        setControlsEnabled(false);
                        addLog('error', 'error', 'è¿æ¥å·²å…³é—­', null);
                    }
                };

            } catch (error) {
                updateStatus('closed');
                addLog('error', 'error', 'è¿æ¥å¤±è´¥: ' + error.message, null);
            }
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            if (eventSource) {
                eventSource.close();
                eventSource = null;
                updateStatus('closed');
                setControlsEnabled(false);
                addLog('system', 'system', 'å·²æ‰‹åŠ¨æ–­å¼€è¿æ¥', null);
                reconnectInfo.textContent = '';
            }
        }

        // äº‹ä»¶ç»‘å®š
        connectBtn.addEventListener('click', connect);
        disconnectBtn.addEventListener('click', disconnect);
        
        clearLog.addEventListener('click', () => {
            eventLog.textContent = '';
            addLog('system', 'system', 'æ—¥å¿—å·²æ¸…ç©º', null);
        });

        addEventBtn.addEventListener('click', () => {
            const eventType = customEventInput.value.trim();
            if (eventType) {
                addCustomEventListener(eventType);
                customEventInput.value = '';
            }
        });

        customEventInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addEventBtn.click();
            }
        });

        sseUrl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                connect();
            }
        });

        // ç­›é€‰å™¨äº‹ä»¶
        Object.values(filters).forEach(checkbox => {
            checkbox.addEventListener('change', applyFilters);
        });
    
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', newTheme);
    }


</script>
</body>
</html>

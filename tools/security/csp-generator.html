<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="keywords" content="csp-generator,security,tools,webutils" />
    <meta name="author" content="WebUtils" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://tools.realtime-ai.chat/tools/security/csp-generator.html" />

    <!-- Open Graph -->
    <meta property="og:title" content="CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:description" content="CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://tools.realtime-ai.chat/tools/security/csp-generator.html"
    />
    <meta property="og:site_name" content="WebUtils" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:image" content="https://tools.realtime-ai.chat/social-preview.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:image:type" content="image/png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:description" content="CSP ç­–ç•¥ç”Ÿæˆå™¨ - WebUtils" />
    <meta name="twitter:image" content="https://tools.realtime-ai.chat/social-preview.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      :root {
        --bg-deep: #0a0a0f;
        --bg-surface: #12121a;
        --bg-card: #1a1a24;
        --bg-input: #0e0e14;
        --text-primary: #e8e8ed;
        --text-secondary: #8888a0;
        --text-muted: #55556a;
        --border-subtle: #2a2a3a;
        --border-strong: #3a3a4a;
        --accent-cyan: #00f5d4;
        --accent-green: #10b981;
        --accent-red: #f43f5e;
        --accent-yellow: #fbbf24;
        --accent-purple: #a855f7;
        --glow-cyan: rgb(0, 245, 212, 0.15);
        --glow-green: rgb(16, 185, 129, 0.15);
        --glow-red: rgb(244, 63, 94, 0.15);
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
      }

      [data-theme="light"] {
        --bg-deep: #fafafa;
        --bg-surface: #fff;
        --bg-card: #fff;
        --bg-input: #f5f5f5;
        --bg-hover: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --text-muted: #999;
        --border-subtle: #e5e5e5;
        --border-strong: #d5d5d5;
      }

      :root {
        --primary-color: #3b82f6;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --error-color: #ef4444;
      }

      body {
        min-height: 100vh;
        padding: 2rem 1rem;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: var(--pico-primary);
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        cursor: pointer;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      .directive-card {
        background: var(--pico-card-background-color);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .directive-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }

      .directive-name {
        font-weight: 600;
        color: var(--pico-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .directive-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .directive-toggle input[type="checkbox"] {
        margin: 0;
      }

      .source-options {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }

      .source-chip {
        padding: 0.35rem 0.75rem;
        border-radius: 2rem;
        border: 2px solid var(--pico-muted-border-color);
        background: transparent;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
      }

      .source-chip:hover {
        border-color: var(--pico-primary);
      }

      .source-chip.selected {
        background: var(--pico-primary);
        border-color: var(--pico-primary);
        color: white;
      }

      .custom-sources {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .custom-sources input {
        flex: 1;
        min-width: 200px;
        margin: 0;
        padding: 0.5rem;
      }

      .custom-sources button {
        padding: 0.5rem 1rem;
        margin: 0;
      }

      .custom-source-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        background: var(--pico-secondary-background);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
      }

      .custom-source-tag button {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
        font-size: 1rem;
        line-height: 1;
      }

      .output-section {
        margin-top: 2rem;
      }

      .output-card {
        background: var(--pico-card-background-color);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .output-card h3 {
        margin-top: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .output-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid var(--pico-muted-border-color);
        padding-bottom: 0.5rem;
      }

      .output-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 4px 4px 0 0;
        transition: all 0.2s;
      }

      .output-tab.active {
        background: var(--pico-primary);
        color: white;
      }

      .output-content {
        background: var(--pico-secondary-background);
        border-radius: 8px;
        padding: 1rem;
        font-family: Monaco, Menlo, "Ubuntu Mono", monospace;
        font-size: 0.85rem;
        word-break: break-all;
        white-space: pre-wrap;
        min-height: 100px;
        max-height: 300px;
        overflow-y: auto;
      }

      .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      .presets {
        margin-bottom: 2rem;
      }

      .preset-btn {
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .info-box {
        background: var(--pico-secondary-background);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 2rem;
        font-size: 0.9rem;
      }

      .directive-desc {
        font-size: 0.85rem;
        color: var(--pico-muted-color);
        margin-bottom: 0.5rem;
      }

      @media (max-width: 768px) {
        .directive-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }
      }

      .breadcrumb {
        background: rgba(255, 255, 255, 0.95);
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.85rem;
      }
      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .breadcrumb span {
        color: #999;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <nav class="breadcrumb">
      <a href="../../index.html">é¦–é¡µ</a>
      <span>â€º</span>
      CSP ç­–ç•¥ç”Ÿæˆå™¨
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>

    <main class="container">
      <a
        href="../../index.html"
        style="
          display: inline-block;
          margin-bottom: 1rem;
          color: var(--pico-primary);
          text-decoration: none;
        "
      >
        â† è¿”å›é¦–é¡µ
      </a>
      <header>
        <h1>ğŸ›¡ï¸ CSP ç­–ç•¥ç”Ÿæˆå™¨</h1>
        <p>å¯è§†åŒ–ç”Ÿæˆ Content-Security-Policy å®‰å…¨ç­–ç•¥å¤´</p>
      </header>

      <section class="presets">
        <strong>å¿«é€Ÿé¢„è®¾ï¼š</strong>
        <button class="preset-btn secondary outline" onclick="applyPreset('strict')">
          ä¸¥æ ¼æ¨¡å¼
        </button>
        <button class="preset-btn secondary outline" onclick="applyPreset('moderate')">
          ä¸­ç­‰å®‰å…¨
        </button>
        <button class="preset-btn secondary outline" onclick="applyPreset('relaxed')">
          å®½æ¾æ¨¡å¼
        </button>
        <button class="preset-btn secondary outline" onclick="applyPreset('clear')">
          æ¸…ç©ºæ‰€æœ‰
        </button>
      </section>

      <section id="directivesSection">
        <!-- æŒ‡ä»¤å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
      </section>

      <section class="output-section">
        <div class="output-card">
          <h3>ğŸ“„ ç”Ÿæˆçš„ CSP ç­–ç•¥</h3>
          <div class="output-tabs">
            <button class="output-tab active" onclick="switchTab('header')">HTTP Header</button>
            <button class="output-tab" onclick="switchTab('meta')">Meta æ ‡ç­¾</button>
            <button class="output-tab" onclick="switchTab('nginx')">Nginx é…ç½®</button>
            <button class="output-tab" onclick="switchTab('apache')">Apache é…ç½®</button>
          </div>
          <div class="output-content" id="outputContent"></div>
          <div class="btn-group">
            <button onclick="copyOutput()">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
            <button class="secondary" onclick="downloadOutput()">ğŸ’¾ ä¸‹è½½é…ç½®</button>
          </div>
        </div>
      </section>

      <div class="info-box">
        <h4>ğŸ’¡ CSP ä½¿ç”¨æç¤º</h4>
        <ul>
          <li>
            <code>'self'</code>
            - ä»…å…è®¸åŒæºèµ„æº
          </li>
          <li>
            <code>'none'</code>
            - ç¦æ­¢æ‰€æœ‰èµ„æº
          </li>
          <li>
            <code>'unsafe-inline'</code>
            - å…è®¸å†…è”è„šæœ¬/æ ·å¼ï¼ˆæœ‰å®‰å…¨é£é™©ï¼‰
          </li>
          <li>
            <code>'unsafe-eval'</code>
            - å…è®¸ eval() å‡½æ•°ï¼ˆæœ‰å®‰å…¨é£é™©ï¼‰
          </li>
          <li>
            <code>https:</code>
            - ä»…å…è®¸ HTTPS èµ„æº
          </li>
          <li>
            <code>data:</code>
            - å…è®¸ data: URI èµ„æº
          </li>
          <li>
            <code>blob:</code>
            - å…è®¸ blob: URI èµ„æº
          </li>
        </ul>
      </div>
    </main>

    <script>
      // ä¸»é¢˜åˆ‡æ¢
      window.toggleTheme = function () {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        document.querySelector(".theme-toggle").textContent = newTheme === "light" ? "ğŸŒ™" : "â˜€ï¸";
        localStorage.setItem("theme", newTheme);
      };

      const savedTheme = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", savedTheme);
      document.querySelector(".theme-toggle").textContent = savedTheme === "light" ? "ğŸŒ™" : "â˜€ï¸";

      // CSP æŒ‡ä»¤å®šä¹‰
      const directives = [
        { name: "default-src", desc: "é»˜è®¤ç­–ç•¥ï¼Œå…¶ä»–æŒ‡ä»¤çš„åå¤‡å€¼", icon: "ğŸ " },
        { name: "script-src", desc: "æ§åˆ¶ JavaScript è„šæœ¬çš„åŠ è½½æ¥æº", icon: "ğŸ“œ" },
        { name: "style-src", desc: "æ§åˆ¶ CSS æ ·å¼è¡¨çš„åŠ è½½æ¥æº", icon: "ğŸ¨" },
        { name: "img-src", desc: "æ§åˆ¶å›¾ç‰‡èµ„æºçš„åŠ è½½æ¥æº", icon: "ğŸ–¼ï¸" },
        { name: "font-src", desc: "æ§åˆ¶å­—ä½“æ–‡ä»¶çš„åŠ è½½æ¥æº", icon: "ğŸ”¤" },
        { name: "connect-src", desc: "æ§åˆ¶ XHRã€WebSocket ç­‰è¿æ¥ç›®æ ‡", icon: "ğŸ”—" },
        { name: "media-src", desc: "æ§åˆ¶éŸ³é¢‘å’Œè§†é¢‘èµ„æºçš„åŠ è½½æ¥æº", icon: "ğŸ¬" },
        { name: "object-src", desc: "æ§åˆ¶ Flash å’Œå…¶ä»–æ’ä»¶çš„åŠ è½½æ¥æº", icon: "ğŸ“¦" },
        { name: "frame-src", desc: "æ§åˆ¶ iframe æ¡†æ¶çš„æ¥æº", icon: "ğŸ–¥ï¸" },
        { name: "frame-ancestors", desc: "æ§åˆ¶å“ªäº›é¡µé¢å¯ä»¥åµŒå…¥å½“å‰é¡µé¢", icon: "ğŸ‘¨â€ğŸ‘§" },
        { name: "worker-src", desc: "æ§åˆ¶ Web Worker è„šæœ¬çš„æ¥æº", icon: "ğŸ‘·" },
        { name: "base-uri", desc: "é™åˆ¶ base å…ƒç´ çš„ URL", icon: "ğŸ”—" },
        { name: "form-action", desc: "é™åˆ¶è¡¨å•æäº¤çš„ç›®æ ‡ URL", icon: "ğŸ“" },
        { name: "report-uri", desc: "æŒ‡å®š CSP è¿è§„æŠ¥å‘Šçš„æ¥æ”¶åœ°å€", icon: "ğŸ“Š" }
      ];

      const sourceOptions = [
        { value: "'self'", label: "'self'" },
        { value: "'none'", label: "'none'" },
        { value: "'unsafe-inline'", label: "'unsafe-inline'" },
        { value: "'unsafe-eval'", label: "'unsafe-eval'" },
        { value: "'strict-dynamic'", label: "'strict-dynamic'" },
        { value: "https:", label: "https:" },
        { value: "data:", label: "data:" },
        { value: "blob:", label: "blob:" },
        { value: "*", label: "* (ä»»æ„)" }
      ];

      // å­˜å‚¨çŠ¶æ€
      const state = {};
      directives.forEach((d) => {
        state[d.name] = {
          enabled: false,
          sources: [],
          customSources: []
        };
      });

      let currentTab = "header";

      // åˆå§‹åŒ–ç•Œé¢
      function initDirectives() {
        const container = document.getElementById("directivesSection");
        container.textContent = "";

        directives.forEach((directive) => {
          const card = document.createElement("div");
          card.className = "directive-card";
          card.id = "directive-" + directive.name;

          // Header
          const header = document.createElement("div");
          header.className = "directive-header";

          const nameDiv = document.createElement("div");
          nameDiv.className = "directive-name";
          nameDiv.textContent = directive.icon + " " + directive.name;

          const toggleDiv = document.createElement("div");
          toggleDiv.className = "directive-toggle";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = "toggle-" + directive.name;
          checkbox.onchange = function () {
            state[directive.name].enabled = this.checked;
            updateOutput();
          };

          const label = document.createElement("label");
          label.htmlFor = "toggle-" + directive.name;
          label.textContent = "å¯ç”¨";

          toggleDiv.appendChild(checkbox);
          toggleDiv.appendChild(label);
          header.appendChild(nameDiv);
          header.appendChild(toggleDiv);
          card.appendChild(header);

          // Description
          const desc = document.createElement("div");
          desc.className = "directive-desc";
          desc.textContent = directive.desc;
          card.appendChild(desc);

          // Source options
          const sourcesDiv = document.createElement("div");
          sourcesDiv.className = "source-options";

          sourceOptions.forEach((opt) => {
            const chip = document.createElement("button");
            chip.className = "source-chip";
            chip.textContent = opt.label;
            chip.dataset.value = opt.value;
            chip.dataset.directive = directive.name;
            chip.onclick = function () {
              this.classList.toggle("selected");
              const sources = state[directive.name].sources;
              const idx = sources.indexOf(opt.value);
              if (idx === -1) {
                sources.push(opt.value);
              } else {
                sources.splice(idx, 1);
              }
              updateOutput();
            };
            sourcesDiv.appendChild(chip);
          });
          card.appendChild(sourcesDiv);

          // Custom sources
          const customDiv = document.createElement("div");
          customDiv.className = "custom-sources";

          const customInput = document.createElement("input");
          customInput.type = "text";
          customInput.placeholder = "æ·»åŠ è‡ªå®šä¹‰æ¥æº (å¦‚: https://cdn.example.com)";
          customInput.id = "custom-" + directive.name;

          const addBtn = document.createElement("button");
          addBtn.className = "secondary";
          addBtn.textContent = "æ·»åŠ ";
          addBtn.onclick = function () {
            const input = document.getElementById("custom-" + directive.name);
            const value = input.value.trim();
            if (value && state[directive.name].customSources.indexOf(value) === -1) {
              state[directive.name].customSources.push(value);
              input.value = "";
              renderCustomSources(directive.name);
              updateOutput();
            }
          };

          customDiv.appendChild(customInput);
          customDiv.appendChild(addBtn);
          card.appendChild(customDiv);

          // Custom sources tags container
          const tagsDiv = document.createElement("div");
          tagsDiv.id = "tags-" + directive.name;
          tagsDiv.style.marginTop = "0.5rem";
          tagsDiv.style.display = "flex";
          tagsDiv.style.flexWrap = "wrap";
          tagsDiv.style.gap = "0.5rem";
          card.appendChild(tagsDiv);

          container.appendChild(card);
        });

        updateOutput();
      }

      function renderCustomSources(directiveName) {
        const tagsDiv = document.getElementById("tags-" + directiveName);
        tagsDiv.textContent = "";

        state[directiveName].customSources.forEach((source, index) => {
          const tag = document.createElement("span");
          tag.className = "custom-source-tag";
          tag.textContent = source + " ";

          const removeBtn = document.createElement("button");
          removeBtn.textContent = "Ã—";
          removeBtn.onclick = function () {
            state[directiveName].customSources.splice(index, 1);
            renderCustomSources(directiveName);
            updateOutput();
          };
          tag.appendChild(removeBtn);
          tagsDiv.appendChild(tag);
        });
      }

      function generateCSP() {
        const parts = [];

        directives.forEach((d) => {
          const s = state[d.name];
          if (s.enabled) {
            const allSources = s.sources.concat(s.customSources);
            if (allSources.length > 0) {
              parts.push(d.name + " " + allSources.join(" "));
            } else {
              parts.push(d.name + " 'none'");
            }
          }
        });

        return parts.join("; ");
      }

      function updateOutput() {
        const csp = generateCSP();
        const outputDiv = document.getElementById("outputContent");

        if (!csp) {
          outputDiv.textContent = "// è¯·å¯ç”¨å¹¶é…ç½®è‡³å°‘ä¸€ä¸ªæŒ‡ä»¤";
          return;
        }

        let output = "";
        switch (currentTab) {
          case "header":
            output = "Content-Security-Policy: " + csp;
            break;
          case "meta":
            output = '<meta http-equiv="Content-Security-Policy" content="' + csp + '">';
            break;
          case "nginx":
            output = 'add_header Content-Security-Policy "' + csp + '" always;';
            break;
          case "apache":
            output = 'Header set Content-Security-Policy "' + csp + '"';
            break;
        }

        outputDiv.textContent = output;
      }

      window.switchTab = function (tab) {
        currentTab = tab;
        document.querySelectorAll(".output-tab").forEach((t) => {
          t.classList.toggle(
            "active",
            t.textContent.toLowerCase().indexOf(tab) !== -1 ||
              (tab === "header" && t.textContent === "HTTP Header") ||
              (tab === "meta" && t.textContent === "Meta æ ‡ç­¾") ||
              (tab === "nginx" && t.textContent === "Nginx é…ç½®") ||
              (tab === "apache" && t.textContent === "Apache é…ç½®")
          );
        });
        document.querySelectorAll(".output-tab").forEach((t, i) => {
          const tabs = ["header", "meta", "nginx", "apache"];
          t.classList.toggle("active", tabs[i] === tab);
        });
        updateOutput();
      };

      window.applyPreset = function (preset) {
        // é‡ç½®æ‰€æœ‰
        directives.forEach((d) => {
          state[d.name].enabled = false;
          state[d.name].sources = [];
          state[d.name].customSources = [];
        });

        if (preset === "strict") {
          state["default-src"].enabled = true;
          state["default-src"].sources = ["'none'"];
          state["script-src"].enabled = true;
          state["script-src"].sources = ["'self'"];
          state["style-src"].enabled = true;
          state["style-src"].sources = ["'self'"];
          state["img-src"].enabled = true;
          state["img-src"].sources = ["'self'"];
          state["font-src"].enabled = true;
          state["font-src"].sources = ["'self'"];
          state["connect-src"].enabled = true;
          state["connect-src"].sources = ["'self'"];
          state["frame-ancestors"].enabled = true;
          state["frame-ancestors"].sources = ["'none'"];
          state["base-uri"].enabled = true;
          state["base-uri"].sources = ["'self'"];
          state["form-action"].enabled = true;
          state["form-action"].sources = ["'self'"];
        } else if (preset === "moderate") {
          state["default-src"].enabled = true;
          state["default-src"].sources = ["'self'"];
          state["script-src"].enabled = true;
          state["script-src"].sources = ["'self'", "'unsafe-inline'"];
          state["style-src"].enabled = true;
          state["style-src"].sources = ["'self'", "'unsafe-inline'"];
          state["img-src"].enabled = true;
          state["img-src"].sources = ["'self'", "data:", "https:"];
          state["font-src"].enabled = true;
          state["font-src"].sources = ["'self'", "https:"];
          state["connect-src"].enabled = true;
          state["connect-src"].sources = ["'self'", "https:"];
        } else if (preset === "relaxed") {
          state["default-src"].enabled = true;
          state["default-src"].sources = ["'self'", "https:"];
          state["script-src"].enabled = true;
          state["script-src"].sources = ["'self'", "'unsafe-inline'", "'unsafe-eval'", "https:"];
          state["style-src"].enabled = true;
          state["style-src"].sources = ["'self'", "'unsafe-inline'", "https:"];
          state["img-src"].enabled = true;
          state["img-src"].sources = ["*", "data:", "blob:"];
        }

        // æ›´æ–° UI
        directives.forEach((d) => {
          const checkbox = document.getElementById("toggle-" + d.name);
          checkbox.checked = state[d.name].enabled;

          const chips = document.querySelectorAll("#directive-" + d.name + " .source-chip");
          chips.forEach((chip) => {
            chip.classList.toggle(
              "selected",
              state[d.name].sources.indexOf(chip.dataset.value) !== -1
            );
          });

          renderCustomSources(d.name);
        });

        updateOutput();
      };

      window.copyOutput = function () {
        const output = document.getElementById("outputContent").textContent;
        navigator.clipboard.writeText(output).then(() => {
          showToast("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        });
      };

      window.downloadOutput = function () {
        const csp = generateCSP();
        let content = "";
        let filename = "";

        switch (currentTab) {
          case "header":
          case "meta":
            content = document.getElementById("outputContent").textContent;
            filename = "csp-policy.txt";
            break;
          case "nginx":
            content =
              "# CSP Policy for Nginx\n" + document.getElementById("outputContent").textContent;
            filename = "csp-nginx.conf";
            break;
          case "apache":
            content =
              "# CSP Policy for Apache\n" + document.getElementById("outputContent").textContent;
            filename = "csp-apache.conf";
            break;
        }

        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      };

      function showToast(message) {
        const toast = document.createElement("div");
        toast.textContent = message;
        toast.style.cssText =
          "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#10b981;color:white;padding:0.75rem 1.5rem;border-radius:8px;z-index:1000;";
        document.body.appendChild(toast);
        setTimeout(function () {
          toast.remove();
        }, 2000);
      }

      // åˆå§‹åŒ–
      initDirectives();
    </script>
  </body>
</html>
